#include utest.vih
#include LogService.vih
#include QueryStr.vih
#include Query.vih

#component "TEST"

vipinterface TEST_QueryStrCommon implements oUTest, oLogServiceSet;
interface TEST_QueryStrCommon;

  var
    _logService: oLogService;

  procedure SetLogService(logService: oLogService); { _logService := logService; }

  function GetDescription: string; { result := 'utils/tests/test_QueryStrCommon.vip TEST_QueryStrCommon'; }

  function Test: boolean;
  {
    result := false;

    var s: oQueryStr;
    s := oQueryStr(new(iQueryStrCommon, QueryStrCommon('select top 10 name from katmc')));

    var q: iQuery;
    var rs: iResultSet;

    var l: longint;
    sqlfreestr(l);
    s.Create(l);

    q := queryManager.createQuery(l);
    rs := q.getResultSet;
    if (rs = nullref or q.errorCode != tsOk)
    {
      _logService.Log('q.errorcode = '+q.errorCode);
      if (rs = nullref) _logService.Log('rs = nullref');
      exit;
    }

    _logService.Log('resultset.count = '+rs.count);

    result := rs.count > 0;
  }
end.
