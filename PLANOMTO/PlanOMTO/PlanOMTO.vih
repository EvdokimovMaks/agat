#ifndef __PlanOmto__
#define __PlanOmto__

#include IModify.vih
#include Query.vih
#include QueryText.vih
#include UserFilter.vih

#component "AGAT"

const
  //Статусы позиций заявок
  ClaimStateMadeoutTop       = 0001000000000043h;  //Папка - оформляемый
  ClaimStateMadeout          = 00010000000000F3h;  //Оформлена
  ClaimStateMadeoutReplacing = 00010000000000FCh;  //Заменяющая
  ClaimStateAcceptTop        = 0001000000000044h;  //Папка - исполняемый
  ClaimStateAccept           = 00010000000000F8h;  //Принята к исполнению
  ClaimStateAcceptReplacing  = 0001000000000119h;  //Заменяющая.Принята к исполнению
end;

table struct tPlanOmto (
  ClaimNrec         : comp,
  IndentNrec        : comp,
  ClaimState        : word,
  ClaimStateNrec    : comp,
  DeliverOrgNrec    : comp,
  KatstroyNrec      : comp,
  PersonNrec        : comp,
  DeviceNrec        : comp,
  GroupmcNrec       : comp,
  KatmcNrec         : comp,
  OtpedNrec         : comp,
  Tu                : string,
  Description       : string,
  ClaimQty          : double,
  ClaimPrice        : double,
  SaldoQty          : double,
  RegradeQty        : double,
  BasedocQty        : double,
  BasedocSum        : double,
  PaidSum           : double,
  DeliveredQty      : double,
  IssuedQty         : double,
  IndentDate        : date,
  IndentDeliverDate : date,
  ClaimAcceptDate   : date,
  DeliverDatePlan   : date,
  DeliverDateChanged: date,
  DeliverDateFact   : date,
  BasedocDate       : date,
  PaidDate          : date
) with index (
  i01 = ClaimNrec
);

type ttplanOmto = record as table tPlanOmto;

vipinterface PlanOmtoFilters(UserFilterGroup);
public:
  constructor Init;
  property GroupmcFilter    : IUserFilterByMarker;
  property KatmcFilter      : IUserFilterByMarker;
  property IndentFilter     : IUserFilterByMarker;
  property KatstroyFilter   : IUserFilterByMarker;
  property PersonFilter     : IUserFilterByMarker;
  property DeliverOrgFilter : IUserFilterByMarker;
  property BasedocFilter    : IUserFilterByMarker;
  property ClaimStatusFilter: IUserFilterByMarker;
  property PriorityFilter   : IUserFilterByMarker;
  property BasedocDateFilter: IUserFilterByPeriod;
end;

vipinterface PlanOmtoQueryText implements ISqlString;
public:
  constructor PlanOmtoQueryText(filters: PlanOmtoFilters);
end;

objinterface IPlanOmto;
  procedure Load;
  procedure Save;
  procedure SetAccept(value: boolean);
  property ClaimNrec         : comp;
  property IndentNrec        : comp;
  property ClaimState        : word;
  property ClaimStateNrec    : comp;
  property DeliverOrgNrec    : comp;
  property KatstroyNrec      : comp;
  property PersonNrec        : comp;
  property DeviceNrec        : comp;
  property GroupmcNrec       : comp;
  property KatmcNrec         : comp;
  property OtpedNrec         : comp;
  property Tu                : string;
  property Description       : string;
  property ClaimQty          : double;
  property ClaimPrice        : double;
  property SaldoQty          : double;
  property RegradeQty        : double;
  property BasedocQty        : double;
  property BasedocSum        : double;
  property PaidSum           : double;
  property DeliveredQty      : double;
  property IssuedQty         : double;
  property IndentDate        : date;
  property IndentDeliverDate : date;
  property ClaimAcceptDate   : date;
  property DeliverDatePlan   : date;
  property DeliverDateChanged: date;
  property DeliverDateFact   : date;
  property BasedocDate       : date;
  property PaidDate          : date;

  index iByClaimNrec = ClaimNrec;
end;

objinterface IPlanOmtoDataProvider;
  function Load: IResultSet;
end;

objinterface IPlanOmtoDataSaver;
  procedure Save(aPlanOmto: IPlanOmto);
end;

vipinterface PlanOmtoDataProvider implements IPlanOmtoDataProvider;
public:
  constructor Create(aSqlString: ISqlString);
  property SqlString: ISqlString;
end;

vipinterface PlanOmtoDataSaverCurrent implements IPlanOmtoDataSaver;

vipinterface PlanOmto implements IPlanOmto, IModify;
public:
  constructor Init;
  constructor Create(aDataProvider: IPlanOmtoDataProvider; aDataSaver: IPlanOmtoDataSaver);
  property DataProvider: IPlanOmtoDataProvider;
  property DataSaver: IPlanOmtoDataSaver;
end;

vipinterface PlanOmtoView;
public:
  constructor Create(aPlanOmto: IPlanOmto);
  procedure Refresh;
  property PlanOmto: IPlanOmto;
end;

vipinterface PlanOmtoFiltersView;
public:
  constructor Create(aFilters: PlanOmtoFilters);
  property Filters: PlanOmtoFilters;
  event procedure OnClickRefresh;
end;

#end
