#include orgkpp.vih

#component "AGAT"

interface OrgKPPHelper;

var
  _orgkppVM: IOrgKPPViewModel;
  _orgkppView: OrgKPPView new;

constructor Init;
{
  if loadvipref(_orgkppVM, 'AGAT::OrgKPPViewModel')
  {
    _orgkppView.vm := _orgkppVM;
    result := true;
  }
  else
    result := false;
}

window wSelectKPP 'ÇÎ°Æ‡ äèè' doaccept, escclose;
  embedded sc1 interface _orgkppView;
  end;
end;

function PickKPPByINN(aINN: string; var aKPP: string): boolean;
{
  _orgkppVM.SetINN(aINN);
  if runwindowmodal(wSelectKPP) = cmDefault
  {
    aKPP := _orgkppVM.KPP;
    result := true;
  }
  else
    result := false;
}

end.

interface OrgKPPHelperTest;
var _helper: OrgKPPHelper;
screen sc1
<<

>>
end;
handleevent
cmInit:
{
  var s: string;
  if _helper.PickKPPByINN('1234', s)
    message('Selected '+s)
  else
    message('Selected nothing');
}
end;
end.
