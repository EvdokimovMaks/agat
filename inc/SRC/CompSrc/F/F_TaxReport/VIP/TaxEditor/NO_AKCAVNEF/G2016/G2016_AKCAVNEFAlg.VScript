//------------------------------------------------------------------------------------------------------------
//                                                                                    (c) корпорация Галактика
// Галактика 9.1 - модуль "Электронная отчетность"
// Алгоритмы расчета : "Декларация по акцизам на автомобильный бензин (1151089)"
//------------------------------------------------------------------------------------------------------------


//============================================================================================================
//#region СЕРВИСНЫЕ МЕТОДЫ
//------------------------------------------------------------------------------------------------------------
@Script GetStrVal(fld:string):string;
@begin
  Result := Trim(String(XMLMAP.GetAttrValueByName(fld)));
@end.

//------------------------------------------------------------------------------------------------------------
@Script GetStrValFormat(fld:string):string;
@begin
  var bufRes: string;

  bufRes := Trim(String(XMLMAP.GetAttrValueByName(fld)));

  if (bufRes = '')
  then Result := '0'
  else if (Double(bufRes) < 0)
       then Result := '('+bufRes+')'
       else Result := bufRes;
@end.

//------------------------------------------------------------------------------------------------------------
@Script GetDblVal(fld:string):double;
@begin
  Result := Double(XMLMAP.GetAttrValueByName(fld));
@end.

//------------------------------------------------------------------------------------------------------------
@Script GetDateVal(fld:string):date;
@begin
  Result := XMLMAP.GetDateAttrValueByName(fld);
@end.

//------------------------------------------------------------------------------------------------------------
@Script GetFldVis(fld:string):boolean;
@begin
  Result := False;
  Result := XMLMAP.GetAttrVisByName(fld);
@end.

//------------------------------------------------------------------------------------------------------------
@Script GetFldVisInTree(fld:string):boolean;
@begin
  Result := XMLMAP.GetAttrVisByNameInTree(fld);
@end.

//------------------------------------------------------------------------------------------------------------
@Script GetPatVal(expr:string):double;
#include AllTaxObj.Vih
@begin
  Result := Double(ПАТ(expr));
@end.

//------------------------------------------------------------------------------------------------------------
@Script SetDblVal(fld:string;val:double);
@begin
  XMLMAP.SetVariantAttrValueByName_Formula(fld, val, 2);
@end.

//------------------------------------------------------------------------------------------------------------
@Script SetFldVal(fld:string; val:string);
@begin
  XMLMAP.SetVariantAttrValueByName_Formula(fld, string(val), 2);
@end.

//------------------------------------------------------------------------------------------------------------
@Script SetNulVal(fld:string);
@begin
  XMLMAP.SetStringAttrValueByName_Formula(fld, '', 2);
@end.

//------------------------------------------------------------------------------------------------------------
@Script SetFldVis(fld:string;vis:boolean);
@begin
  XMLMAP.SetAttrVisByName(fld,vis);
@end.

//------------------------------------------------------------------------------------------------------------
@Script MesErrStop(mesMesAdrXML, mesPole, mesMes: string; mesCountIter : integer = 0; mesMod : integer = 0): boolean;
@begin
  MesError.InsertMesError(mesMesAdrXML, Comp(0), '', mesPole, mesMes, mesCountIter, mesMod);
  Result := True;
@end.

//------------------------------------------------------------------------------------------------------------
@Script GetIter(iter:longint):string;
@begin
  Result := '';

  if (iter > 0)
    Result := '[' + String(iter) + ']';
@end.

//------------------------------------------------------------------------------------------------------------
@Script DTS_I(zName: string): string;
@begin
  Result := DoubleToStr(Round(Double(zName)), '[|-]366666666666666666666');
@end.

//------------------------------------------------------------------------------------------------------------
@Script GetStrNull(fld:string):boolean;
@begin
  Result := XMLMAP.GetIsNullAttrValueByName(fld);
@end.
//#endregion СЕРВИСНЫЕ МЕТОДЫ
//************************************************************************************************************


//============================================================================================================
//#region ДЕЙСТВИЯ ВЫПОЛНЯЕМЫЕ ПРИ УСТАНОВКЕ ВИДИМОСТИ ПОЛЕЙ
//------------------------------------------------------------------------------------------------------------
@Script On_Visable : boolean;
  //==========================================================================================================
  //#region СЕРВИС On_Visable
  //----------------------------------------------------------------------------------------------------------
  #declare IfVis(adrIfVis)
    SetFldVis(#adrIfVis, not GetStrNull(#adrIfVis));
  #end

  #declare SetVisF(adrIfVis)
    SetFldVis(#adrIfVis, False);
  #end

  #declare SetVisT(adrIfVis)
    SetFldVis(#adrIfVis, True);
  #end
  //#endregion СЕРВИС On_Visable
  //**********************************************************************************************************
@begin
  // #region Файл/Документ/СвНП
  #IfVis('Файл/Документ/СвНП/Тлф')

  var buf : string;
  buf := GetStrVal('Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ/ФормРеорг');

  if (buf = '0')
  {
    #SetVisT('Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ'      )
    #SetVisF('Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ/ИННЮЛ')
    #SetVisF('Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ/КПП'  )
  }
  else
  {
    if    (buf = '1')
       or (buf = '2')
       or (buf = '3')
       or (buf = '5')
       or (buf = '6')
    {
      #SetVisT('Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ'      )
      #SetVisT('Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ/ИННЮЛ')
      #SetVisT('Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ/КПП'  )
    }
    else #SetVisF('Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ');
  }
  // #endregion

  // #region Файл/Документ/СвНП
  if     not GetStrNull('Файл/Документ/Подписант/ФИО/Фамилия')
     and not GetStrNull('Файл/Документ/Подписант/ФИО/Имя'    )
  {
    #SetVisT('Файл/Документ/Подписант/ФИО'         )
    #IfVis  ('Файл/Документ/Подписант/ФИО/Отчество')
  }
  else #SetVisF('Файл/Документ/Подписант/ФИО')

  if    (GetStrVal('Файл/Документ/Подписант/ПрПодп') = '2')
     or not GetStrNull('Файл/Документ/Подписант/СвПред/НаимДок')
  {
    #SetVisT('Файл/Документ/Подписант/СвПред'        )
    #IfVis  ('Файл/Документ/Подписант/СвПред/НаимОрг')
  }
  else #SetVisF('Файл/Документ/Подписант/СвПред')
  // #endregion Файл/Документ/Подписант

  var CountI, CountJ, I, J : integer;
  var XMLAdrI, XMLAdrJ : string;
  var fl : boolean;

  // #region Файл/Документ/АкцАвтоНефт/СумНалПУ
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/СумНалПУ');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/СумНалПУ' + getIter(i);
    fl := false;

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СумНалПУКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/СумНалПУКод' + getIter(j);

      if     not GetStrNull(XMLAdrJ + '/КБК'  )
         and not GetStrNull(XMLAdrJ + '/НалПУ')
      then { #SetVisT(XMLAdrJ) fl := true; }
      else   #SetVisF(XMLAdrJ)
    }

    if     fl
       and not GetStrNull(XMLAdrI + '/НалСвид')
       and not GetStrNull(XMLAdrI + '/ОКТМО'  )
    {
      #SetVisT(XMLAdrI            )
      #IfVis  (XMLAdrI + '/ПризНП')
    }
    else #SetVisF(XMLAdrI)
  } // #endregion Файл/Документ/АкцАвтоНефт/СумНалПУ

  // #region Файл/Документ/АкцАвтоНефт/РасчАкц
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкц');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкц' + getIter(i);
    fl := false;

    // #region Файл/Документ/АкцАвтоНефт/РасчАкц/ОперПТ
    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/ОперПТ/ОперПТКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/ОперПТ/ОперПТКод' + getIter(j);

      if     not GetStrNull(XMLAdrJ + '/КодПок'  )
         and not GetStrNull(XMLAdrJ + '/НалБаза' )
         and not GetStrNull(XMLAdrJ + '/СумАкциз')
      then { #SetVisT(XMLAdrJ) fl := true; }
      else   #SetVisF(XMLAdrJ)
    }
    // #endregion Файл/Документ/АкцАвтоНефт/РасчАкц/ОперПТ

    if     fl
       and not GetStrNull(XMLAdrI + '/КодПТ'           )
       and not GetStrNull(XMLAdrI + '/АкцизПУ/КодПок'  )
       and not GetStrNull(XMLAdrI + '/АкцизПУ/СумАкциз')
       and not GetStrNull(XMLAdrI + '/АкцизУм/КодПок'  )
       and not GetStrNull(XMLAdrI + '/АкцизУм/СумАкциз')
    {
      #SetVisT(XMLAdrI)

      // #region Файл/Документ/АкцАвтоНефт/РасчАкц/АкцизВозм
      fl := false;
      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВозм/АкцизВозмКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/АкцизВозм/АкцизВозмКод' + getIter(j);

        if     not GetStrNull(XMLAdrJ + '/КодПок'    )
           and not GetStrNull(XMLAdrJ + '/НалБаза'   )
           and not GetStrNull(XMLAdrJ + '/СумАкциз'  )
           and not GetStrNull(XMLAdrJ + '/НалПерЭксп')
           and not GetStrNull(XMLAdrJ + '/ГодЭксп'   )
        then { #SetVisT(XMLAdrJ) fl := true; }
        else   #SetVisF(XMLAdrJ)
      }

      if fl {
        #SetVisT(XMLAdrI + '/АкцизВозм')

        CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВозм/ПревУплВозм');
        for (j := 0; j < CountJ; j++)
        {
          XMLAdrJ := XMLAdrI + '/АкцизВозм/ПревУплВозм' + getIter(j);

          if     not GetStrNull(XMLAdrJ + '/СумАкциз')
             and not GetStrNull(XMLAdrJ + '/НалПер'  )
             and not GetStrNull(XMLAdrJ + '/Год'     )
          then #SetVisT(XMLAdrJ)
          else #SetVisF(XMLAdrJ)
        }
      }
      else  #SetVisF(XMLAdrI + '/АкцизВозм')
      // #endregion Файл/Документ/АкцАвтоНефт/РасчАкц/АкцизВозм

      // #region Файл/Документ/АкцАвтоНефт/РасчАкц/РеалПТБГ
      fl := false;
      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РеалПТБГ/РеалПТБГКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/РеалПТБГ/РеалПТБГКод' + getIter(j);

        if     not GetStrNull(XMLAdrJ + '/КодПок'  )
           and not GetStrNull(XMLAdrJ + '/НалБаза' )
           and not GetStrNull(XMLAdrJ + '/СумАкциз')
           and not GetStrNull(XMLAdrJ + '/НаличБГ' )
        then { #SetVisT(XMLAdrJ) fl := true; }
        else   #SetVisF(XMLAdrJ)
      }

      SetFldVis(XMLAdrI + '/РеалПТБГ', fl);
      // #endregion Файл/Документ/АкцАвтоНефт/РасчАкц/РеалПТБГ

      // #region Файл/Документ/АкцАвтоНефт/РасчАкц/РеалПТЕЭС
      fl := false;
      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РеалПТЕЭС/РеалПТЕЭСКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/РеалПТЕЭС/РеалПТЕЭСКод' + getIter(j);

        if     not GetStrNull(XMLAdrJ + '/КодПок'    )
           and not GetStrNull(XMLAdrJ + '/НалБаза'   )
           and not GetStrNull(XMLAdrJ + '/СумАкциз'  )
           and not GetStrNull(XMLAdrJ + '/НалПерРеал')
           and not GetStrNull(XMLAdrJ + '/ГодРеал'   )
        then { #SetVisT(XMLAdrJ) fl := true; }
        else   #SetVisF(XMLAdrJ)
      }

      SetFldVis(XMLAdrI + '/РеалПТЕЭС', fl);
      // #endregion Файл/Документ/АкцАвтоНефт/РасчАкц/РеалПТЕЭС

      // #region Файл/Документ/АкцАвтоНефт/РасчАкц/АкцизВыч
      fl := false;
      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВыч/АкцизВычКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/АкцизВыч/АкцизВычКод' + getIter(j);

        if     not GetStrNull(XMLAdrJ + '/КодПок'   )
           and not GetStrNull(XMLAdrJ + '/ОбъемРеал')
           and not GetStrNull(XMLAdrJ + '/СумВычет' )
        then { #SetVisT(XMLAdrJ) fl := true; }
        else   #SetVisF(XMLAdrJ)
      }

      SetFldVis(XMLAdrI + '/АкцизВыч', fl);
      // #endregion Файл/Документ/АкцАвтоНефт/РасчАкц/АкцизВыч
    }
    else #SetVisF(XMLAdrI)
  } // #endregion Файл/Документ/АкцАвтоНефт/РасчАкц

  // #region Файл/Документ/АкцАвтоНефт/РасчАкцГаз
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкцГаз');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкцГаз' + getIter(i);

    if     not GetStrNull(XMLAdrI + '/КодПТ'        )
       and not GetStrNull(XMLAdrI + '/КодПок'       )
       and not GetStrNull(XMLAdrI + '/КБК'          )
       and not GetStrNull(XMLAdrI + '/НомерСогл'    )
       and not GetStrNull(XMLAdrI + '/ДатаСогл'     )
       and not GetStrNull(XMLAdrI + '/ОбъемРеалГаз' )
       and not GetStrNull(XMLAdrI + '/СтоимЕдРеал'  )
       and not GetStrNull(XMLAdrI + '/СумТаможРеал' )
       and not GetStrNull(XMLAdrI + '/РасхТранспГаз')
       and not GetStrNull(XMLAdrI + '/НалБаза'      )
       and not GetStrNull(XMLAdrI + '/СумАкциз'     )
    then #SetVisT(XMLAdrI)
    else #SetVisF(XMLAdrI)
  } // #endregion Файл/Документ/АкцАвтоНефт/РасчАкцГаз

  // #region Файл/Документ/АкцАвтоНефт/РасчНалБаза
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчНалБаза');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчНалБаза' + getIter(i);
    fl := false;

    // #region Файл/Документ/АкцАвтоНефт/РасчНалБаза/РасчНалБазаКод
    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РасчНалБазаКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/РасчНалБазаКод' + getIter(j);

      if     not GetStrNull(XMLAdrJ + '/КодПок'  )
         and not GetStrNull(XMLAdrJ + '/МощнДвиг')
         and not GetStrNull(XMLAdrJ + '/КолПТ'   )
         and not GetStrNull(XMLAdrJ + '/НалБаза' )
      then { #SetVisT(XMLAdrJ) fl := true; }
      else   #SetVisF(XMLAdrJ)
    } // #endregion Файл/Документ/АкцАвтоНефт/РасчНалБаза/РасчНалБазаКод

    if     fl
       and not GetStrNull(XMLAdrI + '/КодПТ')
    then #SetVisT(XMLAdrI)
    else #SetVisF(XMLAdrI)
  } // #endregion Файл/Документ/АкцАвтоНефт/РасчНалБаза

  // #region Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп' + getIter(i);

    if     not GetStrNull(XMLAdrI + '/КодПТ'                )
       and not GetStrNull(XMLAdrI + '/ОбщКолБГПер'          )
       and not GetStrNull(XMLAdrI + '/ОбщСумБГПер'          )
       and not GetStrNull(XMLAdrI + '/АкОсвЭкспПер/ОбъемПТ' )
       and not GetStrNull(XMLAdrI + '/АкОсвЭкспПер/СумАкциз')
    {
      #SetVisT(XMLAdrI                        )
      #IfVis  (XMLAdrI + '/АкОсвБГЭкНеПдтвПер')
      #IfVis  (XMLAdrI + '/АкОсвБГЭкПдтвПред' )
      #IfVis  (XMLAdrI + '/АкОсвБГЭкПдтвКон'  )
      #IfVis  (XMLAdrI + '/АкОсвБГЭкНеПдтвКон')
      #IfVis  (XMLAdrI + '/ПрАкОсвБГПдтвКон'  )

      if     not GetStrNull(XMLAdrI + '/АкОсвЭкспПдтвПер/ОбъемПТ' )
         and not GetStrNull(XMLAdrI + '/АкОсвЭкспПдтвПер/СумАкциз')
      then #SetVisT(XMLAdrI + '/АкОсвЭкспПдтвПер')
      else #SetVisF(XMLAdrI + '/АкОсвЭкспПдтвПер')

      // #region Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп/БГОсвРеалЭксп
      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/БГОсвРеалЭксп');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/БГОсвРеалЭксп' + getIter(j);

        if     not GetStrNull(XMLAdrJ + '/ДатаВыдБГ')
           and not GetStrNull(XMLAdrJ + '/НомерБГ'  )
           and not GetStrNull(XMLAdrJ + '/ДатаНачБГ')
           and not GetStrNull(XMLAdrJ + '/ДатаКонБГ')
           and not GetStrNull(XMLAdrJ + '/СуммаБГ'  )
        {
          #SetVisT(XMLAdrJ)
          #IfVis  (XMLAdrJ + '/ПрАкЭкспПдтвКон')

          if     not GetStrNull(XMLAdrJ + '/АкОсвЭкспПер/ОбРеалЭкспПТ')
             and not GetStrNull(XMLAdrJ + '/АкОсвЭкспПер/СумАкциз'    )
          then #SetVisT(XMLAdrJ + '/АкОсвЭкспПер')
          else #SetVisF(XMLAdrJ + '/АкОсвЭкспПер')

          if     not GetStrNull(XMLAdrJ + '/АкЭкспНеПдтвНач/ОбРеалЭкспПТ')
             and not GetStrNull(XMLAdrJ + '/АкЭкспНеПдтвНач/СумАкциз'    )
             and not GetStrNull(XMLAdrJ + '/АкЭкспНеПдтвНач/НалПерЭксп'  )
             and not GetStrNull(XMLAdrJ + '/АкЭкспНеПдтвНач/ГодЭксп'     )
          then #SetVisT(XMLAdrJ + '/АкЭкспНеПдтвНач')
          else #SetVisF(XMLAdrJ + '/АкЭкспНеПдтвНач')

          if     not GetStrNull(XMLAdrJ + '/АкЭкспПдтвПер/ОбРеалЭкспПТ')
             and not GetStrNull(XMLAdrJ + '/АкЭкспПдтвПер/СумАкциз'    )
             and not GetStrNull(XMLAdrJ + '/АкЭкспПдтвПер/НалПерЭксп'  )
             and not GetStrNull(XMLAdrJ + '/АкЭкспПдтвПер/ГодЭксп'     )
          then #SetVisT(XMLAdrJ + '/АкЭкспПдтвПер')
          else #SetVisF(XMLAdrJ + '/АкЭкспПдтвПер')

          if     not GetStrNull(XMLAdrJ + '/АкЭкспПдтвПред/ОбРеалЭкспПТ')
             and not GetStrNull(XMLAdrJ + '/АкЭкспПдтвПред/СумАкциз'    )
          then #SetVisT(XMLAdrJ + '/АкЭкспПдтвПред')
          else #SetVisF(XMLAdrJ + '/АкЭкспПдтвПред')

          if     not GetStrNull(XMLAdrJ + '/АкЭкспПдтвКон/ОбРеалЭкспПТ')
             and not GetStrNull(XMLAdrJ + '/АкЭкспПдтвКон/СумАкциз'    )
             and not GetStrNull(XMLAdrJ + '/АкЭкспПдтвКон/НалПерЭксп'  )
             and not GetStrNull(XMLAdrJ + '/АкЭкспПдтвКон/ГодЭксп'     )
          then #SetVisT(XMLAdrJ + '/АкЭкспПдтвКон')
          else #SetVisF(XMLAdrJ + '/АкЭкспПдтвКон')

          if     not GetStrNull(XMLAdrJ + '/АкЭкспНеПдтвКон/ОбРеалЭкспПТ')
             and not GetStrNull(XMLAdrJ + '/АкЭкспНеПдтвКон/СумАкциз'    )
             and not GetStrNull(XMLAdrJ + '/АкЭкспНеПдтвКон/НалПерЭксп'  )
             and not GetStrNull(XMLAdrJ + '/АкЭкспНеПдтвКон/ГодЭксп'     )
          then #SetVisT(XMLAdrJ + '/АкЭкспНеПдтвКон')
          else #SetVisF(XMLAdrJ + '/АкЭкспНеПдтвКон')
        }
        else #SetVisF(XMLAdrJ)
      } // #endregion Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп/БГОсвРеалЭксп
    }
    else #SetVisF(XMLAdrI)
  } // #endregion Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп

  // #region Файл/Документ/АкцАвтоНефт/БензПолучСвид
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/БензПолучСвид');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/БензПолучСвид' + getIter(i);
    fl := false;

    // #region Файл/Документ/АкцАвтоНефт/БензПолучСвид/СвОбБензСчФ
    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СвОбБензСчФ');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/СвОбБензСчФ' + getIter(j);

      if     not GetStrNull(XMLAdrJ + '/НомСчФ' )
         and not GetStrNull(XMLAdrJ + '/ДатаСчФ')
         and not GetStrNull(XMLAdrJ + '/ОбСпСчФ')
      {
        #SetVisT(XMLAdrJ              )
        #IfVis  (XMLAdrJ + '/НомКСчФ' )
        #IfVis  (XMLAdrJ + '/ДатаКСчФ')
        #IfVis  (XMLAdrJ + '/ОбСпКСчФ')

        fl := true;
      }
      else #SetVisF(XMLAdrJ)
    } // #endregion Файл/Документ/АкцАвтоНефт/БензПолучСвид/СвОбБензСчФ

    if     not GetStrNull(XMLAdrI + '/ПоставОрг/НаимОрг')
       and not GetStrNull(XMLAdrI + '/ПоставОрг/ИННЮЛ'  )
       and not GetStrNull(XMLAdrI + '/ПоставОрг/КПП'    )
    {
      #SetVisT(XMLAdrI + '/ПоставОрг')
      #SetVisF(XMLAdrI + '/ПоставИП' )
    } else {
      if     not GetStrNull(XMLAdrI + '/ПоставИП/ИННФЛ'      )
         and not GetStrNull(XMLAdrI + '/ПоставИП/ФИО/Фамилия')
         and not GetStrNull(XMLAdrI + '/ПоставИП/ФИО/Имя'    )
      {
        #SetVisT(XMLAdrI + '/ПоставИП' )
        #SetVisF(XMLAdrI + '/ПоставОрг')

        #IfVis  (XMLAdrI + '/ПоставИП/ФИО/Отчество')
      } else {
        #SetVisF(XMLAdrI + '/ПоставОрг')
        #SetVisF(XMLAdrI + '/ПоставИП')
      }
    }

    if     fl
       and not GetStrNull(XMLAdrI + '/СерСвидПост'                   )
       and not GetStrNull(XMLAdrI + '/НомСвидПост'                   )
       and not GetStrNull(XMLAdrI + '/ОбПолБензПер650/КодПТ'         )
       and not GetStrNull(XMLAdrI + '/ОбПолБензПер650/ОбПолучБензПер')
       and   ( GetFldVis (XMLAdrI + '/ПоставОрг'                     )
            or GetFldVis (XMLAdrI + '/ПоставИП'                      ))
    then #SetVisT(XMLAdrI)
    else #SetVisF(XMLAdrI)
  } // #endregion Файл/Документ/АкцАвтоНефт/БензПолучСвид

  // #region Файл/Документ/АкцАвтоНефт/БензРеалСвид
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/БензРеалСвид');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/БензРеалСвид' + getIter(i);
    fl := false;

    // #region Файл/Документ/АкцАвтоНефт/БензРеалСвид/СвОбБензСчФ
    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СвОбБензСчФ');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/СвОбБензСчФ' + getIter(j);

      if     not GetStrNull(XMLAdrJ + '/НомСчФ' )
         and not GetStrNull(XMLAdrJ + '/ДатаСчФ')
         and not GetStrNull(XMLAdrJ + '/ОбСпСчФ')
      {
        #SetVisT(XMLAdrJ              )
        #IfVis  (XMLAdrJ + '/НомКСчФ' )
        #IfVis  (XMLAdrJ + '/ДатаКСчФ')
        #IfVis  (XMLAdrJ + '/ОбСпКСчФ')

        fl := true;
      }
      else #SetVisF(XMLAdrJ)
    } // #endregion Файл/Документ/АкцАвтоНефт/БензРеалСвид/СвОбБензСчФ

    if     not GetStrNull(XMLAdrI + '/ПолучОрг/НаимОрг')
       and not GetStrNull(XMLAdrI + '/ПолучОрг/ИННЮЛ'  )
       and not GetStrNull(XMLAdrI + '/ПолучОрг/КПП'    )
    {
      #SetVisT(XMLAdrI + '/ПолучОрг')
      #SetVisF(XMLAdrI + '/ПолучИП' )
    } else {
      if     not GetStrNull(XMLAdrI + '/ПолучИП/ИННФЛ'      )
         and not GetStrNull(XMLAdrI + '/ПолучИП/ФИО/Фамилия')
         and not GetStrNull(XMLAdrI + '/ПолучИП/ФИО/Имя'    )
      {
        #SetVisT(XMLAdrI + '/ПолучИП' )
        #SetVisF(XMLAdrI + '/ПолучОрг')

        #IfVis  (XMLAdrI + '/ПолучИП/ФИО/Отчество')
      } else {
        #SetVisF(XMLAdrI + '/ПолучОрг')
        #SetVisF(XMLAdrI + '/ПолучИП')
      }
    }
    if     fl
       and not GetStrNull(XMLAdrI + '/СерСвидПол'                    )
       and not GetStrNull(XMLAdrI + '/НомСвидПол'                    )
       and not GetStrNull(XMLAdrI + '/ОбРеалБензПер650/КодПТ'        )
       and not GetStrNull(XMLAdrI + '/ОбРеалБензПер650/ОбРеалБензПер')
       and   ( GetFldVis (XMLAdrI + '/ПолучОрг'                      )
            or GetFldVis (XMLAdrI + '/ПолучИП'                       ))
    then #SetVisT(XMLAdrI)
    else #SetVisF(XMLAdrI)
  } // #endregion Файл/Документ/АкцАвтоНефт/БензРеалСвид
@end.
//#endregion ДЕЙСТВИЯ ВЫПОЛНЯЕМЫЕ ПРИ УСТАНОВКЕ ВИДИМОСТИ ПОЛЕЙ
//************************************************************************************************************


//============================================================================================================
//#region ДЕЙСТВИЯ ВЫПОЛНЯЕМЫЕ ПРИ ПРОВЕРКЕ
//------------------------------------------------------------------------------------------------------------
@Script On_Check : boolean;
  //==========================================================================================================
  //#region СЕРВИС On_Check
  //----------------------------------------------------------------------------------------------------------
  #include AllTaxObj.Vih

  //----------------------------------------------------------------------------------------------------------
  function IsValidPeriod(strIn: string; var strGetMes: string) : boolean;
  begin
    //Налоговый период
    //Период
    strGetMes := 'Возможные значения: 01, 02, 03, 04, 05, 06, 07, 08, 09, 10, 11, 12, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81 или 82';

    Result := False;
    Result :=    CheckError.isRegExpr('^(01|02|03|04|05|06|07|08|09|10|11|12)$', strIn)
              or CheckError.isRegExpr('^(71|72|73|74|75|76|77|78|79|80|81|82)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidPoMestu(strIn: string; var strGetMes: string) : boolean;
  begin
    //По месту нахождения (учета)
    //ПоМесту
    strGetMes := 'Возможные значения: 120, 213, 214, 215, 216, 220 или 331';

    Result := False;
    Result := CheckError.isRegExpr('^(120|213|214|215|216|220|331)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidNalSvid(strIn: string; var strGetMes: string) : boolean;
  begin
    //Признак наличия свидетельства (свидетельств) / сертификата (свидетельства) эксплуатанта
    //НалСвид
    strGetMes := 'Возможные значения: 0 или 1';

    Result := False;
    Result := CheckError.isRegExpr('^(0|1)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidPriznNP(strIn: string; var strGetMes: string) : boolean;
  begin
    //Признак налогоплательщика
    //ПризНП
    strGetMes := 'Возможные значения: A или B';

    Result := False;
    Result := CheckError.isRegExpr('^(A|B)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPT(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код вида подакцизного товара
    //КодПТ
    strGetMes := 'Возможные значения: 500, 510, 520, 531, 532, 600, 630, 640, 650, 665, 671-674, 676-679 или 735';

    Result := False;
    Result :=    CheckError.isRegExpr('^(500|510|520|531|532|678|679|600|630|640)$', strIn)
              or CheckError.isRegExpr('^(650|665|671|672|673|674|676|677|735)$'    , strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPok_OperPTKod(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код показателя
    //КодПок
    strGetMes := 'Возможные значения: 10001, 10006-10012, 10021, 10031-10036, 10038-10047, 20003-20005, 20009, 20011, 20013 или 20015';

    Result := False;
    Result :=    CheckError.isRegExpr('^(10001|10006|10007|10008|10009|10010|10011|10012|10021|10031|10032|10033|10034|10035)$', strIn)
              or CheckError.isRegExpr('^(10036|10038|10039|10040|10041|10042|10043|10044|10045|10046|10047|20003|20004|20005)$', strIn)
              or CheckError.isRegExpr('^(20009|20011|20013|20015)$'                                                            , strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPok_AkcizVychKod(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код показателя
    //КодПок
    strGetMes := 'Возможные значения: 30001, 30002, 30006, 30007, 30020-30040 или 30041';

    Result := False;
    Result :=    CheckError.isRegExpr('^(30001|30002|30006|30007|30020|30021|30022|30023|30024|30025)$', strIn)
              or CheckError.isRegExpr('^(30026|30027|30028|30029|30030|30031|30032|30033|30034|30035)$', strIn)
              or CheckError.isRegExpr('^(30036|30037|30038|30039|30040|30041)$'                        , strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPok_AkcizPU(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код показателя
    //КодПок
    strGetMes := 'Возможное значение: 40001';

    Result := False;
    Result := CheckError.isRegExpr('^(40001)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPok_AkcizUm(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код показателя
    //КодПок
    strGetMes := 'Возможное значение: 40002';

    Result := False;
    Result := CheckError.isRegExpr('^(40002)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPok_AkcizVozmKod(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код показателя
    //КодПок
    strGetMes := 'Возможные значения: 20003, 50001, 20009, 20011, 20013, 20015, 50006 или 50007';

    Result := False;
    Result := CheckError.isRegExpr('^(20003|50001|20009|20011|20013|20015|50006|50007)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPok_RealPTBGKod(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код показателя
    //КодПок
    strGetMes := 'Возможные значения: 20001, 50003, 20008, 20010, 20012, 20014, 50008, 50009, 50010 или 50011';

    Result := False;
    Result := CheckError.isRegExpr('^(20001|50003|20008|20010|20012|20014|50008|50009|50010|50011)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPok_RealPTEESKod(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код показателя
    //КодПок
    strGetMes := 'Возможные значения: 20002, 20004, 50002 или 50004';

    Result := False;
    Result := CheckError.isRegExpr('^(20002|20004|50002|50004)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodNalPer(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код налогового периода
    //НалПер
    strGetMes := 'Возможные значения: 01, 02, 03, 04, 05, 06, 07, 08, 09, 10, 11, 12, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81 или 82';

    Result := False;
    Result :=    CheckError.isRegExpr('^(01|02|03|04|05|06|07|08|09|10|11|12)$', strIn)
              or CheckError.isRegExpr('^(71|72|73|74|75|76|77|78|79|80|81|82)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidNalBG(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код налогового периода
    //НалПер
    strGetMes := 'Возможные значения: 0 или 1';

    Result := False;
    Result := CheckError.isRegExpr('^(0|1)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPT_RaschAkcGaz(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код вида подакцизного товара
    //КодПТ
    strGetMes := 'Возможное значение: 735 или 736';

    Result := False;
    Result := CheckError.isRegExpr('^(735|736)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPok_RaschAkcGaz(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код показателя
    //КодПок
    strGetMes := 'Возможное значение: 10037, 10001, 22001 или 22002';

    Result := False;
    Result := CheckError.isRegExpr('^(10037|10001|22001|22002)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPok_RaschNalBazaKod(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код показателя
    //КодПок
    strGetMes := 'Возможное значение: 10001, 10006-10012, 10041-10043, 20001-20005, 30001, 30002, 50001-50004, 20008-20015, 30033, 30034, 50006-50010 или 50011';

    Result := False;
    Result :=    CheckError.isRegExpr('^(10001|10006|10007|10008|10009|10010|10011|10012|20001|20002|20003|20004|20005|30001|30002|50001|50002|50003|50004)$', strIn)
              or CheckError.isRegExpr('^(10041|10042|10043|20008|20009|20010|20011|20012|20013|20014|20015|30033|30034|50006|50007|50008|50009|50010|50011)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidNomerSogl(strIn: string; var strGetMes: string) : boolean;
  begin
    //Номер международного договора Российской Федерации
    //НомерСогл
    strGetMes := 'Формат поля: от 1 до 10 символов';

    result := false;
    result := (Length(strIn) >= 1) and (Length(strIn) <= 10);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidNomerBG(strIn: string; var strGetMes: string) : boolean;
  begin
    //Номер банковской гарантии
    //НомерБГ
    strGetMes := 'Формат поля: от 1 до 20 символов';

    result := false;
    result := (Length(strIn) >= 1) and (Length(strIn) <= 20);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidKodPT_BenzPoluchSvid(strIn: string; var strGetMes: string) : boolean;
  begin
    //Код вида подакцизного товара
    //КодПТ
    strGetMes := 'Возможное значение: 650';

    Result := False;
    Result := CheckError.isRegExpr('^(650)$', strIn);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidSerSvidPost(strIn: string; var strGetMes: string) : boolean;
  begin
    //Серия свидетельства поставщика
    //СерСвидПост
    strGetMes := 'Формат поля: от 1 до 2 символов';

    result := false;
    result := (Length(strIn) >= 1) and (Length(strIn) <= 2);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidNomSvidPost(strIn: string; var strGetMes: string) : boolean;
  begin
    //Номер свидетельства поставщика
    //НомСвидПост
    strGetMes := 'Формат поля: от 1 до 9 символов';

    result := false;
    result := (Length(strIn) >= 1) and (Length(strIn) <= 9);
  end;

  //----------------------------------------------------------------------------------------------------------
  function IsValidNomSchF(strIn: string; var strGetMes: string) : boolean;
  begin
    //Номер счета-фактуры
    //НомСчФ
    strGetMes := 'Формат поля: от 1 до 256 символов';

    result := false;
    result := (Length(strIn) >= 1) and (Length(strIn) <= 256);
  end;

  //----------------------------------------------------------------------------------------------------------
  #declare _IsValid(_Valid, _AdrXML, _Pole, _Iter=0, _Mod=0)
    if not #_Valid(GetStrVal(#_AdrXML), getMes)
      MesErrStop
      (
        #_AdrXML
      , #_Pole
      , 'Поле не соответствует формату. ' + getMes
      , #_Iter
      , #_Mod
      );
  #end

  //----------------------------------------------------------------------------------------------------------
  #declare _IsValid_Vis(_Valid, _AdrXML, _Pole, _Iter=0, _Mod=0)
    if GetFldVis(#_AdrXML)
      if not #_Valid(GetStrVal(#_AdrXML), getMes)
        MesErrStop
        (
          #_AdrXML
        , #_Pole
        , 'Поле не соответствует формату. ' + getMes
        , #_Iter
        , #_Mod
        );
  #end

  //----------------------------------------------------------------------------------------------------------
  #declare _IsValid_Dec(_AdrXML, _Pole, _Cel, _Drob, _flMin, _Iter=0, _Mod=0)
    if not IsValidDecimal(GetStrVal(#_AdrXML), #_Cel, #_Drob, getMes, #_flMin)
      MesErrStop
      (
        #_AdrXML
      , #_Pole
      , 'Поле не соответствует формату. ' + getMes
      , #_Iter
      , #_Mod
      );
  #end

  //----------------------------------------------------------------------------------------------------------
  #declare _IsValid_Dec_Vis(_AdrXML, _Pole, _Cel, _Drob, _flMin, _Iter=0, _Mod=0)
    if GetFldVis(#_AdrXML)
      if not IsValidDecimal(GetStrVal(#_AdrXML), #_Cel, #_Drob, getMes, #_flMin)
        MesErrStop
        (
          #_AdrXML
        , #_Pole
        , 'Поле не соответствует формату. ' + getMes
        , #_Iter
      , #_Mod
        );
  #end
  //#endregion СЕРВИС On_Check
  //**********************************************************************************************************
@begin
  var getMes, XMLAdrI, XMLAdrJ : string = '';
  var flI, flJ : boolean;
  var CountI, CountJ, I, J : longint;
  var nStr : string;
  var remIter : integer;

  if not IsValidKND(GetStrVal('Файл/Документ/КНД'), '1151089', getMes)
    MesErrStop('Файл/Документ/КНД', 'Код налоговой декларации', 'Поле не соответствует формату. ' + getMes);

  //#region ТИТУЛЬНЫЙ ЛИСТ
  #_IsValid    (IsValidDate   , 'Файл/Документ/ДатаДок'          , 'Дата документа'             )
  #_IsValid    (IsValidOtchGod, 'Файл/Документ/ОтчетГод'         , 'Отчетный год'               )
  #_IsValid    (IsValidSONO   , 'Файл/Документ/КодНО'            , 'Код налогового органа'      )
  #_IsValid    (IsValidOKVED  , 'Файл/Документ/СвНП/ОКВЭД'       , 'Код ОКВЭД'                  )
  #_IsValid    (IsValidNaimOrg, 'Файл/Документ/СвНП/НПЮЛ/НаимОрг', 'Наименование организации'   )
  #_IsValid    (IsValidINNUL  , 'Файл/Документ/СвНП/НПЮЛ/ИННЮЛ'  , 'ИНН'                        )   #_IsValid(CheckError.Prov_INN, 'Файл/Документ/СвНП/НПЮЛ/ИННЮЛ', 'ИНН')
  #_IsValid    (IsValidKPP    , 'Файл/Документ/СвНП/НПЮЛ/КПП'    , 'КПП'                        )
  #_IsValid    (IsValidPrPodp , 'Файл/Документ/Подписант/ПрПодп' , 'Признак подписанта'         )
  #_IsValid_Vis(IsValidTlf    , 'Файл/Документ/СвНП/Тлф'         , 'Контактный телефон'         )
  #_IsValid_Vis(IsValidPeriod , 'Файл/Документ/Период'           , 'Налоговый период'           )
  #_IsValid_Vis(IsValidPoMestu, 'Файл/Документ/ПоМесту'          , 'По месту нахождения (учета)')

  if GetFldVis('Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ')
  {
    #_IsValid    (IsValidFormReorg, 'Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ/ФормРеорг', 'Форма реоргазации')
    #_IsValid_Vis(IsValidINNUL    , 'Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ/ИННЮЛ'    , 'ИНН'              )   #_IsValid_Vis(CheckError.Prov_INN, 'Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ/ИННЮЛ', 'ИНН')
    #_IsValid_Vis(IsValidKPP      , 'Файл/Документ/СвНП/НПЮЛ/СвРеоргЮЛ/КПП'      , 'КПП'              )
  }

  #_IsValid    (IsValidFIO, 'Файл/Документ/Подписант/ФИО/Фамилия' , 'Фамилия' )
  #_IsValid    (IsValidFIO, 'Файл/Документ/Подписант/ФИО/Имя'     , 'Имя'     )
  #_IsValid_Vis(IsValidFIO, 'Файл/Документ/Подписант/ФИО/Отчество', 'Отчество')

  if GetFldVis('Файл/Документ/Подписант/СвПред')
  {
    #_IsValid    (IsValidNaimDok, 'Файл/Документ/Подписант/СвПред/НаимДок', 'Наименование документа'  )
    #_IsValid_Vis(IsValidNaimOrg, 'Файл/Документ/Подписант/СвПред/НаимОрг', 'Наименование организации')
  }
  //#endregion ТИТУЛЬНЫЙ ЛИСТ

  // #region РАЗДЕЛ 1
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/СумНалПУ');   flI := false;
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/СумНалПУ' + getIter(i);
    if not GetFldVis(XMLAdrI) continue;
    flI := true;

    remIter := if(i=0, -1, 1);

    #_IsValid    (IsValidNalSvid, XMLAdrI + '/НалСвид', 'Признак наличия свидетельства (свидетельств) / сертификата (свидетельства) эксплуатанта')
    #_IsValid_Vis(IsValidPriznNP, XMLAdrI + '/ПризНП' , 'Признак налогоплательщика'                                                              )
    #_IsValid_Vis(IsValidOKTMO  , XMLAdrI + '/ОКТМО'  , 'Стр. 010'                                                                               )

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СумНалПУКод');   flJ := false;
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/СумНалПУКод' + getIter(j);
      if not GetFldVis(XMLAdrJ) continue;
      flJ := true;

      nStr := String((j mod 7) + 1) + ': ';

      #_IsValid    (IsValidKBK, XMLAdrJ + '/КБК'  , nStr + 'Стр. 020'                 , remIter, 7)
      #_IsValid_Dec(            XMLAdrJ + '/НалПУ', nStr + 'Стр. 030/040', 12, 0, True, remIter, 7)
    }

    if (not flJ) MesErrStop(XMLAdrI + '/СумНалПУКод/КБК', 'Стр. 020 - 040', 'Должна быть заполнена хотя бы 1 (одна) связка строк 020 - 040');
  }

  if (not flI) MesErrStop('Файл/Документ/АкцАвтоНефт/СумНалПУ/НалСвид', 'Раздел 1', 'Раздел 1 обязателен к заполнению. Должна быть заполнена хотя бы 1 (одна) страница "Раздел 1"');
  // #endregion РАЗДЕЛ 1

  // #region РАЗДЕЛ 2
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкц');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкц' + getIter(i);
    if not GetFldVis(XMLAdrI) continue;

    remIter := if(i=0, -1, 1);

    #_IsValid(IsValidKodPT, XMLAdrI + '/КодПТ', 'Стр. 010')

    // #region РАЗДЕЛ 2.1
    flJ := false;

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/ОперПТ/ОперПТКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/ОперПТ/ОперПТКод' + getIter(j);
      if not GetFldVis(XMLAdrJ) continue;
      flJ := true;

      nStr := 'Р. 2.1, стр. ' + String((j mod 8) + 1) + ', ';

      #_IsValid    (IsValidKodPok_OperPTKod, XMLAdrJ + '/КодПок'  , nStr + 'гр. 1'              , remIter, 8)
      #_IsValid_Dec(                         XMLAdrJ + '/НалБаза' , nStr + 'гр. 2', 15, 3, False, remIter, 8)
      #_IsValid_Dec(                         XMLAdrJ + '/СумАкциз', nStr + 'гр. 3', 11, 0, False, remIter, 8)
    }

    if (not flJ) MesErrStop(XMLAdrI + '/ОперПТ/ОперПТКод/КодПок', 'Раздел 2.1', 'Раздел 2.1 обязателен к заполнению. Должна быть заполнена хотя бы 1 (одна) строка в разделе 2.1');
    // #endregion РАЗДЕЛ 2.1

    // #region РАЗДЕЛ 2.2
    if GetFldVis(XMLAdrI + '/АкцизВыч')
    {
      flJ := false;

      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВыч/АкцизВычКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/АкцизВыч/АкцизВычКод' + getIter(j);
        if not GetFldVis(XMLAdrJ) continue;
        flJ := true;

        nStr := 'Р. 2.2, стр. ' + String((j mod 8) + 1) + ', ';

        #_IsValid    (IsValidKodPok_AkcizVychKod, XMLAdrJ + '/КодПок'   , nStr + 'гр. 1'              , remIter, 8)
        #_IsValid_Dec(                            XMLAdrJ + '/ОбъемРеал', nStr + 'гр. 2', 15, 3, False, remIter, 8)
        #_IsValid_Dec(                            XMLAdrJ + '/СумВычет' , nStr + 'гр. 3', 11, 0, False, remIter, 8)
      }

      if (not flJ) MesErrStop(XMLAdrI + '/АкцизВыч/АкцизВычКод/КодПок', 'Раздел 2.2', 'Должна быть заполнена хотя бы 1 (одна) строка в разделе 2.2');
    }
    // #endregion РАЗДЕЛ 2.2

    // #region РАЗДЕЛ 2.3
    #_IsValid    (IsValidKodPok_AkcizPU, XMLAdrI + '/АкцизПУ/КодПок'  , 'Р. 2.3, стр. 1, гр. 1'              )
    #_IsValid    (IsValidKodPok_AkcizUm, XMLAdrI + '/АкцизУм/КодПок'  , 'Р. 2.3, стр. 2, гр. 1'              )
    #_IsValid_Dec(                       XMLAdrI + '/АкцизПУ/СумАкциз', 'Р. 2.3, стр. 1, гр. 2', 11, 0, False)
    #_IsValid_Dec(                       XMLAdrI + '/АкцизУм/СумАкциз', 'Р. 2.3, стр. 2, гр. 2', 11, 0, False)
    // #endregion РАЗДЕЛ 2.3

    // #region РАЗДЕЛ 2.4
    if GetFldVis(XMLAdrI + '/АкцизВозм')
    {
      flJ := false;

      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВозм/АкцизВозмКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/АкцизВозм/АкцизВозмКод' + getIter(j);
        if not GetFldVis(XMLAdrJ) continue;
        flJ := true;

        nStr := 'Р. 2.4, стр. ' + String((j mod 5) + 1) + ', ';

        #_IsValid    (IsValidKodPok_AkcizVozmKod, XMLAdrJ + '/КодПок'    , nStr + 'гр. 1'              , remIter, 5)
        #_IsValid_Dec(                            XMLAdrJ + '/НалБаза'   , nStr + 'гр. 2', 15, 3, False, remIter, 5)
        #_IsValid_Dec(                            XMLAdrJ + '/СумАкциз'  , nStr + 'гр. 3', 11, 0, False, remIter, 5)
        #_IsValid    (IsValidKodNalPer          , XMLAdrJ + '/НалПерЭксп', nStr + 'гр. 4'              , remIter, 5)
        #_IsValid    (IsValidOtchGod            , XMLAdrJ + '/ГодЭксп'   , nStr + 'гр. 5'              , remIter, 5)
      }

      if (not flJ) MesErrStop(XMLAdrI + '/АкцизВозм/АкцизВозмКод/КодПок', 'Раздел 2.4', 'Должна быть заполнена хотя бы 1 (одна) строка в разделе 2.4');

      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВозм/ПревУплВозм');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/АкцизВозм/ПревУплВозм' + getIter(j);
        if not GetFldVis(XMLAdrJ) continue;

        #_IsValid_Dec(                  XMLAdrJ + '/СумАкциз', 'Разд.2.4., стр. 010, гр. 3', 11, 0, False)
        #_IsValid    (IsValidKodNalPer, XMLAdrJ + '/НалПер'  , 'Разд.2.4., стр. 010, гр. 4'              )
        #_IsValid    (IsValidOtchGod  , XMLAdrJ + '/Год'     , 'Разд.2.4., стр. 010, гр. 5'              )
      }
    }
    // #endregion РАЗДЕЛ 2.4

    // #region РАЗДЕЛ 2.5
    if GetFldVis(XMLAdrI + '/РеалПТБГ')
    {
      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РеалПТБГ/РеалПТБГКод');
      flJ := false;

      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/РеалПТБГ/РеалПТБГКод' + getIter(j);
        if not GetFldVis(XMLAdrJ) continue;
        flJ := true;

        nStr := 'Р. 2.5, стр. ' + String((j mod 4) + 1) + ', ';

        #_IsValid    (IsValidKodPok_RealPTBGKod, XMLAdrJ + '/КодПок'  , nStr + 'Р. 2.5, гр. 1'              , remIter, 4)
        #_IsValid_Dec(                           XMLAdrJ + '/НалБаза' , nStr + 'Р. 2.5, гр. 2', 15, 3, False, remIter, 4)
        #_IsValid_Dec(                           XMLAdrJ + '/СумАкциз', nStr + 'Р. 2.5, гр. 3', 11, 0, False, remIter, 4)
        #_IsValid    (IsValidNalBG             , XMLAdrJ + '/НаличБГ' , nStr + 'Р. 2.5, гр. 4'              , remIter, 4)
      }

      if (not flJ) MesErrStop(XMLAdrI + '/РеалПТБГ/РеалПТБГКод/КодПок', 'Раздел 2.5', 'Должна быть заполнена хотя бы 1 (одна) строка в разделе 2.5');
    }
    // #endregion РАЗДЕЛ 2.5

    // #region РАЗДЕЛ 2.6
    if GetFldVis(XMLAdrI + '/РеалПТЕЭС')
    {
      flJ := false;

      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РеалПТЕЭС/РеалПТЕЭСКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/РеалПТЕЭС/РеалПТЕЭСКод' + getIter(j);
        if not GetFldVis(XMLAdrJ) continue;
        flJ := true;

        nStr := 'Р. 2.6, стр. ' + String((j mod 5) + 1) + ', ';

        #_IsValid    (IsValidKodPok_RealPTEESKod, XMLAdrJ + '/КодПок'    , nStr + 'гр. 1'              , remIter, 5)
        #_IsValid_Dec(                            XMLAdrJ + '/НалБаза'   , nStr + 'гр. 2', 15, 3, False, remIter, 5)
        #_IsValid_Dec(                            XMLAdrJ + '/СумАкциз'  , nStr + 'гр. 3', 11, 0, False, remIter, 5)
        #_IsValid    (IsValidKodNalPer          , XMLAdrJ + '/НалПерРеал', nStr + 'гр. 4'              , remIter, 5)
        #_IsValid    (IsValidOtchGod            , XMLAdrJ + '/ГодРеал'   , nStr + 'гр. 5'              , remIter, 5)
      }

      if (not flJ) MesErrStop(XMLAdrI + '/РеалПТЕЭС/РеалПТЕЭСКод/КодПок', 'Раздел 2.6', 'Должна быть заполнена хотя бы 1 (одна) строка в разделе 2.6');
    }
    // #endregion РАЗДЕЛ 2.6
  }
  // #endregion РАЗДЕЛ 2

  // #region РАЗДЕЛ 3
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкцГаз');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкцГаз' + getIter(i);
    if not GetFldVis(XMLAdrI) continue;

    #_IsValid    (IsValidKodPT_RaschAkcGaz , XMLAdrI + '/КодПТ'        , 'Стр. 010'              )
    #_IsValid    (IsValidKodPok_RaschAkcGaz, XMLAdrI + '/КодПок'       , 'Стр. 020'              )
    #_IsValid    (IsValidKBK               , XMLAdrI + '/КБК'          , 'Стр. 030'              )
    #_IsValid    (IsValidNomerSogl         , XMLAdrI + '/НомерСогл'    , 'Стр. 040'              )
    #_IsValid    (IsValidDate              , XMLAdrI + '/ДатаСогл'     , 'Стр. 050'              )
    #_IsValid_Dec(                           XMLAdrI + '/ОбъемРеалГаз' , 'Стр. 060', 18, 3, false)
    #_IsValid_Dec(                           XMLAdrI + '/СтоимЕдРеал'  , 'Стр. 070', 13, 2, false)
    #_IsValid_Dec(                           XMLAdrI + '/СумТаможРеал' , 'Стр. 080', 13, 2, false)
    #_IsValid_Dec(                           XMLAdrI + '/РасхТранспГаз', 'Стр. 090', 13, 2, false)
    #_IsValid_Dec(                           XMLAdrI + '/НалБаза'      , 'Стр. 100', 14, 2, false)
    #_IsValid_Dec(                           XMLAdrI + '/СумАкциз'     , 'Стр. 110', 11, 0, false)
  }
  // #endregion РАЗДЕЛ 3

  // #region ПРИЛОЖЕНИЕ 1
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчНалБаза');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчНалБаза' + getIter(i);
    if not GetFldVis(XMLAdrI) continue;
    flJ := false;

    remIter := if(i=0, -1, 1);

    #_IsValid(IsValidKodPT, XMLAdrI + '/КодПТ', 'Стр. 010')

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РасчНалБазаКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/РасчНалБазаКод' + getIter(j);
      if not GetFldVis(XMLAdrJ) continue;
      flJ := true;

      nStr := LPadCh(String((j mod 22) + 1), '0', 2) + ': ';

      #_IsValid    (IsValidKodPok_RaschNalBazaKod, XMLAdrJ + '/КодПок'  , nStr + 'Гр. 1'              , remIter, 22)
      #_IsValid_Dec(                               XMLAdrJ + '/МощнДвиг', nStr + 'Гр. 2',  4, 1, false, remIter, 22)
      #_IsValid_Dec(                               XMLAdrJ + '/КолПТ'   , nStr + 'Гр. 3',  8, 0, false, remIter, 22)
      #_IsValid_Dec(                               XMLAdrJ + '/НалБаза' , nStr + 'Гр. 4', 13, 2, false, remIter, 22)
    }

    if (not flJ) MesErrStop(XMLAdrI + '/РасчНалБазаКод/КодПок', 'Приложение 1', 'Должна быть заполнена хотя бы 1 (одна) строка в приложение 1');
  }
  // #endregion ПРИЛОЖЕНИЕ 1

  // #region ПРИЛОЖЕНИЕ 2
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп' + getIter(i);
    if not GetFldVis(XMLAdrI) continue;

    #_IsValid        (IsValidKodPT, XMLAdrI + '/КодПТ'                , 'Стр. 010'                     )
    #_IsValid_Dec    (              XMLAdrI + '/ОбщКолБГПер'          , 'Стр. 020'       ,  4, 0, false)
    #_IsValid_Dec    (              XMLAdrI + '/ОбщСумБГПер'          , 'Стр. 030'       , 11, 0, false)
    #_IsValid_Dec    (              XMLAdrI + '/АкОсвЭкспПер/ОбъемПТ' , 'Стр. 040, гр. 3', 15, 3, false)
    #_IsValid_Dec    (              XMLAdrI + '/АкОсвЭкспПер/СумАкциз', 'Стр. 040, гр. 4', 11, 0, false)
    #_IsValid_Dec_Vis(              XMLAdrI + '/АкОсвБГЭкНеПдтвПер'   , 'Стр. 050, гр. 4', 11, 0, false)
    #_IsValid_Dec_Vis(              XMLAdrI + '/АкОсвБГЭкПдтвПред'    , 'Стр. 070, гр. 4', 11, 0, false)
    #_IsValid_Dec_Vis(              XMLAdrI + '/АкОсвБГЭкПдтвКон'     , 'Стр. 080, гр. 4', 11, 0, false)
    #_IsValid_Dec_Vis(              XMLAdrI + '/АкОсвБГЭкНеПдтвКон'   , 'Стр. 090, гр. 4', 11, 0, false)
    #_IsValid_Dec_Vis(              XMLAdrI + '/ПрАкОсвБГПдтвКон'     , 'Стр. 100, гр. 4', 11, 0, false)

    if GetFldVis(XMLAdrI + '/АкОсвЭкспПдтвПер') {
      #_IsValid_Dec(XMLAdrI + '/АкОсвЭкспПдтвПер/ОбъемПТ' , 'Стр. 060, гр. 3', 15, 3, false)
      #_IsValid_Dec(XMLAdrI + '/АкОсвЭкспПдтвПер/СумАкциз', 'Стр. 060, гр. 4', 11, 0, false)
    }

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/БГОсвРеалЭксп');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/БГОсвРеалЭксп' + getIter(j);
      if not GetFldVis(XMLAdrJ) continue;

      #_IsValid        (IsValidDate   , XMLAdrJ + '/ДатаВыдБГ'      , 'Стр. 115'              )
      #_IsValid        (IsValidNomerBG, XMLAdrJ + '/НомерБГ'        , 'Стр. 120'              )
      #_IsValid        (IsValidDate   , XMLAdrJ + '/ДатаНачБГ'      , 'Стр. 130'              )
      #_IsValid        (IsValidDate   , XMLAdrJ + '/ДатаКонБГ'      , 'Стр. 140'              )
      #_IsValid_Dec    (                XMLAdrJ + '/СуммаБГ'        , 'Стр. 150', 11, 0, false)
      #_IsValid_Dec_Vis(                XMLAdrJ + '/ПрАкЭкспПдтвКон', 'Стр. 220', 11, 0, false)

      if GetFldVis(XMLAdrJ + '/АкОсвЭкспПер') {
        #_IsValid_Dec(XMLAdrJ + '/АкОсвЭкспПер/ОбРеалЭкспПТ', 'Стр. 160, гр. 3', 13, 3, false)
        #_IsValid_Dec(XMLAdrJ + '/АкОсвЭкспПер/СумАкциз'    , 'Стр. 160, гр. 4', 11, 0, false)
      }

      if GetFldVis(XMLAdrJ + '/АкЭкспНеПдтвНач') {
        #_IsValid_Dec(                  XMLAdrJ + '/АкЭкспНеПдтвНач/ОбРеалЭкспПТ', 'Стр. 170, гр. 3', 13, 3, false)
        #_IsValid_Dec(                  XMLAdrJ + '/АкЭкспНеПдтвНач/СумАкциз'    , 'Стр. 170, гр. 4', 11, 0, false)
        #_IsValid    (IsValidKodNalPer, XMLAdrJ + '/АкЭкспНеПдтвНач/НалПерЭксп'  , 'Стр. 170, гр. 5'              )
        #_IsValid    (IsValidOtchGod  , XMLAdrJ + '/АкЭкспНеПдтвНач/ГодЭксп'     , 'Стр. 170, гр. 6'              )
      }

      if GetFldVis(XMLAdrJ + '/АкЭкспПдтвПер') {
        #_IsValid_Dec(                  XMLAdrJ + '/АкЭкспПдтвПер/ОбРеалЭкспПТ', 'Стр. 180, гр. 3', 13, 3, false)
        #_IsValid_Dec(                  XMLAdrJ + '/АкЭкспПдтвПер/СумАкциз'    , 'Стр. 180, гр. 4', 11, 0, false)
        #_IsValid    (IsValidKodNalPer, XMLAdrJ + '/АкЭкспПдтвПер/НалПерЭксп'  , 'Стр. 180, гр. 5'              )
        #_IsValid    (IsValidOtchGod  , XMLAdrJ + '/АкЭкспПдтвПер/ГодЭксп'     , 'Стр. 180, гр. 6'              )
      }

      if GetFldVis(XMLAdrJ + '/АкЭкспПдтвПред') {
        #_IsValid_Dec(XMLAdrJ + '/АкЭкспПдтвПред/ОбРеалЭкспПТ', 'Стр. 190, гр. 3', 13, 3, false)
        #_IsValid_Dec(XMLAdrJ + '/АкЭкспПдтвПред/СумАкциз'    , 'Стр. 190, гр. 4', 11, 0, false)
      }

      if GetFldVis(XMLAdrJ + '/АкЭкспПдтвКон') {
        #_IsValid_Dec(                  XMLAdrJ + '/АкЭкспПдтвКон/ОбРеалЭкспПТ', 'Стр. 200, гр. 3', 13, 3, false)
        #_IsValid_Dec(                  XMLAdrJ + '/АкЭкспПдтвКон/СумАкциз'    , 'Стр. 200, гр. 4', 11, 0, false)
        #_IsValid    (IsValidKodNalPer, XMLAdrJ + '/АкЭкспПдтвКон/НалПерЭксп'  , 'Стр. 200, гр. 5'              )
        #_IsValid    (IsValidOtchGod  , XMLAdrJ + '/АкЭкспПдтвКон/ГодЭксп'     , 'Стр. 200, гр. 6'              )
      }

      if GetFldVis(XMLAdrJ + '/АкЭкспНеПдтвКон') {
        #_IsValid_Dec(                  XMLAdrJ + '/АкЭкспНеПдтвКон/ОбРеалЭкспПТ', 'Стр. 210, гр. 3', 13, 3, false)
        #_IsValid_Dec(                  XMLAdrJ + '/АкЭкспНеПдтвКон/СумАкциз'    , 'Стр. 210, гр. 4', 11, 0, false)
        #_IsValid    (IsValidKodNalPer, XMLAdrJ + '/АкЭкспНеПдтвКон/НалПерЭксп'  , 'Стр. 210, гр. 5'              )
        #_IsValid    (IsValidOtchGod  , XMLAdrJ + '/АкЭкспНеПдтвКон/ГодЭксп'     , 'Стр. 210, гр. 6'              )
      }
    }
  }
  // #endregion ПРИЛОЖЕНИЕ 2

  // #region ПРИЛОЖЕНИЕ 3
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/БензПолучСвид');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/БензПолучСвид' + getIter(i);
    if not GetFldVis(XMLAdrI) continue;
    flJ := false;

    remIter := if(i=0, -1, 1);

    #_IsValid    (IsValidSerSvidPost         , XMLAdrI + '/СерСвидПост'                   , 'Стр. 040 (серия)'              )
    #_IsValid    (IsValidNomSvidPost         , XMLAdrI + '/НомСвидПост'                   , 'Стр. 040 (номер)'              )
    #_IsValid    (IsValidKodPT_BenzPoluchSvid, XMLAdrI + '/ОбПолБензПер650/КодПТ'         , 'Стр. 050, гр. 1'               )
    #_IsValid_Dec(                             XMLAdrI + '/ОбПолБензПер650/ОбПолучБензПер', 'Стр. 050, гр. 3' , 14, 3, false)

    if GetFldVis(XMLAdrI + '/ПоставОрг')
    {
      #_IsValid_Vis(IsValidNaimOrg     , XMLAdrI + '/ПоставОрг/НаимОрг', 'Стр. 010 (ЮЛ), наименование организации')
      #_IsValid_Vis(IsValidINNUL       , XMLAdrI + '/ПоставОрг/ИННЮЛ'  , 'Стр. 020 (ЮЛ), ИНН'                     )
      #_IsValid_Vis(CheckError.Prov_INN, XMLAdrI + '/ПоставОрг/ИННЮЛ'  , 'Стр. 020 (ЮЛ), ИНН'                     )
      #_IsValid_Vis(IsValidKPP         , XMLAdrI + '/ПоставОрг/КПП'    , 'Стр. 030 (ЮЛ), КПП'                     )
    }
    else  if GetFldVis(XMLAdrI + '/ПоставИП')
          {
             #_IsValid    (IsValidFIO         , XMLAdrI + '/ПоставИП/ФИО/Фамилия' , 'Стр. 010 (ИП), фамилия' )
             #_IsValid    (IsValidFIO         , XMLAdrI + '/ПоставИП/ФИО/Имя'     , 'Стр. 010 (ИП), имя'     )
             #_IsValid_Vis(IsValidFIO         , XMLAdrI + '/ПоставИП/ФИО/Отчество', 'Стр. 010 (ИП), отчество')
             #_IsValid    (IsValidINNFL       , XMLAdrI + '/ПоставИП/ИННФЛ'       , 'Стр. 020 (ИП), ИНН'     )
             #_IsValid    (CheckError.Prov_INN, XMLAdrI + '/ПоставИП/ИННФЛ'       , 'Стр. 020 (ИП), ИНН'     )
          }
          else MesErrStop(XMLAdrI + '/ПоставОрг/НаимОрг', 'ЮЛ / ИП', 'Должны быть заполнены либо данные ЮЛ, либо данные ИП');

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СвОбБензСчФ');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/СвОбБензСчФ' + getIter(j);
      if not GetFldVis(XMLAdrJ) continue;
      flJ := true;

      nStr := 'Стр. ' + String(j + 1) + ', ';

      #_IsValid        (IsValidNomSchF, XMLAdrJ + '/НомСчФ'  , nStr + 'гр. 1'              , remIter, 3)
      #_IsValid        (IsValidDate   , XMLAdrJ + '/ДатаСчФ' , nStr + 'гр. 2'              , remIter, 3)
      #_IsValid_Dec    (                XMLAdrJ + '/ОбСпСчФ' , nStr + 'гр. 3', 13, 3, false, remIter, 3)
      #_IsValid_Vis    (IsValidNomSchF, XMLAdrJ + '/НомКСчФ' , nStr + 'гр. 4'              , remIter, 3)
      #_IsValid_Vis    (IsValidDate   , XMLAdrJ + '/ДатаКСчФ', nStr + 'гр. 5'              , remIter, 3)
      #_IsValid_Dec_Vis(                XMLAdrJ + '/ОбСпКСчФ', nStr + 'гр. 6', 13, 3, false, remIter, 3)
    }

    if (not flJ) MesErrStop(XMLAdrI + '/СвОбБензСчФ/НомСчФ', 'Приложение 3', 'Должна быть заполнена хотя бы 1 (одна) строка в приложение 3');
  }
  // #endregion ПРИЛОЖЕНИЕ 3

  // #region ПРИЛОЖЕНИЕ 4
  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/БензРеалСвид');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/БензРеалСвид' + getIter(i);
    if not GetFldVis(XMLAdrI) continue;
    flJ := false;

    remIter := if(i=0, -1, 1);

    #_IsValid    (IsValidSerSvidPost         , XMLAdrI + '/СерСвидПол'                    , 'Стр. 040 (серия)'              )
    #_IsValid    (IsValidNomSvidPost         , XMLAdrI + '/НомСвидПол'                    , 'Стр. 040 (номер)'              )
    #_IsValid    (IsValidKodPT_BenzPoluchSvid, XMLAdrI + '/ОбРеалБензПер650/КодПТ'        , 'Стр. 050, гр. 1'               )
    #_IsValid_Dec(                             XMLAdrI + '/ОбРеалБензПер650/ОбРеалБензПер', 'Стр. 050, гр. 3' , 14, 3, false)

    if GetFldVis(XMLAdrI + '/ПолучОрг')
    {
      #_IsValid(IsValidNaimOrg     , XMLAdrI + '/ПолучОрг/НаимОрг', 'Стр. 010 (ЮЛ), наименование организации')
      #_IsValid(IsValidINNUL       , XMLAdrI + '/ПолучОрг/ИННЮЛ'  , 'Стр. 020 (ЮЛ), ИНН'                     )
      #_IsValid(CheckError.Prov_INN, XMLAdrI + '/ПолучОрг/ИННЮЛ'  , 'Стр. 020 (ЮЛ), ИНН'                     )
      #_IsValid(IsValidKPP         , XMLAdrI + '/ПолучОрг/КПП'    , 'Стр. 030 (ЮЛ), КПП'                     )
    }
    else  if GetFldVis(XMLAdrI + '/ПолучИП')
          {
             #_IsValid    (IsValidFIO         , XMLAdrI + '/ПолучИП/ФИО/Фамилия' , 'Стр. 010 (ИП), фамилия' )
             #_IsValid    (IsValidFIO         , XMLAdrI + '/ПолучИП/ФИО/Имя'     , 'Стр. 010 (ИП), имя'     )
             #_IsValid_Vis(IsValidFIO         , XMLAdrI + '/ПолучИП/ФИО/Отчество', 'Стр. 010 (ИП), отчество')
             #_IsValid    (IsValidINNFL       , XMLAdrI + '/ПолучИП/ИННФЛ'       , 'Стр. 020 (ИП), ИНН'     )
             #_IsValid    (CheckError.Prov_INN, XMLAdrI + '/ПолучИП/ИННФЛ'       , 'Стр. 020 (ИП), ИНН'     )
          }
          else MesErrStop(XMLAdrI + '/ПолучОрг/НаимОрг', 'ЮЛ / ИП', 'Должны быть заполнены либо данные ЮЛ, либо данные ИП');

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СвОбБензСчФ');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/СвОбБензСчФ' + getIter(j);
      if not GetFldVis(XMLAdrJ) continue;
      flJ := true;

      nStr := 'Стр. ' + String(j + 1) + ', ';

      #_IsValid        (IsValidNomSchF, XMLAdrJ + '/НомСчФ'  , nStr + 'гр. 1'              , remIter, 3)
      #_IsValid        (IsValidDate   , XMLAdrJ + '/ДатаСчФ' , nStr + 'гр. 2'              , remIter, 3)
      #_IsValid_Dec    (                XMLAdrJ + '/ОбСпСчФ' , nStr + 'гр. 3', 13, 3, false, remIter, 3)
      #_IsValid_Vis    (IsValidNomSchF, XMLAdrJ + '/НомКСчФ' , nStr + 'гр. 4'              , remIter, 3)
      #_IsValid_Vis    (IsValidDate   , XMLAdrJ + '/ДатаКСчФ', nStr + 'гр. 5'              , remIter, 3)
      #_IsValid_Dec_Vis(                XMLAdrJ + '/ОбСпКСчФ', nStr + 'гр. 6', 13, 3, false, remIter, 3)
    }

    if (not flJ) MesErrStop(XMLAdrI + '/СвОбБензСчФ/НомСчФ', 'Приложение 4', 'Должна быть заполнена хотя бы 1 (одна) строка в приложение 4');
  }
  // #endregion ПРИЛОЖЕНИЕ 4
@end.
//#endregion ДЕЙСТВИЯ ВЫПОЛНЯЕМЫЕ ПРИ ПРОВЕРКЕ
//************************************************************************************************************


//============================================================================================================
//#region ДЕЙСТВИЯ ВЫПОЛНЯЕМЫЕ ПРИ ПРОВЕРКЕ КОНТРОЛЬНЫХ СООТНОШЕНИЙ
//------------------------------------------------------------------------------------------------------------
@Script On_CheckKS : boolean;
  //==========================================================================================================
  // #region СЕРВИС On_CheckKS
  //----------------------------------------------------------------------------------------------------------

  // #region МАКРОСЫ

  // Для работы с текущим отчетом
  #undef GD // Вернуть значение поля типа Double
  #declare GD(_XMLAdr)
    if (XMLMap.GetAttrVisByName(#_XMLAdr), Double(XMLMap.GetAttrValueByName(#_XMLAdr)), 0.0);
  #end

  #undef GS // Вернуть значение поля типа String
  #declare GS(_XMLAdr)
    String(XMLMap.GetAttrValueByName(#_XMLAdr));
  #end

  // Для работы с приложением к бух. отчетности
  #undef GDp // Вернуть значение поля типа Double
  #declare GDp(_XMLAdr)
    Double(tmpXMLMap.GetAttrValueByName(#_XMLAdr));
  #end

  // Сравнить
  #undef KS
  #declare KS(_If, _adrXML, _Pole, _Mes, _Iter=0, _IterNum=1)
    if (not #_If)
    {
      MesError.InsertMesError(#_adrXML, Comp(0), '', #_Pole, #_Mes, #_Iter, #_IterNum);
    }
  #end

  // #endregion МАКРОСЫ

  // #region FUNCTIONS

  function KS_1_1 (_val : string) : boolean;
  {
    Result := False;
    Result := ( (_val = '1') or (_val = '0') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_1_2 (_val : string) : boolean;
  {
    Result := False;
    Result := ( (_val = 'A') or (_val = 'B') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_2_1 (_val : string) : boolean;
  {
    Result := False;
    Result := (  (_val = '510') or (_val = '520') or (_val = '531') or (_val = '532') or (_val = '630') or (_val = '640') or (_val = '650')
              or (_val = '665') or (_val = '671') or (_val = '672') or (_val = '673') or (_val = '674') or (_val = '676') or (_val = '677') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_2_2 (_val : string) : boolean;
  {
    Result := False;
    Result := (  (_val = '10001') or (_val = '10006') or (_val = '10007') or (_val = '10008') or (_val = '10009') or (_val = '10010') or (_val = '10011')
              or (_val = '10012') or (_val = '10021') or (_val = '10031') or (_val = '10032') or (_val = '10033') or (_val = '10034') or (_val = '10035')
              or (_val = '10036') or (_val = '10038') or (_val = '10039') or (_val = '10040') or (_val = '20003') or (_val = '20004') or (_val = '20005') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_2_4 (_val : string) : boolean;
  {
    Result := False;
    Result := (  (_val = '30001') or (_val = '30002') or (_val = '30006') or (_val = '30007') or (_val = '30020') or (_val = '30021') or (_val = '30022')
              or (_val = '30023') or (_val = '30024') or (_val = '30025') or (_val = '30026') or (_val = '30027') or (_val = '30028') or (_val = '30029')
              or (_val = '30030') or (_val = '30031') or (_val = '30032') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_2_5 (_val : string) : boolean;
  {
    Result := False;
    Result := ( (_val = '40001') or (_val = '40002') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_2_8 (_val : string) : boolean;
  {
    Result := False;
    Result := ( (_val = '20003') or (_val = '50001') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_2_9 (_val : string) : boolean;
  {
    Result := False;
    Result := ( (_val = '20001') or (_val = '50003') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_2_10 (_val : string) : boolean;
  {
    Result := False;
    Result := ( (_val = '0') or (_val = '1') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_2_11 (_val : string) : boolean;
  {
    Result := False;
    Result := ( (_val = '20002') or (_val = '20004') or (_val = '50002') or (_val = '50004') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_4_1 (_val : string) : boolean;
  {
    Result := False;
    Result := ( (_val = '510') or (_val = '520') or (_val = '531') or (_val = '532') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_4_2 (_val : string) : boolean;
  {
    Result := False;
    Result := ( (_val = '510') or (_val = '520') or (_val = '531') or (_val = '532') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_4_3 (_val : string) : boolean;
  {
    Result := False;
    Result := (  (_val = '10001') or (_val = '10006') or (_val = '10007') or (_val = '10008') or (_val = '10009') or (_val = '10010') or (_val = '10011')
              or (_val = '10012') or (_val = '20001') or (_val = '20002') or (_val = '20003') or (_val = '20004') or (_val = '20005') or (_val = '30001')
              or (_val = '30002') or (_val = '50001') or (_val = '50002') or (_val = '50003') or (_val = '50004') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_5_1 (_val : string) : boolean;
  {
    Result := False;
    Result := (  (_val = '510') or (_val = '520') or (_val = '531') or (_val = '532') or (_val = '630') or (_val = '640') or (_val = '650') or (_val = '665')
              or (_val = '671') or (_val = '672') or (_val = '673') or (_val = '674') or (_val = '676') or (_val = '677') );
  }

  //----------------------------------------------------------------------------------------------------------
  function KS_6_1 (_val : string) : boolean;
  {
    Result := False;
    Result := (  (_val = '500') or (_val = '510') or (_val = '520') or (_val = '531') or (_val = '532') or (_val = '600') or (_val = '630') or (_val = '640')
              or (_val = '650') or (_val = '665') or (_val = '671') or (_val = '672') or (_val = '673') or (_val = '674') or (_val = '676') or (_val = '677') );
  }

  // #endregion FUNCTIONS

  // #endregion СЕРВИС On_CheckKS
  //**********************************************************************************************************
@begin
  var i, j, k, CountI, CountJ, CountK : integer;
  var XMLAdrI, XMLAdrJ, XMLAdrK : string;
  var remIter : integer;
  var nStr : string;

  // #region РАЗДЕЛ 1

  // #region Объявление переменных

  var aR1_NalSv, aR1_NP
    , sR1_NalSv, sR1_NP : string;

  // #endregion Объявление переменных

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/СумНалПУ');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/СумНалПУ' + getIter(i);

    if (not GetFldVis(XMLAdrI)) Continue;

    // #region Инициализация переменных

    aR1_NalSv := XMLAdrI + '/НалСвид';  sR1_NalSv := GetStrVal(aR1_NalSv);
    aR1_NP    := XMLAdrI + '/ПризНП' ;  sR1_NP    := GetStrVal(aR1_NP   );

    // #endregion Инициализация переменных

    #KS(KS_1_1(sR1_NalSv), aR1_NalSv, 'Р. 1, признак нал. свид.' , 'КС 1.1 :: р. 1 "признак наличия свидетельства/сертификата" = "1" или "0"')

    if GetFldVis(aR1_NP)
    { #KS(KS_1_2(sR1_NP), aR1_NP, 'Р. 1, признак налогоплат.', 'КС 1.2 :: р. 1 "признак налогоплательщика" = "А" или "В"') }
  }

  // #endregion РАЗДЕЛ 1

  // #region РАЗДЕЛ 2

  // #region Объявление переменных

  var aR2_010, aR2_StAkc
    , aR21_1, aR21_2, aR21_3
    , aR22_1, aR22_3
    , aR23_1, aR23_2
    , aR24_1
    , aR25_1, aR25_4
    , aR26_1, aR26_2, aR26_3
    , sR2_010
    , sR21_1
    , sR22_1
    , sR23_1
    , sR24_1
    , sR25_1, sR25_4
    , sR26_1 : string;
  var dR2_StAkc
    , dR21_2, dR21_3
    , dR22_3
    , dR23_2
    , dR26_2, dR26_3
    , dSum_R21_2_if20002, dSum_R21_3_if20004, dSum_R21_3, dSum_R22_3 : double;

  // #endregion Объявление переменных

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкц');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкц' + getIter(i);

    if (not GetFldVis(XMLAdrI)) Continue;

    // #region Инициализация переменных

    remIter := if(i=0, -1, 1);

    dSum_R21_2_if20002 := dSum_R21_3_if20004 := dSum_R21_3 := dSum_R22_3 := 0;

    aR2_010   := XMLAdrI + '/КодПТ';  sR2_010   := GetStrVal(aR2_010  );
    aR2_StAkc := XMLAdrI + '/СтАкц';  dR2_StAkc := GetDblVal(aR2_StAkc);

    // #endregion Инициализация переменных

    #KS(KS_2_1(sR2_010), aR2_010, 'Р. 2, стр. 010', 'КС 2.01 :: р. 2. ст. 010 = "510" или "520" или "531" или "532" или "630" или "640" или "650" или "665" или "671" или "672" или "673" или "674" или "676" или "677"')

    // #region РАЗДЕЛ 2.1

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/ОперПТ/ОперПТКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/ОперПТ/ОперПТКод' + getIter(j);

      if (not GetFldVis(XMLAdrJ)) Continue;

      // #region Инициализация переменных

      nStr := 'Р. 2.1, стр. ' + String((j mod 8) + 1) + ', ';

      aR21_1 := XMLAdrJ + '/КодПок'  ;  sR21_1 := GetStrVal(aR21_1);
      aR21_2 := XMLAdrJ + '/НалБаза' ;  dR21_2 := GetDblVal(aR21_2);  if (sR21_1 = '20002') dSum_R21_2_if20002 += dR21_2;
      aR21_3 := XMLAdrJ + '/СумАкциз';  dR21_3 := GetDblVal(aR21_3);  if (sR21_1 = '20004') dSum_R21_3_if20004 += dR21_3;

      dSum_R21_3 += dR21_3;

      // #endregion Инициализация переменных

      #KS(KS_2_2(sR21_1)               , aR21_1, nStr + 'гр. 1', 'КС 2.02 :: р. 2. пр. 2.1. гр. 1 = "10001" или "10006 - 10012" или "10021" или "10031 - 10036" или "10038 - 10040" или "20003 - 20005"'            , remIter, 8)
      #KS((dR21_3 = dR21_2 * dR2_StAkc), aR21_3, nStr + 'гр. 3', 'КС 2.03 :: р. 2. пр. 2.1. гр. 3 (по соответствующему ПТ р. 2. ст. 010 и соответствующему ПТ р. 2. пр. 2.1. гр. 1) = р. 2. пр. 2.1. гр. 2 * Ставка', remIter, 8)
    }

    // #endregion РАЗДЕЛ 2.1

    // #region РАЗДЕЛ 2.2

    if GetFldVis(XMLAdrI + '/АкцизВыч')
    {
      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВыч/АкцизВычКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/АкцизВыч/АкцизВычКод' + getIter(j);

        if (not GetFldVis(XMLAdrJ)) Continue;

        // #region Инициализация переменных

        nStr := 'Р. 2.2, стр. ' + String((j mod 8) + 1) + ', ';

        aR22_1 := XMLAdrJ + '/КодПок'  ;  sR22_1 := GetStrVal(aR22_1);
        aR22_3 := XMLAdrJ + '/СумВычет';  dR22_3 := GetDblVal(aR22_3);

        dSum_R22_3 += dR22_3;

        // #endregion Инициализация переменных

        #KS(KS_2_4(sR22_1), aR22_1, nStr + 'гр. 1', 'КС 2.04 :: р. 2. пр. 2.2. гр. 1 = "30001 - 30002" или "30006 - 30007" или "30020 - 30032"', remIter, 8)
      }
    }

    // #endregion РАЗДЕЛ 2.2

    // #region РАЗДЕЛ 2.3

    // #region Инициализация переменных

    aR23_1 := XMLAdrI + '/АкцизПУ/КодПок'  ;  sR23_1 := GetStrVal(aR23_1);
    aR23_2 := XMLAdrI + '/АкцизПУ/СумАкциз';  dR23_2 := GetDblVal(aR23_2);

    // #endregion Инициализация переменных

    #KS(KS_2_5(sR23_1), aR23_1, 'Р. 2.3, гр. 1 (1)', 'КС 2.05 :: р. 2. пр. 2.3. гр. 1 = "40001" или "40002"')

    if (dSum_R21_3 >= dSum_R22_3) and (sR23_1 = '40001')
    {
      if (not (dR23_2 = dSum_R21_3 - dSum_R22_3))
        MesError.InsertMesError(
          aR23_2
        , Comp(0)
        , ''
        , 'Р. 2.3, гр. 2 (1)'
        , 'КС 2.06 :: Если Сумма р. 2. пр. 2.1. гр. 3 >= Сумма р. 2. пр. 2.2. гр. 3, то р. 2. пр. 2.3. гр. 2 по коду гр. 1 "40001" = Сумма р. 2. пр. 2.1. гр. 3 - Сумма р. 2. пр. 2.2. гр. 3 (РАССЧИТАНО '+String((dSum_R21_3 - dSum_R22_3), 0, 3)+')'
        );
    }

    // #region Инициализация переменных

    aR23_1 := XMLAdrI + '/АкцизУм/КодПок'  ;  sR23_1 := GetStrVal(aR23_1);
    aR23_2 := XMLAdrI + '/АкцизУм/СумАкциз';  dR23_2 := GetDblVal(aR23_2);

    // #endregion Инициализация переменных

    #KS(KS_2_5(sR23_1), aR23_1, 'Р. 2.3, гр. 1 (2)', 'КС 2.05 :: р. 2. пр. 2.3. гр. 1 = "40001" или "40002"')

    if (dSum_R21_3 < dSum_R22_3) and (sR23_1 = '40002')
    {
      if (not (dR23_2 = dSum_R22_3 - dSum_R21_3))
        MesError.InsertMesError(
          aR23_2
        , Comp(0)
        , ''
        , 'Р. 2.3, гр. 2 (2)'
        , 'КС 2.07 :: Если Сумма р. 2. пр. 2.1. гр. 3 < Сумма р. 2. пр. 2.2. гр. 3, то р. 2. пр. 2.3. гр. 2 по коду гр. 1 "40002" = Сумма р. 2. пр. 2.2. гр. 3 - Сумма р. 2. пр. 2.1. гр. 3 (РАССЧИТАНО '+String((dSum_R22_3 - dSum_R21_3), 0, 3)+')'
        );
    }

    // #endregion РАЗДЕЛ 2.3

    // #region РАЗДЕЛ 2.4

    if GetFldVis(XMLAdrI + '/АкцизВозм')
    {
      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВозм/АкцизВозмКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/АкцизВозм/АкцизВозмКод' + getIter(j);

        if (not GetFldVis(XMLAdrJ)) Continue;

        // #region Инициализация переменных

        nStr := 'Р. 2.4, стр. ' + String((j mod 5) + 1) + ', ';

        aR24_1 := XMLAdrJ + '/КодПок';  sR24_1 := GetStrVal(aR24_1);

        // #endregion Инициализация переменных

        #KS(KS_2_8(sR24_1), aR24_1, nStr + 'гр. 1', 'КС 2.08 :: р. 2. пр. 2.4. гр. 1 = "20003" или "50001"', remIter, 5)
      }
    }

    // #endregion РАЗДЕЛ 2.4

    // #region РАЗДЕЛ 2.5

    if GetFldVis(XMLAdrI + '/РеалПТБГ')
    {
      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РеалПТБГ/РеалПТБГКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/РеалПТБГ/РеалПТБГКод' + getIter(j);

        if (not GetFldVis(XMLAdrJ)) Continue;

        // #region Инициализация переменных

        nStr := 'Р. 2.5, стр. ' + String((j mod 4) + 1) + ', ';

        aR25_1 := XMLAdrJ + '/КодПок' ;  sR25_1 := GetStrVal(aR25_1);
        aR25_4 := XMLAdrJ + '/НаличБГ';  sR25_4 := GetStrVal(aR25_4);

        // #endregion Инициализация переменных

        #KS(KS_2_9 (sR25_1), aR25_1, nStr + 'гр. 1', 'КС 2.09 :: р. 2. пр. 2.5. гр. 1 = "20001" или "50003"', remIter, 4)
        #KS(KS_2_10(sR25_4), aR25_4, nStr + 'гр. 4', 'КС 2.10 :: р. 2. пр. 2.5. гр. 4 = "0" или "1"'        , remIter, 4)
      }
    }

    // #endregion РАЗДЕЛ 2.5

    // #region РАЗДЕЛ 2.6

    if GetFldVis(XMLAdrI + '/РеалПТЕЭС')
    {
      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РеалПТЕЭС/РеалПТЕЭСКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/РеалПТЕЭС/РеалПТЕЭСКод' + getIter(j);

        if (not GetFldVis(XMLAdrJ)) Continue;

        // #region Инициализация переменных

        nStr := 'Р. 2.6, стр. ' + String((j mod 5) + 1) + ', ';

        aR26_1 := XMLAdrJ + '/КодПок'  ;  sR26_1 := GetStrVal(aR26_1);
        aR26_2 := XMLAdrJ + '/НалБаза' ;  dR26_2 := GetDblVal(aR26_2);
        aR26_3 := XMLAdrJ + '/СумАкциз';  dR26_3 := GetDblVal(aR26_3);

        // #endregion Инициализация переменных

        #KS(KS_2_11(sR26_1)              , aR26_1, nStr + 'гр. 1', 'КС 2.11 :: р. 2. пр. 2.6. гр. 1 = "20002" или "20004" или "50002" или "50004"'     , remIter, 5)
        #KS((dR26_3 = dR26_2 * dR2_StAkc), aR26_3, nStr + 'гр. 3', 'КС 2.14 :: р. 2. пр. 2.6. гр. 3 = р. 2. пр. 2.6. гр. 2 * соответствующую Ставку ПТ', remIter, 5)

        if (sR26_1 = '20002') { #KS((dR26_2 = dSum_R21_2_if20002), aR26_2, nStr + 'гр. 2', 'КС 2.12 :: р. 2. пр. 2.6. гр. 2 с кодом "20002" по гр. 1 = р. 2. пр. 2.1. гр. 2 с кодом "20002" по гр. 1', remIter, 5) }
        if (sR26_1 = '20004') { #KS((dR26_3 = dSum_R21_3_if20004), aR26_3, nStr + 'гр. 3', 'КС 2.13 :: р. 2. пр. 2.6. гр. 3 с кодом "20004" по гр. 1 = р. 2. пр. 2.1. гр. 3 с кодом "20004" по гр. 1', remIter, 5) }
      }
    }

    // #endregion РАЗДЕЛ 2.6
  }

  // #endregion РАЗДЕЛ 2

  // #region РАЗДЕЛ 3

  // #region Объявление переменных

  var flR1_020, flR1_030 : boolean;
  var aR3_StAkc, aR3_010, aR3_020, aR3_030, aR3_060, aR3_070, aR3_080, aR3_090, aR3_100, aR3_110
    , sR3_010, sR3_020, sR3_030 : string;
  var dR3_StAkc, dR3_060, dR3_070, dR3_080, dR3_090, dR3_100, dR3_110 : double;

  // #endregion Объявление переменных

  // #region Объявление переменных (Раздел 1)

  var aR1_020, aR1_030
    , sR1_020 : string;
  var dR1_030 : double;

  // #endregion Объявление переменных (Раздел 1)

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкцГаз');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкцГаз' + getIter(i);

    if (not GetFldVis(XMLAdrI)) Continue;

    // #region Инициализация переменных

    flR1_020 := flR1_030 := False;

    aR3_010 := XMLAdrI + '/КодПТ' ;  sR3_010 := GetStrVal(aR3_010);
    aR3_020 := XMLAdrI + '/КодПок';  sR3_020 := GetStrVal(aR3_020);
    aR3_030 := XMLAdrI + '/КБК'   ;  sR3_030 := GetStrVal(aR3_030);

    aR3_StAkc := XMLAdrI + '/СтАкц'        ;  dR3_StAkc := GetDblVal(aR3_StAkc);
    aR3_060   := XMLAdrI + '/ОбъемРеалГаз' ;  dR3_060   := GetDblVal(aR3_060  );
    aR3_070   := XMLAdrI + '/СтоимЕдРеал'  ;  dR3_070   := GetDblVal(aR3_070  );
    aR3_080   := XMLAdrI + '/СумТаможРеал' ;  dR3_080   := GetDblVal(aR3_080  );
    aR3_090   := XMLAdrI + '/РасхТранспГаз';  dR3_090   := GetDblVal(aR3_090  );
    aR3_100   := XMLAdrI + '/НалБаза'      ;  dR3_100   := GetDblVal(aR3_100  );
    aR3_110   := XMLAdrI + '/СумАкциз'     ;  dR3_110   := GetDblVal(aR3_110  );

    // #endregion Инициализация переменных

    // #region Обход Раздела 1

    CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/СумНалПУ');
    for (i := 0; i < CountI; i++)
    {
      XMLAdrI := 'Файл/Документ/АкцАвтоНефт/СумНалПУ' + getIter(i);

      if (not GetFldVis(XMLAdrI)) Continue;

      CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СумНалПУКод');
      for (j := 0; j < CountJ; j++)
      {
        XMLAdrJ := XMLAdrI + '/СумНалПУКод' + getIter(j);

        if (not GetFldVis(XMLAdrJ)) Continue;

        // #region Инициализация переменных

        aR1_020 := XMLAdrJ + '/КБК'  ;  sR1_020 := GetStrVal(aR1_020);
        aR1_030 := XMLAdrJ + '/НалПУ';  dR1_030 := GetDblVal(aR1_030);

        // #endregion Инициализация переменных

        if (sR3_030 = sR1_020)
        {
          flR1_020 := True;

          if (dR1_030 >= 0) and (dR1_030 = dR3_110)
          {
            flR1_030 := True;
            Break;
          }
          else flR1_030 := False;
        }
      }
    }

    // #endregion Обход Раздела 1

    #KS((sR3_010 = '735'  ), aR3_010, 'Стр. 010', 'КС 3.1 :: р. 3. ст. 010 = "735"'  )
    #KS((sR3_020 = '10037'), aR3_020, 'Стр. 020', 'КС 3.2 :: р. 3. ст. 020 = "10037"')

    #KS(flR1_020, aR3_030, 'Стр. 010', 'КС 3.3 :: р. 3. ст. 030 = р. 1. ст. 020'                        )
    #KS(flR1_030, aR3_110, 'Стр. 020', 'КС 3.6 :: р. 3. ст. 110 = р. 1. ст. 030 по соответствующему КБК')

    #KS((dR3_100 = dR3_060 * dR3_070 - (dR3_080 + dR3_090)), aR3_100, 'Стр. 100', 'КС 3.4 :: р. 3. ст. 100 = р. 3. ст. 060 * р. 3. ст. 070 - (р. 3. ст. 080 + р. 3. ст. 090)')
    #KS((dR3_110 = dR3_100 * dR3_StAkc                    ), aR3_110, 'Стр. 110', 'КС 3.5 :: р. 3. ст. 110 = р. 3. ст. 100 * Ставку'                                         )
  }

  // #endregion РАЗДЕЛ 3

  // #region ПРИЛОЖЕНИЕ 1

  // #region Объявление переменных

  var aP1_010, aP1_Gr1, aP1_Gr2, aP1_Gr3, aP1_Gr4
    , sP1_010, sP1_Gr1 : string;
  var dP1_Gr2, dP1_Gr3, dP1_Gr4 : double;

  // #endregion Объявление переменных

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчНалБаза');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчНалБаза' + getIter(i);

    if (not GetFldVis(XMLAdrI)) Continue;

    // #region Инициализация переменных

    aP1_010 := XMLAdrI + '/КодПТ';  sP1_010 := GetStrVal(aP1_010);

    // #endregion Инициализация переменных

    #KS(KS_4_1(sP1_010), aP1_010, 'Стр. 010', 'КС 4.1 :: Прил. N 1 ст. 010 = "510" или "520" или "531" или "532"'                )
    #KS(KS_4_2(sP1_010), aP1_010, 'Стр. 010', 'КС 4.2 :: Прил. N 1 ст. 010 = р. 2. ст. 010 для автомобилей легковых и мотоциклов')

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РасчНалБазаКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/РасчНалБазаКод' + getIter(j);

      if (not GetFldVis(XMLAdrJ)) Continue;

      // #region Инициализация переменных

      remIter := if(i=0,-1,1);

      nStr := LPadCh(String((j mod 22) + 1), '0', 2) + ': ';

      aP1_Gr1 := XMLAdrJ + '/КодПок'  ;  sP1_Gr1 := GetStrVal(aP1_Gr1);
      aP1_Gr2 := XMLAdrJ + '/МощнДвиг';  dP1_Gr2 := GetDblVal(aP1_Gr2);
      aP1_Gr3 := XMLAdrJ + '/КолПТ'   ;  dP1_Gr3 := GetDblVal(aP1_Gr3);
      aP1_Gr4 := XMLAdrJ + '/НалБаза' ;  dP1_Gr4 := GetDblVal(aP1_Gr4);

      // #endregion Инициализация переменных

      #KS(KS_4_3(sP1_Gr1)              , aP1_Gr1, nStr + 'Гр. 1', 'КС 4.3 :: Прил. N 1 гр. 1 = "10001" или "10006 - 10012" или "20001 - 20005" или "30001" - "30002" или "50001" - "50004"', remIter, 22)
      #KS((dP1_Gr4 = dP1_Gr2 * dP1_Gr3), aP1_Gr4, nStr + 'Гр. 4', 'КС 4.4 :: Прил. N 1 гр. 4 = Прил. N 1 гр. 2 * Прил. N 1 гр. 3 по соответствующему коду Прил. N 1 гр. 1'                 , remIter, 22)
    }
  }

  // #endregion ПРИЛОЖЕНИЕ 1

  // #region ПРИЛОЖЕНИЕ 2

  // #region Объявление переменных

  var aP21_Stav, aP21_010, aP21_020, aP21_030, aP21_040_3, aP21_050_4, aP21_060, aP21_060_3, aP21_060_4, aP21_070_4, aP21_080_4, aP21_090_4, aP21_100_4
    , aP22_120, aP22_150, aP22_160, aP22_170, aP22_180, aP22_190, aP22_200, aP22_210, aP22_115, aP22_130, aP22_140, aP22_160_3, aP22_160_4, aP22_170_3, aP22_170_4
    , aP22_180_3, aP22_180_4, aP22_190_3, aP22_190_4, aP22_200_3, aP22_200_4, aP22_210_3, aP22_210_4, aP22_220_3
    , sP21_010
    , sP22_120 : string;
  var dP22_115, dP22_130, dP22_140 : date;
  var dP21_Stav, dP21_020, dP21_030, dP21_040_3, dP21_050_4, dP21_060_3, dP21_060_4, dP21_070_4, dP21_080_4, dP21_090_4, dP21_100_4
    , dP22_150, dP22_160_3, dP22_160_4, dP22_170_3, dP22_170_4, dP22_180_3, dP22_180_4, dP22_190_3, dP22_190_4, dP22_200_3, dP22_200_4, dP22_210_3, dP22_210_4
    , dP22_220_3
    , dSum_P22_150, dSum_P22_160_3, dSum_P22_170_4, dSum_P22_180_3, dSum_P22_180_4, dSum_P22_190_4, dSum_P22_200_4, dSum_P22_210_4, dSum_P22_220_3 : double;
  var masP22_120 : array [1..1] of string;

  var aR25_2 : string;
  var dR25_2
    , dSum_R25_2 : double;

  // #endregion Объявление переменных

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп' + getIter(i);

    if (not GetFldVis(XMLAdrI)) Continue;

    // #region Инициализация переменных

    SetLimit(masP22_120, 0);

    dSum_P22_150 := dSum_P22_160_3 := dSum_P22_170_4 := dSum_P22_180_3 := dSum_P22_180_4 := dSum_P22_190_4 := dSum_P22_200_4 := dSum_P22_210_4 :=
    dSum_P22_220_3 := 0;

    aP21_060 := XMLAdrI + '/АкОсвЭкспПдтвПер';

    aP21_Stav  := XMLAdrI + '/СтАкц'                ;  dP21_Stav  := GetDblVal(aP21_Stav );
    aP21_010   := XMLAdrI + '/КодПТ'                ;  sP21_010   := GetStrVal(aP21_010  );
    aP21_020   := XMLAdrI  + '/ОбщКолБГПер'         ;  dP21_020   := GetDblVal(aP21_020  );
    aP21_030   := XMLAdrI  + '/ОбщСумБГПер'         ;  dP21_030   := GetDblVal(aP21_030  );
    aP21_040_3 := XMLAdrI  + '/АкОсвЭкспПер/ОбъемПТ';  dP21_040_3 := GetDblVal(aP21_040_3);
    aP21_050_4 := XMLAdrI  + '/АкОсвБГЭкНеПдтвПер'  ;  dP21_050_4 := GetDblVal(aP21_050_4);
    aP21_060_3 := aP21_060 + '/ОбъемПТ'             ;  dP21_060_3 := GetDblVal(aP21_060_3);
    aP21_060_4 := aP21_060 + '/СумАкциз'            ;  dP21_060_4 := GetDblVal(aP21_060_4);
    aP21_070_4 := XMLAdrI  + '/АкОсвБГЭкПдтвПред'   ;  dP21_070_4 := GetDblVal(aP21_070_4);
    aP21_080_4 := XMLAdrI  + '/АкОсвБГЭкПдтвКон'    ;  dP21_080_4 := GetDblVal(aP21_080_4);
    aP21_090_4 := XMLAdrI  + '/АкОсвБГЭкНеПдтвКон'  ;  dP21_090_4 := GetDblVal(aP21_090_4);
    aP21_100_4 := XMLAdrI  + '/ПрАкОсвБГПдтвКон'    ;  dP21_100_4 := GetDblVal(aP21_100_4);

    // #endregion Инициализация переменных

    // #region ПРИЛОЖЕНИЕ 2.2

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/БГОсвРеалЭксп');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/БГОсвРеалЭксп' + getIter(j);

      if (not GetFldVis(XMLAdrJ)) Continue;

      // #region Инициализация переменных

      aP22_120 := XMLAdrJ + '/НомерБГ';  sP22_120 := GetStrVal(aP22_120);

      aP22_115 := XMLAdrJ + '/ДатаВыдБГ';  dP22_115 := GetDateVal(aP22_115);
      aP22_130 := XMLAdrJ + '/ДатаНачБГ';  dP22_130 := GetDateVal(aP22_130);
      aP22_140 := XMLAdrJ + '/ДатаКонБГ';  dP22_140 := GetDateVal(aP22_140);
      aP22_150 := XMLAdrJ + '/СуммаБГ'  ;  dP22_150 := GetDblVal (aP22_150);  dSum_P22_150 += dP22_150;

      aP22_160 := XMLAdrJ + '/АкОсвЭкспПер'   ;
      aP22_170 := XMLAdrJ + '/АкЭкспНеПдтвНач';
      aP22_180 := XMLAdrJ + '/АкЭкспПдтвПер'  ;
      aP22_190 := XMLAdrJ + '/АкЭкспПдтвПред' ;
      aP22_200 := XMLAdrJ + '/АкЭкспПдтвКон'  ;
      aP22_210 := XMLAdrJ + '/АкЭкспНеПдтвКон';

      aP22_160_3 := aP22_160 + '/ОбРеалЭкспПТ'   ;  dP22_160_3 := GetDblVal(aP22_160_3);
      aP22_160_4 := aP22_160 + '/СумАкциз'       ;  dP22_160_4 := GetDblVal(aP22_160_4);
      aP22_170_3 := aP22_170 + '/ОбРеалЭкспПТ'   ;  dP22_170_3 := GetDblVal(aP22_170_3);
      aP22_170_4 := aP22_170 + '/СумАкциз'       ;  dP22_170_4 := GetDblVal(aP22_170_4);
      aP22_180_3 := aP22_180 + '/ОбРеалЭкспПТ'   ;  dP22_180_3 := GetDblVal(aP22_180_3);
      aP22_180_4 := aP22_180 + '/СумАкциз'       ;  dP22_180_4 := GetDblVal(aP22_180_4);
      aP22_190_3 := aP22_190 + '/ОбРеалЭкспПТ'   ;  dP22_190_3 := GetDblVal(aP22_190_3);
      aP22_190_4 := aP22_190 + '/СумАкциз'       ;  dP22_190_4 := GetDblVal(aP22_190_4);
      aP22_200_3 := aP22_200 + '/ОбРеалЭкспПТ'   ;  dP22_200_3 := GetDblVal(aP22_200_3);
      aP22_200_4 := aP22_200 + '/СумАкциз'       ;  dP22_200_4 := GetDblVal(aP22_200_4);
      aP22_210_3 := aP22_210 + '/ОбРеалЭкспПТ'   ;  dP22_210_3 := GetDblVal(aP22_210_3);
      aP22_210_4 := aP22_210 + '/СумАкциз'       ;  dP22_210_4 := GetDblVal(aP22_210_4);
      aP22_220_3 := XMLAdrJ  + '/ПрАкЭкспПдтвКон';  dP22_220_3 := GetDblVal(aP22_220_3);

      if GetFldVis(aP22_160  ) { dSum_P22_160_3 += dP22_160_3; }
      if GetFldVis(aP22_170  ) { dSum_P22_170_4 += dP22_170_4; }
      if GetFldVis(aP22_180  ) { dSum_P22_180_3 += dP22_180_3;
                                 dSum_P22_180_4 += dP22_180_4; }
      if GetFldVis(aP22_190  ) { dSum_P22_190_4 += dP22_190_4; }
      if GetFldVis(aP22_200  ) { dSum_P22_200_4 += dP22_200_4; }
      if GetFldVis(aP22_210  ) { dSum_P22_210_4 += dP22_210_4; }
      if GetFldVis(aP22_220_3) { dSum_P22_220_3 += dP22_220_3; }

      // #endregion Инициализация переменных

      if (FindItem(masP22_120, sP22_120) = -1)
      {
        SetLimit(masP22_120, Count(masP22_120) + 1);
        masP22_120[Count(masP22_120)] := sP22_120;
      }

      #KS(KS_6_1(sP21_010), aP21_010, 'Стр. 110', 'КС 6.01 :: Прил. N 2 р. 2. ст. 110 = "500" или "510" или "520" или "531" или "532" или "600" или "630" или "640" или "650" или "665" или "671" или "672" или "673" или "674" или "676" или "677"')

      #KS((dP22_115 < dP22_130), aP22_115, 'Стр. 115', 'КС 6.02 :: Прил. N 2 р. 2. ст. 115 ранее Прил. N 2 р. 2. ст. 130')
      #KS((dP22_115 < dP22_140), aP22_115, 'Стр. 115', 'КС 6.03 :: Прил. N 2 р. 2. ст. 115 ранее Прил. N 2 р. 2. ст. 140')
      #KS((dP22_130 < dP22_140), aP22_130, 'Стр. 130', 'КС 6.04 :: Прил. N 2 р. 2. ст. 130 ранее Прил. N 2 р. 2. ст. 140')

      if GetFldVis(aP22_160) { #KS((dP22_160_4 = dP22_160_3 * dP21_Stav), aP22_160_4, 'Стр. 160, гр. 4', 'КС 6.05 :: Прил. N 2 р. 2. гр. 4. ст. 160 = Прил. N 2 р. 2. гр. 3. ст. 160 * Ставка по соответствующему коду ПТ') }
      if GetFldVis(aP22_170) { #KS((dP22_170_4 = dP22_170_3 * dP21_Stav), aP22_170_4, 'Стр. 170, гр. 4', 'КС 6.06 :: Прил. N 2 р. 2. гр. 4. ст. 170 = Прил. N 2 р. 2. гр. 3. ст. 170 * Ставка по соответствующему коду ПТ') }
      if GetFldVis(aP22_180) { #KS((dP22_180_4 = dP22_180_3 * dP21_Stav), aP22_180_4, 'Стр. 180, гр. 4', 'КС 6.08 :: Прил. N 2 р. 2. гр. 4. ст. 180 = Прил. N 2 р. 2. гр. 3. ст. 180 * Ставка по соответствующему коду ПТ') }
      if GetFldVis(aP22_190) { #KS((dP22_190_4 = dP22_190_3 * dP21_Stav), aP22_190_4, 'Стр. 190, гр. 4', 'КС 6.09 :: Прил. N 2 р. 2. гр. 4. ст. 190 = Прил. N 2 р. 2. гр. 3. ст. 190 * Ставка по соответствующему коду ПТ') }

      if GetFldVis(aP22_200)
      {
        #KS((dP22_200_4 = dP22_200_3 * dP21_Stav  ), aP22_200_4, 'Стр. 200, гр. 4', 'КС 6.11 :: Прил. N 2 р. 2. гр. 4. ст. 200 = Прил. N 2 р. 2. гр. 3. ст. 200 * Ставка по соответствующему коду ПТ')

        if (GetFldVis(aP22_180) and GetFldVis(aP22_190))
        {
          #KS((dP22_200_3 = dP22_180_3 + dP22_190_3), aP22_200_3, 'Стр. 200, гр. 3', 'КС 6.10 :: Прил. N 2 р. 2. гр. 3. ст. 200 = Прил. N 2 р. 2. гр. 3. ст. 180 + Прил. N 2 р. 2. гр. 3. ст. 190')
          #KS((dP22_200_4 = dP22_180_4 + dP22_190_4), aP22_200_4, 'Стр. 200, гр. 4', 'КС 6.12 :: Прил. N 2 р. 2. гр. 4. ст. 200 = Прил. N 2 р. 2. гр. 4. ст. 180 + Прил. N 2 р. 2. гр. 4. ст. 190')
        }
      }

      if GetFldVis(aP22_210)
      {
        if GetFldVis(aP22_160)
        {
          if GetFldVis(aP22_200)
          {
            if (not (dP22_210_3 = dP22_160_3 - dP22_200_3))
              MesError.InsertMesError(
                aP22_210_3
              , Comp(0)
              , ''
              , 'Стр. 210, гр. 3'
              , 'КС 6.14 :: Прил. N 2 р. 2. гр. 3. ст. 210 = Сумма всех Д Прил. N 2 р. 2. гр. 3. ст. 160 - Прил. N 2 р. 2. гр. 3. ст. 200 для соответствующей БГ (РАССЧИТАНО '+String((dP22_160_3 - dP22_200_3), 0, 3)+')'
              );

            if (not (dP22_210_4 = dP22_160_4 - dP22_200_4))
              MesError.InsertMesError(
                aP22_210_4
              , Comp(0)
              , ''
              , 'Стр. 210, гр. 4'
              , 'КС 6.16 :: Прил. N 2 р. 2. гр. 4. ст. 210 = Сумма всех Д Прил. N 2 р. 2. гр. 4. ст. 160 - Прил. N 2 р. 2. гр. 4. ст. 200 для соответствующей БГ (РАССЧИТАНО '+String((dP22_160_4 - dP22_200_4), 0, 3)+')'
              );
          }

          if GetFldVis(aP22_170) and GetFldVis(aP22_180)
            if (not (dP22_210_4 = (dP22_160_4 + dP22_170_4) - dP22_180_4))
            {
              MesError.InsertMesError(
                aP22_210_4
              , Comp(0)
              , ''
              , 'Стр. 210, гр. 4'
              , 'КС 6.17 :: Прил. N 2 р. 2. гр. 4. ст. 210 = (Прил. N 2 р. 2. гр. 4. ст. 160 + Прил. N 2 р. 2. гр. 4. ст. 170) - Прил. N 2 р. 2. гр. 4. ст. 180 для соответствующей БГ для одного нп'
              );
            }
        }

        #KS((dP22_210_4 = dP22_210_3 * dP21_Stav), aP22_210_4, 'Стр. 210, гр. 4', 'КС 6.18 :: Прил. N 2 р. 2. гр. 4. ст. 210 = Прил. N 2 р. 2. гр. 3. ст. 210 * Ставка по соответствующему коду ПТ')
      }

      if GetFldVis(aP22_220_3) and GetFldVis(aP22_200)
      {
        #KS((dP22_220_3 <= dP22_150 - dP22_200_4), aP22_220_3, 'Стр. 220, гр. 3', 'КС 6.21 :: Прил. N 2 р. 2. гр. 3. ст. 220 <= Прил. N 2 р. 2. ст. 150 - Прил. N 2 р. 2. гр. 4. ст. 200 для соответствующей БГ')
      }
    }
    // #endregion ПРИЛОЖЕНИЕ 2.2

    // #region Получение данных из Раздела 2.5

    dSum_R25_2 := 0;

    CountJ := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкц');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := 'Файл/Документ/АкцАвтоНефт/РасчАкц' + getIter(j);

      if (not GetFldVis(XMLAdrJ)) Continue;

      // #region Инициализация переменных

      aR2_010 := XMLAdrJ + '/КодПТ';  sR2_010 := GetStrVal(aR2_010);

      // #endregion Инициализация переменных

      if (sP21_010 <> sR2_010) Continue;

      // #region РАЗДЕЛ 2.5

      if GetFldVis(XMLAdrJ + '/РеалПТБГ')
      {
        CountK := XMLMap.GetNodeCountByName(XMLAdrJ + '/РеалПТБГ/РеалПТБГКод');
        for (k := 0; k < CountK; k++)
        {
          XMLAdrK := XMLAdrJ + '/РеалПТБГ/РеалПТБГКод' + getIter(k);

          if (not GetFldVis(XMLAdrK)) Continue;

          // #region Инициализация переменных

          aR25_1 := XMLAdrK + '/КодПок' ;  sR25_1 := GetStrVal(aR25_1);
          aR25_2 := XMLAdrK + '/НалБаза';  dR25_2 := GetDblVal(aR25_2);

          // #endregion Инициализация переменных

          if (sR25_1 = '50003') dSum_R25_2 += dR25_2;
        }
      }

      // #endregion РАЗДЕЛ 2.5
    }

    // #endregion Получение данных из Раздела 2.5

    #KS(KS_5_1(sP21_010), aP21_010, 'Стр. 010', 'КС 5.01 :: Прил. N 2 р. 1. ст. 010 = "510" или "520" или "531" или "532" или "630" или "640" или "650" или "665" или "671" или "672" или "673" или "674" или "676" или "677"')

    #KS((dP21_020 = Count(masP22_120)), aP21_020, 'Стр. 020', 'КС 5.02 :: Прил. N 2 р. 1. ст. 020 = Общее количество БГ с разными номерами Прил. N 2 р. 2. ст. 120 по соответствующему коду ПТ')

    #KS((dP21_030 = dSum_P22_150), aP21_030, 'Стр. 010', 'КС 5.03 :: Прил. N 2 р. 1. ст. 030 = Сумма ст. 150 Прил. N 2 р. 2 по соответствующему коду ПТ (РАССЧИТАНО '+String(dSum_P22_150, 0, 3)+')')

    #KS((dP21_040_3 = dSum_P22_160_3), aP21_040_3, 'Стр. 040, гр. 3', 'КС 5.04 :: Прил. N 2 р. 1. гр. 3. ст. 040 = Сумма ст. 160 гр. 3 Прил. N 2 р. 2 по соответствующему коду ПТ (РАССЧИТАНО '  +String(dSum_P22_160_3, 0, 3)+')')
    #KS((dP21_050_4 = dSum_P22_170_4), aP21_050_4, 'Стр. 050, гр. 4', 'КС 5.05 :: Прил. N 2 р. 1. гр. 4. ст. 050 = Сумма ст. 170 гр. 4 Прил. N 2 р. 2 (РАССЧИТАНО '                              +String(dSum_P22_170_4, 0, 3)+')')
    #KS((dP21_060_3 = dSum_P22_180_3), aP21_060_3, 'Стр. 060, гр. 3', 'КС 5.07 :: Прил. N 2 р. 1. гр. 3. ст. 060 = Сумма Прил. N 2 р. 2. гр. 3. ст. 180 по соответствующему коду ПТ (РАССЧИТАНО '+String(dSum_P22_180_3, 0, 3)+')')
    #KS((dP21_060_4 = dSum_P22_180_4), aP21_060_4, 'Стр. 060, гр. 4', 'КС 5.09 :: Прил. N 2 р. 1. гр. 4. ст. 060 = Сумма Прил. N 2 р. 2. гр. 4. ст. 180 по соответствующему коду ПТ (РАССЧИТАНО '+String(dSum_P22_180_4, 0, 3)+')')
    #KS((dP21_070_4 = dSum_P22_190_4), aP21_070_4, 'Стр. 070, гр. 4', 'КС 5.10 :: Прил. N 2 р. 1. гр. 4. ст. 070 = Сумма Прил. N 2 р. 2. гр. 4. ст. 190 по соответствующему коду ПТ (РАССЧИТАНО '+String(dSum_P22_190_4, 0, 3)+')')
    #KS((dP21_080_4 = dSum_P22_200_4), aP21_080_4, 'Стр. 080, гр. 4', 'КС 5.11 :: Прил. N 2 р. 1. гр. 4. ст. 080 = Сумма Прил. N 2 р. 2. гр. 4. ст. 200 по соответствующему коду ПТ (РАССЧИТАНО '+String(dSum_P22_200_4, 0, 3)+')')
    #KS((dP21_090_4 = dSum_P22_210_4), aP21_090_4, 'Стр. 090, гр. 4', 'КС 5.13 :: Прил. N 2 р. 1. гр. 4. ст. 090 = Сумма Прил. N 2 р. 2. гр. 4. ст. 210 по соответствующему коду ПТ (РАССЧИТАНО '+String(dSum_P22_210_4, 0, 3)+')')

    #KS((dP21_060_3 = dSum_R25_2), aP21_060_3, 'Стр. 060, гр. 3', 'КС 5.08 :: Прил. N 2 р. 1. гр. 3. ст. 060 = гр. 2. пр. 2.5. р. 2 по коду показателя гр. 1 = "50003" (РАССЧИТАНО '+String(dSum_R25_2, 0, 3)+')')

    #KS((dP21_080_4 = dP21_060_4 + dP21_070_4), aP21_080_4, 'Стр. 080, гр. 4', 'КС 5.12 :: Прил. N 2 р. 1. гр. 4. ст. 080 = Прил. N 2 р. 1. гр. 4. ст. 060 + Прил. N 2 р. 1. гр. 4. ст. 070')

    #KS((dP21_100_4 = dSum_P22_220_3), aP21_100_4, 'Стр. 100, гр. 4', 'КС 5.15 :: Прил. N 2 р. 1. гр. 4. ст. 100 = Сумма Прил. N 2 р. 2. гр. 3. ст. 220 по соответствующему коду ПТ (РАССЧИТАНО '+String(dSum_P22_220_3, 0, 3)+')')
  }

  // #endregion ПРИЛОЖЕНИЕ 2

  // #region ПРИЛОЖЕНИЕ 3

  // #region Объявление переменных

  var flP3P4, flP3P4_INN : boolean;
  var aP3_020, aP3_050_1, aP3_050_3, aP3_3, aP3_6
    , sP3_020, sP3_050_1 : string;
  var dP3_050_3, dP3_3, dP3_6
    , dP3_Sum : double;

  // #endregion Объявление переменных

  // #region Объявление переменных (Приложение 4)

  var aP4_020, aP4_050_1, aP4_050_3
    , sP4_020, sP4_050_1 : string;
  var dP4_050_3 : double;

  // #endregion Объявление переменных (Приложение 4)

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/БензПолучСвид');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/БензПолучСвид' + getIter(i);

    if (not GetFldVis(XMLAdrI)) Continue;

    dP3_Sum := 0;

    // #region Инициализация переменных

    if GetFldVis(XMLAdrI + '/ПоставОрг') aP3_020 := XMLAdrI + '/ПоставОрг/ИННЮЛ';
    if GetFldVis(XMLAdrI + '/ПоставИП' ) aP3_020 := XMLAdrI + '/ПоставИП/ИННФЛ' ;

    sP3_020 := GetStrVal(aP3_020);

    aP3_050_1 := XMLAdrI + '/ОбПолБензПер650/КодПТ'         ;   sP3_050_1 := GetStrVal(aP3_050_1);
    aP3_050_3 := XMLAdrI + '/ОбПолБензПер650/ОбПолучБензПер';   dP3_050_3 := GetDblVal(aP3_050_3);

    flP3P4 := flP3P4_INN := False;

    // #endregion Инициализация переменных

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СвОбБензСчФ');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/СвОбБензСчФ' + getIter(j);

      if (not GetFldVis(XMLAdrJ)) Continue;

      // #region Инициализация переменных

      aP3_3 := XMLAdrJ + '/ОбСпСчФ' ;  dP3_3 := GetDblVal(aP3_3);
      aP3_6 := XMLAdrJ + '/ОбСпКСчФ';  dP3_6 := GetDblVal(aP3_6);

      // #endregion Инициализация переменных

      dP3_Sum += if (GetFldVis(aP3_6), dP3_6, dP3_3);
    }

    // #region Обход Приложения 4

    CountJ := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/БензРеалСвид');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := 'Файл/Документ/АкцАвтоНефт/БензРеалСвид' + getIter(j);

      if (not GetFldVis(XMLAdrJ)) Continue;

      // #region Инициализация переменных

      if GetFldVis(XMLAdrJ + '/ПолучОрг') aP4_020 := XMLAdrJ + '/ПолучОрг/ИННЮЛ';
      if GetFldVis(XMLAdrJ + '/ПолучИП' ) aP4_020 := XMLAdrJ + '/ПолучИП/ИННФЛ' ;

      sP4_020 := GetStrVal(aP4_020);

      aP4_050_1 := XMLAdrJ + '/ОбРеалБензПер650/КодПТ'        ;   sP4_050_1 := GetStrVal(aP4_050_1);
      aP4_050_3 := XMLAdrJ + '/ОбРеалБензПер650/ОбРеалБензПер';   dP4_050_3 := GetStrVal(aP4_050_3);

      // #endregion Инициализация переменных

      if ( (sP3_050_1 = sP4_050_1) and (dP3_050_3 = dP4_050_3) )
      {
        flP3P4 := True;
        flP3P4_INN := (sP3_020 = sP4_020);

        if flP3P4_INN Break;
      }
    }

    // #endregion Обход Приложения 4

    #KS((sP3_050_1 = '650'  ), aP3_050_1, 'Стр. 050, гр. 1', 'КС 7.1 :: Прил. N 3 гр. 1. ст. 050 = "650"'                                                                                                             )
    #KS((dP3_050_3 = dP3_Sum), aP3_050_3, 'Стр. 050, гр. 3', 'КС 7.2 :: Прил. N 3 гр. 3. ст. 050 = Сумма (Прил. N 3 гр. 6, если гр. 6 > 0 + Прил. N 3 гр. 3, если гр. 6 = "-") (РАССЧИТАНО '+String(dP3_Sum, 0, 3)+')')
    #KS(flP3P4               , aP3_050_3, 'Прил. 3'        , 'КС 7.3 :: Прил. N 3 гр. 1, гр. 2, гр. 3 = Прил. N 4 гр. 1, гр. 2, гр. 3 для любого нп'                                                                  )
    #KS(flP3P4_INN           , aP3_020  , 'Прил. 3'        , 'КС 7.4 :: Если Прил. N 3 гр. 1, гр. 2, гр. 3 = Прил. N 4 гр. 1, гр. 2, гр. 3, то Прил. N 3. ст. 020 = Прил. N 4 (ИНН) ст. 020'                          )
  }

  // #endregion ПРИЛОЖЕНИЕ 3

  // #region ПРИЛОЖЕНИЕ 4

  // #region Объявление переменных

  var aP4_3, aP4_6 : string;
  var dP4_3, dP4_6
    , dP4_Sum : double;

  // #endregion Объявление переменных

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/БензРеалСвид');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/БензРеалСвид' + getIter(i);

    if (not GetFldVis(XMLAdrI)) Continue;

    dP4_Sum := 0;

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СвОбБензСчФ');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/СвОбБензСчФ' + getIter(j);

      if (not GetFldVis(XMLAdrJ)) Continue;

      // #region Инициализация переменных

      aP4_3 := XMLAdrJ + '/ОбСпСчФ' ;   dP4_3 := GetDblVal(aP4_3);
      aP4_6 := XMLAdrJ + '/ОбСпКСчФ';   dP4_6 := GetDblVal(aP4_6);

      // #endregion Инициализация переменных

      dP4_Sum += if (GetFldVis(aP4_6), dP4_6, dP4_3);
    }

    // #region Инициализация переменных

    aP4_050_1 := XMLAdrI + '/ОбРеалБензПер650/КодПТ'        ;  sP4_050_1 := GetStrVal(aP4_050_1);
    aP4_050_3 := XMLAdrI + '/ОбРеалБензПер650/ОбРеалБензПер';  dP4_050_3 := GetStrVal(aP4_050_3);

    // #endregion Инициализация переменных

    #KS((sP4_050_1 = '650'  ), aP4_050_1, 'Стр. 050, гр. 1', 'КС 8.1 :: Прил. N 4 гр. 1. ст. 050 = "650"'                                                                                                       )
    #KS((dP4_050_3 = dP4_Sum), aP4_050_3, 'Стр. 050, гр. 3', 'КС 8.2 :: Прил. N 3 гр. 3. ст. 050 = Сумма (Прил. N 4 гр. 6, если гр. 6 > 0 + Прил. N 4 гр. 3, если гр. 6 = "-") (РАССЧИТАНО '+String(dP4_Sum)+')')
  }

  // #endregion ПРИЛОЖЕНИЕ 4
@end.
//#endregion ДЕЙСТВИЯ ВЫПОЛНЯЕМЫЕ ПРИ ПРОВЕРКЕ КОНТРОЛЬНЫХ СООТНОШЕНИЙ
//************************************************************************************************************


//============================================================================================================
//#region ДЕЙСТВИЯ ВЫПОЛНЯЕМЫЕ ПРИ РАСЧЕТЕ
//------------------------------------------------------------------------------------------------------------
@Script On_Recalc : boolean;
  //==========================================================================================================
  //#region СЕРВИС On_Recalc
  //----------------------------------------------------------------------------------------------------------
  procedure Log(_strAdr, _strMes, _strVal : string);
  {
    MesError.InsertRasch('', _strAdr, _strMes, _strVal);
  }

  procedure LogIter(_strAdr, _strMes, _strVal : string; _iter, _mod : integer);
  {
    MesError.InsertRasch('', _strAdr, _strMes, _strVal, _iter, _mod);
  }

  procedure LogProc(_strAdr, _strMes, _strVal : string; fl : boolean);
  {
    if fl
    then MesError.InsertRasch('', _strAdr, _strMes + ' / 100', _strVal + ' / 100')
    else MesError.InsertRasch('', _strAdr, _strMes, _strVal);
  }

  function GV(_strAdr : string) : string;
  {
    Result := GetStrValFormat(_strAdr);
  }

  procedure SV(_adr : string; var _val : double);
  {
    SetDblVal(_adr, _val);
    _val := GetDblVal(_adr);
  }

  procedure SetNulVal_Get(_adr : string; var _val : double);
  {
    SetNulVal(_adr);
    _val := GetDblVal(_adr);
  }

  procedure GetCutStr (var inputStr : string);
  {
    inputStr := SubStr(inputStr, 1, Length(inputStr) - 3);
    if (inputStr = '') inputStr := '0';
  }

  function GetStrDbl_3 (inputVal : double) : string;
  { Result := DoubleToStr(Round(inputVal, 3),'[|-]3666666666666666~999'); }

  function GetStrDbl_0 (inputVal : double) : string;
  { Result := DoubleToStr(Round(inputVal),'[|-]3666666666666666'); }
  //#endregion СЕРВИС On_Recalc
  //**********************************************************************************************************
@begin
  On_Visable;
  //------------------------------------------------------------------------------------------------------------

  if ((GetStrVal('Файл/Документ/ДатаДок') = '') or (GetStrVal('Файл/Документ/ДатаДок') = 'ДД.ММ.ГГГГ'))
    SetFldVal('Файл/Документ/ДатаДок', DateToStr(Cur_Date, XMLMap.GetAttrVFormatByName('Файл/Документ/ДатаДок')));

  var KodOKEI_EdIzm_744 : double;
  KodOKEI_EdIzm_744 := 1;

  var XMLAdrI, XMLAdrJ, XMLAdrK : string;
  var CountI, CountJ, CountK
    , I, J, K : integer;
  var fl, flProc : boolean;

  var aStAkc : string;
  var valStAkc : double;
  var remIter : integer;

  // #region РАЗДЕЛ 2
  var buf_dR21_Gr3, buf_dR22_Gr3, dR23_Gr2
    , buf_dR24_010_20003, buf_dR24_010_50001 : double;
  var buf_vR24_010_20003, buf_vR24_010_50001
    , buf_vR21_Gr3, buf_vR22_Gr3
    , aR23_Gr2_40001, aR23_Gr2_40002, vR23_Gr3, mR23_Gr3
    , sR24_Gr4, sR24_Gr5 : string;

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкц');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкц' + getIter(i);

    if GetStrNull(XMLAdrI + '/КодПТ') continue;

    remIter := if(i=0, -1, 1);

    aStAkc := XMLAdrI + '/СтАкц';
    valStAkc := GetDblVal(aStAkc);

    flProc := (GetDblVal(XMLAdrI + '/ЕдИзм') = KodOKEI_EdIzm_744);
    if (flProc) valStAkc := valStAkc / 100;

    // #region РАЗДЕЛ 2.1
    var aR21_Gr1, aR21_Gr2, aR21_Gr3, mR21_Gr3, vR21_Gr3 : string = '';
    var dR21_Gr2, dR21_Gr3 : double;

    buf_dR21_Gr3 := 0;
    buf_vR21_Gr3 := '';

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/ОперПТ/ОперПТКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/ОперПТ/ОперПТКод' + getIter(j);

      aR21_Gr1 := XMLAdrJ + '/КодПок'  ;
      aR21_Gr2 := XMLAdrJ + '/НалБаза' ;   dR21_Gr2 := GetDblVal(aR21_Gr2);
      aR21_Gr3 := XMLAdrJ + '/СумАкциз';

      if     not GetStrNull(aR21_Gr1)
         and not GetStrNull(aR21_Gr2)
      {
        dR21_Gr3 := dR21_Gr2 * valStAkc;   SV(aR21_Gr3, dR21_Gr3);

        buf_dR21_Gr3 += dR21_Gr3;   buf_vR21_Gr3 += GetStrDbl_0(dR21_Gr3) + ' + ';

        if (flProc)
        {
          vR21_Gr3 := GV(aR21_Gr3)+' = '+GV(aR21_Gr2)+' * '+GV(aStAkc)+' / 100';
          mR21_Gr3 := 'Раздел 2.1: Гр. 3 = гр. 2 * Ставку акциза / 100';
        } else {
          vR21_Gr3 := GV(aR21_Gr3)+' = '+GV(aR21_Gr2)+' * '+GV(aStAkc);
          mR21_Gr3 := 'Раздел 2.1: Гр. 3 = гр. 2 * Ставку акциза';
        }

        LogIter(aR21_Gr3, mR21_Gr3, vR21_Gr3, remIter, 8);
      }
      else SetNulVal_Get(aR21_Gr3, dR21_Gr3);
    } // #endregion РАЗДЕЛ 2.1

    // #region РАЗДЕЛ 2.2
    var aR22_Gr1, aR22_Gr2, aR22_Gr3 : string = '';
    var dR22_Gr3 : double;

    buf_dR22_Gr3 := 0;
    buf_vR22_Gr3 := '';

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВыч/АкцизВычКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/АкцизВыч/АкцизВычКод' + getIter(j);

      aR22_Gr1 := XMLAdrJ + '/КодПок'   ;
      aR22_Gr2 := XMLAdrJ + '/ОбъемРеал';
      aR22_Gr3 := XMLAdrJ + '/СумВычет' ;   dR22_Gr3 := GetDblVal(aR22_Gr3);

      if     not GetStrNull(aR22_Gr1)
         and not GetStrNull(aR22_Gr2)
         and not GetStrNull(aR22_Gr3)
      {
        buf_dR22_Gr3 += dR22_Gr3;   buf_vR22_Gr3 += GetStrDbl_0(dR22_Gr3) + ' + ';
      }
    } // #endregion РАЗДЕЛ 2.2

    // #region РАЗДЕЛ 2.3
    dR23_Gr2 := buf_dR21_Gr3 - buf_dR22_Gr3;

    aR23_Gr2_40001 := XMLAdrI + '/АкцизПУ/СумАкциз';
    aR23_Gr2_40002 := XMLAdrI + '/АкцизУм/СумАкциз';

    GetCutStr(buf_vR21_Gr3);
    GetCutStr(buf_vR22_Gr3);

    if (dR23_Gr2 > 0)
    {
      SV(aR23_Gr2_40001, dR23_Gr2);
      SV(aR23_Gr2_40002, 0       );

      vR23_Gr3 := GV(aR23_Gr2_40001)+' = ('+buf_vR21_Gr3+') - ('+buf_vR22_Gr3+')';
      mR23_Gr3 := 'Раздел 2.3, код 40001: Гр. 2 = сумма(Разд.2.1, гр.3) - сумма(Разд.2.2, гр.3)';

      Log(aR23_Gr2_40001, mR23_Gr3, vR23_Gr3);
    } else {
      SV(aR23_Gr2_40002, ABS(dR23_Gr2));
      SV(aR23_Gr2_40001, 0            );

      vR23_Gr3 := GV(aR23_Gr2_40002)+' = ('+buf_vR22_Gr3+') - ('+buf_vR21_Gr3+')';
      mR23_Gr3 := 'Раздел 2.3, код 40002: Гр. 2 = сумма(Разд.2.2, гр.3) - сумма(Разд.2.1, гр.3)';

      Log(aR23_Gr2_40002, mR23_Gr3, vR23_Gr3);
    } // #endregion РАЗДЕЛ 2.3

    // #region РАЗДЕЛ 2.4
    var aR24_Gr1, aR24_Gr2, aR24_Gr3, aR24_Gr4, aR24_Gr5, mR24_Gr3, vR24_Gr3 : string = '';
    var dR24_Gr2, dR24_Gr3 : double;

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВозм/АкцизВозмКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/АкцизВозм/АкцизВозмКод' + getIter(j);

      aR24_Gr1 := XMLAdrJ + '/КодПок'    ;
      aR24_Gr2 := XMLAdrJ + '/НалБаза'   ;   dR24_Gr2 := GetDblVal(aR24_Gr2);
      aR24_Gr3 := XMLAdrJ + '/СумАкциз'  ;
      aR24_Gr4 := XMLAdrJ + '/НалПерЭксп';
      aR24_Gr5 := XMLAdrJ + '/ГодЭксп'   ;

      if     not GetStrNull(aR24_Gr1)
         and not GetStrNull(aR24_Gr2)
         and not GetStrNull(aR24_Gr4)
         and not GetStrNull(aR24_Gr5)
      {
        dR24_Gr3 := dR24_Gr2 * valStAkc;   SV(aR24_Gr3, dR24_Gr3);

        if (flProc)
        {
          vR24_Gr3 := GV(aR24_Gr3)+' = '+GV(aR24_Gr2)+' * '+GV(aStAkc)+' / 100';
          mR24_Gr3 := 'Раздел 2.4: Гр. 3 = гр. 2 * Ставку акциза / 100';
        } else {
          vR24_Gr3 := GV(aR24_Gr3)+' = '+GV(aR24_Gr2)+' * '+GV(aStAkc);
          mR24_Gr3 := 'Раздел 2.4: Гр. 3 = гр. 2 * Ставку акциза';
        }

        LogIter(aR24_Gr3, mR24_Gr3, vR24_Gr3, remIter, 5);
      }
      else SetNulVal_Get(aR24_Gr3, dR24_Gr3);
    }

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВозм/ПревУплВозм');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/АкцизВозм/ПревУплВозм' + getIter(j);

      aR24_Gr3 := XMLAdrJ + '/СумАкциз';
      aR24_Gr4 := XMLAdrJ + '/НалПер'  ;   sR24_Gr4 := GetStrVal(aR24_Gr4);
      aR24_Gr5 := XMLAdrJ + '/Год'     ;   sR24_Gr5 := GetStrVal(aR24_Gr5);

      buf_dR24_010_20003 := buf_dR24_010_50001 := 0;
      buf_vR24_010_20003 := buf_vR24_010_50001 := '';

      if     not GetStrNull(aR24_Gr4)
         and not GetStrNull(aR24_Gr5)
      {
        fl := false;

        CountK := XMLMap.GetNodeCountByName(XMLAdrI + '/АкцизВозм/АкцизВозмКод');
        for (k := 0; k < CountK; k++)
        {
          XMLAdrK := XMLAdrI + '/АкцизВозм/АкцизВозмКод' + getIter(k);

          aR24_Gr1 := XMLAdrK + '/КодПок'    ;
          aR24_Gr2 := XMLAdrK + '/НалБаза'   ;
          aR24_Gr3 := XMLAdrK + '/СумАкциз'  ;   dR24_Gr3 := GetDblVal(aR24_Gr3);
          aR24_Gr4 := XMLAdrK + '/НалПерЭксп';
          aR24_Gr5 := XMLAdrK + '/ГодЭксп'   ;

          if     not GetStrNull(aR24_Gr1)
             and not GetStrNull(aR24_Gr2)
             and not GetStrNull(aR24_Gr3)
             and not GetStrNull(aR24_Gr4)
             and not GetStrNull(aR24_Gr5)
          then  if     (GetStrVal(aR24_Gr4) = sR24_Gr4)
                   and (GetStrVal(aR24_Gr5) = sR24_Gr5)
                {
                  case GetStrVal(aR24_Gr1) of
                    '20003' : { buf_dR24_010_20003 += dR24_Gr3; buf_vR24_010_20003 += GetStrDbl_0(dR24_Gr3) + ' + '; fl := true; }
                    '50001' : { buf_dR24_010_50001 += dR24_Gr3; buf_vR24_010_50001 += GetStrDbl_0(dR24_Gr3) + ' + '; fl := true; }
                  end;
                }
        }

        GetCutStr(buf_vR24_010_20003);
        GetCutStr(buf_vR24_010_50001);

        aR24_Gr3 := XMLAdrJ + '/СумАкциз';

        if fl
        {
          dR24_Gr3 := buf_dR24_010_20003 - buf_dR24_010_50001;   SV(aR24_Gr3, dR24_Gr3);
          vR24_Gr3 := GV(aR24_Gr3)+' = ('+buf_vR24_010_20003+') - ('+buf_vR24_010_50001+')';
          mR24_Gr3 := 'Раздел 2.4, стр. 010, гр. 3 = сумма(Разд.2.4, гр.3, гр.1=20003) - сумма(Разд.2.4, гр.3, гр.1=50001)';
          Log(aR24_Gr3, mR24_Gr3, vR24_Gr3);
        }
        else SetNulVal_Get(aR24_Gr3, dR24_Gr3);
      }
      else SetNulVal_Get(aR24_Gr3, dR24_Gr3);
    }
    // #endregion РАЗДЕЛ 2.4

    // #region РАЗДЕЛ 2.5
    var aR25_Gr1, aR25_Gr2, aR25_Gr3, aR25_Gr4, mR25_Gr3, vR25_Gr3 : string = '';
    var dR25_Gr2, dR25_Gr3 : double;

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РеалПТБГ/РеалПТБГКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/РеалПТБГ/РеалПТБГКод' + getIter(j);

      aR25_Gr1 := XMLAdrJ + '/КодПок'  ;
      aR25_Gr2 := XMLAdrJ + '/НалБаза' ;   dR25_Gr2 := GetDblVal(aR25_Gr2);
      aR25_Gr3 := XMLAdrJ + '/СумАкциз';
      aR25_Gr4 := XMLAdrJ + '/НаличБГ' ;

      if     not GetStrNull(aR25_Gr1)
         and not GetStrNull(aR25_Gr2)
         and not GetStrNull(aR25_Gr4)
      {
        dR25_Gr3 := dR25_Gr2 * valStAkc;   SV(aR25_Gr3, dR25_Gr3);

        if (flProc)
        {
          vR25_Gr3 := GV(aR25_Gr3)+' = '+GV(aR25_Gr2)+' * '+GV(aStAkc)+' / 100';
          mR25_Gr3 := 'Раздел 2.5: Гр. 3 = гр. 2 * Ставку акциза / 100';
        } else {
          vR25_Gr3 := GV(aR25_Gr3)+' = '+GV(aR25_Gr2)+' * '+GV(aStAkc);
          mR25_Gr3 := 'Раздел 2.5: Гр. 3 = гр. 2 * Ставку акциза';
        }

        LogIter(aR25_Gr3, mR25_Gr3, vR25_Gr3, remIter, 4);
      }
      else SetNulVal_Get(aR25_Gr3, dR25_Gr3)
    } // #endregion РАЗДЕЛ 2.5

    // #region РАЗДЕЛ 2.6
    var aR26_Gr1, aR26_Gr2, aR26_Gr3, aR26_Gr4, aR26_Gr5, mR26_Gr3, vR26_Gr3 : string = '';
    var dR26_Gr2, dR26_Gr3 : double;

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РеалПТЕЭС/РеалПТЕЭСКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/РеалПТЕЭС/РеалПТЕЭСКод' + getIter(j);

      aR26_Gr1 := XMLAdrJ + '/КодПок'    ;
      aR26_Gr2 := XMLAdrJ + '/НалБаза'   ;   dR26_Gr2 := GetDblVal(aR26_Gr2);
      aR26_Gr3 := XMLAdrJ + '/СумАкциз'  ;
      aR26_Gr4 := XMLAdrJ + '/НалПерРеал';
      aR26_Gr5 := XMLAdrJ + '/ГодРеал'   ;

      if     not GetStrNull(aR26_Gr1)
         and not GetStrNull(aR26_Gr2)
         and not GetStrNull(aR26_Gr4)
         and not GetStrNull(aR26_Gr5)
      {
        dR26_Gr3 := dR26_Gr2 * valStAkc;   SV(aR26_Gr3, dR26_Gr3);

        if (flProc)
        {
          vR26_Gr3 := GV(aR26_Gr3)+' = '+GV(aR26_Gr2)+' * '+GV(aStAkc)+' / 100';
          mR26_Gr3 := 'Раздел 2.6: Гр. 3 = гр. 2 * Ставку акциза / 100';
        } else {
          vR26_Gr3 := GV(aR26_Gr3)+' = '+GV(aR26_Gr2)+' * '+GV(aStAkc);
          mR26_Gr3 := 'Раздел 2.6: Гр. 3 = гр. 2 * Ставку акциза';
        }

        LogIter(aR26_Gr3, mR26_Gr3, vR26_Gr3, remIter, 5);
      }
      else SetNulVal_Get(aR26_Gr3, dR26_Gr3)
    } // #endregion РАЗДЕЛ 2.6
  } // #endregion РАЗДЕЛ 2

  // #region РАЗДЕЛ 3
  var aR3_060, aR3_070, aR3_080, aR3_090, aR3_100, aR3_110, mR3_100, mR3_110, vR3_100, vR3_110 : string = '';
  var dR3_060, dR3_070, dR3_080, dR3_090, dR3_100, dR3_110 : double;

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкцГаз');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкцГаз' + getIter(i);

    aR3_060 := XMLAdrI + '/ОбъемРеалГаз' ;   dR3_060 := GetDblVal(aR3_060);
    aR3_070 := XMLAdrI + '/СтоимЕдРеал'  ;   dR3_070 := GetDblVal(aR3_070);
    aR3_080 := XMLAdrI + '/СумТаможРеал' ;   dR3_080 := GetDblVal(aR3_080);
    aR3_090 := XMLAdrI + '/РасхТранспГаз';   dR3_090 := GetDblVal(aR3_090);
    aR3_100 := XMLAdrI + '/НалБаза'      ;
    aR3_110 := XMLAdrI + '/СумАкциз'     ;

    if     not GetStrNull(XMLAdrI + '/КодПТ'    ) and not GetStrNull(aR3_060)
       and not GetStrNull(XMLAdrI + '/КодПок'   ) and not GetStrNull(aR3_070)
       and not GetStrNull(XMLAdrI + '/КБК'      ) and not GetStrNull(aR3_080)
       and not GetStrNull(XMLAdrI + '/НомерСогл') and not GetStrNull(aR3_090)
       and not GetStrNull(XMLAdrI + '/ДатаСогл' )
    {
      aStAkc := XMLAdrI + '/СтАкц';
      valStAkc := GetDblVal(aStAkc);

      flProc := (GetDblVal(XMLAdrI + '/ЕдИзм') = KodOKEI_EdIzm_744);
      if (flProc) valStAkc := valStAkc / 100;

      dR3_100 := (dR3_060 * dR3_070) - (dR3_080 + dR3_090);   SV(aR3_100, dR3_100);
      dR3_110 := dR3_100 * valStAkc                       ;   SV(aR3_110, dR3_110);

      vR3_100 := GV(aR3_100)+' = ('+GV(aR3_060)+' * '+GV(aR3_070)+') - ('+GV(aR3_080)+' + '+GV(aR3_090)+')';
      mR3_100 := 'Стр. 100 = (стр. 060 * стр. 070) - (стр. 080 + стр. 090)';

      if (flProc)
      {
        vR3_110 := GV(aR3_110)+' = '+GV(aR3_100)+' * '+GV(aStAkc)+' / 100';
        mR3_110 := 'Стр. 110 = стр. 100 * Ставку акциза / 100';
      } else {
        vR3_110 := GV(aR3_110)+' = '+GV(aR3_100)+' * '+GV(aStAkc);
        mR3_110 := 'Стр. 110 = стр. 100 * Ставку акциза';
      }

      Log(aR3_100, mR3_100, vR3_100);
      Log(aR3_110, mR3_110, vR3_110);
    }
    else
    {
      SetNulVal_Get(aR3_100, dR3_100);
      SetNulVal_Get(aR3_110, dR3_110);
    }
  } // #endregion РАЗДЕЛ 3

  // #region ПРИЛОЖЕНИЕ 1
  var aP1_Gr2, aP1_Gr3, aP1_Gr4, vP1_Gr4, mP1_Gr4 : string = '';
  var dP1_Gr2, dP1_Gr3, dP1_Gr4 : double;

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчНалБаза');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчНалБаза' + getIter(i);

    if GetStrNull(XMLAdrI + '/КодПТ') continue;

    remIter := if(i=0, -1, 1);

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/РасчНалБазаКод');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/РасчНалБазаКод' + getIter(j);

      aP1_Gr2 := XMLAdrJ + '/МощнДвиг';   dP1_Gr2 := GetDblVal(aP1_Gr2);
      aP1_Gr3 := XMLAdrJ + '/КолПТ'   ;   dP1_Gr3 := GetDblVal(aP1_Gr3);
      aP1_Gr4 := XMLAdrJ + '/НалБаза' ;

      if     not GetStrNull(XMLAdrJ + '/КодПок')
         and not GetStrNull(aP1_Gr2            )
         and not GetStrNull(aP1_Gr3            )
      {
        dP1_Gr4 := dP1_Gr2 * dP1_Gr3;   SV(aP1_Gr4, dP1_Gr4);
        vP1_Gr4 := GV(aP1_Gr4)+' = '+GV(aP1_Gr2)+' * '+GV(aP1_Gr3);
        mP1_Gr4 := 'Стр. '+LPadCh(String((j mod 22) + 1), '0', 2)+': гр. 4 = гр. 2 * гр. 3';
        LogIter(aP1_Gr4, mP1_Gr4, vP1_Gr4, remIter, 22);
      }
      else SetNulVal_Get(aP1_Gr4, dP1_Gr4);
    }
  } // #endregion ПРИЛОЖЕНИЕ 1

  // #region ПРИЛОЖЕНИЕ 2.1
  var vP21_030, vP21_040_Gr3, vP21_040_Gr4, vP21_050_Gr4, vP21_060_Gr3, vP21_060_Gr4, vP21_070_Gr4, vP21_090_Gr4
    , aP21_020, aP21_030, aP21_040_Gr3, aP21_040_Gr4, aP21_050_Gr4, aP21_060_Gr3, aP21_060_Gr4, aP21_070_Gr4, aP21_080_Gr4, aP21_090_Gr4, aP21_100_Gr4
    , aP22_150, aP22_160_Gr3, aP22_170_Gr3, aP22_180_Gr3, aP22_190_Gr3, aP22_200_Gr3, aP22_210_Gr3, aP22_220_Gr3
    , aP22_160_Gr4, aP22_170_Gr4, aP22_170_Gr5, aP22_170_Gr6, aP22_180_Gr4, aP22_180_Gr5, aP22_180_Gr6, aP22_190_Gr4, aP22_200_Gr4, aP22_200_Gr5, aP22_200_Gr6
    , aP22_210_Gr4, aP22_210_Gr5, aP22_210_Gr6, aP22_220_Gr4 : string = '';
  var dP21_020, dP21_030, dP21_040_Gr3, dP21_040_Gr4, dP21_050_Gr4, dP21_060_Gr3, dP21_060_Gr4, dP21_070_Gr4, dP21_080_Gr4, dP21_090_Gr4, dP21_100_Gr4
    , dP22_150, dP22_160_Gr3, dP22_170_Gr3, dP22_180_Gr3, dP22_190_Gr3, dP22_200_Gr3, dP22_210_Gr3, dP22_220_Gr3
    , dP22_160_Gr4, dP22_170_Gr4, dP22_180_Gr4, dP22_190_Gr4, dP22_200_Gr4, dP22_210_Gr4, dP22_220_Gr4 : double;

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/РасчАкОсвБГЭксп' + getIter(i);

    if GetStrNull(XMLAdrI + '/КодПТ') continue;

    aStAkc := XMLAdrI + '/СтАкц';
    valStAkc := GetDblVal(aStAkc);

    flProc := (GetDblVal(XMLAdrI + '/ЕдИзм') = KodOKEI_EdIzm_744);
    if (flProc) valStAkc := valStAkc / 100;

    aP21_020     := XMLAdrI + '/ОбщКолБГПер'              ;
    aP21_030     := XMLAdrI + '/ОбщСумБГПер'              ;
    aP21_040_Gr3 := XMLAdrI + '/АкОсвЭкспПер/ОбъемПТ'     ;
    aP21_040_Gr4 := XMLAdrI + '/АкОсвЭкспПер/СумАкциз'    ;
    aP21_050_Gr4 := XMLAdrI + '/АкОсвБГЭкНеПдтвПер'       ;
    aP21_060_Gr3 := XMLAdrI + '/АкОсвЭкспПдтвПер/ОбъемПТ' ;
    aP21_060_Gr4 := XMLAdrI + '/АкОсвЭкспПдтвПер/СумАкциз';
    aP21_070_Gr4 := XMLAdrI + '/АкОсвБГЭкПдтвПред'        ;
    aP21_080_Gr4 := XMLAdrI + '/АкОсвБГЭкПдтвКон'         ;
    aP21_090_Gr4 := XMLAdrI + '/АкОсвБГЭкНеПдтвКон'       ;
    aP21_100_Gr4 := XMLAdrI + '/ПрАкОсвБГПдтвКон'         ;

    dP21_020 := dP21_030 := dP21_040_Gr3 := dP21_040_Gr4 := dP21_050_Gr4 := dP21_060_Gr3 := dP21_060_Gr4 := dP21_070_Gr4 := dP21_080_Gr4 := dP21_090_Gr4 := dP21_100_Gr4 := 0;
    vP21_030 := vP21_040_Gr3 := vP21_040_Gr4 := vP21_050_Gr4 := vP21_060_Gr3 := vP21_060_Gr4 := vP21_070_Gr4 := vP21_090_Gr4 := '';

    // #region ПРИЛОЖЕНИЕ 2.2
    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/БГОсвРеалЭксп');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/БГОсвРеалЭксп' + getIter(j);

      if     not GetStrNull(XMLAdrJ + '/ДатаВыдБГ')
         and not GetStrNull(XMLAdrJ + '/НомерБГ'  )
         and not GetStrNull(XMLAdrJ + '/ДатаНачБГ')
         and not GetStrNull(XMLAdrJ + '/ДатаКонБГ')
         and not GetStrNull(XMLAdrJ + '/СуммаБГ'  )
      {
        aP22_150     := XMLAdrJ + '/СуммаБГ'                     ;   dP22_150     := GetDblVal(aP22_150    );
        aP22_160_Gr3 := XMLAdrJ + '/АкОсвЭкспПер/ОбРеалЭкспПТ'   ;   dP22_160_Gr3 := GetDblVal(aP22_160_Gr3);
        aP22_160_Gr4 := XMLAdrJ + '/АкОсвЭкспПер/СумАкциз'       ;   dP22_160_Gr4 := GetDblVal(aP22_160_Gr4);
        aP22_170_Gr3 := XMLAdrJ + '/АкЭкспНеПдтвНач/ОбРеалЭкспПТ';   dP22_170_Gr3 := GetDblVal(aP22_170_Gr3);
        aP22_170_Gr4 := XMLAdrJ + '/АкЭкспНеПдтвНач/СумАкциз'    ;   dP22_170_Gr4 := GetDblVal(aP22_170_Gr4);
        aP22_170_Gr5 := XMLAdrJ + '/АкЭкспНеПдтвНач/НалПерЭксп'  ;
        aP22_170_Gr6 := XMLAdrJ + '/АкЭкспНеПдтвНач/ГодЭксп'     ;
        aP22_180_Gr3 := XMLAdrJ + '/АкЭкспПдтвПер/ОбРеалЭкспПТ'  ;   dP22_180_Gr3 := GetDblVal(aP22_180_Gr3);
        aP22_180_Gr4 := XMLAdrJ + '/АкЭкспПдтвПер/СумАкциз'      ;   dP22_180_Gr4 := GetDblVal(aP22_180_Gr4);
        aP22_180_Gr5 := XMLAdrJ + '/АкЭкспПдтвПер/НалПерЭксп'    ;
        aP22_180_Gr6 := XMLAdrJ + '/АкЭкспПдтвПер/ГодЭксп'       ;
        aP22_190_Gr3 := XMLAdrJ + '/АкЭкспПдтвПред/ОбРеалЭкспПТ' ;   dP22_190_Gr3 := GetDblVal(aP22_190_Gr3);
        aP22_190_Gr4 := XMLAdrJ + '/АкЭкспПдтвПред/СумАкциз'     ;   dP22_190_Gr4 := GetDblVal(aP22_190_Gr4);
        aP22_200_Gr3 := XMLAdrJ + '/АкЭкспПдтвКон/ОбРеалЭкспПТ'  ;   dP22_200_Gr3 := GetDblVal(aP22_200_Gr3);
        aP22_200_Gr4 := XMLAdrJ + '/АкЭкспПдтвКон/СумАкциз'      ;   dP22_200_Gr4 := GetDblVal(aP22_200_Gr4);
        aP22_200_Gr5 := XMLAdrJ + '/АкЭкспПдтвКон/НалПерЭксп'    ;
        aP22_200_Gr6 := XMLAdrJ + '/АкЭкспПдтвКон/ГодЭксп'       ;
        aP22_210_Gr3 := XMLAdrJ + '/АкЭкспНеПдтвКон/ОбРеалЭкспПТ';   dP22_210_Gr3 := GetDblVal(aP22_210_Gr3);
        aP22_210_Gr4 := XMLAdrJ + '/АкЭкспНеПдтвКон/СумАкциз'    ;   dP22_210_Gr4 := GetDblVal(aP22_210_Gr4);
        aP22_210_Gr5 := XMLAdrJ + '/АкЭкспНеПдтвКон/НалПерЭксп'  ;
        aP22_210_Gr6 := XMLAdrJ + '/АкЭкспНеПдтвКон/ГодЭксп'     ;
        aP22_220_Gr3 := XMLAdrJ + '/ПрАкЭкспПдтвКон'             ;   dP22_220_Gr3 := GetDblVal(aP22_220_Gr3);

        if not GetStrNull(aP22_160_Gr3) {
          dP22_160_Gr4 := dP22_160_Gr3 * valStAkc;   SV(aP22_160_Gr4, dP22_160_Gr4);
          LogProc(aP22_160_Gr4, 'Стр. 160, гр. 4 = стр. 160, гр. 3 * Ставку акциза', GV(aP22_160_Gr4)+' = '+GV(aP22_160_Gr3)+' * '+GV(aStAkc), flProc);
        } else {
          SetNulVal_Get(aP22_160_Gr3, dP22_160_Gr3);
          SetNulVal_Get(aP22_160_Gr4, dP22_160_Gr4);
        }

        if     not GetStrNull(aP22_170_Gr3)
           and not GetStrNull(aP22_170_Gr5)
           and not GetStrNull(aP22_170_Gr6)
        {
          dP22_170_Gr4 := dP22_170_Gr3 * valStAkc;   SV(aP22_170_Gr4, dP22_170_Gr4);
          LogProc(aP22_170_Gr4, 'Стр. 170, гр. 4 = стр. 170, гр. 3 * Ставку акциза', GV(aP22_170_Gr4)+' = '+GV(aP22_170_Gr3)+' * '+GV(aStAkc), flProc)
        } else {
          SetNulVal_Get(aP22_170_Gr3, dP22_170_Gr3);
          SetNulVal_Get(aP22_170_Gr4, dP22_170_Gr4);
        }

        if     not GetStrNull(aP22_180_Gr3)
           and not GetStrNull(aP22_180_Gr5)
           and not GetStrNull(aP22_180_Gr6)
        {
          dP22_180_Gr4 := dP22_180_Gr3 * valStAkc;   SV(aP22_180_Gr4, dP22_180_Gr4);
          LogProc(aP22_180_Gr4, 'Стр. 180, гр. 4 = стр. 180, гр. 3 * Ставку акциза', GV(aP22_180_Gr4)+' = '+GV(aP22_180_Gr3)+' * '+GV(aStAkc), flProc);
        } else {
          SetNulVal_Get(aP22_180_Gr3, dP22_180_Gr3);
          SetNulVal_Get(aP22_180_Gr4, dP22_180_Gr4);
        }

        if not GetStrNull(aP22_190_Gr3) {
          dP22_190_Gr4 := dP22_190_Gr3 * valStAkc;   SV(aP22_190_Gr4, dP22_190_Gr4);
          LogProc(aP22_190_Gr4, 'Стр. 190, гр. 4 = стр. 190, гр. 3 * Ставку акциза', GV(aP22_190_Gr4)+' = '+GV(aP22_190_Gr3)+' * '+GV(aStAkc), flProc);
        } else {
          SetNulVal_Get(aP22_190_Gr3, dP22_190_Gr3);
          SetNulVal_Get(aP22_190_Gr4, dP22_190_Gr4);
        }

        if     not GetStrNull(aP22_200_Gr5)
           and not GetStrNull(aP22_200_Gr6)
           and ( (     not GetStrNull(aP22_180_Gr3)
                   and not GetStrNull(aP22_180_Gr4)
                   and not GetStrNull(aP22_180_Gr5)
                   and not GetStrNull(aP22_180_Gr6)
                 ) or (
                       not GetStrNull(aP22_190_Gr3)
                   and not GetStrNull(aP22_190_Gr4) )
               )
        {
          dP22_200_Gr3 := dP22_180_Gr3 + dP22_190_Gr3;   SV(aP22_200_Gr3, dP22_200_Gr3);
          dP22_200_Gr4 := dP22_180_Gr4 + dP22_190_Gr4;   SV(aP22_200_Gr4, dP22_200_Gr4);

          Log(aP22_200_Gr3, 'Стр. 200, гр. 3 = стр. 180, гр. 3 + стр. 190, гр. 3', GV(aP22_200_Gr3)+' = '+GV(aP22_180_Gr3)+' + '+GV(aP22_190_Gr3));
          Log(aP22_200_Gr4, 'Стр. 200, гр. 4 = стр. 180, гр. 4 + стр. 190, гр. 4', GV(aP22_200_Gr4)+' = '+GV(aP22_180_Gr4)+' + '+GV(aP22_190_Gr4));
        }
        else
        {
          SetNulVal_Get(aP22_200_Gr3, dP22_200_Gr3);
          SetNulVal_Get(aP22_200_Gr4, dP22_200_Gr4);
        }

        if     not GetStrNull(aP22_210_Gr5)
           and not GetStrNull(aP22_210_Gr6)
        {
          if     not GetStrNull(aP22_180_Gr3)
             and not GetStrNull(aP22_180_Gr4)
             and not GetStrNull(aP22_180_Gr5)
             and not GetStrNull(aP22_180_Gr6)
          {
            if     not GetStrNull(aP22_170_Gr3)
               and not GetStrNull(aP22_170_Gr4)
               and not GetStrNull(aP22_170_Gr5)
               and not GetStrNull(aP22_170_Gr6)
            {
              dP22_210_Gr3 := dP22_170_Gr3 - dP22_180_Gr3;  SV(aP22_210_Gr3, dP22_210_Gr3);
              Log(aP22_210_Gr3, 'Стр. 210, гр. 3 = стр. 170, гр. 3 - стр. 180, гр. 3', GV(aP22_210_Gr3)+' = '+GV(aP22_170_Gr3)+' - '+GV(aP22_180_Gr3));
            } else {
              dP22_210_Gr3 := dP22_160_Gr3 - dP22_180_Gr3;  SV(aP22_210_Gr3, dP22_210_Gr3);
              Log(aP22_210_Gr3, 'Стр. 210, гр. 3 = стр. 160, гр. 3 - стр. 180, гр. 3', GV(aP22_210_Gr3)+' = '+GV(aP22_160_Gr3)+' - '+GV(aP22_180_Gr3));
            }
          }
          else
            if     not GetStrNull(aP22_160_Gr3)
               and not GetStrNull(aP22_160_Gr4)
            {
              dP22_210_Gr3 := dP22_160_Gr3;  SV(aP22_210_Gr3, dP22_210_Gr3);
              Log(aP22_210_Gr3, 'Стр. 210, гр. 3 = стр. 160, гр. 3', GV(aP22_210_Gr3)+' = '+GV(aP22_160_Gr3));
            }
            else SetNulVal_Get(aP22_210_Gr3, dP22_210_Gr3);
        }
        else SetNulVal_Get(aP22_210_Gr3, dP22_210_Gr3);

        if     not GetStrNull(aP22_210_Gr3)
           and not GetStrNull(aP22_210_Gr5)
           and not GetStrNull(aP22_210_Gr6)
        {
          dP22_210_Gr4 := dP22_210_Gr3 * valStAkc;   SV(aP22_210_Gr4, dP22_210_Gr4);
          LogProc(aP22_210_Gr4, 'Стр. 210, гр. 4 = стр. 210, гр. 3 * Ставку акциза', GV(aP22_210_Gr4)+' = '+GV(aP22_210_Gr3)+' * '+GV(aStAkc), flProc);
        }
        else SetNulVal_Get(aP22_210_Gr4, dP22_210_Gr4);

        if    not GetStrNull(aP22_160_Gr4)
           or not GetStrNull(aP22_200_Gr4)
        {
          dP22_220_Gr3 := dP22_160_Gr4 - dP22_200_Gr4;   SV(aP22_220_Gr3, dP22_220_Gr3);
          Log(aP22_220_Gr3, 'Стр. 220, гр. 3 = стр. 160, гр. 4 - стр. 200, гр. 4', GV(aP22_220_Gr3)+' = '+GV(aP22_160_Gr4)+' - '+GV(aP22_200_Gr4));
        }
        else SetNulVal_Get(aP22_220_Gr3, dP22_220_Gr3);

        dP21_020     += 1           ;
        dP21_030     += dP22_150    ;   vP21_030     := GetStrDbl_0(dP22_150    ) + ' + ';
        dP21_040_Gr3 += dP22_160_Gr3;   vP21_040_Gr3 := GetStrDbl_3(dP22_160_Gr3) + ' + ';
        dP21_040_Gr4 += dP22_160_Gr4;   vP21_040_Gr4 := GetStrDbl_0(dP22_160_Gr4) + ' + ';
        dP21_050_Gr4 += dP22_170_Gr4;   vP21_050_Gr4 := GetStrDbl_0(dP22_170_Gr4) + ' + ';
        dP21_060_Gr3 += dP22_180_Gr3;   vP21_060_Gr3 := GetStrDbl_3(dP22_180_Gr3) + ' + ';
        dP21_060_Gr4 += dP22_180_Gr4;   vP21_060_Gr4 := GetStrDbl_0(dP22_180_Gr4) + ' + ';
        dP21_070_Gr4 += dP22_190_Gr4;   vP21_070_Gr4 := GetStrDbl_0(dP22_190_Gr4) + ' + ';
        dP21_090_Gr4 += dP22_210_Gr4;   vP21_090_Gr4 := GetStrDbl_0(dP22_210_Gr4) + ' + ';
      }
    } // #endregion ПРИЛОЖЕНИЕ 2.2

                               SV(aP21_020    , dP21_020    );   Log(aP21_020    , 'Стр. 020 = количество(Прил.2.2)'                   , GV(aP21_030    )+' = '+String(CountJ));
    GetCutStr(vP21_030    );   SV(aP21_030    , dP21_030    );   Log(aP21_030    , 'Стр. 030 = сумма(Прил.2.2, стр. 150)'              , GV(aP21_030    )+' = '+vP21_030      );
    GetCutStr(vP21_040_Gr3);   SV(aP21_040_Gr3, dP21_040_Gr3);   Log(aP21_040_Gr3, 'Стр. 040, гр. 3 = сумма(Прил.2.2, стр. 160, гр. 3)', GV(aP21_040_Gr3)+' = '+vP21_040_Gr3  );
    GetCutStr(vP21_040_Gr4);   SV(aP21_040_Gr4, dP21_040_Gr4);   Log(aP21_040_Gr4, 'Стр. 040, гр. 4 = сумма(Прил.2.2, стр. 160, гр. 4)', GV(aP21_040_Gr4)+' = '+vP21_040_Gr4  );
    GetCutStr(vP21_050_Gr4);   SV(aP21_050_Gr4, dP21_050_Gr4);   Log(aP21_050_Gr4, 'Стр. 050, гр. 4 = сумма(Прил.2.2, стр. 170, гр. 4)', GV(aP21_050_Gr4)+' = '+vP21_050_Gr4  );
    GetCutStr(vP21_060_Gr3);   SV(aP21_060_Gr3, dP21_060_Gr3);   Log(aP21_060_Gr3, 'Стр. 060, гр. 3 = сумма(Прил.2.2, стр. 180, гр. 3)', GV(aP21_060_Gr3)+' = '+vP21_060_Gr3  );
    GetCutStr(vP21_060_Gr4);   SV(aP21_060_Gr4, dP21_060_Gr4);   Log(aP21_060_Gr4, 'Стр. 060, гр. 4 = сумма(Прил.2.2, стр. 180, гр. 4)', GV(aP21_060_Gr4)+' = '+vP21_060_Gr4  );
    GetCutStr(vP21_070_Gr4);   SV(aP21_070_Gr4, dP21_070_Gr4);   Log(aP21_070_Gr4, 'Стр. 070, гр. 4 = сумма(Прил.2.2, стр. 190, гр. 4)', GV(aP21_070_Gr4)+' = '+vP21_070_Gr4  );
    GetCutStr(vP21_090_Gr4);   SV(aP21_090_Gr4, dP21_090_Gr4);   Log(aP21_090_Gr4, 'Стр. 090, гр. 4 = сумма(Прил.2.2, стр. 210, гр. 4)', GV(aP21_090_Gr4)+' = '+vP21_090_Gr4  );

    dP21_080_Gr4 := dP21_060_Gr4 + dP21_070_Gr4;   SV(aP21_080_Gr4, dP21_080_Gr4);
    dP21_100_Gr4 := dP21_040_Gr4 - dP21_080_Gr4;   SV(aP21_100_Gr4, dP21_100_Gr4);

    Log(aP21_080_Gr4, 'Стр. 080, гр. 4 = стр. 060, гр. 4 + стр. 070, гр. 4', GV(aP21_080_Gr4)+' = '+GV(aP21_060_Gr4)+' + '+GV(aP21_070_Gr4));
    Log(aP21_100_Gr4, 'Стр. 100, гр. 4 = стр. 040, гр. 4 - стр. 080, гр. 4', GV(aP21_100_Gr4)+' = '+GV(aP21_040_Gr4)+' - '+GV(aP21_080_Gr4));
  } // #endregion ПРИЛОЖЕНИЕ 2.1

  // #region ПРИЛОЖЕНИЕ 3
  var dP3_050, dP3_060_Gr3, dP3_060_Gr6 : double;
  var aP3_050, vP3_050, aP3_060_Gr3, aP3_060_Gr6 : string;

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/БензПолучСвид');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/БензПолучСвид' + getIter(i);

    if    GetStrNull(XMLAdrI + '/СерСвидПост'          )
       or GetStrNull(XMLAdrI + '/НомСвидПост'          )
       or GetStrNull(XMLAdrI + '/ОбПолБензПер650/КодПТ') continue;

    if   ( GetStrNull(XMLAdrI + '/ПоставОрг/НаимОрг'   )
       and GetStrNull(XMLAdrI + '/ПоставОрг/ИННЮЛ'     )
       and GetStrNull(XMLAdrI + '/ПоставОрг/КПП'       ) )
     and (
           GetStrNull(XMLAdrI + '/ПоставИП/ИННФЛ'      )
       and GetStrNull(XMLAdrI + '/ПоставИП/ФИО/Фамилия')
       and GetStrNull(XMLAdrI + '/ПоставИП/ФИО/Имя'    ) ) continue;

    dP3_050 := 0;
    vP3_050 := '';
    aP3_050 := XMLAdrI + '/ОбПолБензПер650/ОбПолучБензПер';

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СвОбБензСчФ');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/СвОбБензСчФ' + getIter(j);

      if    GetStrNull(XMLAdrJ + '/НомСчФ' )
         or GetStrNull(XMLAdrJ + '/ДатаСчФ')
         or GetStrNull(XMLAdrJ + '/ОбСпСчФ') continue;

      aP3_060_Gr3 := XMLAdrJ + '/ОбСпСчФ' ;   dP3_060_Gr3 := GetDblVal(aP3_060_Gr3);
      aP3_060_Gr6 := XMLAdrJ + '/ОбСпКСчФ';   dP3_060_Gr6 := GetDblVal(aP3_060_Gr6);

      if GetStrNull(aP3_060_Gr6)
      {
        dP3_050 += dP3_060_Gr3;
        vP3_050 += GetStrDbl_3(dP3_060_Gr3) + ' + ';
      } else {
        dP3_050 += dP3_060_Gr6;
        vP3_050 += GetStrDbl_3(dP3_060_Gr6) + ' + ';
      }
    }

    GetCutStr(vP3_050);   SV(aP3_050, dP3_050);
    Log(aP3_050, 'Стр. 050 = сумма(стр. 060, гр 3 (или гр. 6, если она заполнена))', GV(aP3_050)+' = '+vP3_050);
  } // #endregion ПРИЛОЖЕНИЕ 3

  // #region ПРИЛОЖЕНИЕ 4
  var dP4_050, dP4_060_Gr3, dP4_060_Gr6 : double;
  var aP4_050, vP4_050, aP4_060_Gr3, aP4_060_Gr6 : string;

  CountI := XMLMap.GetNodeCountByName('Файл/Документ/АкцАвтоНефт/БензРеалСвид');
  for (i := 0; i < CountI; i++)
  {
    XMLAdrI := 'Файл/Документ/АкцАвтоНефт/БензРеалСвид' + getIter(i);

    if    GetStrNull(XMLAdrI + '/СерСвидПол'            )
       or GetStrNull(XMLAdrI + '/НомСвидПол'            )
       or GetStrNull(XMLAdrI + '/ОбРеалБензПер650/КодПТ') continue;

    if   ( GetStrNull(XMLAdrI + '/ПолучОрг/НаимОрг'   )
       and GetStrNull(XMLAdrI + '/ПолучОрг/ИННЮЛ'     )
       and GetStrNull(XMLAdrI + '/ПолучОрг/КПП'       ) )
     and (
           GetStrNull(XMLAdrI + '/ПолучИП/ИННФЛ'      )
       and GetStrNull(XMLAdrI + '/ПолучИП/ФИО/Фамилия')
       and GetStrNull(XMLAdrI + '/ПолучИП/ФИО/Имя'    ) ) continue;

    dP4_050 := 0;
    vP4_050 := '';
    aP4_050 := XMLAdrI + '/ОбРеалБензПер650/ОбРеалБензПер';

    CountJ := XMLMap.GetNodeCountByName(XMLAdrI + '/СвОбБензСчФ');
    for (j := 0; j < CountJ; j++)
    {
      XMLAdrJ := XMLAdrI + '/СвОбБензСчФ' + getIter(j);

      if    GetStrNull(XMLAdrJ + '/НомСчФ' )
         or GetStrNull(XMLAdrJ + '/ДатаСчФ')
         or GetStrNull(XMLAdrJ + '/ОбСпСчФ') continue;

      aP4_060_Gr3 := XMLAdrJ + '/ОбСпСчФ' ;   dP4_060_Gr3 := GetDblVal(aP4_060_Gr3);
      aP4_060_Gr6 := XMLAdrJ + '/ОбСпКСчФ';   dP4_060_Gr6 := GetDblVal(aP4_060_Gr6);

      if GetStrNull(aP4_060_Gr6)
      {
        dP4_050 += dP4_060_Gr3;
        vP4_050 += GetStrDbl_3(dP4_060_Gr3) + ' + ';
      } else {
        dP4_050 += dP4_060_Gr6;
        vP4_050 += GetStrDbl_3(dP4_060_Gr6) + ' + ';
      }
    }

    GetCutStr(vP4_050);   SV(aP4_050, dP4_050);
    Log(aP4_050, 'Стр. 050 = сумма(стр. 060, гр 3 (или гр. 6, если она заполнена))', GV(aP4_050)+' = '+vP4_050);
  } // #endregion ПРИЛОЖЕНИЕ 4
@end.
//#endregion ДЕЙСТВИЯ ВЫПОЛНЯЕМЫЕ ПРИ РАСЧЕТЕ
//************************************************************************************************************


//============================================================================================================
//#region ДЕЙСТВИЯ ВЫПОЛНЯЕМЫЕ ПРИ ЭКСПОРТЕ В XML
//------------------------------------------------------------------------------------------------------------
@Script On_ExportXML : boolean;
@begin
  SetFldVal('Файл/ИдФайл', Replace(_IdFail_, '.xml', ''));

  if (not XMLMap.ExpToXml(_XmlFileName_)) {
    Message('On_ExportXML: '+ XMLMap.GetStLastError, cancelButton+Warning);
    Exit;
  }

  message('Выгружен в файл ' + _XmlFileName_);
@end.
//#endregion ДЕЙСТВИЯ ВЫПОЛНЯЕМЫЕ ПРИ ЭКСПОРТЕ В XML
//************************************************************************************************************
