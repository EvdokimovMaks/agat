//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 9.10 - модуль "Управление бюджетом"
// Библиотека функций : "Распределение агрегатов аналитик"
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// Список "листовых" значений распределяемого агрегата
Table struct TblLeafList
(
  NRec       : comp       // номер записи (FpValues.NRec)
, cPeriod    : comp       // период
, cHashAn    : comp       // аналитика
, Summa      : double     // прежняя сумма (FpValues.Summa)
)
with index
(
  TblLeafList01 = NRec
);

//------------------------------------------------------------------------------
// Список "базовых" агрегатов
Table struct TblBaseAgrList
(
  NRec       : comp       // номер записи
, cNode      : comp       // вышестоящий
, KodGrKau   : word       // код аналитики
, cMean      : comp       // значение аналитики
, Name       : TName      // наименование значения аналитики
, Code       : s20        // код для сортировки
, Sum        : double     // сумма
, isAxisAgr  : boolean    // является ли агрегатом на оси
, ArrayIndex : LongInt    //
)
with index
(
  TblBaseAgrList01 = NRec (AutoInc, Unique)
, TblBaseAgrList02 = cMean + KodGrKau
, TblBaseAgrList03 = cNode + Code
);

//------------------------------------------------------------------------------
// Список "листовых" значений аналитик
Table struct TblAnLeaf
(
  NRec       : comp       // номер записи
, wAn        : word       // код аналитик
, MID        : TSurrPtr   // список значений аналитики
)
with index
(
  TblAnLeaf01 = NRec (AutoInc, Unique)
);

//------------------------------------------------------------------------------
// Список "листовых" значений агрегата иерархии статей
Table struct TblHierStBudLeaf
(
  NRec       : comp       // номер записи
, cStBud     : comp       // статья бюджета
, OldSum     : double     // прежняя сумма
, NewSum     : double     // новая сумма
, LeafAnCount: LongInt    // количество "листовых" аналитик по статье
)
with index
(
  TblHierStBudLeaf01 = NRec (AutoInc, Unique)
);

//------------------------------------------------------------------------------
// Список "листовых" значений агрегата иерархии
Table struct TblHierLeaf
(
  NRec       : comp       // номер записи
, cMain      : comp       // ссылка на TblHierStBudLeaf
, cStBud     : comp       // статья бюджета
, CAnID      : TSurrPtr   // контерйнер аналитик
, OldSum     : double     // прежняя сумма
, NewSum     : double     // новая сумма
, isRasp     : boolean    // требуется ли распределять по этому значению
)
with index
(
  TblHierLeaf01 = NRec (AutoInc, Unique)
, TblHierLeaf02 = cMain
);
