//******************************************************************************
//                                                      (c) корпорация Галактика
// Галактика 8.1 - логистика
// Вычисляемые поля коректировочных документов
//******************************************************************************

//-----------------------------------------------------------------------------
// старое кол-во
, oCorrDocFun.GetKDKolOld(SpSopr.cADocSp, SpSopr.cSopr)
         (FieldName = KDKolOld)
//-----------------------------------------------------------------------------
// новое в кол-во
, KDKolOld + if (SpSopr.Kol <> 0, SpSopr.KolOpl, 0)
         (FieldName = KDKolNew)
//-----------------------------------------------------------------------------
// разница в кол-ве
, KDKolNew - KDKolOld
         (FieldName = KDKolDiff)
//-----------------------------------------------------------------------------
// старая стоимость
, oCorrDocFun.GetKDSummaOld(SpSopr.cADocSp, SpSopr.cSopr, KatSopr.cVal)
         (FieldName = KDSummaOld)
//-----------------------------------------------------------------------------
// старая стоимость (без округления)
, oCorrDocFun.GetKDSummaOld2(SpSopr.cADocSp, SpSopr.cSopr, KatSopr.cVal)
         (FieldName = KDSummaOld2)
//-----------------------------------------------------------------------------
// новая стоимость
, if (KatSopr.cVal = 0, oSDFuns.FSRoundRub(KatSopr.VidSopr, SpSopr.Price  * SpSopr.KolOpl)
                      , oSDFuns.FSRoundVal(KatSopr.VidSopr, SpSopr.VPrice * SpSopr.KolOpl))
  + oCorrDocFun.GetKDSummaOld(SpSopr.cADocSp, SpSopr.cSopr, KatSopr.cVal)
         (FieldName = KDSummaNew)
//-----------------------------------------------------------------------------
// новая стоимость (без округления)
, if (KatSopr.cVal = 0, SpSopr.rPrice, SpSopr.rVPrice) * SpSopr.KolOpl
  + oCorrDocFun.GetKDSummaOld2(SpSopr.cADocSp, SpSopr.cSopr, KatSopr.cVal)
         (FieldName = KDSummaNew2)
//-----------------------------------------------------------------------------
// разница в стоимости
, KDSummaNew - KDSummaOld
         (FieldName = KDSummaDiff)
//-----------------------------------------------------------------------------
// старая цена
// ERP-1521 - Дабы избежать деления на 0 и исключения при вычислении поля
, KDSummaOld2 * if(KDKolOld=1,1.00,1/ if(KDKolOld=0, 1.00, KDKolOld ) )
         (FieldName = KDPriceOld)
//-----------------------------------------------------------------------------
// новая цена  ERP-1336 если кол-во 0, приравняем старой цене
// ERP-1521 - Дабы избежать деления на 0 и исключения при вычислении поля
, if(KDKolNew=0,KDPriceOld, KDSummaNew2 / if(KDKolNew=0,1.00, KDKolNew ) )
         (FieldName = KDPriceNew)
//-----------------------------------------------------------------------------
// разница в цене
, KDPriceNew - KDPriceOld
         (FieldName = KDPriceDiff)
//-----------------------------------------------------------------------------
// старые налоги
, oCorrDocFun.GetKDNalogOld(SpSopr.cADocSp, SpSopr.cSopr, KatSopr.cVal)
         (FieldName = KDNalogOld)
//-----------------------------------------------------------------------------
// новые налоги
, if (KatSopr.cVal = 0, SpSopr.SumNDS, SpSopr.SumVNDS)
  + oCorrDocFun.GetKDNalogOld(SpSopr.cADocSp, SpSopr.cSopr, KatSopr.cVal)
         (FieldName = KDNalogNew)
//-----------------------------------------------------------------------------
// разница в налогах
, KDNalogNew - KDNalogOld
         (FieldName = KDNalogDiff)
//-----------------------------------------------------------------------------
