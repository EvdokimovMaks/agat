//------------------------------------------------------------------------------------------------------------
//                                                      (c) Корпорация ГАЛАКТИКА
// Галактика 9.2
// Дополнительные банковские карты сотрудника
//------------------------------------------------------------------------------------------------------------
#Component "Z_BankCard"
//------------------------------------------------------------------------------------------------------------
#doc
Банковские карты
#end

#include ZBankCard.inc

ObjInterface ObjZBankCard;
  #doc
  Инициализация выборки данных
  Параметры:
  cRecLsch_ - Lschet.nRec
  #end
  procedure InitStore(cRecLsch_ : comp);

  #doc
  Получить номер корпоративной карты сотрудника
  #end
  function fsGetCorpoNumderCard: string;

  #doc
  Получить ссылку на банк по номеру карты сотрудника
  #end
  function fsGetBankCard(sNumberCard: string): comp;

  #doc
  Получить ссылку на подразделение по номеру карты сотрудника
  #end
  function fsGetPodrCard(sNumberCard: string): comp;

  #doc
  Получить ссылку на лицевой счет сотрудника (Lschet.nRec) по номеру карты сотрудника
  #end
  function fsGetcRecLschCard(sNumberCard: string): comp;

end;

ObjInterface ObjZBankCard_Ext;
  #doc
  Получить ссылку на лицевой счет сотрудника (Lschet.nRec) по номеру карты сотрудника и
  ссылку на таблицу Persons (Persons.nRec)
  #end
  function fsGetcRecLschandPersonCard(sNumberCard: string; var cRecPerson: comp): comp;

end;

ObjInterface ObjZBankCard_Ext2;
  #doc
  Импорт банковских реквизитов сотрудника
    Параметры:
    cRecLsch_    - ссылка на лицевой счет сотрудника (LSchet.nRec), для которого поступают данные о реквизитах
    wTypeOfDoc_  - параметр вида записи (const Money.ccm):
                     основные банковские реквизиты                        (const cnCard_Salary),
                     данные дополнительного банка (заработная плата)      (const cnCard_SalaryDop),
                     данные основного банка для межрасчетных выплат       (const cnCard_SalaryMP),
                     данные дополнительного банка для межрасчетных выплат (const cnCard_SalaryMPDop)
    sNumSch_     - номер лицевого счета
    cKatOrgBank_ - ссылка на организацию-получателя (KATORGBANK.NREC)
    cKatBank_    - ссылка на банк (KATBANK.NREC)
    dtBeg_       - дата начала действия записи
    dtValid_     - дата окончания действия записи
  Функция возвращает результат выполнения импорта:
    0 - произошла ошибка добавления
    1 - добавлена новая запись о реквизите
    2 - обновлена запись о реквизите
    3 - запись о реквизите не изменилась
  #end
  function fwImportBankCard(cRecLsch_ : comp; wTypeOfDoc_: word; sNumSch_: tName; cKatOrgBank_, cKatBank_: comp; dtBeg_, dtValid_: date): word;

  #doc
    Сохранение данных
  #end
  procedure DoneStore;
end;

ObjInterface ObjZBank_Card;
  property _cRecPerson   : comp read write; // #docl Persons.nRec
  property _cRecLschet   : comp read write; // #docl Lschet.nRec
  property _wParHyperLink: word read write;

  function fboAddNewCard(coTable: word; cRec: comp): boolean;
  procedure pSetRelation(cRecLschet_, cRecPerson_: comp);
  procedure pReDrawCard;
  procedure pDeleteBankCardLS(cRecPerson_: comp);
  procedure pSetCardFSS(cRecCard_: comp);
  procedure pSetEditWin(wParEdit_: word);
  event procedure OnSetCardDefault(cRecCard: comp);
  event procedure pRereadRecordLSCHET;
end;

#doc
Просмотр
#end
objinterface ObjZBank_CardVIEW;
  #doc
  Просмотр
  #end
  procedure pRunWindowBankCard(cBankCard_: comp);
end;

#doc
Дополнительные возможности, позиционирование на карту по условиям
#end
objinterface ObjZBank_Card_Ext3;
  #doc
  Дополнительные возможности, позиционирование на карту по условиям
  #end
  procedure pSetRelationAdv(cRecLschet_, cRecPerson_: comp; wTypeUse: word; cOrg_, cBank_: comp);
end;

#doc
Дополнительные возможности, получение окружения карты по номеру
#end
ObjInterface ObjZBankCard_Ext4;
  #doc
    Получение наименование платежной системы по константе cnPay_
  #end
  function fGetPaySystemName(cnPay_ : word): string;

  #doc
    Получение признака основной карты по номеру карты сотрудника
  #end
  function fIsBankCardBase(sNumberCard_: string): boolean;
  #doc
    Получение признака использования карты для выплат ФСС по номеру карты сотрудника
  #end
  function fIsBankCardFSS(sNumberCard_: string): boolean;
  #doc
    Получение признака использования карты для выплат аванса по номеру карты сотрудника
  #end
  function fIsBankCardAvans(sNumberCard_: string): boolean;
  #doc
    Получение признака использования карты для выплат з/п по номеру карты сотрудника
  #end
  function fIsBankCardSalary(sNumberCard_: string): boolean;
end;

//------------------------------------------------------------------------------------------------------------
VipInterface ZBankCard implements ObjZBankCard, ObjZBankCard_Ext, ObjZBankCard_Ext2
  Licensed   (FREE)
Parameters(
  cRecLschet : comp;
  cRecPerson : comp = 0;
  sNumberCard: string = '';
  pwMode     : word = cgiNo
  );
//------------------------------------------------------------------------------------------------------------
VipInterface ZBank_Card implements ObjZBank_Card, ObjZBankCard, ObjZBankCard_Ext, ObjZBankCard_Ext2,
                                   ObjZBank_CardVIEW, ObjZBank_Card_Ext3, ObjZBankCard_Ext4
  Licensed   (FREE)
Parameters(
  cRecLschet : comp;
  cRecPerson : comp = 0;
  cRecZBankCard: comp = 0;
  pwMode     : word = cgiNo
  );
