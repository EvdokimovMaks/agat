// =============================================================================
//                                                     (c)  корпорация Галактика
// Галактика 8.0 - Производственный контур
// Объект для работы со связями позиций журнала резервирования
// =============================================================================

#ifdef ComponentVersion
#component "M_MnPlan"
#end

Table Struct LinkWithRsvOper
(
  NRec : Comp,
  cPos : Comp,
  cPrev: Comp,
  cNext: Comp
)
With Index
(
  LinkWithRsvOper01 = NRec(Unique, Surrogate),
  LinkWithRsvOper02 = cPos + cPrev + cNext,
  LinkWithRsvOper03 = cPos + cNext + cPrev,
  LinkWithRsvOper04 = cPrev + cNext,
  LinkWithRsvOper05 = cNext + cPrev
)
;

Type stModif_RSV = Record
  Flag   : Word;
  wMode  : Word;
  wState : Word;
  wStatus: Word;
  FlagRun: Word;
  wValue1: Word;
  wValue2: Word;
  cParty : Comp;
  cValue1: Comp;
  cValue2: Comp;
  dValue1: Double;
  dValue2: Double;
  dValue3: Double;
  dtTime1: _DateTime;
  dtTime2: _DateTime;
End;

#doc
 Описание интерфейса "Объект для работы со связями позиций журнала резервирования"</brief>
#end
ObjInterface oRsvOperLink;

#doc
 Получить предыдущие и (или) последущие позиции</brief><br>
 Параметры:<br>
   cPos    - NRec позиции журнала, для которой необходимо получить предыдущие и последующие позиции<br>
   wDirect - направление (0 - предыдущие; 1 - последующие; 2 - предыдущие и последующие)<br>
   wLevel  - уровень разузлования; 1 - первый уровень, другое значение - полностью разузловывает<br>
   stm     - структура параметров<br>
             stm.Flag - ,битовая маска = 1 - заполнение таблицы для последующей работы со связями<br>
                                         2 - суммирование трудоемкости по журналу в stm.dValue1<br>
 Результат:<br>
   Для Flag = 1 - True, если есть хотя бы одна связь, иначе - False<br>
#end
Function GoLinksRsvOper( cPos: Comp; wDirect: Word; wLevel: Word; Var stm: stModif_RSV ): Boolean;

#doc
 Получить первую предыдущую позицию</brief><br>
 Параметры:<br>
   cPos  - NRec позиции журнала, для которой ннеобходимо найти предыдущие <br>
   cPrev - возвращается NRec предыдущей позиции журнала <br>
 Результат:<br>
   True, если успешно, иначе - False<br>
#end
Function GetFirst_PrevPos( cPos: Comp; Var cPrev: Comp ): Boolean;

#doc
 Получить следующую предыдущую позицию</brief><br>
 Параметры:<br>
   cPos  - NRec позиции журнала, для которой ннеобходимо найти предыдущие <br>
   cPrev - возвращается NRec предыдущей позиции журнала <br>
 Результат:<br>
   True, если успешно, иначе - False<br>
#end
Function GetNext_PrevPos( cPos: Comp; Var cPrev: Comp ): Boolean;

#doc
 Получить первую последующую позицию</brief><br>
 Параметры:<br>
   cPos  - NRec позиции журнала, для которой ннеобходимо найти последующую <br>
   cNext - возвращается NRec последующей позиции журнала <br>
 Результат:<br>
   True, если успешно, иначе - False<br>
#end
Function GetFirst_NextPos( cPos: Comp; Var cNext: Comp ): Boolean;

#doc
 Получить следующую последующую позицию</brief><br>
 Параметры:<br>
   cPos  - NRec позиции журнала, для которой ннеобходимо найти последующую <br>
   cNext - возвращается NRec последующей позиции журнала <br>
 Результат:<br>
   True, если успешно, иначе - False<br>
#end
Function GetNext_NextPos( cPos: Comp; Var cNext: Comp ): Boolean;

#doc
 Чистит таблицу LinkWithRsvOper </brief><br>
 Обязательно запускать после окончания работы со связями<br>
 Результат:<br>
   True, если успешно, иначе - False<br>
#end
Function ClearLinks: Boolean;


#doc
  Изменение статуса и состояния в записях RsvOper(текущей и последующих операциях)</brief><br>
 Параметры:<br>
   _cRsvOper  - NRec позиции журнала, для которой необходимо найти последующую <br>
   _NewStatus - Новое значение статуса позиции <br>
   _OldStatus - Старое значение статуса позиции <br>
   wSost      - Старое/новое значение состояния <br>
 Результат:<br>
   True, если успешно, иначе - False<br>
#end
Function NewPosStatus(_cRsvOper: comp; _NewStatus: word; _OldStatus: word;
                      var wSost: word; var UslFlag: word):boolean;

//#doc
//   Создание связи позиции журнала с позицией различных документов (накладная, план)</brief><br>
// Параметры:<br>
//   wDirect  - Направление связи (приход/расход) <br>
//   wDoc     - Тип связанного документа (константа таблицы - coKatSopr, coMnPlan  и т.д.) <br>
//   cDoc     - NRec связанного документа <br>
//   cPos     - NRec связанной позиции документа <br>
//   cRsvOper - NRec позиции журнала, для которой создается связь <br>
// Результат:<br>
//   True, если успешно, иначе - False<br>
//#end
//Function CreateLinkRsvReg(wDirect: Word; wDoc, cDoc, cPos, cRsvOper: Comp): Boolean;

end;

VipInterface iRsvOperLink implements oRsvOperLink #Licensed_Free;
