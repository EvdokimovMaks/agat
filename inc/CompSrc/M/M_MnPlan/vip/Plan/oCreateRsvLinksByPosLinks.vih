//********************************************************************************
//                                                        (c) корпорация Галактика
// Галактика 8.12 - Управление производственной логистикой
//
// Реализация объекта для формирования связей RsvOper по связям позиций спецификации
//********************************************************************************

#IFNDEF __CreateRsvLinksByPosLinks__
#DEFINE __CreateRsvLinksByPosLinks__

#ifdef ComponentVersion
#component "M_MnPlan"
#endif

#doc
  Реализация объекта для формирования связей RsvOper по связям
  позиций спецификации планового документа</brief>
#end

#include ProtPlan_CF.vih

ObjInterface oCreateRsvLinksByPosLinks;

  //******************************************************************************
  // pr_cMnplan   : документ для которого необходимо формировать связи
  // pr_cSpMnplan : позиция  для которой  необходимо формировать связи
  //    учитывается если pr_wAllP1_SelP2_CurP3 = 3
  // pr_wAllP1_SelP2_CurP3 : какие позиции документа выбирать
  //    1 - все поз (AllPos -- > AllP 1)
  //    2 - выбранные в документе (SelectedPos --> SelP 2)
  //    3 - Текущая позиция(pr_cSpMnplan) (CurPos --> CurP 3)
  // pr_wAdd0_Reform1 : режим формирования связей
  //    0 - добавление, если необходимо
  //    1 - переформирование(удаление последних старых, добавление новых связей)
  //    2 - удаление
  // pr_cVariaPl : вариант планирования
  //   -1 - Вариант планирования не учитывается
  //   -2 - Вариант планирования ищется в аналитиках документа
  //        Если не находит pr_cVariaPl присваивается 0
  // pr_wStatusRsvOperTransmit : Флаг RsvOper.Status для позиций передачи
  // pr_wStatusRsvOperPotr : Флаг RsvOper.Status для позиций потребности
  //   0 - статус не учитывается
  //   1 - планируемый
  //   2 - утвержденный
  //   4 - фактический
  //   Пример 1+4 -- Учитывается 2 статуса  (планируемый и фактический)


public Function CreateLinksForDoc(pr_cMnplan : comp; pr_cSpMnplan : comp;
                                  pr_wAllP1_SelP2_CurP3 : word;
                                  pr_wAdd0_Reform1_Del2 : word;
                                  pr_cVariaPl : comp;
                                  pr_wfStatusRsvOperTransmit: word;
                                  pr_wfStatusRsvOperPotr : word;
                                  pr_wfCalcParams : comp;
                                  pr_wfDebugParams : comp) : boolean;

//Выгружать события в протокол
public procedure SetProtocol(pr_cProt : comp; pr_IProt : oProtPlan_CF);

//Добавление документа для распределения остатков и НЗП
public procedure AddDocWithNZPandRests(pr_cDoc : comp);
//Удаляем все документы под которые искать остатки и НЗП
public procedure DeleteAllDocsWithNZPandRests;

end;//ObjInterface oiShowDDocHier

VipInterface iCreateRsvLinksByPosLinks Implements oCreateRsvLinksByPosLinks Licensed(free);

#ENDIF//__oiTPPDocuments_VIH__
