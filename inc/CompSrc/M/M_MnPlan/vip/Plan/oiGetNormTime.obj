//******************************************************************************
//                                                      (c) корпорация ГАЛАКТИКА
// ГАЛАКТИКА 8.1 Производственный контур/ПП
// объектный интерфейс заполнения  таблицы TmpObj данными из ПЗ
//******************************************************************************


#ifndef __oiGetNormTime_VIH
#define __oiGetNormTime_VIH

#ifdef ComponentVersion
#component "M_MNPLAN"
#end

ObjInterface oiGetNormTime; forward;

type
  rObjInfoPP = record
               wVal$1, // признак план/факт нормочасы (1/2)
               wVal$2, // количество ПЗ (если 0 то по всем ПЗ)
               wVal$3, // 0 - не включать визуализацию
               wVal$4, // 0/1 - выбранные документы передаются в (маркере/Pick)
                       // (пока работаем только с Pick)
               wVal$5, // если не 0, то содежит код КАУ фильтра,
                       // nRec фильтра тогда находится в cVal$5
               wVal$6,
               wVal$7,
               cVal$1, // grafic.nRec
               cVal$2, // fpperiod.nrec
               cVal$3,
               cVal$4, cVal$5, cVal$6, cVal$7, cVal$8,
               cVal$9, cVal$10: comp;
               dVal$1,
               dVal$2,
               dVal$3,
               dVal$4,
               dVal$5,
               dVal$6,
               dVal$7,
               dVal$8,
               dVal$9,
              dVal$10
                     : double;
               sVal$1: string;
             end;


#doc
объектный интерфейс заполнения таблицы TmpObj данными из ПЗ (нормо-часы план/факт)</brief>
#end
ObjInterface oiGetNormTime;

#doc
устанавка парметров объекта</brief>
#end
  procedure SetParam(rBuffer: rObjInfoPP);

#doc
заполнение таблицы TmpObj данными из ПЗ</brief>
#end
/*
возвращает:
 - таблица TmpObj
 (запись формируется только если все OK или не задан nRec организации(.wVal$2 на выходе = 8)
  TmpObj.wPodr   := cgKau_Zakaz;        - тип док-та
  TmpObj.cPodr   := MnPlan.nRec;        - ПЗ
  TmpObj.wKau[1] := SpMnPlan.TypeIzd;   - тип МЦ/Усл
  TmpObj.cKau[1] := SpMnPlan.cIzd;      - ссылка на МЦ/Усл
  TmpObj.wKau[2] := cgKau_KatOrg;       - организация  (потребитель)
  TmpObj.cKau[2] := cDet;               - ссылка на  организацию
  TmpObj.wKau[3] := cgKau_Zakaz;        - тип док-та(ПЗ)
  TmpObj.cKau[3] := cPZ;                - сам ПЗ
  TmpObj.wKau[4] := cgKau_KatParty;     - партия  (партия выпуска)
  TmpObj.cKau[4] := cParty;             - ссылка на партию
  TmpObj.wKau[5] := cgKau_KatPodr;      - подразделение (изготовитель)
  TmpObj.cKau[5] := cPodr;              - ссылка на подразделение
  TmpObj.Kol     := dNormoTime;         - нормо-часы

 - структура rObjInfoPP:
 .wVal$1, // код работы функции
   0      - все OK
   1      - нет позиционирования на FpPeriod
   2      - нет границ FpPeriod
   3      - нет позиционирования на Grafik
   4      - интерфейс GetNastr не загружен
   0ffffh - есть ньюансы (в .wVal$2 и в .wVal$3)

 .wVal$2 // доп код работы функции
   1      - нет вообще ПЗ
   2      - нет шаблона документа
   4      - не задана поле трудоемкости в шаблоне документа
   8      - нет позиций в плане какого-то документа
   16      - нет организации в плане какого-то документа
   32     - есть позиции док-та отличные от МЦ или услуг
  64      - есть позиции с отсутствием таблицы SpMnPl
  128     - есть позиции с отсутствием таблицы ValSpMnP
  256     - некорректный код во входном параметре rLRes.wVal$1
  512     - границы периода и документа не пересекаются
  1024    - ошибка поиска рабочих дней в графике для периода
  2048    - ошибка поиска рабочих дней в графике для документа
  4096    - ошибка вставки записи в таблицу TmpObj
  8192    - работа ф-ии прервана user
 16384    - период и график/документ не пересекаются
 32768    - документ не является ПЗ

  .wVal$3 // доп код работы функции
   1      - нет аналитики задаваемой по фильтру (.wVal$5,.cVal$5)
*/
  function GetNormoTime: rObjInfoPP;

end; // oiGetNormTime

#endif  // __oiGetNormTime_VIH
