//------------------------------------------------------------------------------
//                                                      (c) Корпорация ГАЛАКТИКА
// Галактика 8.1 - базовый интерфейс
// Объектный интерфейс проверки и установки прав доступа на редактирование
//------------------------------------------------------------------------------

#ifdef ComponentVersion
#Component "F_Common"
#end

#doc
Объектный интерфейс инициализации параметров и свойств объекта
#end
ObjInterface ObjPermisInitParams;

  #doc
  Код причины блокировки документа (см. константы cgProt_xxx в Inc\BuhConst.inc)
  #end
  Property wProtect : word read;

  #doc
  Документ заблокирован по статусу
  #end
  Property bProtectStat : boolean read;

  #doc
  Инициализация параметров документа.
  Должна вызываться в cmInit интерфейса, где используются методы этого объекта
  #end
  Procedure SetCurParamDoc(wTecTbl, wTiDkGal, wTiDkUser : word; bCanUpdate : boolean);

end;

#doc
Объектный интерфейс смены дескриптора пользователя и рабочей группы
#end
ObjInterface ObjPermisDescrDesGr;

  #doc
  Изменение рабочей группы в документе по cmPick
  #end
  Function PickNewDesGr(var sMyDesGr : tDesGr; var sMyDescr : tDescr) : boolean;

  #doc
  Изменение дескриптора пользователя в документе по cmPick
  #end
  Function PickNewDescr(var sMyDesGr : tDesGr; var sMyDescr : tDescr) : boolean;

  #doc
  Переключение на работу от имени пользователя с другим дескриптором/группой
  (по Alt+M в интерфейсе. Функция недоступна, если установлено значение
  настройки "Доступ к документам" - только со своим дескриптором)
  #end
  Function GetPickNewDescr(var sMyDesGr : tDesGr; var sMyDescr : tDescr; var wMyVisible : word) : boolean;

  #doc
  !!! Не использовать - метод введен для сохранения функциональности на время внедрения объекта !!!
  Устанавливает текущую рабочую группу, дескриптор пользователя
  и доступ к документам из настройки, если установлен фильтр
  #end
  Procedure SetCurUser(sNameFilter : string);

  #doc
  При создании новой записи устанавливает рабочую группу, дескриптор и доступ
  к документам пользователя, от имени которого работаем (т.е здесь CurDesGr,
  CurDescr и CurVisible - это значения не из настройки, если например был
  установлен фильтр по другому дескриптору или поменяли его по Alt+M)
  #end
  Function CanSetDefDesGrDescr(var sMyDesGr : tDesGr; var sMyDescr : tDescr;
                               var wMyVisible : word; var bSetBounds : boolean) : boolean;

  #doc
  При создании новой записи проверяет доступ к документам по статусу
  и условия функции CanSetDefDesGrDescr
  #end
  Function CanSetDefaultDoc(var sMyDesGr : tDesGr; var sMyDescr : tDescr; var wMyVisible : word;
                            var bSetBounds, bStatusDef : boolean; var cNRecStatus : comp) : boolean;

  #doc
  Проверка прав доступа на ЧТЕНИЕ для документа с указанными атрибутами
  (использовать при открытии интерфейса для редактирования заданного документа)
  #end
  Function CanOpenDoc(sMyDesGr : tDesGr; sMyDescr : tDescr;
                      sTitleDoc, sNoDok : string; dDateOb : date) : boolean;

end;

#doc
Объектный интерфейс проверки и установки прав доступа на редактирование
#end
ObjInterface ObjPermisDocProtect;

  #doc
  Начало редактирования документа
  #end
  Function StartEditDoc(bWinEditOpen, bNotProtNotNew : boolean; cNRecDoc : comp) : boolean;

  #doc
  Окончание редактирования документа
  #end
  Procedure StopEditDoc(bWinEditOpen : boolean);

  #doc
  Строковое представление актуальной причины блокирования записи
  #end
  Function GetStrMesProtected : string;

  #doc
  Определение прав доступа на редактирование.
  Функция возвращает код причины блокировки документа, если его надо блокировать
  #end
  Function GetProtected(sMyDesGr : tDesGr; sMyDescr : tDescr;
                        dDateDoc : date; cNRecDoc, cNRecStatus : comp) : word;

  #doc
  Сброс флага "У пользователя запросили подтверждение на редактирование в закрытом периоде"
  #end
  Procedure ResetConfirm;

  #doc
  Запрос подтверждения при закрытом периоде.
  Функция возвращает True, если документ можно редактировать
  #end
  Function ConfirmCloseDate(dDateDoc : date; wShowMessage : word) : boolean;

  #doc
  Проверка прав доступа на редактирование.
  Функция возвращает True, если документ можно редактировать
  #end
  Function CanEditProtect(dDateDoc : date; wShowMessage : word; var wDocProtect : word) : boolean;

end;

#doc
Объектный интерфейс проверки прав доступа для определения цвета расскраски записи
#end
ObjInterface ObjPermisColorProt;

  #doc
  Определение прав доступа для расскраски записей.
  Функция возвращает код причины блокировки документа, если его надо блокировать
  #end
  Function GetProtForColor(sMyDesGr : tDesGr; sMyDescr : tDescr;
                        dDateDoc : date; cNRecDoc, cNRecStatus : comp) : word;

end;

#doc
Объектный интерфейс проверки прав доступа к проводкам
#end
ObjInterface ObjPermisOborotProt;

  #doc
  Проверка, есть ли доступ ко всем проводкам документа
  #end
  Function GetProtectedForTXO(sMyDesGr : tDesGr; sMyDescr : tDescr;
                              dDateDoc : date; cNRecDoc, cNRecStatus : comp) : word;

end;

#ifdef __FastClose__
#doc
Объектный интерфейс проверки прав доступа к проводкам по актам
#end
ObjInterface ObjPermissionFastClose;

  #doc
  Проверка, есть ли доступ к проводке по статусу акта
  #end
  Function CanEditOborotFastClose(cOborot : comp; wShowMessage : word) : boolean;

end;
#end

#doc
Объектный интерфейс проверки прав доступа по типу документа
#end
ObjInterface ObjPermissionByTiDk;

  #doc
    Получить права доступа по типу документа (если настройка включена)
  #end
  Function GetCurVisible(_wMyTiDkGal : word) : word;

end;

#doc
Объектный интерфейс контроля рассчитаных прав доступа
#end
ObjInterface ObjPermissionByCheckSem;
  #doc
    Выставить семофор что права доступа рассчитаны
  #end
  Function StartCheckSemaphore(cNRecDoc : comp): boolean;

  #doc
    Проверка выставлен ли фемафор рассчитаных прав доступа
  #end
  Function IsSetCheckSemaphore(cNRecDoc : comp): boolean;

  #doc
    Снять семофор что права доступа рассчитаны
  #end
  Function StopCheckSemaphore(cNRecDoc : comp): boolean;

  #doc
    Выставить семафор начала привязки ТXO
  #end
  Function StartTXO(cNRecDoc : comp): boolean;

  #doc
    Снять семафор начала привязки ТXO
  #end
  Function StopTXO(cNRecDoc  : comp): boolean;

  #doc
   Выставлен ли семафор привязки ТXO
  #end
  Function isSetTXOSemaphore(cNRecDoc : comp): boolean;

end;

#doc
Объектный интерфейс проверки прав доступа на создание проводок по актам
#end
ObjInterface ObjPermissionInsFC;
  #doc
  Проверка, есть ли доступ на создание проводки по статусу акта
  #end
  Function CanInsOborotFastClose(cSoprHoz : comp; wShowMessage : word) : boolean;

end;

#doc
Объектный интерфейс проверки прав доступа по плану счетов
#end
ObjInterface ObjPermissionByPlansSch;

  #doc
  Установить значение текущего плана счетов
  #end
  Procedure SetCurPlansSch(cPlansSch : comp);

end;

#doc
Объектный интерфейс блокировки проводок при редактировании
#end
ObjInterface ObjPermisEditOb;

  #doc
  Начало редактирования проводки
  #end
  Function StartEditOb(bWinEditOpen : boolean; cNRecOb : comp) : boolean;

  #doc
  Окончание редактирования документа
  #end
  Procedure StopEditOb(bWinEditOpen : boolean);


end;

#doc
Объектный интерфейс определения видимости документа
#end
ObjInterface ObjPermisViewDoc;

 #doc
 Отображается ли для пользователя документ в каталоге документов
 #end
 Function isVisibleDocForUser(wTecTbl, wTiDkGal, wTiDkUser : word; sDesGr : tDesGr; sDescr : tDescr; cNRecDoc : comp) : boolean;

end;


VipInterface Permission implements ObjPermisInitParams, ObjPermisDescrDesGr, ObjPermisDocProtect, ObjPermisColorProt, ObjPermisOborotProt
#ifdef __FastClose__
  , ObjPermissionFastClose
#end
  , ObjPermissionByTiDk, ObjPermissionByCheckSem, ObjPermissionInsFC, ObjPermissionByPlansSch, ObjPermisEditOb, ObjPermisViewDoc

Licensed (Free)
;
//------------------------------------------------------------------------------
