// несколько шаблонов, объединенных в один универсальный
// (получается шаблон в шаблоне :)
//
// для следующих аналитик:
//  cgKau_KlassifTS1    = 5040 = Классификация ТС   по первому целевому признаку
//  cgKau_KlassifTS2    = 5041 = Классификация ТС по второму целевому признаку
//  cgKau_KlassifTSVid  = 5042 = Классификация ТС по виду
//  cgKau_KlassifTSEng  = 5043 = Классификация ТС по типу основного двигателя
//  cgKau_KlassifTSTrl  = 5044 = Классификация ТС по наличию прицепа
//  cgKau_KlassifTSPark = 5045 = Классификация ТС по парку учета
#declare AddKauVars
  TypeTC : word;
#end
#define  TreeKatalog
#define  KauTable   Morale
#define  TreeField  cBack
#declare PrivateForTreeBounds
  bounds ForTree = cNode   == Morale.cBack and
                   #wType + TypeTC == Morale.WhatIs    ordered by TableOrder
#end
#define  RuleForLeaf (not isValid(#SubMorale))
#declare AddKauTitle
if (TypeTC = 0,' [Автотранспорт]',
    if(TypeTC = 100,' [Железнодорожный транспорт]',
      if(TypeTC = 200,' [Прочий транспорт]','')))
#end
#declare BrowseFields
  Morale.TipTc 'Код'          : [15], protect;
  Morale.Name  'Наименование' : [40], protect;
#end
#declare QuickChoiceFields
  ViewField   = Morale.Name;
  ViewField   = Morale.TipTc;
  SearchField = Morale.Name;
#end
#declare KauOrders
  order byName     by  Morale.Name
  order byKod      by  Morale.TipTc
#end
#declare AddKauTables
  ,Morale SubMorale
#end
#declare KauOrdersCase
  #Morale.Name : SetOrder(tiByName);
  #Morale.TipTc  : SetOrder(tiByKod);
#end
#declare PrivateFindPickedDoc
  if (cSavedKau <> 0)
    if (GetFirst #KauTable where ((cSavedKau == #KauTable.NRec)) = tsOk)
    {
      set TypeTC := Morale.WhatIs - #wType
      SetNameWindow;
      exit;
    }

  if (not ReadMyDsk(TypeTC,'cg_kau_KlassifTS_TypeTC',true))
    set TypeTC := word(0);

  if (GetFirst #KauTable <> tsOk)
    NoDataMessage;
#end
#declare AddLogTableBounds
  and #wType + TypeTC == Morale.WhatIs
  and Morale.nrec == SubMorale.cBack // подчиненные записи
#end
#declare AddReturnAction
  SaveMyDsk(TypeTC, 'cg_kau_KlassifTS_TypeTC')
#end
#declare AddCommand
  RunInterface(GetMorale, (#wType + TypeTC), Morale.nRec, '', Word(0),word(15));
#end
#declare EditCommand
  RunInterface(GetMorale, (#wType + TypeTC), Morale.nRec, '', Word(0),word(14));
#end

#declare SpecialKauCommands

  // автотранспорт
  cmValue1:
    if TypeTC <> 0
    {
      set TypeTC := 0;
      if (GetFirst Morale = tsOk) {};
      ReReadRecord(#Morale);
      SetNameWindow;
    }

  // ЖД транспорт
  cmValue2:
    if TypeTC <> 100
    {
      set TypeTC := 100;
      if (GetFirst Morale = tsOk) {};
      ReReadRecord(#Morale);
      SetNameWindow;
    }
  // рпрочий транспорт
  cmValue3:
    if TypeTC <> 200
    {
      set TypeTC := 200;
      if (GetFirst Morale = tsOk) {};
      ReReadRecord(#Morale);
      SetNameWindow;
    }
  cmAttrib:
  {
   case TypeTC of
        0: set TypeTC := 100;
     100: set TypeTC  := 200;
     200: set TypeTC  := 0;
   end;
   if (GetFirst Morale = tsOk) {};
   ReReadRecord(#Morale);
   SetNameWindow;
  }
#end
#define HotKeyLines
