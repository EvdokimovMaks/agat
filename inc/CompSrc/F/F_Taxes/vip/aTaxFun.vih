#ifndef __ATAXFUN_VIH__
#define __ATAXFUN_VIH__
//**************************************************************
#ifdef ComponentVersion
#component "F_TAXES"
#end
//**************************************************************

#include TKatSopr.vih
#include TPlPor.vih

#ifndef __TYPE_TPlPorNazn__
#define __TYPE_TPlPorNazn__
// назначение платежа
type TPlPorNazn = record
  s1, s2, s3, s4, s5, s6, s7: string;
end;
#end
//**************************************************************
// Функции для работы с Налогами
#doc
  Функции для работы с Налогами
#end

ObjInterface objTaxFun;
  //-------------------------------------------------------

#doc
 интерфейс выбора нового статуса
#end
  function MyGetNewStatus(_DocType: word; var _wStatus: word; var _cStatus: comp): boolean;

#doc
 подбор платежек (плат.поручений и авизо)
#end
  function Find_Plpor(_wStatus: word; _cStruct: comp; _Level: word;
                      _dBeg: date; _dEnd: date): longint;
#doc
  подбор налоговых актов
#end

  function Find_KatSopr(_wStatus: word; _cStruct: comp; _Level: word;
                        _dBeg: date; _dEnd: date): longint;
#doc
  изм.статуса ПНП или Налогового Акта при изм.статуса Акта сверки
#end

  function ChangeStatus(_type: word; _cAktSvr: comp;
                        _wStatus: word; _cStatus: comp): boolean;
#doc
  изменим статус по запросу
#end
  function ChangeStatusByAsk(_type: word; _cAktSvr: comp): boolean;
#doc
  изменим статус по запросу
#end
  function ChangeStatusNoAsk(_type: word; _cAktSvr: comp; _wStatus: word): boolean;
  //-------------------------------------------------------
  #doc
   код для ук.записи каталога
  #end
  
  function KatAll_GetCode(_cRec: comp): string;
  #doc
   название для ук.записи каталога
  #end
  
  function KatAll_GetName(_cRec: comp): string;

/*
  // поиск в описателе дерева ссылки на бюджет (без ТПН)
  function KatTr_FindGrouping(_cGNI: comp; _cTax: comp; _cBud: comp): comp;
  // поиск в описателе дерева ссылки на получателя
  // (у всех ТПН одного бюджета он одинаковый)
  function KatTr_FindUNN(_cGrouping: comp): comp;
*/

  #doc
    поиск стр-ры по ее составляющим
  #end
  
  function KatStr_Find(_cGNI: comp; _cTax: comp;
                       _cBud: comp; _cTPN: comp;
                       _cPol: comp): comp;
/*
  // поиск стр-ры по ИНН, ТПН
  function KatStr_FindByIbncTpn(_cIbnc: comp; _cTPN: comp): comp;
  // из структуры вытягивает ТПН
  function KatStr_GetTpn(_cStr: comp): comp;
*/

  #doc
   из структуры вытягивает Бюджет
  #end
  
  function KatStr_GetBud(_cStr: comp): comp;
!  #ifdef GAL5_85
  #doc
   получатель налога (ИНН-Бюджет-Вид налога по Банку)
  #end
  
  function KatStr_GetPol(_cStr: comp): comp;
  #doc
   организация из получателя налога
  #end
  
  function KatStr_GetPolOrg(_cStr: comp; var _cPol: comp;
                            var _cBankPol: comp): boolean;
!  #end
  #doc
   уровень стр-ры
  #end
  
  function KatStr_GetLevel(_cStr: comp): word;

  #doc
    поиск КПП филиала
  #end
  
  function KatKpp_FindKodByFilial(_cFilial: comp; var _sKpp: string): comp;
  #doc
    без кода (чтобы лишний параметр в ф.вызова не заводить)
  #end
  
  function KatKpp_FindByFilial(_cFilial: comp): comp;
  #doc
    поиск КПП с указанным кодом
  #end
  
  function KatKpp_FindByCode(_sCode: string): comp;
  #doc
    поиск филиала по КПП
  #end
  
  function KatKpp_FindFilial(_cKpp: comp): comp;
  #doc
    поиск организации по КПП
  #end
  
  function KatKpp_FindOrg(_cKpp: comp): comp;
  #doc
    по КПП определим ГНИ
  #end
  
  function KatKpp_GetGni(_cKpp: comp): comp;
  #doc
    создание КПП
  #end
  
  function KatKpp_Create(_sKpp: string; _cFilial: comp;
                              _sFilialName: string;
                              _cFilialNode: comp; _cGNI: comp): boolean;
  #doc
    возвращает название для ИНН
  #end
  
  function KatUNN_GetName(_UNN: string; _cOFK: comp; _cBank: comp): string;
  #doc
   название с ГНИ
  #end

  function KatUNN_GetLongName(_cGNI: comp; _cKatUnn: comp): string;
  #doc
   поиск, а если не найдена - создание, записи в "ИНН-ОФК-Банк"
  #end

  function KatUNN_CheckExists(_UNN: string; _cBank: comp): comp;

  #doc
   код региона
  #end

  function Region_GetCode(_cRec: comp): string;
  #doc
   поиск региона по ГНИ
  #end

  function Region_FindByGNI(_cGNI: comp): comp;
  //-------------------------------------------------------
  #doc
   формирование назначения платежа
  #end

  function TaxPlp_GetNazn(_sBud : string; _sAtd : string;
                          _sOsn : string; _sPer : string;
                          _NoDoc: string; _DatOb: string;
                          _sTPN : string; _sPrim: string): tPlPorNazn;
  #doc
   проверка спецификации Налогового акта
  #end

  function TaxAkt_CheckSpecify(bufKatSopr: TKatSopr): boolean;
  #doc
   обновление значения атрибута
  #end

  function Attr_CheckVal(_coTable: word; _Name: string; _wType: word;
                         _cTable : comp; _sValue: string): comp;
  //-------------------------------------------------------
  #doc
   берет организацию филиала
  #end

  function Filial_GetOrg(_cFilial: comp; _isMessage: word): comp;
  #doc
   берет АТД филиала
  #end

  function Filial_GetATD(_cFilial: comp): comp;
  #doc
   филиал по ссылке на организацию
  #end

  function Filial_FindByOrg(_cOrg: comp): comp;
  //-------------------------------------------------------
  #doc
   Kpp = KatOrg.KodPlatNDS
  #end

  function KatOrg_GetKpp(_cOrg: comp): string;
  #doc
   ОКАТО = KatOrg.OKDP (специально для МТГ)
  #end

  function KatOrg_GetOKATO(_cOrg: comp): string;
  #doc
   ОКАТО = Filial.Abbr (специально для МТГ)
  #end

  function Filial_GetOKATO(_cFilial: comp): string;
  #doc
   формирование назначения платежа по заполненной записи rNazn
  #end

  function TaxPlp_GetNaznByRec(var bufPlPor: TPlPor;
                               rNazn: tPlPorNazn): boolean;
  #doc
   формирование назначения платежа через буфер PlPor
  #end

  function TaxPlp_GetNaznByBuf(var bufPlPor: TPlPor;
                               _cFilial: comp): boolean;
  #doc
   поиск КПП филиала по организации
  #end

  function KatKpp_FindKodByOrg(_cOrg: comp; var _sKpp: string): comp;
  #doc
   без кода (чтобы лишний параметр в ф.вызова не заводить)
  #end

  function KatKpp_FindByOrg(_cOrg: comp): comp;
  //-------------------------------------------------------
End; //objTaxFun

VipInterface iTaxFun implements objTaxFun
  #Licensed_Free
;
//**************************************************************
#end //__ATAXFUN_VIH__
