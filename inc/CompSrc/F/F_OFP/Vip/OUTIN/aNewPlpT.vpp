//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 5.80 - модуль "Платежный календарь"
// Формирование платежных документов
//------------------------------------------------------------------------------

//******************************************************************************
// причина неформирования платежек по Фоп
Table struct sComment
(
  Name      : TName
, cClearing : comp
)
with index
(
  byClearing = cClearing
);

// временная таблица для группирования
Table struct sBunching
(
    nRec          : comp
  , Code          : word                  // группируем все Фоп или Фоп для взаимозачета
  , Npp           : longint

  , ClearType     : word                  //
  , dDoc          : date                  // дата выписки
  , cKatOrg       : comp                  // контрагент
  , MeanType      : word                  // тип ПС
  , cPlatMean     : comp                  // ПС
  , cVal          : comp                  // валюта

  , NumCantForm   : longint               // число причин, по кот.нельзя формировать
  , NumCantFormCl : longint               // по Фоп2
  , CanForm       : word                  // возможность формирования Фоп
  , CanFormCl     : word                  // возможность формирования Фоп2
  , DocType       : word                  // тип формируемого платежного документа
  , DocTypeCl     : word                  //   по Фоп2 валютного документа
  , Summa         : double                // сумма Фоп
  , SummaCl       : double                // сумма Фоп1, Фоп2
  , cClearing     : comp                  // Фоп, по полям кот.сформируем документ
  , cClearingCl   : comp                  // Фоп2 взаимозачета, конвертации
  , cMadeDoc      : comp                  // сформированная ХО
  , cMadeDocCl    : comp                  // по Фоп2
  , Cut           : array [1..13] of comp // для занесения разрезов группировки
)
with index
(
   byNRec = nRec (unique, surrogate)
 , sBunching01 = Npp + cClearing
 , sBunching02 = Code +
               CanForm +
               Cut[1] +   // Clearing.nRec
               Cut[4] +   // Clearing.dDoc
               Cut[3] +   // Clearing.ClearType
               Cut[2] +   // DocType
               Cut[5] +
               Cut[6] +
               Cut[7] +
               Cut[8] +
               Cut[9] +
               Cut[10]+
               Cut[11]+
               Cut[12]+
               Cut[13]
);

// платежки, кот.будут сформированы
Table struct sPlatDoc
(
    CanForm: word   // возможность формирования (cgCanForm_-константы)
  , Npp: longint    // Npp документа (связан с sBunching.Npp)
  , nCut : word     // номер sBunching.Cut, на кот.изменилась Фоп (срез)
  // поля - по привязанным sBunching
  , dDoc: date      // дата документа
  , Summa: double   // сумма привязанных sBunching.Summa, сумма Фоп1 - для ValutDoc
  , SummaCl: double // сумма Фоп2 - для ValutDoc
  , NumFop: longint // число привязанных Фоп
  // доп.поля - по Фоп
  , DocType: word   // тип
  , ClearType: word //

  , cMadeDoc: comp  // сформированный документ

  , cKatOrg: comp   // контрагент
  , MeanType: word  // тип ПС
  , cPlatMean: comp // ПС
  , cVal: comp      // валюта
)
with index
(
    byNpp = Npp // для пометки
  , byCanForm  = CanForm + DocType
    // для сортировки sPlatDocSee (sBunching02 такое же)
  , byDate = CanForm + dDoc + MeanType + cPlatMean + DocType + cKatOrg
);

//******************************************************************************
