//------------------------------------------------------------------------------
//                                                      (c) Корпорация ГАЛАКТИКА
// Галактика 8.1 - Бухгалтерский контур
// Отчет о величине амортизационной льготы для ОС/НМА
//------------------------------------------------------------------------------
#doc
  Форма для печати величин амортизационной льготы
#end
.form 'Prn_MTOSLgota'
.hide
.fields
  TiDk  : word       //тип ОС или НМА
  Метод_учета
  cNastrOS : comp    //ссылка на NastrOS
  wModeCalc: word    //режим расчета
  SumFormat

  InNumOS
  NameOs
  cKatOS   : comp    //ссылка на KatOS
  OtchPerOS : date   // отчетный период карточки

  AmGr_Kod    : string  // Код амортизационной группы
  AmGr_Name   : string  // Имя амортизационной группы
  DatEk       : date    // Дата ввода
  SrokIsp     : double  // Срок полезного использования
  KatOs_IsLeaf : word

  NameOper
  DateOper         : date    //дата операции
  cMoveOS          : comp    //ссылка на операцию
  SysOper          : word    //системный код операции
  SumNew           : double  //сумма изменения из операции
  Sum1             : double  //величина подлежащая амортизационной льготе для проведения амортизации
  Sum1_1           : double  //сумма изменения стоимости за предыдущий период для основания с признаком "учитывать в следующем отчетном периоде"
  Sum2             : double  //накопленная величина изменения стоимости подлежащая амортизационной льготе
  Sum2From01012009 : double  // с 01.01.2009
  SumL             : double  //величина амортизационной льготы
  SumL_Next        : double  //величина аморт.льготы за предыдущий период для основания с признаком "учитывать в следующем отчетном периоде"
  AllSumL          : double  //накопленная величина амортизационной льготы
  AllSumL01012008  : double  //накопленная величина амортизационной льготы с 01.01.2008 для восстановлнеия
  Sum3             : double  //накопленная величина изменения стоимости не подлежащая амортизационной льготе
  Sum4             : double  //величина изменения стоимости не подлежащая амортизационной льготе
  SumL_PS          : double  //величина амортизационной льготы из операции поступления
  SumL_NextPS      : double  //величина аморт.льготы за предыдущий период для основания с признаком "учитывать в следующем отчетном периоде"
  wModeLgota       : word    // 0 - без льготы, 1 - в текущем, 2 - в следующем отч.периоде
  Kol              : double  //количество объектов карточки
  CanMustCalcAmort : word    // должна ли быть и/или рассчитана амортизация в месяц операции DateOper
  Pr_L             : word
  SumL_Proc        : double
  TotalSumL_Proc   : double
.endfields
.var
   iExcelFormat : ExcelFormat;
.endvar

  TiDk             ^
  Метод_учета      ^
  cNastrOS         ^
  wModeCalc        ^
  SumFormat        ^
.{ CheckEnter MT_OSLgotaKatOS
  InNumOS          ^
  NameOs           ^
  cKatOS           ^
  OtchPerOS        ^
  AmGr_Kod         ^
  AmGr_Name        ^
  DatEk            ^
  SrokIsp          ^
  KatOs_IsLeaf     ^

.{ CheckEnter MT_OSLgotaOperation
  NameOper          ^
  DateOper          ^
  cMoveOS           ^
  SysOper           ^
  SumNew            ^
  Sum1              ^
  Sum1_1            ^
  Sum2              ^
  Sum2From01012009  ^
  SumL              ^
  SumL_Next         ^
  AllSumL           ^
  AllSumL01012008   ^
  Sum3              ^
  Sum4              ^
  SumL_PS           ^
  SumL_NextPS       ^
  wModeLgota        ^
  Kol               ^
  CanMustCalcAmort  ^
.{ CheckEnter MT_OSLgotaIncluding
  Pr_L              ^
  SumL_Proc         ^
  TotalSumL_Proc    ^
.}
.}
.}
.endform

//------------------------------------------------------------------------------
.Linkform 'MTOSLgota_01' prototype is 'Prn_MTOSLgota'
.NameInList 'Ведомость амортизационных льгот по ОС/НМА'
.Group 'Итоговые суммы'
.Defo landscape
.var
   sSum1, sSum2, sSumL, sAllSumL : double;
.endvar
.fields
  CommonFormHeader
  Метод_учета
  if (TiDk mod 100 = 15, 'ОС', 'НМА')
.endfields
.begin
    sSum1 := 0;  sSum2 := 0;   sSumL := 0;  sAllSumL := 0;
end.
 Р^ Р
 ИМетод учета: ^ И

                          БВедомость величин амортизационных льгот по ^ Б

.{ CheckEnter MT_OSLgotaKatOS
.[H
 Р                                                                                                                                                                                лист @np@
──────────────────────────────┬───────────────┬───────────────┬──────────────────┬──────────────────┬───────────────────┬──────────────────┬──────────────────┬──────────────────┬──────────────────
                              │               │               │ Изменение ст-ти, │ Накопленная вели-│  Изменение ст-ти, │ Накопленная вели-│     Величина     │    Накопленная   │  Восстановленная
                              │  Инвентарный  │Отчетный период│ подлежащее амор- │  чина изменения  │не подлежащее амор-│  чина изменения  │  амортизационной │      величина    │      величина
        Наименование          │     номер     │    карточки   │тизационной льготе│    стоимости,    │ тизационной льготе│   стоимости, не  │      льготы      │  амортизационной │  амортизационной
                              │               │               │в отчетном периоде│ подлежащая льготе│ в отчетном периоде│ подлежащая льготе│                  │       льготы     │      льготы
──────────────────────────────┼───────────────┼───────────────┼──────────────────┼──────────────────┼───────────────────┼──────────────────┼──────────────────┼──────────────────┼────────────────── Р
.]H
.{ CheckEnter MT_OSLgotaOperation
.begin
  if (KatOs_IsLeaf = 1)
  {
    sSum1 += Sum1;
    sSum2 += Sum2;
    sSumL += SumL;
    sAllSumL += AllSumL;
  }
end.
.fields
  NameOs
  InNumOS
  iExcelFormat.DateToStrRep(OtchPerOS, 'Month YYYY')

  iExcelFormat.DoubleToStrRep(Sum1, SumFormat)             //величина подлежащая амортизационной льготе для проведения амортизации
  iExcelFormat.DoubleToStrRep(Sum2, SumFormat)             //накопленная величина изменения стоимости подлежащая амортизационной льготе
  iExcelFormat.DoubleToStrRep(Sum4, SumFormat)             //величина изменения стоимости не подлежащая амортизационной льготе
  iExcelFormat.DoubleToStrRep(Sum3, SumFormat)             //накопленная величина изменения стоимости не подлежащая амортизационной льготе
  iExcelFormat.DoubleToStrRep(SumL, SumFormat)             //величина амортизационной льготы
  iExcelFormat.DoubleToStrRep(AllSumL, SumFormat)          //накопленная величина амортизационной льготы
  iExcelFormat.DoubleToStrRep(AllSumL01012008, SumFormat)  //накопленная величина амортизационной льготы с 01.01.2008 для восстановлнеия
.endfields
 Р@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@@@@@@@@@@@@@@@│@@@@@@@@@@@@@@@│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&
.{ CheckEnter MT_OSLgotaIncluding
.}
.}
.}
──────────────────────────────┴───────────────┴───────────────┴──────────────────┴──────────────────┴───────────────────┴──────────────────┴──────────────────┴──────────────────┴──────────────────
 А.fields
  iExcelFormat.DoubleToStrRep(sSum1, SumFormat)
  iExcelFormat.DoubleToStrRep(sSum2, SumFormat)
  iExcelFormat.DoubleToStrRep(sSumL, SumFormat)
  iExcelFormat.DoubleToStrRep(sAllSumL, SumFormat)
.endfields
 Б Итого:                                                        &&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&                                        &&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&& 
.endform

//------------------------------------------------------------------------------
.Linkform 'MTOSLgota_02' prototype is 'Prn_MTOSLgota'
.NameInList 'Ведомость амортизационных льгот в разрезе операций ОС/НМА'
.Group 'С детализацией до операций'
.fields
  CommonFormHeader
  Метод_учета
  if (TiDk mod 100 = 15, 'ОС', 'НМА')
.endfields
 Р^ Р
 ИМетод учета: ^ И

 Б          Ведомость величин амортизационных льгот в разрезе операций ^ Б

.{ CheckEnter MT_OSLgotaKatOS
.[H
 Р                                                                                                                                       лист @np@
──────────┬──────────────────────────────┬──────────────────┬──────────────────┬──────────────────┬──────────────────┬──────────────────┬──────────────────
          │                              │     Величина     │ Накопленная вели-│ Накопленная вели-│     Величина     │    Накопленная   │  Восстановленная
   Дата   │                              │     изменения    │  чина изменения  │  чина изменения  │  амортизационной │      величина    │      величина
 операции │           Операция           │     стоимости    │    стоимости,    │   стоимости, не  │      льготы      │  амортизационной │  амортизационной
          │                              │                  │ подлежащая льготе│ подлежащая льготе│                  │       льготы     │       льготы
──────────┴──────────────────────────────┴──────────────────┴──────────────────┴──────────────────┴──────────────────┴──────────────────┴────────────────── Р
.]H
.fields
  InNumOS
  NameOs
.endfields
.{?Internal;(InNumOS <> '');
 Р@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Р
.}
.{ CheckEnter MT_OSLgotaOperation
.fields
  iExcelFormat.DateToStrRep(DateOper, 'DD/MM/YYYY')
  NameOper
  iExcelFormat.DoubleToStrRep(SumNew, SumFormat)
  iExcelFormat.DoubleToStrRep(Sum2, SumFormat)               //накопленная величина изменения стоимости подлежащая амортизационной льготе
  iExcelFormat.DoubleToStrRep(Sum3, SumFormat)               //накопленная величина изменения стоимости не подлежащая амортизационной льготе
  iExcelFormat.DoubleToStrRep(SumL, SumFormat)               //величина амортизационной льготы
  iExcelFormat.DoubleToStrRep(AllSumL, SumFormat)           //накопленная величина амортизационной льготы
  iExcelFormat.DoubleToStrRep(AllSumL01012008, SumFormat)   //накопленная величина амортизационной льготы с 01.01.2008 для восстановлнеия
.endfields
 Р@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&& Р
.{ CheckEnter MT_OSLgotaIncluding
.}
.}
.}
 Р─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Р
.endform

//------------------------------------------------------------------------------
.Linkform 'MTOSLgota_03' prototype is 'Prn_MTOSLgota'
.NameInList 'Ведомость амортизационных льгот по ОС/НМА с расшифровкой по процентным ставкам'
.Group 'Итоговые суммы'
.Defo landscape
.var
   sSum1, sSum2, sSumL, sAllSumL : double;
.endvar
.fields
  CommonFormHeader
  Метод_учета
  if (TiDk mod 100 = 15, 'ОС', 'НМА')
.endfields
.begin
    sSum1 := 0;  sSum2 := 0;  sSumL := 0;    sAllSumL := 0;
end.
 Р^ Р
 ИМетод учета: ^ И

                     БВедомость величин амортизационных льгот по ^ с расшифровкой по процентным ставкам  Б

.{ CheckEnter MT_OSLgotaKatOS
.[H
 Р                                                                                                                                                                                        лист @np@
──────────────────────────────┬───────────────┬───────────────┬──────────────────┬──────────────────┬───────────────────┬──────────────────┬──────────────────┬──────────────────┬──────────────────
                              │               │               │ Изменение ст-ти, │ Накопленная вели-│  Изменение ст-ти, │ Накопленная вели-│     Величина     │    Накопленная   │  Восстановленная
                              │  Инвентарный  │Отчетный период│ подлежащее амор- │  чина изменения  │не подлежащее амор-│  чина изменения  │  амортизационной │      величина    │      величина
        Наименование          │     номер     │    карточки   │тизационной льготе│    стоимости,    │ тизационной льготе│   стоимости, не  │      льготы      │  амортизационной │  амортизационной
                              │               │               │в отчетном периоде│ подлежащая льготе│ в отчетном периоде│ подлежащая льготе│в отчетном периоде│       льготы     │      льготы
──────────────────────────────┼───────────────┼───────────────┼──────────────────┼──────────────────┼───────────────────┼──────────────────┼──────────────────┼──────────────────┼────────────────── Р
.]H
.{ CheckEnter MT_OSLgotaOperation
.begin
  if (KatOs_IsLeaf = 1)
  {
    sSum1 += Sum1;
    sSum2 += Sum2;
    sSumL += SumL;
    sAllSumL += AllSumL;
  }
end.
.fields
  NameOs
  InNumOS
  iExcelFormat.DateToStrRep(OtchPerOS, 'Month YYYY')

  iExcelFormat.DoubleToStrRep(Sum1, SumFormat)             //величина подлежащая амортизационной льготе для проведения амортизации
  iExcelFormat.DoubleToStrRep(Sum2, SumFormat)             //накопленная величина изменения стоимости подлежащая амортизационной льготе
  iExcelFormat.DoubleToStrRep(Sum4, SumFormat)             //величина изменения стоимости не подлежащая амортизационной льготе
  iExcelFormat.DoubleToStrRep(Sum3, SumFormat)             //накопленная величина изменения стоимости не подлежащая амортизационной льготе
  iExcelFormat.DoubleToStrRep(SumL, SumFormat)             //величина амортизационной льготы
  iExcelFormat.DoubleToStrRep(AllSumL, SumFormat)          //накопленная величина амортизационной льготы
  iExcelFormat.DoubleToStrRep(AllSumL01012008, SumFormat)  //накопленная величина амортизационной льготы с 01.01.2008 для восстановлнеия
.endfields
 Р@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@│@@@@@@@@@@@@@@@│@@@@@@@@@@@@@@@│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&
.{ CheckEnter MT_OSLgotaIncluding
.{?Internal;Pr_L>0;
.fields
 'по ставке до ' + String(Pr_L, 3, 0) + ' %'
 iExcelFormat.DoubleToStrRep(SumL_Proc, SumFormat)
 iExcelFormat.DoubleToStrRep(TotalSumL_Proc, SumFormat)
.endfields
                                                                                                                        @@@@@@@@@@@@@@@@@@@│&&&&&&&&&&&&&&&&&&│&&&&&&&&&&&&&&&&&&│
.}
.}
.}
.}
──────────────────────────────┴───────────────┴───────────────┴──────────────────┴──────────────────┴───────────────────┴──────────────────┴──────────────────┴──────────────────┴──────────────────
.FIELDS
  iExcelFormat.DoubleToStrRep(sSum1, SumFormat)
  iExcelFormat.DoubleToStrRep(sSum2, SumFormat)
  iExcelFormat.DoubleToStrRep(sSumL, SumFormat)
  iExcelFormat.DoubleToStrRep(sAllSumL, SumFormat)
.endfields
 БИтого:                                                         &&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&                                        &&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&& Б
.endform Р

