.LinkForm 'AktPostNMA2015' Prototype is 'OSONE'
.NameInList '[ВСМН] Акт приема-передачи нематериальных активов (ЭХД)'
.F 'NUL'
.group 'Поступление НМА <<ВСМН>>'
.var
  iRow : word;
  iFeeSigners : FeeSigners;
  iLvar : iLvarToString;
  Массив_Член_комиссии_ФИО: ARRAY [1..2] of String;
  Массив_Член_комиссии_Должность: ARRAY [1..2] of String;
  Номер_подписанта:Word;
  barcode : string;
  iLastHeadRow : integer;
.endvar
.create view n
as select
 *
from
 MoveOS
where
((
  MoveOS.COSNOV   == KlassOS.nrec
 ))
;
.{ // Начало формы
.begin
  xlKillExcel;
  xlDisplayAlerts(false);
  xlCreateExcelWithTemplate(TranslatePath('%ClientStartPath%')+'\XLS\F_OSOper\AktPostNMA2015.xlt',true);

  if (xlIsExcelValid)
  {
    barcode :=  Ean13ToEanGnivcTTF(GenerateBarCodeEx (coMoveOs, MoveOsNRec));
    xlSetCellStringValue(barcode, 1/*Row*/, 1/*Col*/,1 ,1);

    xlSetCellStringValue('     АКТ № '+Номер_документа+' от ' +DateToStr(Дата_документа, '" DD " mon YYYYг.'), 6, 3, 6 ,3);
    xlSetCellStringValue(Поставщик, 11/*Row*/, 5/*Col*/,11 ,5);
    // xlSetCellStringValue(Структурное_подразделение_Поставщика, 11/*Row*/, 5/*Col*/,11 ,5);
    xlSetCellStringValue(ПОСТАВЩИК_ОКПО, 11, 10, 11, 10);
    xlSetCellStringValue(Получатель,13/*Row*/, 5/*Col*/,13 ,5);
    // xlSetCellStringValue(Структурное_подразделение_Получателя, 13/*Row*/, 5/*Col*/,13 ,5);
    xlSetCellStringValue(Получатель_ОКПО, 13, 10, 13, 10);

    xlSetCellStringValue(ИмяОС, 16, 4/*Col*/, 16, 4);
    // Характеристика
    iRow := 17;

    var r : word;
    var s : string;
    r:=0;

    if iLvar.InitAllMemo(Comp(KatOSNrec), 3000, 0)
    while (iLVar.GetMemoStr(S))
    {
      r++;
      if r = 1
        xlSetCellStringValue(s, iRow, 1, iRow, 1);
      else
       {
        iRow++;
        xlInsertRange(-4121/*xlShiftDown*/ , iRow, 1, iRow, 10);
        xlMergeCells(iRow, 1, iRow, 8);
        // xlFrameCells(xlBorderB, xlThin, 1, 1, iRow, 1, iRow, 8);
        xlSetCellStringValue(s, iRow, 1, iRow, 1);
        }
    }

    iRow:=iRow + 1;

    If n.GetFirst MoveOS where ((comp(MoveOsNRec) == MoveOS.Nrec))= tsOk
      If n.GetFirst KlassOS = tsOk
        xlSetCellStringValue(KlassOs.Name, iRow, 4, iRow, 4);
  }
end.
.{CheckEnter FEESIGNERSMEMBER_OSONE
.}
.{CheckEnter FEESIGNERSRESPONSIBLE_OSONE
.}
.{CheckEnter OS_OBOROT
.}
.{CheckEnter OS_LEAFS
.}
.{CheckEnter OS_SOSTAV
.}
.{CheckEnter OS_NALDRAG
.}
.{CheckEnter OS_AKTUSL
.}
.begin
  // Установить ширину заголовка таблицы
  //  xlSetRowHeight(60, iRow+5/*Row*/, 1/*Col*/, iRow+5, 11);
  //  xlSetRowHeight(38, iRow+6/*Row*/, 1/*Col*/, iRow+6, 11);
  xlSetRowHeight(80, iRow+5/*Row*/, 1/*Col*/, iRow+6, 1);
  xlSetRowHeight(80, iRow+5/*Row*/, 2/*Col*/, iRow+6, 2);
  xlSetRowHeight(80, iRow+5/*Row*/, 3/*Col*/, iRow+6, 3);
  xlSetRowHeight(80, iRow+5/*Row*/, 4/*Col*/, iRow+6, 4);

  xlSetRowHeight(40, iRow+5/*Row*/, 5/*Col*/, iRow+5, 7);
  xlSetRowHeight(40, iRow+5/*Row*/, 8/*Col*/, iRow+5, 10);


  //спецификация
  iRow += 8;
  iLastHeadRow := iRow;
  xlSetCellNumberValue(Полная_стоимость, iRow, 1/*Col*/,iRow ,1);
  xlSetNumberFormat('#'+xlGetThousandSeparator+ '##0'+xlGetDecimalSeparator+'00',iRow, 1, iRow, 1);

  xlSetCellNumberValue(Срок_полезного_использования, iRow, 2/*Col*/,iRow ,2);
  xlSetCellNumberValue(Новая_сумма_износа,iRow, 3/*Col*/,iRow ,3);
  xlSetNumberFormat('#'+xlGetThousandSeparator+ '##0'+xlGetDecimalSeparator+'00', iRow, 3, iRow, 3);

  xlSetCellNumberValue( Полная_стоимость - Новая_сумма_износа, iRow, 4/*Col*/, iRow, 4);
  xlSetNumberFormat('#'+xlGetThousandSeparator+ '##0'+xlGetDecimalSeparator+'00', iRow, 4, iRow, 4);

  // xlSetCellStringValue(ИмяОС, iRow, 7/*Col*/,iRow ,7);
  // xlSetCellStringValue(DateToStr(ДАТА_ПОСТ,'DD.MM.YYYY'), iRow, 8/*Col*/,iRow ,8);
  // xlSetCellStringValue(ИнвНомер, iRow, 9/*Col*/,iRow ,9);
  xlWrapText(iRow, 1,iRow, 10);

  iRow += 6;
  // сдал
  xlSetCellStringValue(МОЛ_ДОЛЖНОСТЬ_ПОСТАВЩИКА, iRow, 3/*Col*/, iRow, 3);
  xlSetCellStringValue(МОЛ_ДОЛЖНОСТЬ_ПОЛУЧАТЕЛЯ, iRow, 9/*Col*/, iRow, 9);

  iRow += 3;
  xlSetCellStringValue(МОЛ_ПОСТАВЩИКА     , iRow, 3/*Col*/,iRow ,3);
  // принял
  xlSetCellStringValue(МОЛ_ПОЛУЧАТЕЛЯ     , iRow, 9/*Col*/,iRow ,9);

  iRow += 5;
  xlSetCellStringValue('     АКТ № '+Номер_документа+' от ' +DateToStr(Дата_документа, '" DD " mon YYYYг.'), iRow, 3, iRow ,3);
  iRow += 1;
  xlSetCellStringValue(barcode, iRow/*Row*/, 8/*Col*/, iRow, 8);


 var fMacros : string;
 fmacros  := GetStringParameter('Files','TmpFilesDirectory',0)+'MacrosRep.bas';
 DeleteFile(Fmacros);
 LogStrToFile(Fmacros, 'Sub Sub1()                         ');
 LogStrToFile(Fmacros, 'Rows("1:'+iLastHeadRow+'").EntireRow.AutoFit    ');
 LogStrToFile(Fmacros, 'End Sub                            ');
 if ( xlImportModule(Fmacros) )
   {
     if not xlRunMacro('Sub1')
       message('Ошибка запуска макроса MacrosRep');
   }
 else
   message ('Ошибка загрузки макроса MacrosRep.');

  DeleteFile(Fmacros);
  xlKillExcel;
end.
.} // Конец формы
.endform
