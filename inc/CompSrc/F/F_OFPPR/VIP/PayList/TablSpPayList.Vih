//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 8.10 - модуль "Платежный календарь (PR)"
// Табличный объект : "Спецификация реестра платежей"
//------------------------------------------------------------------------------

#ifndef __TablSpPayList_Vih__
#define __TablSpPayList_Vih__

#ifdef  ComponentVersion
#component "F_OFPPR"
#endif//ComponentVersion
              
//------------------------------------------------------------------------------
#include Fp_BaseAbstractTblInc.Vih  // Абстрактный базовый интерфейс : "Object Related Table"
#include TablPayList.Vih            // Табличный объект : "Реестр платежей"
#include ExtTablClearing.Vih        // Табличный объект взаимодействия: "Финансовые операции"
#include ExtTablDocReqUksMTO.Vih    // Табличный объект взаимодействия: "Заявки модуля L_UksMTO"
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
#doc
Табличный объект : "Спецификация реестра платежей"
#end
Private ObjInterface oTablSpPayList( oFp_BaseAbstractTblInc );
  // поля спецификации 
  Property NRec              : comp                  read write;  // Номер записи          
  Property cPayList          : comp                  read write;  // Реестр платежей
  Property Npp               : word                  read write;  // Номер по порядку
  Property Status            : word                  read write;  // Текущее состояние
  Property cDocReq           : comp                  read write;  // Заявка
  Property cAktOFP           : comp                  read write;  // Обязательство
  Property cClearing         : comp                  read write;  // Финооперация
  Property cAktPerf          : comp                  read write;  // Исполнение обязательств
  Property wActive           : word                  read write;  // Режимы активности (см. TablSpPayList.Inc)
  Property Summa             : tSumma                read write;  // Сумма платежа
  Property cVal              : comp                  read write;  // Валюта платежа 
  Property Name              : string                read write;  // Описание              
                                                     
  Property IsActive          : boolean               read      ;  // Заявка "активна" в реестре
  Property IsAbandon         : boolean               read write;  // Заявка "исключена" из реестра
  Property IsAborted         : boolean                    write;  // Заявка "отменена" из реестра
  Property IsWarningSumma    : boolean               read      ;  // По такой сумме не может быть создан ПД
  Property AbandonChar       : s1                    read      ;  // Символ "исключенности" заявки из реестра
                                                     
  // поля самого реестра                             
  Property PLGrDsc           : s20                   read      ;  // "Реестр платедей" - группа/дескриптор пользователя
  Property PLDesGr           : tDescr                read      ;  // "Реестр платедей" - группа пользователя
  Property PLDescr           : tDesGr                read      ;  // "Реестр платедей" - дескриптор пользователя        
  Property PLStatus          : word                  read      ;  // "Реестр платедей" - статус
  Property PLNoDoc           : s20                   read      ;  // "Реестр платедей" - номер документа
  Property PLdDoc            : Date                  read write;  // "Реестр платедей" - дата документа
  Property PLdFin            : Date                  read      ;  // "Реестр платедей" - дата финансирования
  Property PLSumma           : tSumma                read      ;  // "Реестр платедей" - сумма
                                                  
  // поля заявки
  Property otfDocReq         : oExtTablDocReqUksMTO  read      ;  // Табличный объект: "Заявки"           
  Property DRGrDsc           : s20                   read      ;  // "Заявка" - группа/дескриптор пользователя 
  Property DRDesGr           : tDescr                read      ;  // "Заявка" - группа пользователя            
  Property DRDescr           : tDesGr                read      ;  // "Заявка" - дескриптор пользователя        
  Property DRNoDoc           : s20                   read      ;  // "Заявка" - номер документа
  Property DRdDoc            : Date                  read      ;  // "Заявка" - дата создания
  Property DRdFin            : Date                  read      ;  // "Заявка" - регаментная дата платежа
  Property DRFullNote        : s80                   read      ;  // "Заявка" - полное наименование статуса
  Property DRAbbrNote        : s30                   read      ;  // "Заявка" - краткое наименование статуса
  Property DRsOrg            : string                read      ;  // "Заявка" - наименование контрагента
  Property DRSumma           : tSumma                read      ;  // "Заявка" - сумма
  Property DRPDSumma         : tSumma                read      ;  // "Заявка" - сумма сформированных платежных документов
  Property DRsVal            : s5                    read      ;  // "Заявка" - наименование валюты
                                                     
  // поля ФОП                                        
  Property otfClearing       : oExtTablClearing      read      ;  // Табличный объект: "Финансовые операции"
  Property CLMeanType        : word                  read write;  // "ФОП" - тип платежного средства
  Property CLMeanTypeName    : TName                 read      ;  // "ФОП" - наименование типа платежного средства
  Property CLcPlanMean       : comp                  read write;  // "ФОП" - платежное средство
  Property CLPlatMeanName    : TName                 read      ;  // "ФОП" - наименование платежного средства
  Property CLIsMultyPlatMean : boolean               read      ;  // "ФОП" - по типу ПС, ведется несколько ПС
  Property CLTiDKGal         : word                  read write;  // "ФОП" - тип документа системный
  Property CLTiDKGalName     : TName                 read      ;  // "ФОП" - наименование системного типа документа
  Property CLSumma           : tSumma                read write;  // "ФОП" - сумма
  Property CLSumVal          : tSumma                read write;  // "ФОП" - сумма в валюте
  Property CLHozSumma        : tSumma                read      ;  // "ФОП" - сумма сформированнных ПД
  Property CLSumFact         : tSumma                read      ;  // "ФОП" - сумма оплаченных ПД
  Property CLcVal            : comp                  read write;  // "ФОП" - валюта плат ср-ва
  Property CLsVal            : s5                    read      ;  // "ФОП" - наименование валюты
                                                  
  // поля платежного документа                    
  Property PDIsExist         : boolean               read      ;  // "ПД" - документ уже существует
  Property PDDocName         : string                read      ;  // "ПД" - наименование документа
  Property PDNoDoc           : TNoDoc                read      ;  // "ПД" - номер документа
  Property PDDatOb           : date                  read      ;  // "ПД" - дата документа
  Property PDTiDK            : word                  read      ;  // "ПД" - тип документа
  Property PDTiDKGal         : word                  read      ;  // "ПД" - тип документа системный
  Property PDcDoc            : comp                  read      ;  // "ПД" - NRec документа
  Property PDSumma           : tSumma                read      ;  // "ПД" - сумма 
  Property PDSumVal          : tSumma                read      ;  // "ПД" - сумма в валюте
  Property PDcVal            : comp                  read      ;  // "ПД" - валюта
  Property PDsVal            : s5                    read      ;  // "ПД" - наименование валюты


  Index SpPayList01 = NRec(Unique, Primary) ;
  Index SpPayList02 = cPayList, Npp         ;
  Index SpPayList03 = cPayList, cDocReq     ;
  Index SpPayList04 = cDocReq, wActive      ;
  Index SpPayList05 = wActive               ;
  Index SpPayList06 = cPayList, cAktOFP     ;
  Index SpPayList07 = cAktOFP, wActive      ;
  Index SpPayList08 = cClearing             ;
  Index SpPayList09 = cDocReq, PLdDoc       ;


  //----------------------------------------------------------------------------
  #doc
     Получить ссылку на табличный объект : "Реестр платежей"
  #end
  Function GetVipRefPayList(
  var _oPL  : oTablPayList    // Табличный объект : "Реестр платежей"
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить идентификатор иконки статуса
  #end
  Function GetStatusImage : string;
  //----------------------------------------------------------------------------
  #doc
     Получить идентификатор иконки платежного документа
  #end
  Function GetPayDocImage : string;

  //----------------------------------------------------------------------------
  #doc
     Расчитать следующий номер поп порядку
  #end
  Function CalcNextNpp : boolean;

  //----------------------------------------------------------------------------
  #doc
     Установить сумму разноски заявки
  #end
  Function SetSumma(_Value : double) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Установить признак "исключена"
  #end
  Function SetIsAbandon(_Value : boolean) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Установить признак "отклонена"
  #end
  Function SetIsAborted(_Value : boolean) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить наименование типа платежного средства
  #end
  Function GetMeanTypeName(
    _wMeanType  : word;       // тип ПС
    _IsAbbrName : boolean     // True - выводить краткое наименование, False - полное
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Сформировать массивы значений типа платежного средства
  #end
  Function GetMeanTypeArray(
      _wClearType : word;     // тип операции
  var _ArrMTs     : TArrMTs;  // массив наименований
  var _ArrMTw     : TArrMTw   // массив констант
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Запуск выбора платежного средства
  #end
  Function RunPickPlatMean(
      _wMeanType : word;      // тип ПС
  var _cPlatMean : comp       // GC
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Можно ли создавть пдатежный документ
  #end
  Function GetIsCanCreatePayDoc(
    _wMessage    : word       // режим выдачи сообщений
  ) : boolean;

End; // ObjInterface

//------------------------------------------------------------------------------
VipInterface TablSpPayList( Fp_BaseAbstractTblInc ) implements oTablSpPayList
#Licensed_Free;
Public:
  Function  IModify.doInsert : word;
  Function  IModify.doUpdate : word;
  Function  IModify.doDelete : word;
           
  Function  IManualIndex.Count : LongInt;

  Function  oTablSpPayList.CheckFld : boolean;
End;

#endif//__TablSpPayList_Vih__
