//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 8.10 - модуль "Управление бюджетом"
// Интерфейс взаимодействия : "Копии бюджетов"
//------------------------------------------------------------------------------

#ifndef __FpExBV_Vih__
#define __FpExBV_Vih__

#ifdef  ComponentVersion
#component "F_FpBudget"
#endif//ComponentVersion

//------------------------------------------------------------------------------
#include FpExBV.Inc    // типы данных инт. взаимодействия "Копии бюджетов"
#include FpBudVar.Inc  // типы данных сущности "Копии бюджетов"
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
#doc
Интерфейс взаимодействия : "Копии бюджетов"<br>
<b>Внимание!</b> Интерфейс предназначен только для использования внутри контура "Финансы"<br>
#end
ObjInterface iExtFpBudVar;

  //============================================================================
  //                                  ERROR
  //----------------------------------------------------------------------------
  #doc
     Функция возвращает описание последней ошибки
  #end
  Function GetStLastError : string;
  //----------------------------------------------------------------------------
  #doc
     Вывод сообщения последней ошибки
  #end
  Function RunShowError : boolean;
  //****************************************************************************


  //============================================================================
  //                                INIT-DONE
  //----------------------------------------------------------------------------
  #doc
     Освобождение ссылок на объекты, провоцирующие циклические зависимости
  #end
  Function FreeCrossVipRef : boolean;
  //****************************************************************************


  //============================================================================
  //                               FIELDS (Get)
  //----------------------------------------------------------------------------
  #doc
     Получить признак "активной копии"
  #end
  Function GetActive(
      _cBudVar  : comp        // копия бюжета
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить наименование
  #end
  Function GetName(
      _cBudVar  : comp        // копия бюжета
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Получить наименование в виде "стадия"/"вариант"
  #end
  Function GetStVarName(
      _cBudVar  : comp        // копия бюжета
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Получить ссылку на бюджет
  #end
  Function GetBudget(
      _cBudVar  : comp        // копия бюжета
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Получить ЦО бюджета
  #end
  Function GetCO(
      _cBudVar  : comp        // копия бюжета
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Получить период бюджета
  #end
  Function GetPeriod(
      _cBudVar  : comp        // копия бюжета
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Получить ссылку на типологию периода бюджета
  #end
  Function GetMainTPer(
      _cBudVar  : comp        // копия бюжета
  ) : comp;
  //----------------------------------------------------------------------------
  #doc
     Получить ссылку на тип периода бюджета
  #end
  Function GetSpTPer(
      _cBudVar  : comp        // копия бюжета
  ) : comp;
  //----------------------------------------------------------------------------
  #doc
     Является ли тип периода бюджета копии - текущим типов установленным для бюджетирвоания
  #end
  Function IsCurTPer(
      _cBudVar  : comp        // копия бюжета
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить вариант бюджета
  #end
  Function GetVariant(
      _cBudVar  : comp        // копия бюжета
  ) : comp;
  //----------------------------------------------------------------------------
  #doc
     Получить вариант прогнозного курса бюджета
  #end
  Function GetValVariant(
      _cBudVar  : comp        // копия бюжета
  ) : comp;
  //----------------------------------------------------------------------------
  #doc
     Получить вариант расчета бюджета
  #end
  Function GetAlgVariant(
      _cBudVar  : comp        // копия бюжета
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Получить стадию бюджетного процесса
  #end
  Function GetStage(
      _cBudVar  : comp        // копия бюжета
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Получить дескриптор пользователя
  #end
  Function GetDescr(
      _cBudVar  : comp        // копия бюжета
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Получить текущую "область видимости", установленную для пользователя
  #end
  Function GetCurArea : comp;
  //----------------------------------------------------------------------------
  #doc
     Получить наименование "области видимости"
  #end
  Function GetAreaName(
      _cArea : comp           // область видимости
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Получить ссылку на "предыдущую" копию бюджета
  #end
  Function GetPrevBudVar(
      _cBudVar  : comp        // копия бюжета
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Получить типологию периода
  #end
  Function GetTypoTPer(
      _cBudVar  : comp        // копия бюжета
  ) : comp;     

  //----------------------------------------------------------------------------
  #doc
     Получить "правило передачи данных" установленное для заданного регистра
  #end
  Function GetObRelTune(
      _cBudVar  : comp;       // копия бюжета
      _wKodReg  : word
  ) : comp;
  //****************************************************************************


  //============================================================================
  //                               FIELDS (Set)
  //----------------------------------------------------------------------------
  //----------------------------------------------------------------------------
  #doc
     Установить наименование копии бюджета
  #end
  Function SetName(
      _cBudVar  : comp;       // копия бюжета 
      _Value    : string      // наименование
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Установить текущую "область видимости"
  #end
  Function SetCurArea(
      _cArea    : comp        // область видимости
  ) : boolean;


  //============================================================================
  //                                  COMMON
  //----------------------------------------------------------------------------
  #doc
     Есть ли данные в копии бюджета для заданного регистра учета 
  #end
  Function HaveValues(
      _cBudVar  : comp;       // копия бюжета
      _wKodReg  : word        // код регистра
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить наименование статуса для заданного регистра учета
  #end
  Function GetRegStateName(
      _cBudVar  : comp;       // копия бюжета 
      _wKodReg  : word        // код регистра
  ) : string;
  //----------------------------------------------------------------------------
  #doc
     Получить короткое наименование статуса для заданного регистра учета
  #end
  Function GetRegStateShortName(
      _cBudVar  : comp;       // копия бюжета 
      _wKodReg  : word        // код регистра
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Получить буфер активной копии бюджета
  #end
  Function FindActiveBuf(
      _cBudget  : comp;       // ссылка на бюджет
  var _Buff     : TPFpBudVar  // буффер копии бюджета
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить ссылку на активную копию бюджета
  #end
  Function FindActive(
      _cBudget  : comp;       // ссылка на бюджет
      _wMessage : word        // режим выдачи сообщений
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Получить буфер копии бюджета, по заданным реквизитам
  #end
  Function FindBudVarBuf(
      _cBudget  : comp;       // ссылка на бюджет
      _cVariant : comp;       // вариант бюджета 
      _sStage   : string;     // стадия бюджетного процесса 
  var _Buff     : TPFpBudVar  // буффер копии бюджета
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить ссылку на копию бюджета, по заданным реквизитам
  #end
  Function FindBudVar(
      _cBudget  : comp;       // ссылка на бюджет
      _cVariant : comp;       // вариант бюджета  
      _sStage   : string;     // стадия бюджетного процесса 
      _wMessage : word        // режим выдачи сообщений
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Получить буфер последней копии бюджета
  #end
  Function FindLastBudVarBuf(
      _cBudget  : comp;       // ссылка на бюджет
      _cVariant : comp;       // вариант бюджета  
  var _Buff     : TPFpBudVar  // буффер копии бюджета
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить ссылку на последнюю копию бюджета
  #end
  Function FindLastBudVar(
      _cBudget  : comp;       // ссылка на бюджет
      _cVariant : comp;       // вариант бюджета  
      _wMessage : word        // режим выдачи сообщений
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Найти первую доступную копию бюджета по заданной области видимости
  #end
  Function FindAnyAvBudVar(
      _cBudget  : comp;       // ссылка на бюджет
      _wMessage : word        // режим выдачи сообщений
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Установить признак "активности" копии
  #end
  Function SetActivBudVar(
      _cBudVar  : comp;       // копия бюжета 
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Установить примечание 
  #end
  Function SetInfo(
      _cBudVar  : comp;       // копия бюжета 
      _sPrim    : string      // примечание
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Сгенерировать новую стадию бюджетного процесса
  #end
  Function GetNewStage(
      _cBudget  : comp;       // ссылка на бюджет 
      _cVariant : comp;       // вариант бюджета  
      _cArea    : comp
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Создать копию бюджета
  #end
  Function InsBudVar(
      _cBudget  : comp;       // ссылка на бюджет
  var _cVariant : comp;       // вариант бюджета 
  var _sStage   : string;     // стадия бюджетного процесса
      _wMessage : word        // режим выдачи сообщений
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Создать новую копию бюджета
  #end
  Function InsNewBudVar(
      _cBudget  : comp;       // ссылка на бюджет
  var _cVariant : comp;       // вариант бюджета 
  var _sStage   : string
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Создать копию бюджета с заданным дескриптором
  #end
  Function InsBudVarByDscr(
      _cBudget  : comp;       // ссылка на бюджет
  var _cVariant : comp;       // вариант бюджета 
  var _sStage   : string;     // стадия бюджетного процесса
      _sDescr   : string;     // дескриптор пользователя
      _wMessage : word        // режим выдачи сообщений
  ) : comp;

  //----------------------------------------------------------------------------
  #doc
     Удалить данные по копии бюджета
  #end
  Function DelValuesBudVar(
      _cBudVar  : comp;       // копия бюжета
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Удалить все данные по копии бюджета и регистру
  #end
  Function DelValuesByKodRegBudVar(
      _cBudVar  : comp;       // копия бюжета
      _wKodReg  : word;       // код регистра
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Удалить данные по копии бюджета и регистру в "открытом периоде"
  #end
  Function DelValuesByKodRegBudVarInOpenPeriod(
      _cBudVar  : comp;       // копия бюжета
      _wKodReg  : word;       // код регистра
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Очистить данные по копии бюджета и регистру в "открытом периоде"
  #end
  Function ClrValuesByKodRegBudVarInOpenPeriod(
      _cBudVar  : comp;       // копия бюжета
      _wKodReg  : word;       // код регистра
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Удалить копию бюджета
  #end
  Function DelBudVar(
      _cBudVar  : comp;       // копия бюжета
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Удалить копию бюджета с выставлением блокировки
  #end
  Function DelBudVarWithLock(
      _cBudVar  : comp;       // копия бюжета
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;
  //****************************************************************************


  //============================================================================
  //                            МОНОПОЛЬНЫЙ ДОСТУП
  //----------------------------------------------------------------------------
  #doc
     Установить значения свойства
  #end
  Function SetMonoUser(
      _cBudVar  : comp;       // копия бюжета 
      _sDescr   : string;     // дескриптор пользователя 
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Получить значения свойства
  #end
  Function GetMonoUser(
      _cBudVar  : comp        // копия бюжета
  ) : string;
  //****************************************************************************


  //============================================================================
  //                                  RIGHT
  //----------------------------------------------------------------------------
  #doc
     Разрешено ли редактирование таблицы копий бюджета
  #end
  Function CanEditTbl(
      _cBudget  : comp;       // ссылка на бюджет
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;          

  //----------------------------------------------------------------------------
  #doc
     Разрешено ли редактирование копии бюджета
  #end
  Function CanEditRec(
      _cBudVar  : comp;       // копия бюжета
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;          

  //----------------------------------------------------------------------------
  #doc
     Разрешен ли просмотр данных копии бюджета
  #end
  Function CanViewValues(
      _cBudVar  : comp;       // копия бюжета
      _wKodReg  : word;       // код регистра
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Разрешено ли использование данных копии бюджета
  #end
  Function CanUseValues(
      _cBudVar  : comp;       // копия бюжета
      _wKodReg  : word;       // код регистра
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Разрешено ли редактирование данных копии бюджета текущему пользователю
  #end
  Function CanEditValues(
      _cBudVar  : comp;       // копия бюжета
      _wKodReg  : word;       // код регистра
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Разрешено ли редактирование данных копии бюджета (расширенная версия)
  #end
  Function CanEditValues_Adv(
      _cBudVar  : comp;       // копия бюжета
      _wKodReg  : word;       // код регистра
      _isByUser : boolean;    // учитывать права текущего пользователя
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Разрешено ли удалять копию бюджета
  #end
  Function CanDelRec(
      _cBudVar  : comp;       // копия бюжета
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Разрешено ли редактировать поля, влияющие на расчет бюджета
  #end
  Function CanEditAlgRules(
      _cBudVar  : comp;       // копия бюжета          
      _wMessage : word        // режим выдачи сообщений
  ) : boolean;
  //****************************************************************************


  //============================================================================
  //                                  DIALOG
  //----------------------------------------------------------------------------
  //----------------------------------------------------------------------------
  #doc
     Функция возвращает наименование маркера
  #end
  Function GetMarkerName : string;

  //----------------------------------------------------------------------------
  Function DlgBudVarProp(
     _wRunMode  : word;       // режим
                              // 0 - создание новой копии бюджеты
                              // 1 - редактирование ст.бюдж. процесса
                              // 2 - просто выбор
  var _cArea    : comp;       // обл видимости
      _cBudget  : comp;       // ссылка на бюджет
  var _cVariant : comp;       // вариант бюджета
  var _sStage   : string;     // стадия бюджета
  var _sDescr   : string;     // дескриптор пользователя
  var _wGetMode : word        // wGetMode = 1 Активная копия
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Запуск интерфейса просмотра
  #end
  Function RunViewBudVar(
      _wIntMode : word;       // режим запуска (cgiNo, cgiPick, ...) см.GLOCONST.INC
      _cGetBud  : comp;       // ссылка на бюджет
  var _cGetRec  : comp        // копия бюджета
  ) : LongInt;

  //----------------------------------------------------------------------------
  #doc
     Запуск интерфейса редактирования
  #end
  Function RunEditBudVar(
      _wIntMode : word;       // режим запуска (cgiNo, cgiPick, ...) см.GLOCONST.INC
  var _cGetBud  : comp;       // ссылка на бюджет
  var _cGetRec  : comp        // копия бюджета
  ) : boolean;
  //****************************************************************************


  //============================================================================
  //                                CONVERTER
  //----------------------------------------------------------------------------
  #doc
     Запуск функции проверки корректности
  #end
  Function CheckAllBudVarVariant : boolean;
  //****************************************************************************


End; // ObjInterface


//==============================================================================
VipInterface vExtFpBudVar implements iExtFpBudVar
#Licensed_Free;
Public:
  Constructor Init;
  Destructor  Done;
End;


#endif//__FpExBV_Vih__
