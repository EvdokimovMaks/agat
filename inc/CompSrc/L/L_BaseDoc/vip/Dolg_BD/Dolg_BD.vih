//******************************************************************************
//                                                      (c) корпорация Галактика
// Галактика 8.1 - Логистика
// Функции для получения сумм отгрузок, оплат, задолженностуй по ДО
//******************************************************************************

//******************************************************************************

#ifNdef __Dolg_BD_VIH__
#define __Dolg_BD_VIH__

//******************************************************************************

#ifdef ComponentVersion
#component "L_BASEDOC"
#end

#doc
Содержит методы для расчета сумм отгрузок и платежей по ДО
#end
ObjInterface CalcDolgBDObj;
//------------------------------------------------------------------------------
 // расчет суммы отгрузок по ДО на дату
 Function GetSumOtgr_DO(_cRecBD       : comp;
                        dDateCalc     : date;    // дата расчета
                    var SumOtgrDO     : double;  // сумма отгрузок по ДО
                    var SumDolgOtgrDO : double   // сумма задолженности отгрузок по ДО
                       ) : boolean;
//------------------------------------------------------------------------------
 //  расчет сумм поступивших платежей по ДО
 Function GetSumOpl_DO(_cRecBD   : comp;
                       dDateCalc : date;    // дата расчета
                   var AllPlat   : TSumma;  // сумма отгрузок по ДО
                   var PlatPrih  : TSumma;
                   var PlatRash  : TSumma;
                   var DolgPlat  : TSumma
                      ) : boolean;
//------------------------------------------------------------------------------
 // получить дату курса и курс для ДО
 // если нет BaseFin
 // _wMode = 1 - дата курса/дата цен/дата ДО
 //          2 - если дата цен <> 0, то дата цен, иначе BaseDoc.dDoc
 //          4 - только BaseDoc.dDoc
 //          8 - max из дат: "оплатить до", BaseDoc.dEnd (планируемый срок оплаты)
 //          32768 - не учитывать привязанные BaseFin (1 SHL 15)
 Function GetCurseValRubMoneyDO(_cBaseDoc
                              , _cBaseFin: comp;
                            var _dCurse  : date;
                            var _Curse   : TSumma;
                                _wMode   : word) : double;

//------------------------------------------------------------------------------
 // расчет сумм отгрузок и рекламаций по ДО на дату
 // возвращает сумму отгрузок с учетом рекламаций по ДО
 Function GetAllSumOtgrDO( _cRecBD            : comp;
                           dBegDateCalc       : date;    // дата начала интервала учета накладных
                           dEndDateCalc       : date;    // дата окончания и дата расчета
                       var SumOtgrDO          : double;  // сумма отгрузок по ДО
                       var SumReklDO          : double;  // сумма рекламаций по ДО
                       var SumDolgOnlyOtgrDO  : double;  // сумма задолженности отгрузок по ДО
                       var DolgOtgrDOWihtRekl : double   // сумма задолженности отгрузок с учетом рекламаций
                         ) : double;

//------------------------------------------------------------------------------
 //  расчет сумм поступивших платежей по ДО
 // _wMode = 0 - учет всех BaseFin -ов
 //          1 - не учитывать _cBaseFin
 //          2 - не учитывать платеж, связанный с _cBaseFin
 //          4 - учесть только _cBaseFin
 //          8 - учесть только BaseFin-ы платежа, связанного с _cBaseFin
 //         16 - учитывать штрафы
 Function GetAllSumOpl_DO(_cRecBD      : comp;
                          _cBaseFin    : comp;
                          dBegDateCalc : date;    // дата начала интервала учета BaseFin
                          dEndDateCalc : date;    // дата окончания и дата расчета
                      var AllPlat      : TSumma;  // сумма всех платежей по ДО
                      var PlatPrih     : TSumma;
                      var PlatRash     : TSumma;
                      var DolgPlat     : TSumma;
                          _wMode : word
                         ): double;
//------------------------------------------------------------------------------
 //переинициализация переменных
 Function ReReadValueTunes: boolean;
 //Сумма НДЕ отгрузок по ДО
 Function GetAllSumOtgrDO_NDE: double;

 //Сумма НДЕ платежей по ДО
 Function GetAllSumOplDO_NDE: double;

 //Признак того, что все отгрузки/платежи были в НДЕ
 Function IsDocsOnlyNDE: boolean;
end;

ObjInterface CalcDolgBDObj_pl;
  Function GetAllSumOtgrDO_ext(_cRecBD           : comp;
                               dBegDateCalc      : date;   // дата начала интервала учета накладных
                               dEndDateCalc      : date;   // дата окончания и дата расчета
                           var SumOtgrDO         : double; // сумма отгрузок по ДО направление как у ДО
                           var SumReklDO         : double; // сумма возвратов по ДО направление обратное к ДО
                           var SumDolgOnlyOtgrDO : double; // сумма задолженности отгрузок по ДО
                           var DolgOtgrDOWihtRekl: double  // сумма задолженности отгрузок с учетом рекламаций
                        ): double;

end;

VipInterface CalcDolgBD implements CalcDolgBDObj
                                  ,CalcDolgBDObj_pl
  licensed (free) Parameters (pRecBD : comp; pDateCalc : date)
;

#end // __Dolg_BD_VIH__
//******************************************************************************
