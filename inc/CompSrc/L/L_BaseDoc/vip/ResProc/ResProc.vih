//********************************************************************************
//                                                      (c) корпорация Галактика *
// Галактика 8.1 - Логистика                                                     *
// Интерфейс с функциями резервирования                                          *
//********************************************************************************

#ifNdef __ResProc_vih___
#define __ResProc_vih___

#ifdef ComponentVersion
#component "L_BASEDOC"
#end

#include TBaseDoc.vih

#doc
 Интерфейс с функциями резервирования
#end
ObjInterface objResProc;
  Function  AllowedToReservOnParty(pPartyStep, pPartySaldo: comp): boolean;
  Function  CheckRestrictRazrez(pSklad, pMOL, pParty: comp): boolean;
  Procedure SubResTovMC(BDcParty    : comp;
                        ssPrMC      : word;
                        sscMCUSL    : comp;
                        koeKoef     : double;
                        NeedKolSub  : double);
  Procedure SubResRazrez(pBaseDoc: comp; Buf: TSpStepP);
  Procedure DelPosDoRes(pSpStep: comp);
  Function  ProcSklRes(pBaseDoc: comp; NeedMsg: boolean): boolean;
  Procedure ResPoTov(pBaseDoc: comp; Buf: TSpStepP; ManualInput: double; RepErr, NeedMsg: boolean);

  #doc
  Автоматическое резервирование по позициям.</brief>
  В случае, если пакетном режиме (NeedMsg = false), вызов метода завершен ошибкой (метод вернул false),
  то описание причины ошибки можно получить вызовом GetLastErrMsg().
  В процессе резервирования может формироваться протокол. В пакетном режиме протокол на экран не выводится.
  Им можно манипулировать, воспользовавшись методами GetReportHandle, GetReportFileName.
  #end
  Function  Proc20(pBaseDoc: comp; var ResIs: boolean; NeedMsg: boolean): boolean;
  Procedure Proc14(pBaseDoc: comp);
  Function  GetKolNotADGL(pSpStep: comp): double;
  Procedure SubResRazrezWithCheckADGL(pBaseDoc: comp; Buf: TSpStepP);

  #doc
  Возвращает текст сообщения об ошибке при неудачном завершении ProcSklRes, ProcSklResEx, Proc20,
  когда параметр NeedMsg = false.
  #end
  Function GetLastErrMsg: String;

  #doc
  Возвращает хэндл протокола ошибок.
  #end
  Function GetReportHandle: longint;

  #doc
  Возвращает имя файла с путем, в котором находится протокол ошибок.
  #end
  Function GetReportFileName: string;

  #doc
  Расширенный вариант метода резервирования по полному складскому разрезу.</brief>
  В случае, если пакетном режиме (NeedMsg = false), вызов метода завершен ошибкой (метод вернул false),
  то описание причины ошибки можно получить вызовом GetLastErrMsg().
  В процессе резервирования может формироваться протокол. В пакетном режиме протокол на экран не выводится.
  Им можно манипулировать, воспользовавшись методами GetReportHandle, GetReportFileName.
  #end
  function ProcSklResEx2(
    pBaseDoc: comp;
    pSpStep: comp;     //#docl 0 - по всей спецификации, SpStep.nRec - по конкретной позиции
    NeedMsg: boolean;  //#docl false - не выдавать никаких сообщений пользователю
    out FullRes: word; //#docl 1 - выполнено полное резервирование, 2 - выполнено частичное резервирование.
    out KolNet: word;
    out ResFlag: boolean;
    out PartyFlag: boolean
  ): boolean;
end;

VipInterface iResProc implements objResProc licensed (free);

#end // __ResProc_vih___