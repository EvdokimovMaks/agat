//******************************************************************************
//                                                      (c) корпорация Галактика
// Галактика 7.12 - Логистика
// Функции для документов-оснований
//******************************************************************************

#ifNdef __DOfuns_vih__
#define __DOfuns_vih__

#ifdef ComponentVersion
#component "L_BASEDOC"
#end

#doc
Содержит описание методов для работы с документами-основаниями
#end
ObjInterface ObjDOfuns;

//******************************************************************************
#doc
Проверка наличия проводок перед удалением ДО
#end
function CheckFinCanDelDO(wVidDoc : word; cBaseDoc : comp; isMes : boolean): boolean;

//------------------------------------------------------------------------------
#doc
Удаление хозопераций по ДО
#end
Procedure DelRaznPlt(var cBaseDoc: comp);

//------------------------------------------------------------------------------
#doc
Округление по настройке Round.BuyDORub
#end
function fRoundRub1_1(sum: double): double;

#doc
Округление по настройке Round.BuyDOVal
#end
function fRoundVal1_1(sum: double): double;

#doc
Округление по настройке Round.SellDORub
#end
function fRoundRub2_1(sum: double): double;

#doc
Округление по настройке Round.SellDOVal
#end
function fRoundVal2_1(sum: double): double;

//------------------------------------------------------------------------------
#doc
Округление с определением настройки округления по типу документа для сумм в НДЕ
#end
function DoRoundNde(Tip: word; var Sum: double): double;

#doc
Округление с определением настройки округления по типу документа для сумм в валюте
#end
function DoRoundVlt(Tip: word; var Sum: double): double;

#doc
Округление с определением настройки округления по типу документа для сумм в НДЕ/валюте
#end
function DoRound(Vlt: comp; Tip: word; var Sum: double): double;

//------------------------------------------------------------------------------
#doc
Округление с определением настройки округления по типу документа для сумм в НДЕ
#end
function DoRoundNdeP(Tip: word; var Sum: double): double;

#doc
Округление с определением настройки округления по типу документа для сумм в валюте
#end
function DoRoundVltP(Tip: word; var Sum: double): double;

#doc
Округление с определением настройки округления по типу документа для сумм в НДЕ/валюте
#end
function DoRoundP(Vlt: comp; Tip: word; var Sum: double): double;

//------------------------------------------------------------------------------
#doc
Возвращает количество знаков после запятой
#end
function getKolZnak(RRub: double): byte;

//------------------------------------------------------------------------------
#doc
Возвращает количество знаков после запятой для цены/стоимости в НДЕ/валюте
#end
procedure GetRoundValues(VidDoc : word; var ForPrice, ForVPrice, ForSumma, ForVSumma : byte);

//------------------------------------------------------------------------------
#doc
Установка точности отображения цены/стоимости
#end
procedure QuickSetRoundFormat(VidDoc: word);

//------------------------------------------------------------------------------
#doc
Установка точности отображения цены/стоимости
#end
procedure SetRoundFormat(VidDoc: word; IsVal: boolean);

//------------------------------------------------------------------------------
#doc
Удаление позиции спецификации
#end
function SpStep_Delete (_NRec: comp): word ;

//------------------------------------------------------------------------------
#doc
Отсоединить вагон от спецификации ДО
#end
function VagFun_DisConnectSpStep(pSpStep:comp): word;

//------------------------------------------------------------------------------
#doc
Присоединить вагон к спецификации ДО
#end
function VagFun_ConnectSpStep(pVag:comp;pSpStep:comp;pOrg:comp): boolean;

//------------------------------------------------------------------------------
#doc
Функция установки грузополучателя в УК
#end
function VagFun_SetGrPol(pSpStep:comp;pOrg:comp):word;

//------------------------------------------------------------------------------
#doc
Сообщение при отмене удаления ДО
#end
procedure BaseDoc_Message_Error(s: string);

//------------------------------------------------------------------------------
#doc
Функция удаления ДО
#end
function BaseDoc_Delete (_NRec: comp): word;

//------------------------------------------------------------------------------
#doc
Расчет скидок по ДО
#end
function BaseDoc_CountSkidka(_NRec: comp; isMes: boolean): word;

//------------------------------------------------------------------------------
#doc
Изменение номера ДО
#end
procedure ChangeNoDoc(pBaseDoc: comp; sNSopr: tDocNumber);

//------------------------------------------------------------------------------
#doc
Определение направления операции по типу документа
#end
function GetDirectOnVidDoc(wVidDoc: word): word;

//------------------------------------------------------------------------------
#doc
Определение типа хозоперации по типу документа
#end
function GetTipHozOnVidDoc(wVidDoc: word): word;

//------------------------------------------------------------------------------
#doc
Определение типа документа по типу хозоперации
#end
function GetVidDocOnTipHoz(wTipHoz: word): word;

//------------------------------------------------------------------------------
#doc
Определение налоговой базы
#end
function GetBaseNalog(bufBaseDoc: type$BaseDoc; bufSpStep: type$SpStep; pGroupMC: string[20]): double;

//------------------------------------------------------------------------------
#doc
Формирование номера ДО
#end
Function GetNextNumberBaseDoc(BD_buf: type$BaseDoc): tDocNumber;

end;

#doc
Содержит описание методов для работы с документами-основаниями
#end
ObjInterface ObjDOfunsV2(ObjDOfuns);
//------------------------------------------------------------------------------
#doc
Проверка на уникальность номера ДО. !!!! Лучше пользоваться IsNoDocUniqueEx
#end
Function IsNoDocUnique(pBaseDoc : comp; wVidDoc : word; sNewNoDoc, sOldNoDoc : string) : boolean;

end;

#doc
Содержит описание методов для работы с документами-основаниями
#end
ObjInterface ObjDOfunsV3(ObjDOfunsV2);
//------------------------------------------------------------------------------
#doc
Проверка на уникальность номера ДО с возвратом текста ошибки
#end
Function IsNoDocUniqueEx(bufBaseDoc: type$BaseDoc; sOldNoDoc : string; var sError : string) : boolean;

end;

#doc
Содержит описание методов для работы с документами-основаниями
#end
ObjInterface ObjDOfunsV4(ObjDOfunsV3);
//------------------------------------------------------------------------------
#doc
Получить значение примечания ДО по документу
#end
Function SetBaseDocName(wTable : word; pRec : comp; boDog : boolean): string;
end;

#doc
Содержит описание методов для работы с документами-основаниями
#end
ObjInterface ObjDOfunsV5(ObjDOfunsV4);
//------------------------------------------------------------------------------
#doc
Округление с определением настройки округления по типу документа для сумм в НДЕ/валюте
#end
function DoRoundEx(bufBaseDoc: type$BaseDoc; var Sum: double): double;
end;

#doc
Содержит описание методов для работы с документами-основаниями
#end
ObjInterface ObjDOfunsV6(ObjDOfunsV5);
//------------------------------------------------------------------------------
#doc
Получить значения количества дней от дат оплатить и отгрузить до по умолчанию
#end
Procedure GetOplAndOtgrDatesDef(wVidDoc : word; pOrg: comp; _dDoc: date; var dOpl, dOtgr: date);
end;
//------------------------------------------------------------------------------

//******************************************************************************

VipInterface DOfuns implements ObjDOfunsV6 licensed (FREE);

//******************************************************************************

#end // __DOfuns_vih__
