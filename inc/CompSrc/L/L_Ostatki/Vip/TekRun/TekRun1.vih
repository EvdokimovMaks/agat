//******************************************************************************
//                                                      (c) корпорация Галактика
// Галактика 8.1 - Общие функции
// Объект с функциями модификации текущих остатков (SP <> 0)
//******************************************************************************

// для использования необходимо
// 1) описать переменную fTekRun1 при помощи #include tekrun1.var
// 2) запускать методы объектного интерфейса через переменную: fTekRun1.ModifyDoRes(...

// Использование семафоров (функции WaitSemaphore, SwitchSemaphore) с параметром
// pMC = Comp(0) зарезервировано за счетами-фактурами (L_SF).

#ifNdef __TekRun1_VIH__
#define __TekRun1_VIH__

//******************************************************************************

#component "L_Ostatki"

#doc
Объект с функциями модификации текущих остатков (SP <> 0)
#end
ObjInterface ObjTekRun1;

//******************************************************************************
#doc
  Минимальное значение для количества МЦ
#end
Function  GetMinQuantity: double;

#doc
  Возвращает сумму резервов во всех dores-ах, ссылающихся на конкретный SpStep
#end
Function  GetSumDoRes(cSpStep: comp): double;

#doc
  Модификация текущих матценностей
#end
Function  ModifyTekMC( w_SP : Word;
                       c_MC : Comp;
                       KK : Double;
                       RR : Double
                     ) : Boolean;

#doc
  Модификация складских остатков (SP <> 0)
#end
Function  ModifySklOst( w_SP : Word;
                        c_MC : Comp;
                        c_Podr : Comp;
                        KK : Double;
                        RR : Double
                      ) : Boolean;

#doc
  Модификация текущих складских остатков (SP <> 0)
#end
Function  ModifySklOstAlways( w_SP : Word;
                              c_MC : Comp;
                              c_Podr : Comp;
                              KK : Double;
                              RR : Double
                            ) : Boolean;

#doc
  Модификация текущих остатков
#end
Function  ModifyTekSaldo( w_SP : Word;
                          c_MC,
                          c_Podr,
                          c_MOL,
                          c_Party : Comp;
                          KK,
                          RR : Double
                        ) : Boolean;

#doc
  Последовательно вызывает функии ModifyTekMC; ModifySklOst; ModifyTekSaldo,
  делая откат в случае неуспеха по любой из них
#end
Function  ModifyAllTek( w_SP : Word;
                        c_MC,
                        c_Podr,
                        c_MOL,
                        c_Party : Comp;
                        KK,
                        RR : Double
                      ) : Boolean;

#doc
  Модификация резрва по подразделениям
#end
Function  ModifyDoRes( c_SpStep,
                       c_Podr,
                       c_MOL,
                       c_Party : Comp;
                       RR : Double
                     ) : Boolean;

#doc
  Удаление резрва по подразделениям
#end
Function  DeleteDoRes(c_SpStep: Comp) : Boolean;

#doc
  Установка семафора
  Семафор устанавливается для исключения одновременного резервирования по одной и той же МЦ
#end
Function  SwitchSemaphore( bParam : Boolean;
                           pMC : Comp
                         ) : Boolean;

#doc
  Ожидание освобождения семафора
#end
Function  WaitSemaphore(pMC : Comp) : Boolean;

#doc
  Удаление резерва по предприятию
#end
Procedure DelDoResOnSpSopr( w_SP : Word;
                            pSpSopr : Comp
                          );

//******************************************************************************

end;

//******************************************************************************

VipInterface TekRun1 implements ObjTekRun1 licensed (FREE);

#end

//******************************************************************************
