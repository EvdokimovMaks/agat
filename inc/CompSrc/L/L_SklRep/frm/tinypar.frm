 Р! ╔═════════════════════════════════════════════════════════════════════════╗
! ║  Разработал:  Александр Крахотко                                        ║
! ║  Назначение:  печать движения в разрезе наименований                    ║
! ╚═════════════════════════════════════════════════════════════════════════╝
#INCLUDE tinypar.pro // форма прототип
#doc
Фактические цены (НДЕ и валюта отчетов)
#end
.linkform 'TinyPar_0011' prototype is 'TinyPar'
.NameInList 'Фактические цены (НДЕ и валюта отчетов)'
.group 'НДЕ и валюта отчетов'
.PAPER PA4
.ORIENT LANDSCAPE
.DEFO LANDSCAPE
.LL 80
.P 60
.fields
  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv
  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv
.endfields
.[H SKIP
   ИЛист@NP@
┌──────────────────────────────┬─────────────────────────────────────────────────┬────────────────────────────────────────────┬──────────────────────────────────────────────┬────────────────────────────────────────────────┐
│                              │                  ОСТАТОК НА НАЧАЛО              │                    ПРИХОД                  │                    РАСХОД                    │                ОСТАТОК НА КОНЕЦ                │
│                              ├──────┬───────────────────┬──────────────────────┼──────┬────────────────┬────────────────────┼──────┬────────────────┬──────────────────────┼──────┬──────────────────┬──────────────────────┤
│         Наименование         │      │        цена       │         сумма        │      │      цена      │        сумма       │      │      цена      │         сумма        │      │        цена      │         сумма        │
│                              │кол-во├──────────┬────────┼───────────┬──────────┤кол-во├────────┬───────┼──────────┬─────────┤кол-во├────────┬───────┼───────────┬──────────┤кол-во├─────────┬────────┼───────────┬──────────┤
│                              │      │   @@@@@@ │ @@@@@@ │    @@@@@@ │   @@@@@@ │      │ @@@@@@ │ @@@@@ │   @@@@@@ │  @@@@@@ │      │ @@@@@@ │ @@@@@ │   @@@@@@  │   @@@@@@ │      │  @@@@@@ │ @@@@@@ │   @@@@@@  │   @@@@@@ │
└──────────────────────────────┴──────┴──────────┴────────┴───────────┴──────────┴──────┴────────┴───────┴──────────┴─────────┴──────┴────────┴───────┴───────────┴──────────┴──────┴─────────┴────────┴───────────┴──────────┘
.]H
.function if01(_d:double):double;
begin
  if01 := if ( abs(_d) < GetPresision_forKol, 1, _d) ;
end.
.fields
  NDE_Simv VAL_Simv
  Kurs_Val

  дата_начальная
  дата_конечная

  sPodr sMOL sMC sParty sGrMC

  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv
  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv

  склад_имя
  мол_имя
  мц_имя
  мц_ном
  ед_учт_имя

  партия_имя



    pbk pbs/if01(pbk) pbs/if01(pbk)/Kurs_val pbs pbs/Kurs_val
    pak pas/if01(pak) pas/if01(pak)/Kurs_val pas pas/Kurs_val
    psk pss/if01(psk) pss/if01(psk)/Kurs_val pss pss/Kurs_val
    pek pes/if01(pek) pes/if01(pek)/Kurs_val pes pes/Kurs_val

    tbk tbs/if01(tbk) tbs/if01(tbk)/Kurs_val tbs tbs/Kurs_val
    tak tas/if01(tak) tas/if01(tak)/Kurs_val tas tas/Kurs_val
    tsk tss/if01(tsk) tss/if01(tsk)/Kurs_val tss tss/Kurs_val
    tek tes/if01(tek) tes/if01(tek)/Kurs_val tes tes/Kurs_val

    mbk mbs/if01(mbk) mbs/if01(mbk)/Kurs_val mbs mbs/Kurs_val
    mak mas/if01(mak) mas/if01(mak)/Kurs_val mas mas/Kurs_val
    msk mss/if01(msk) mss/if01(msk)/Kurs_val mss mss/Kurs_val
    mek mes/if01(mek) mes/if01(mek)/Kurs_val mes mes/Kurs_val

    sbk sbs/if01(sbk) sbs/if01(sbk)/Kurs_val sbs sbs/Kurs_val
    sak sas/if01(sak) sas/if01(sak)/Kurs_val sas sas/Kurs_val
    ssk sss/if01(ssk) sss/if01(ssk)/Kurs_val sss sss/Kurs_val
    sek ses/if01(sek) ses/if01(sek)/Kurs_val ses ses/Kurs_val

    ibk ibs/if01(ibk) ibs/if01(ibk)/Kurs_val ibs ibs/Kurs_val
    iak ias/if01(iak) ias/if01(iak)/Kurs_val ias ias/Kurs_val
    isk iss/if01(isk) iss/if01(isk)/Kurs_val iss iss/Kurs_val
    iek ies/if01(iek) ies/if01(iek)/Kurs_val ies ies/Kurs_val
.endfields
ОБОРОТНАЯ ВЕДОМОСТЬ ДВИЖЕНИЯ МЦ
  Ведомость сформирована
    в учетных единицах измерения
    в НДЕ, ^ и валюте отчетов, ^
    курс валюты : &&&&&&&.&&&&
          с ^ по ^

  Используемые фильтры :
  Склад     : ^
  МОЛ       : ^
  МЦ        : ^
  Партия    : ^
  Группа МЦ : ^

  Лист@NP@
┌──────────────────────────────┬─────────────────────────────────────────────────┬────────────────────────────────────────────┬──────────────────────────────────────────────┬────────────────────────────────────────────────┐
│                              │                  ОСТАТОК НА НАЧАЛО              │                    ПРИХОД                  │                    РАСХОД                    │                ОСТАТОК НА КОНЕЦ                │
│                              ├──────┬───────────────────┬──────────────────────┼──────┬────────────────┬────────────────────┼──────┬────────────────┬──────────────────────┼──────┬──────────────────┬──────────────────────┤
│         Наименование         │      │        цена       │         сумма        │      │      цена      │        сумма       │      │      цена      │         сумма        │      │        цена      │         сумма        │
│                              │кол-во├──────────┬────────┼───────────┬──────────┤кол-во├────────┬───────┼──────────┬─────────┤кол-во├────────┬───────┼───────────┬──────────┤кол-во├─────────┬────────┼───────────┬──────────┤
│                              │      │   @@@@@@ │ @@@@@@ │    @@@@@@ │   @@@@@@ │      │ @@@@@@ │ @@@@@ │   @@@@@@ │  @@@@@@ │      │ @@@@@@ │ @@@@@ │   @@@@@@  │   @@@@@@ │      │  @@@@@@ │ @@@@@@ │   @@@@@@  │   @@@@@@ │
└──────────────────────────────┴──────┴──────────┴────────┴───────────┴──────────┴──────┴────────┴───────┴──────────┴─────────┴──────┴────────┴───────┴───────────┴──────────┴──────┴─────────┴────────┴───────────┴──────────┘
.{ CheckEnter TinyParPodr
СКЛАД ^
.{ CheckEnter TinyParMol
 МОЛ ^
.{ CheckEnter TinyParMC
  МЦ ^, НОМ.НОМЕР ^, ЕДИНИЦА ИЗМЕРЕНИЯ ^
.{ CheckEnter TinyParParty
   @@@@@@@@@@@@@@@@@@@@@@@@@@@ &&&&&& &&&&&&&.&& &&&&&.&& &&&&&&&&.&& &&&&&&&.&& &&&&&&& &&&&&.&& &&&&.&& &&&&&&&.&& &&&&&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&&&.&& &&&&&&&.&& &&&&&& &&&&&&.&& &&&&&.&& &&&&&&&&.&& &&&&&&&.&&
.} //checkEnter TinyParParty
  ИТОГО ПО МЦ                  &&&&&& &&&&&&&.&& &&&&&.&& &&&&&&&&.&& &&&&&&&.&& &&&&&&& &&&&&.&& &&&&.&& &&&&&&&.&& &&&&&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&&&.&& &&&&&&&.&& &&&&&& &&&&&&.&& &&&&&.&& &&&&&&&&.&& &&&&&&&.&&
.} //checkEnter TinyParMC
 ИТОГО ПО МОЛ                  &&&&&& &&&&&&&.&& &&&&&.&& &&&&&&&&.&& &&&&&&&.&& &&&&&&& &&&&&.&& &&&&.&& &&&&&&&.&& &&&&&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&&&.&& &&&&&&&.&& &&&&&& &&&&&&.&& &&&&&.&& &&&&&&&&.&& &&&&&&&.&&
.} //checkEnter TinyParMol
ИТОГО ПО СКЛАДУ                &&&&&& &&&&&&&.&& &&&&&.&& &&&&&&&&.&& &&&&&&&.&& &&&&&&& &&&&&.&& &&&&.&& &&&&&&&.&& &&&&&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&&&.&& &&&&&&&.&& &&&&&& &&&&&&.&& &&&&&.&& &&&&&&&&.&& &&&&&&&.&&

.} //checkEnter TinyParPodr
 .............................................................................................................................................................................................................................
ИТОГО ПО ВЕДОМОСТИ             &&&&&& &&&&&&&.&& &&&&&.&& &&&&&&&&.&& &&&&&&&.&& &&&&&&& &&&&&.&& &&&&.&& &&&&&&&.&& &&&&&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&&&.&& &&&&&&&.&& &&&&&& &&&&&&.&& &&&&&.&& &&&&&&&&.&& &&&&&&&.&&

.endform Ш


 Р#doc
Учетные и фактические цены(НДЕ и валюта отчетов)
#end
.linkform 'TinyPar_0021' prototype is 'TinyPar'
.NameInList 'Учетные и фактические цены(НДЕ и валюта отчетов)'
.group 'НДЕ и валюта отчетов'
.PAPER PA4
.ORIENT LANDSCAPE
.DEFO LANDSCAPE
.LL 80
.P 60
.Create view TiPar1
  var
    curPrice,
    curParty,
    curMC    : comp;
  from
    Prices (ReadOnly)
  where
    ((
      curPrice == Prices.cKlPrice  and
      curParty == Prices.cParty    and
      curMC    == Prices.cThing
    ))
;
.fields
  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv NDE_Simv VAL_Simv
  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv NDE_Simv VAL_Simv
.endfields
.[H SKIP
  Лист@NP@ Р
 Ш───────────────────────────┬───────────────────────────────────────────────────────────────────────┬────────────────────────────────────────┬──────────────────────────────────────────┬────────────────────────────────────────
                           │                          ОСТАТОК НА НАЧАЛО                            │                   ПРИХОД               │                     РАСХОД               │               ОСТАТОК НА КОНЕЦ
                           ├────────────────────────────┬──────┬───────────────────────────────────┼──────┬─────────────────────────────────┼──────┬───────────────────────────────────┼──────┬─────────────────────────────────
                           │            цена            │      │             стоимость             │      │           стоимость             │      │              стоимость            │      │           стоимость
         Наименование      ├─────────────┬──────────────┤      ├─────────────────┬─────────────────┤      ├───────────────┬─────────────────┤      ├─────────────────┬─────────────────┤      ├───────────────┬─────────────────
                           │по прайс-лист│  фактическая │кол-во│   по прайс-листу│    фактическая  │кол-во│ по прайс-листу│   фактическая   │кол-во│  по прайс-листу │    фактическая  │кол-во│ по прайс-листу│    фактическая
                           ├──────┬──────┼───────┬──────┤      ├─────────┬───────┼─────────┬───────┤      ├────────┬──────┼────────┬────────┤      ├─────────┬───────┼─────────┬───────┤      ├────────┬──────┼─────────┬───────
                           │@@@@@@│@@@@@@│@@@@@@@│@@@@@@│      │ @@@@@@@ │ @@@@@ │ @@@@@@@ │ @@@@@ │      │ @@@@@@@│ @@@@@│ @@@@@@ │ @@@@@@@│      │ @@@@@@@ │ @@@@@@│ @@@@@@@ │ @@@@@@│      │ @@@@@@@│ @@@@@│ @@@@@@@ │ @@@@@@
───────────────────────────┴──────┴──────┴───────┴──────┴──────┴─────────┴───────┴─────────┴───────┴──────┴────────┴──────┴────────┴────────┴──────┴─────────┴───────┴─────────┴───────┴──────┴────────┴──────┴─────────┴─────── Ш
 Ш.]H
.function if01(_d:double):double;
begin
  if01 := if ( abs(_d) < GetPresision_forKol, 1, _d) ;
end.
.var
  pprice : double

  pppb, pppa, ppps,
  tppb, tppa, tpps,
  mppb, mppa, mpps,
  sppb, sppa, spps,
  ippb, ippa, ipps  : double

  prListVal: string

.endvar

.fields
  NDE_Simv VAL_Simv
  Kurs_val

  дата_начальная
  дата_конечная

  sPodr sMOL sMC sParty sGrMC
  prListVal

  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv NDE_Simv VAL_Simv
  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv  NDE_Simv VAL_Simv NDE_Simv VAL_Simv

  склад_имя

  мол_имя

  мц_имя
  мц_ном
  ед_учт_имя

  партия_имя

    pprice  pprice/Kurs_val      pbs/if01(pbk)  pbs/if01(pbk)/Kurs_val

    pbk   pppb            pppb/Kurs_val             pbs  pbs/Kurs_val
    pak   pppa            pppa/Kurs_val             pas  pas/Kurs_val
    psk   ppps            ppps/Kurs_val             pss  pss/Kurs_val
    pek   pppb+pppa-ppps  pppb+pppa-ppps/Kurs_val   pes  pes/Kurs_val

    tbk   tppb            tppb/Kurs_val             tbs  tbs/Kurs_val
    tak   tppa            tppa/Kurs_val             tas  tas/Kurs_val
    tsk   tpps            tpps/Kurs_val             tss  tss/Kurs_val
    tek   tppb+tppa-tpps  tppb+tppa-tpps/Kurs_val   tes  tes/Kurs_val

    mbk   mppb            mppb/Kurs_val             mbs  mbs/Kurs_val
    mak   mppa            mppa/Kurs_val             mas  mas/Kurs_val
    msk   mpps            mpps/Kurs_val             mss  mss/Kurs_val
    mek   mppb+mppa-mpps  mppb+mppa-mpps/Kurs_val   mes  mes/Kurs_val

    sbk   sppb            sppb/Kurs_val             sbs  sbs/Kurs_val
    sak   sppa            sppa/Kurs_val             sas  sas/Kurs_val
    ssk   spps            spps/Kurs_val             sss  sss/Kurs_val
    sek   sppb+sppa-spps  sppb+sppa-spps/Kurs_val   ses  ses/Kurs_val

    ibk   ippb            ippb/Kurs_val             ibs  ibs/Kurs_val
    iak   ippa            ippa/Kurs_val             ias  ias/Kurs_val
    isk   ipps            ipps/Kurs_val             iss  iss/Kurs_val
    iek   ippb+ippa-ipps  ippb+ippa-ipps/Kurs_val   ies  ies/Kurs_val
.endfields
.begin
  tiPar1.curPrice := 0 ;
  RunInterface ('GetKlPr3',tiPar1.curPrice) ;
  if (tiPar1.curPrice = 0 )
    Message(''#3'Не выбран ни один прайс лист !!!'#13#3+
            'Учетные цены будут нулевыми...',0);

  prListVal:='';
  if GetFirst KlPrice where ((tiPar1.curPrice == KlPrice.nRec)) =0
    if GetFirst KlVal where ((KlPrice.cVal == KlVal.nRec)) =0
      prListVal:= 'Цены из прайс-листа - в '+KlVal.dollarah+'. Цены приведены в соответствие с Уч.ЕдИзм МЦ';
    else
      prListVal:= 'Цены из прайс-листа приведены в соответствие с Уч.ЕдИзм МЦ';

 end.
 ОБОРОТНАЯ ВЕДОМОСТЬ ДВИЖЕНИЯ МЦ

  Ведомость сформирована
    в учетных единицах измерения
    в НДЕ, ^ и валюте отчетов, ^
    курс валюты : &&&&&&&.&&&&
          с ^ по ^

  Используемые фильтры :
  Склад     : ^
  МОЛ       : ^
  МЦ        : ^
  Партия    : ^
  Группа МЦ : ^

  Лист@NP@
  ^ Ш
 Ш───────────────────────────┬───────────────────────────────────────────────────────────────────────┬────────────────────────────────────────┬──────────────────────────────────────────┬────────────────────────────────────────
                           │                          ОСТАТОК НА НАЧАЛО                            │                   ПРИХОД               │                     РАСХОД               │               ОСТАТОК НА КОНЕЦ
                           ├────────────────────────────┬──────┬───────────────────────────────────┼──────┬─────────────────────────────────┼──────┬───────────────────────────────────┼──────┬─────────────────────────────────
                           │            цена            │      │             стоимость             │      │           стоимость             │      │              стоимость            │      │           стоимость
         Наименование      ├─────────────┬──────────────┤      ├─────────────────┬─────────────────┤      ├───────────────┬─────────────────┤      ├─────────────────┬─────────────────┤      ├───────────────┬─────────────────
                           │по прайс-лист│  фактическая │кол-во│   по прайс-листу│    фактическая  │кол-во│ по прайс-листу│   фактическая   │кол-во│  по прайс-листу │    фактическая  │кол-во│ по прайс-листу│    фактическая
                           ├──────┬──────┼───────┬──────┤      ├─────────┬───────┼─────────┬───────┤      ├────────┬──────┼────────┬────────┤      ├─────────┬───────┼─────────┬───────┤      ├────────┬──────┼─────────┬───────
                           │@@@@@@│@@@@@@│@@@@@@@│@@@@@@│      │ @@@@@@@ │ @@@@@ │ @@@@@@@ │ @@@@@ │      │ @@@@@@@│ @@@@@│ @@@@@@ │ @@@@@@@│      │ @@@@@@@ │ @@@@@@│ @@@@@@@ │ @@@@@@│      │ @@@@@@@│ @@@@@│ @@@@@@@ │ @@@@@@
───────────────────────────┴──────┴──────┴───────┴──────┴──────┴─────────┴───────┴─────────┴───────┴──────┴────────┴──────┴────────┴────────┴──────┴─────────┴───────┴─────────┴───────┴──────┴────────┴──────┴─────────┴─────── Ш
 Ш
.begin
  ippb := 0 ;
  ippa := 0 ;
  ipps := 0 ;
 end.
.{ CheckEnter TinyParPodr
.begin
  sppb := 0 ;
  sppa := 0 ;
  spps := 0 ;
 end.
СКЛАД ^
.{ CheckEnter TinyParMol
.begin
  mppb := 0 ;
  mppa := 0 ;
  mpps := 0 ;
 end.
 МОЛ ^
.{ CheckEnter TinyParMC
.begin

  tppb := 0 ;
  tppa := 0 ;
  tpps := 0 ;
 end.
  МЦ ^, НОМ.НОМЕР ^, ЕДИНИЦА ИЗМЕРЕНИЯ ^
.{ CheckEnter TinyParParty
.begin
  tiPar1.curMC    := мц_рек ;
  tiPar1.curParty := партия_рек ;
  pprice := 0;
  if tiPar1.GetFirst Prices = 0
   { if TiPar1.Prices.cVal =0
       pprice:= TiPar1.Prices.Price
     else
       pprice:= TiPar1.Prices.sumVal;

     if GetFirst KatOtpEd where ((TiPar1.Prices.cOtpEd == KatOtpEd.nRec)) = 0
       pprice:= pprice / KatOtpEd.koef;

   }

  pppb := if01(pbk)*pprice ;
  pppa := if01(pak)*pprice ;
  ppps := if01(psk)*pprice ;

  tppb := tppb + pppb ;
  tppa := tppa + pppa ;
  tpps := tpps + ppps ;

  mppb := mppb + pppb ;
  mppa := mppa + pppa ;
  mpps := mpps + ppps ;

  sppb := sppb + pppb ;
  sppa := sppa + pppa ;
  spps := spps + ppps ;

  ippb := ippb + pppb ;
  ippa := ippa + pppa ;
  ipps := ipps + ppps ;
 end.
 @@@@@@@@@@@@@@@@@@@@@@@@@ &&&&.&& &&&.&& &&&&.&& &&&.&& &&&&&& &&&&&&.&& &&&&.&& &&&&&&.&& &&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&.&& &&&&.&& &&&&&& &&&&&&.&& &&&&.&& &&&&&&.&& &&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&&.&& &&&&.&&
.} // CheckEnter TinyParParty
  ИТОГО ПО МЦ                                            &&&&&& &&&&&&.&& &&&&.&& &&&&&&.&& &&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&.&& &&&&.&& &&&&&& &&&&&&.&& &&&&.&& &&&&&&.&& &&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&&.&& &&&&.&&
.} // CheckEnter TinyParMC
 ИТОГО ПО МОЛ                                            &&&&&& &&&&&&.&& &&&&.&& &&&&&&.&& &&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&.&& &&&&.&& &&&&&& &&&&&&.&& &&&&.&& &&&&&&.&& &&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&&.&& &&&&.&&
.} // CheckEnter TinyParMol
ИТОГО ПО СКЛАДУ                                          &&&&&& &&&&&&.&& &&&&.&& &&&&&&.&& &&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&.&& &&&&.&& &&&&&& &&&&&&.&& &&&&.&& &&&&&&.&& &&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&&.&& &&&&.&&

.} // CheckEnter TinyParPodr
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
ИТОГО ПО ВЕДОМОСТИ                                       &&&&&& &&&&&&.&& &&&&.&& &&&&&&.&& &&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&.&& &&&&.&& &&&&&& &&&&&&.&& &&&&.&& &&&&&&.&& &&&&.&& &&&&&& &&&&&.&& &&&&.&& &&&&&&.&& &&&&.&&

.endform Р

#doc
Фактические цены (НДЕ))
#end
.linkform 'TinyPar_0012' prototype is 'TinyPar'
.NameInList 'Фактические цены (НДЕ)'
.group 'НДЕ'
.PAPER PA4
.ORIENT LANDSCAPE
.DEFO LANDSCAPE
.LL 80
.P 60
.fields
  NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv
.endfields
.[H SKIP
 И  Лист@NP@
 Р┌────────────────────────────────┬──────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┬───────────────────────────────────────┐
│                                │            ОСТАТОК НА НАЧАЛО         │               ПРИХОД                │                 РАСХОД              │             ОСТАОК НА КОНЕЦ           │
│         Наименование           ├───────┬─────────────┬────────────────┼───────┬─────────────┬───────────────┼───────┬─────────────┬───────────────┼───────┬──────────────┬────────────────┤
│                                │кол-во │цена, @@@@@@ │сумма, @@@@@@@@ │кол-во │цена, @@@@@@ │сумма, @@@@@@@@│кол-во │цена, @@@@@@ │сумма, @@@@@@@@│кол-во │цена, @@@@@@  │сумма, @@@@@@@@ │
└────────────────────────────────┴───────┴─────────────┴────────────────┴───────┴─────────────┴───────────────┴───────┴─────────────┴───────────────┴───────┴──────────────┴────────────────┘ Р
.]H Ш
.function if01(_d:double):double;
begin
  if01 := if ( abs(_d) < GetPresision_forKol, 1, _d) ;
end.
.fields
  NDE_Simv

  дата_начальная
  дата_конечная

  sPodr sMOL sMC sParty sGrMC

  NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv

  склад_имя
  мол_имя
  мц_имя
  мц_ном
  ед_учт_имя

  партия_имя

    pbk pbs/if01(pbk) pbs
    pak pas/if01(pak) pas
    psk pss/if01(psk) pss
    pek pes/if01(pek) pes

    tbk tbs/if01(tbk) tbs
    tak tas/if01(tak) tas
    tsk tss/if01(tsk) tss
    tek tes/if01(tek) tes

    mbk mbs/if01(mbk) mbs
    mak mas/if01(mak) mas
    msk mss/if01(msk) mss
    mek mes/if01(mek) mes

    sbk sbs/if01(sbk) sbs
    sak sas/if01(sak) sas
    ssk sss/if01(ssk) sss
    sek ses/if01(sek) ses

    ibk ibs/if01(ibk) ibs
    iak ias/if01(iak) ias
    isk iss/if01(isk) iss
    iek ies/if01(iek) ies
.endfields

 И  ОБОРОТНАЯ ВЕДОМОСТЬ ДВИЖЕНИЯ МЦ

  Ведомость сформирована
    в учетных единицах измерения
    в НДЕ, ^
          с ^ по ^

  Используемые фильтры :
  Склад     : ^
  МОЛ       : ^
  МЦ        : ^
  Партия    : ^
  Группа МЦ : ^

  Лист@NP@ Р
 Р┌────────────────────────────────┬──────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┬───────────────────────────────────────┐
│                                │            ОСТАТОК НА НАЧАЛО         │               ПРИХОД                │                 РАСХОД              │             ОСТАОК НА КОНЕЦ           │
│         Наименование           ├───────┬─────────────┬────────────────┼───────┬─────────────┬───────────────┼───────┬─────────────┬───────────────┼───────┬──────────────┬────────────────┤
│                                │кол-во │цена, @@@@@@ │сумма, @@@@@@   │кол-во │цена, @@@@@@ │сумма, @@@@@@  │кол-во │цена, @@@@@@ │сумма, @@@@@@  │кол-во │цена, @@@@@@  │сумма, @@@@@@   │
└────────────────────────────────┴───────┴─────────────┴────────────────┴───────┴─────────────┴───────────────┴───────┴─────────────┴───────────────┴───────┴──────────────┴────────────────┘ Р
 Ш.{ checkenter tinyparpodr
СКЛАД ^
.{ CheckEnter TinyParMol
 МОЛ ^
.{ CheckEnter TinyParMC
  МЦ ^, НОМ.НОМЕР ^, ЕДИНИЦА ИЗМЕРЕНИЯ ^
.{ CheckEnter TinyParParty
  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &&&&&&&&  &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&&.&& &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&.&& &&&&&&&& &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&.&& &&&&&&&&  &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&&&.&&
.} //CHECKENTER TINYPARPARTY
  ИТОГО ПО МЦ                           &&&&&&&&  &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&&.&& &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&.&& &&&&&&&& &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&.&& &&&&&&&&  &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&&&.&&
.} //checkEnter TinyParMC
 ИТОГО ПО МОЛ                           &&&&&&&&  &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&&.&& &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&.&& &&&&&&&& &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&.&& &&&&&&&&  &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&&&.&&
.} //checkEnter TinyParMol
ИТОГО ПО СКЛАДУ                         &&&&&&&&  &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&&.&& &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&.&& &&&&&&&& &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&.&& &&&&&&&&  &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&&&.&&

.} //checkEnter TinyParPodr
 ...............................................................................................................................................................................................................................
ИТОГО ПО ВЕДОМОСТИ                      &&&&&&&&  &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&&.&& &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&.&& &&&&&&&& &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&.&& &&&&&&&&  &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&&&.&&

.endform Ш
 И
 Ш#doc
Учетные и фактические цены (НДЕ)
#end
.linkform 'TinyPar_0022' prototype is 'TinyPar'
.NameInList 'Учетные и фактические цены (НДЕ)'
.group 'НДЕ'
.PAPER PA4
.ORIENT LANDSCAPE
.DEFO LANDSCAPE
.LL 80
.P 60
.Create view TiPar1
  var
    curPrice,
    curParty,
    curMC    : comp;
  from
    Prices (ReadOnly)
  where
    ((
      curPrice == Prices.cKlPrice  and
      curParty == Prices.cParty    and
      curMC    == Prices.cThing
    ))
;
.fields
  NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv
.endfields
 И.[H SKIP
  Лист@NP@
┌─────────────────────────────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┐
│                             │                         ОСТАТОК НА НАЧАЛО                           │                   ПРИХОД            │                   РАСХОД            │              ОСТАТОК НА КОНЕЦ       │
│                             ├──────────────────────────────┬──────┬───────────────────────────────┼──────┬──────────────────────────────┼──────┬──────────────────────────────┼──────┬──────────────────────────────┤
│                             │             цена             │      │           cтоимость           │      │           стоимость          │      │           стоимость          │      │           стоимость          │
│       Наименование          ├───────────────┬──────────────┤      ├───────────────┬───────────────┤      ├───────────────┬──────────────┤      ├───────────────┬──────────────┤      ├───────────────┬──────────────┤
│                             │по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая,  │кол-во│по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая, │
│                             │     @@@@@@    │    @@@@@@    │      │     @@@@@@    │    @@@@@@     │      │     @@@@@@    │    @@@@@@    │      │    @@@@@@     │    @@@@@@    │      │     @@@@@@    │    @@@@@@    │
└─────────────────────────────┴───────────────┴──────────────┴──────┴───────────────┴───────────────┴──────┴───────────────┴──────────────┴──────┴───────────────┴──────────────┴──────┴───────────────┴──────────────┘
.]H
.function if01(_d:double):double;
begin
  if01 := if ( abs(_d) < GetPresision_forKol, 1, _d) ;
end.
.var
  pprice : double

  pppb, pppa, ppps,
  tppb, tppa, tpps,
  mppb, mppa, mpps,
  sppb, sppa, spps,
  ippb, ippa, ipps  : double

  prListVal: string

.endvar

.fields
  NDE_Simv
  дата_начальная
  дата_конечная

  sPodr sMOL sMC sParty sGrMC
  prListVal

  NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv NDE_Simv

  склад_имя

  мол_имя

  мц_имя
  мц_ном
  ед_учт_имя

  партия_имя

    pprice        pbs/if01(pbk)

    pbk   pppb            pbs
    pak   pppa            pas
    psk   ppps            pss
    pek   pppb+pppa-ppps  pes

    tbk   tppb            tbs
    tak   tppa            tas
    tsk   tpps            tss
    tek   tppb+tppa-tpps  tes

    mbk   mppb            mbs
    mak   mppa            mas
    msk   mpps            mss
    mek   mppb+mppa-mpps  mes

    sbk   sppb            sbs
    sak   sppa            sas
    ssk   spps            sss
    sek   sppb+sppa-spps  ses

    ibk   ippb            ibs
    iak   ippa            ias
    isk   ipps            iss
    iek   ippb+ippa-ipps  ies
.endfields
.begin
  tiPar1.curPrice := 0 ;
  RunInterface ('GetKlPr3',tiPar1.curPrice) ;
  if (tiPar1.curPrice = 0 )
    Message(''#3'Не выбран ни один прайс лист !!!'#13#3+
            'Учетные цены будут нулевыми...',0);

  prListVal:='';
  if GetFirst KlPrice where ((tiPar1.curPrice == KlPrice.nRec)) =0
    if GetFirst KlVal where ((KlPrice.cVal == KlVal.nRec)) =0
      prListVal:= 'Цены из прайс-листа - в '+KlVal.dollarah+'. Цены приведены в соответствие с Уч.ЕдИзм МЦ';
    else
      prListVal:= 'Цены из прайс-листа приведены в соответствие с Уч.ЕдИзм МЦ';

 end.
 ОБОРОТНАЯ ВЕДОМОСТЬ ДВИЖЕНИЯ МЦ

  Ведомость сформирована
    в учетных единицах измерения
    в НДЕ, ^
          с ^ по ^

  Используемые фильтры :
  Склад     : ^
  МОЛ       : ^
  МЦ        : ^
  Партия    : ^
  Группа МЦ : ^

  Лист@NP@
  ^
┌─────────────────────────────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┐
│                             │                         ОСТАТОК НА НАЧАЛО                           │                   ПРИХОД            │                   РАСХОД            │              ОСТАТОК НА КОНЕЦ       │
│                             ├──────────────────────────────┬──────┬───────────────────────────────┼──────┬──────────────────────────────┼──────┬──────────────────────────────┼──────┬──────────────────────────────┤
│       Наименование          │             цена             │      │           cтоимость           │      │           стоимость          │      │           стоимость          │      │           стоимость          │
│                             ├───────────────┬──────────────┤      ├───────────────┬───────────────┤      ├───────────────┬──────────────┤      ├───────────────┬──────────────┤      ├───────────────┬──────────────┤
│                             │по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая,  │кол-во│по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая, │
│                             │     @@@@@@    │    @@@@@@    │      │     @@@@@@    │    @@@@@@     │      │     @@@@@@    │    @@@@@@    │      │    @@@@@@     │    @@@@@@    │      │     @@@@@@    │    @@@@@@    │
└─────────────────────────────┴───────────────┴──────────────┴──────┴───────────────┴───────────────┴──────┴───────────────┴──────────────┴──────┴───────────────┴──────────────┴──────┴───────────────┴──────────────┘
.begin
  ippb := 0 ;
  ippa := 0 ;
  ipps := 0 ;
 end.
.{ CheckEnter TinyParPodr
.begin
  sppb := 0 ;
  sppa := 0 ;
  spps := 0 ;
 end.
СКЛАД ^
.{ CheckEnter TinyParMol
.begin
  mppb := 0 ;
  mppa := 0 ;
  mpps := 0 ;
 end.
 МОЛ ^
.{ CheckEnter TinyParMC
.begin

  tppb := 0 ;
  tppa := 0 ;
  tpps := 0 ;
 end.
  МЦ ^, НОМ.НОМЕР ^, ЕДИНИЦА ИЗМЕРЕНИЯ ^
.{ CheckEnter TinyParParty
.begin
  tiPar1.curMC    := мц_рек ;
  tiPar1.curParty := партия_рек ;
  pprice := 0;
  if tiPar1.GetFirst Prices = 0
   { if TiPar1.Prices.cVal =0
       pprice:= TiPar1.Prices.Price
     else
       pprice:= TiPar1.Prices.sumVal;

     if GetFirst KatOtpEd where ((TiPar1.Prices.cOtpEd == KatOtpEd.nRec)) = 0
       pprice:= pprice / KatOtpEd.koef;

   }

  pppb := if01(pbk)*pprice ;
  pppa := if01(pak)*pprice ;
  ppps := if01(psk)*pprice ;

  tppb := tppb + pppb ;
  tppa := tppa + pppa ;
  tpps := tpps + ppps ;

  mppb := mppb + pppb ;
  mppa := mppa + pppa ;
  mpps := mpps + ppps ;

  sppb := sppb + pppb ;
  sppa := sppa + pppa ;
  spps := spps + ppps ;

  ippb := ippb + pppb ;
  ippa := ippa + pppa ;
  ipps := ipps + ppps ;
 end.
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&&
.} // CheckEnter TinyParParty
  ИТОГО ПО МЦ                                                 &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&&
.} // CheckEnter TinyParMC
 ИТОГО ПО МОЛ                                                 &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&&
.} // CheckEnter TinyParMol
ИТОГО ПО СКЛАДУ                                               &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&&

.} // CheckEnter TinyParPodr
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
ИТОГО ПО ВЕДОМОСТИ                                         &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&&
.endform Ш

 Р#doc
Фактические цены (Валюта отчетов)
#end
.linkform 'TinyPar_0013' prototype is 'TinyPar'
.NameInList 'Фактические цены (Валюта отчетов)'
.group 'Валюта отчетов'
.PAPER PA4
.ORIENT LANDSCAPE
.DEFO LANDSCAPE
.LL 80
.P 60
.fields
  VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv
.endfields
.[H SKIP
  Лист@NP@
┌────────────────────────────────┬──────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┬───────────────────────────────────────┐
│                                │            ОСТАТОК НА НАЧАЛО         │               ПРИХОД                │                 РАСХОД              │            ОСТАТОК НА КОНЕЦ           │
│         Наименование           ├───────┬─────────────┬────────────────┼───────┬─────────────┬───────────────┼───────┬─────────────┬───────────────┼───────┬──────────────┬────────────────┤
│                                │кол-во │цена, @@@@@@ │сумма, @@@@@@   │кол-во │цена, @@@@@@ │сумма, @@@@@@  │кол-во │цена, @@@@@@ │сумма, @@@@@@  │кол-во │цена, @@@@@@  │сумма, @@@@@@   │
└────────────────────────────────┴───────┴─────────────┴────────────────┴───────┴─────────────┴───────────────┴───────┴─────────────┴───────────────┴───────┴──────────────┴────────────────┘
.]H
.function if01(_d:double):double;
begin
  if01 := if ( abs(_d) < GetPresision_forKol, 1, _d) ;
end.
.fields
  VAL_Simv
  Kurs_Val

  дата_начальная
  дата_конечная

  sPodr sMOL sMC sParty sGrMC

  VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv

  склад_имя
  мол_имя
  мц_имя
  мц_ном
  ед_учт_имя

  партия_имя

    pbk pbs/if01(pbk)/Kurs_val pbs/Kurs_val
    pak pas/if01(pak)/Kurs_val pas/Kurs_val
    psk pss/if01(psk)/Kurs_val pss/Kurs_val
    pek pes/if01(pek)/Kurs_val pes/Kurs_val

    tbk tbs/if01(tbk)/Kurs_val tbs/Kurs_val
    tak tas/if01(tak)/Kurs_val tas/Kurs_val
    tsk tss/if01(tsk)/Kurs_val tss/Kurs_val
    tek tes/if01(tek)/Kurs_val tes/Kurs_val

    mbk mbs/if01(mbk)/Kurs_val mbs/Kurs_val
    mak mas/if01(mak)/Kurs_val mas/Kurs_val
    msk mss/if01(msk)/Kurs_val mss/Kurs_val
    mek mes/if01(mek)/Kurs_val mes/Kurs_val

    sbk sbs/if01(sbk)/Kurs_val sbs/Kurs_val
    sak sas/if01(sak)/Kurs_val sas/Kurs_val
    ssk sss/if01(ssk)/Kurs_val sss/Kurs_val
    sek ses/if01(sek)/Kurs_val ses/Kurs_val

    ibk ibs/if01(ibk)/Kurs_val ibs/Kurs_val
    iak ias/if01(iak)/Kurs_val ias/Kurs_val
    isk iss/if01(isk)/Kurs_val iss/Kurs_val
    iek ies/if01(iek)/Kurs_val ies/Kurs_val
.endfields

  ОБОРОТНАЯ ВЕДОМОСТЬ ДВИЖЕНИЯ МЦ

  Ведомость сформирована
    в учетных единицах измерения
    в валюте отчетов, ^
    курс валюты : &&&&&&&.&&&&
          с ^ по ^

  Используемые фильтры :
  Склад     : ^
  МОЛ       : ^
  МЦ        : ^
  Партия    : ^
  Группа МЦ : ^

  Лист@NP@
┌────────────────────────────────┬──────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┬───────────────────────────────────────┐
│                                │            ОСТАТОК НА НАЧАЛО         │               ПРИХОД                │                 РАСХОД              │            ОСТАТОК НА КОНЕЦ           │
│         Наименование           ├───────┬─────────────┬────────────────┼───────┬─────────────┬───────────────┼───────┬─────────────┬───────────────┼───────┬──────────────┬────────────────┤
│                                │кол-во │цена, @@@@@@ │сумма, @@@@@@   │кол-во │цена, @@@@@@ │сумма, @@@@@@  │кол-во │цена, @@@@@@ │сумма, @@@@@@  │кол-во │цена, @@@@@@  │сумма, @@@@@@   │
└────────────────────────────────┴───────┴─────────────┴────────────────┴───────┴─────────────┴───────────────┴───────┴─────────────┴───────────────┴───────┴──────────────┴────────────────┘
 И.{ checkenter tinyparpodr
СКЛАД ^
.{ CheckEnter TinyParMol
 МОЛ ^
.{ CheckEnter TinyParMC
  МЦ ^, НОМ.НОМЕР ^, ЕДИНИЦА ИЗМЕРЕНИЯ ^
.{ CheckEnter TinyParParty
  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &&&&&&&&  &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&&.&& &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&.&& &&&&&&&& &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&.&& &&&&&&&&  &&&&&&&&&&&&.&&  &&&&&&&&&&&&&&&.&&
.} //CHECKENTER TINYPARPARTY
  ИТОГО ПО МЦ                           &&&&&&&&  &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&&.&& &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&.&& &&&&&&&& &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&.&& &&&&&&&&  &&&&&&&&&&&&.&&  &&&&&&&&&&&&&&&.&&
.} //checkEnter TinyParMC
 ИТОГО ПО МОЛ                           &&&&&&&&  &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&&.&& &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&.&& &&&&&&&& &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&.&& &&&&&&&&  &&&&&&&&&&&&.&&  &&&&&&&&&&&&&&&.&&
.} //checkEnter TinyParMol
ИТОГО ПО СКЛАДУ                         &&&&&&&&  &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&&.&& &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&.&& &&&&&&&& &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&.&& &&&&&&&&  &&&&&&&&&&&&.&&  &&&&&&&&&&&&&&&.&&

.} //checkEnter TinyParPodr
 ............................................................................................................................................................................................................................
ИТОГО ПО ВЕДОМОСТИ                      &&&&&&&&  &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&&.&& &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&&&&.&& &&&&&&&& &&&&&&&&&&&&&.&&  &&&&&&&&&&&&&&.&& &&&&&&&&  &&&&&&&&&&&&.&&  &&&&&&&&&&&&&&&.&&
.endform
 Р
 Р#doc
Оборотная ведомость движения (уч.ед. и НДЕ)
#end
.linkform 'TinyPar_0023' prototype is 'TinyPar'
.NameInList 'Учетные и фактические цены (Валюта отчетов)'
.group 'Валюта отчетов'
.PAPER PA4
.ORIENT LANDSCAPE
.DEFO LANDSCAPE
.LL 80
.P 60
.Create view TiPar1
  var
    curPrice,
    curParty,
    curMC    : comp;
  from
    Prices (ReadOnly)
  where
    ((
      curPrice == Prices.cKlPrice  and
      curParty == Prices.cParty    and
      curMC    == Prices.cThing
    ))
;
.fields
  VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv
.endfields
.[H SKIP
  Лист@NP@
┌─────────────────────────────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┐
│                             │                         ОСТАТОК НА НАЧАЛО                           │                   ПРИХОД            │                   РАСХОД            │              ОСТАТОК НА КОНЕЦ       │
│                             ├──────────────────────────────┬──────┬───────────────────────────────┼──────┬──────────────────────────────┼──────┬──────────────────────────────┼──────┬──────────────────────────────┤
│       Наименование          │             цена             │      │           cтоимость           │      │           стоимость          │      │           стоимость          │      │           стоимость          │
│                             ├───────────────┬──────────────┤      ├───────────────┬───────────────┤      ├───────────────┬──────────────┤      ├───────────────┬──────────────┤      ├───────────────┬──────────────┤
│                             │по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая,  │кол-во│по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая, │
│                             │     @@@@@@    │    @@@@@@    │      │     @@@@@@    │    @@@@@@     │      │     @@@@@@    │    @@@@@@    │      │    @@@@@@     │    @@@@@@    │      │     @@@@@@    │    @@@@@@    │
└─────────────────────────────┴───────────────┴──────────────┴──────┴───────────────┴───────────────┴──────┴───────────────┴──────────────┴──────┴───────────────┴──────────────┴──────┴───────────────┴──────────────┘
.]H
.function if01(_d:double):double;
begin
  if01 := if ( abs(_d) < GetPresision_forKol, 1, _d) ;
end.
.var
  pprice : double

  pppb, pppa, ppps,
  tppb, tppa, tpps,
  mppb, mppa, mpps,
  sppb, sppa, spps,
  ippb, ippa, ipps  : double

  prListVal: string

.endvar

.fields
  VAL_Simv
  Kurs_val

  дата_начальная
  дата_конечная

  sPodr sMOL sMC sParty sGrMC
  prListVal

  VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv VAL_Simv

  склад_имя

  мол_имя

  мц_имя
  мц_ном
  ед_учт_имя

  партия_имя

    pprice/Kurs_val  pbs/if01(pbk)/Kurs_val

    pbk   pppb/Kurs_val            pbs/Kurs_val
    pak   pppa/Kurs_val            pas/Kurs_val
    psk   ppps/Kurs_val            pss/Kurs_val
    pek   pppb+pppa-ppps/Kurs_val  pes/Kurs_val

    tbk   tppb/Kurs_val            tbs/Kurs_val
    tak   tppa/Kurs_val            tas/Kurs_val
    tsk   tpps/Kurs_val            tss/Kurs_val
    tek   tppb+tppa-tpps/Kurs_val  tes/Kurs_val

    mbk   mppb/Kurs_val            mbs/Kurs_val
    mak   mppa/Kurs_val            mas/Kurs_val
    msk   mpps/Kurs_val            mss/Kurs_val
    mek   mppb+mppa-mpps/Kurs_val  mes/Kurs_val

    sbk   sppb/Kurs_val            sbs/Kurs_val
    sak   sppa/Kurs_val            sas/Kurs_val
    ssk   spps/Kurs_val            sss/Kurs_val
    sek   sppb+sppa-spps/Kurs_val  ses/Kurs_val

    ibk   ippb/Kurs_val            ibs/Kurs_val
    iak   ippa/Kurs_val            ias/Kurs_val
    isk   ipps/Kurs_val            iss/Kurs_val
    iek   ippb+ippa-ipps/Kurs_val  ies/Kurs_val
.endfields
.begin
  tiPar1.curPrice := 0 ;
  RunInterface ('GetKlPr3',tiPar1.curPrice) ;
  if (tiPar1.curPrice = 0 )
    Message(''#3'Не выбран ни один прайс лист !!!'#13#3+
            'Учетные цены будут нулевыми...',0);

  prListVal:='';
  if GetFirst KlPrice where ((tiPar1.curPrice == KlPrice.nRec)) =0
    if GetFirst KlVal where ((KlPrice.cVal == KlVal.nRec)) =0
      prListVal:= 'Цены из прайс-листа - в '+KlVal.dollarah+'. Цены приведены в соответствие с Уч.ЕдИзм МЦ';
    else
      prListVal:= 'Цены из прайс-листа приведены в соответствие с Уч.ЕдИзм МЦ';

 end.

  ОБОРОТНАЯ ВЕДОМОСТЬ ДВИЖЕНИЯ МЦ

  Ведомость сформирована
    в учетных единицах измерения
    в валюте отчетов, ^
    курс валюты : &&&&&&&.&&&&
          с ^ по ^

  Используемые фильтры :
  Склад     : ^
  МОЛ       : ^
  МЦ        : ^
  Партия    : ^
  Группа МЦ : ^

  Лист@NP@
  ^
┌─────────────────────────────┬─────────────────────────────────────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┬─────────────────────────────────────┐
│                             │                         ОСТАТОК НА НАЧАЛО                           │                   ПРИХОД            │                   РАСХОД            │              ОСТАТОК НА КОНЕЦ       │
│                             ├──────────────────────────────┬──────┬───────────────────────────────┼──────┬──────────────────────────────┼──────┬──────────────────────────────┼──────┬──────────────────────────────┤
│       Наименование          │             цена             │      │           cтоимость           │      │           стоимость          │      │           стоимость          │      │           стоимость          │
│                             ├───────────────┬──────────────┤      ├───────────────┬───────────────┤      ├───────────────┬──────────────┤      ├───────────────┬──────────────┤      ├───────────────┬──────────────┤
│                             │по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая,  │кол-во│по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая, │кол-во│по прайс-листу,│ фактическая, │
│                             │     @@@@@@    │    @@@@@@    │      │     @@@@@@    │    @@@@@@     │      │     @@@@@@    │    @@@@@@    │      │    @@@@@@     │    @@@@@@    │      │     @@@@@@    │    @@@@@@    │
└─────────────────────────────┴───────────────┴──────────────┴──────┴───────────────┴───────────────┴──────┴───────────────┴──────────────┴──────┴───────────────┴──────────────┴──────┴───────────────┴──────────────┘
.begin
  ippb := 0 ;
  ippa := 0 ;
  ipps := 0 ;
 end.
.{ CheckEnter TinyParPodr
.begin
  sppb := 0 ;
  sppa := 0 ;
  spps := 0 ;
 end.
СКЛАД ^
.{ CheckEnter TinyParMol
.begin
  mppb := 0 ;
  mppa := 0 ;
  mpps := 0 ;
 end.
 МОЛ ^
.{ CheckEnter TinyParMC
.begin

  tppb := 0 ;
  tppa := 0 ;
  tpps := 0 ;
 end.
  МЦ ^, НОМ.НОМЕР ^, ЕДИНИЦА ИЗМЕРЕНИЯ ^
.{ CheckEnter TinyParParty
.begin
  tiPar1.curMC    := мц_рек ;
  tiPar1.curParty := партия_рек ;
  pprice := 0;
  if tiPar1.GetFirst Prices = 0
   { if TiPar1.Prices.cVal =0
       pprice:= TiPar1.Prices.Price
     else
       pprice:= TiPar1.Prices.sumVal;

     if GetFirst KatOtpEd where ((TiPar1.Prices.cOtpEd == KatOtpEd.nRec)) = 0
       pprice:= pprice / KatOtpEd.koef;

   }

  pppb := if01(pbk)*pprice ;
  pppa := if01(pak)*pprice ;
  ppps := if01(psk)*pprice ;

  tppb := tppb + pppb ;
  tppa := tppa + pppa ;
  tpps := tpps + ppps ;

  mppb := mppb + pppb ;
  mppa := mppa + pppa ;
  mpps := mpps + ppps ;

  sppb := sppb + pppb ;
  sppa := sppa + pppa ;
  spps := spps + ppps ;

  ippb := ippb + pppb ;
  ippa := ippa + pppa ;
  ipps := ipps + ppps ;
 end.
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@ &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&&
.} // CheckEnter TinyParParty
  ИТОГО ПО МЦ                                                 &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&&
.} // CheckEnter TinyParMC
 ИТОГО ПО МОЛ                                                 &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&&
.} // CheckEnter TinyParMol
ИТОГО ПО СКЛАДУ                                               &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&&

.} // CheckEnter TinyParPodr
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
ИТОГО ПО ВЕДОМОСТИ                                         &&&&&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&&.&& &&&&&& &&&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& &&&&&&& &&&&&&&&&&&.&& &&&&&&&&&&&.&& Ш
.endform
#doc
С содержанием драгметаллов
#end
.linkform 'TinyPar_0031' prototype is 'TinyPar'
.NameInList 'С содержанием драгметаллов'
.group 'НДЕ и валюта отчетов'
.PAPER PA4
.ORIENT LANDSCAPE
.DEFO LANDSCAPE
.LL 80
.P 60
.[H SKIP
  Лист@NP@
 Ш──────────────────────────┬────────────────────┬────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────
 Наименование МЦ/драгмет. │   Номенк. номер    │Ед.учета│   ВХОДЯЩИЙ ОСТАТОК   │        ПРИХОД        │        РАСХОД        │   ИСХОДЯЩИЙ ОСТАТОК
──────────────────────────┼────────────────────┼────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────
          (1)             │        (2)         │   (3)  │         (4)          │          (5)         │          (6)         │          (7)
──────────────────────────┴────────────────────┴────────┴──────────────────────┴──────────────────────┴──────────────────────┴────────────────────── Ш
 И.]H
.function if01(_d:double):double;
begin
  if01 := if ( abs(_d) < GetPresision_forKol, 1, _d) ;
end.
.create view VDrag
var _рек : comp;
    _tiDk: word;
from  KatDrag(readonly), NalDrag(readonly), KatEd(readonly)
where
(( _tiDk            == NalDrag.TiDk   and
   _рек             == NalDrag.cKatOS and
   NalDrag.cKatDrag == KatDrag.nRec   and
   KatDrag.cKatEd   == KatEd.nRec

))
;
.create view MCDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( МЦ_рек           == TmpSaldo2.cMC   (noindex) and
   -1               == TmpSaldo2.cPodr (noindex) and
   -1               == TmpSaldo2.cMOL  (noindex) and
   TmpSaldo2.cVal   == KatDrag.nRec   and
   KatDrag.cKatEd   == KatEd.nRec
))
;
.create view MOLDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( мол_рек          == TmpSaldo2.cMOL (noindex) and
   -1               == TmpSaldo2.cMC  (noindex) and
   -1               == TmpSaldo2.cPodr(noindex) and
   TmpSaldo2.cVal   == KatDrag.nRec   and
   KatDrag.cKatEd   == KatEd.nRec
))
;
.create view PodrDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( склад_рек        == TmpSaldo2.cPodr(noindex) and
   -1               == TmpSaldo2.cMC  (noindex) and
   -1               == TmpSaldo2.cMOL (noindex) and
   TmpSaldo2.cVal   == KatDrag.nRec    and
   KatDrag.cKatEd   == KatEd.nRec
))
;
.create view AllDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( -2               == TmpSaldo2.cPodr(noIndex) and
   TmpSaldo2.cVal   == KatDrag.nRec             and
   KatDrag.cKatEd   == KatEd.nRec
))
;
.function InsertTmp2_DM(cDM_, cMC_, cPodr_, cMOL_:comp):boolean;
begin
InsertTmp2_DM := true;
if VDrag.GetFirst TmpSaldo2 where ((cMC_   == TmpSaldo2.cMC   and
                                    cPodr_ == TmpSaldo2.cPodr and
                                    cMOL_  == TmpSaldo2.cMOL  and
                                    cDM_   == TmpSaldo2.cVal(noIndex) ))<>tsOk
  { VDrag.TmpSaldo2.cVal := cDM_;
    VDrag.TmpSaldo2.cMC  := cMC_;
    VDrag.TmpSaldo2.cMOL := cMOL_;
    VDrag.TmpSaldo2.cPodr:= cPodr_;
    VDrag.TmpSaldo2.kol := pbk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolP:= pak * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolR:= psk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.sumP:= pek * VDrag.NalDrag.Kol;
    VDrag.insert current TmpSaldo2;
  }
else
  {
    VDrag.TmpSaldo2.kol := VDrag.TmpSaldo2.kol  + pbk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolP:= VDrag.TmpSaldo2.kolP + pak * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolR:= VDrag.TmpSaldo2.kolR + psk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.sumP:= VDrag.TmpSaldo2.sumP + pek * VDrag.NalDrag.Kol;
    VDrag.update current TmpSaldo2;
  }
end.
.var
  molKolB, molKolA, molKolS, molKolE,
  SklKol, AllKol : double
.endvar
.fields
  дата_начальная
  дата_конечная
  sPodr sMOL sMC sParty sGrMC
  склад_имя
  if(мол_имя='','без МОЛ',мол_имя)
  мц_имя
  мц_ном
!  ед_учт_имя
  партия_имя
  ед_учт_имя
  DoubleToStr(pbk, '[|-]3666`666`666`666.8889999999')
  DoubleToStr(pak, '[|-]3666`666`666`666.8889999999')
  DoubleToStr(psk, '[|-]3666`666`666`666.8889999999')
  DoubleToStr(pek, '[|-]3666`666`666`666.8889999999')
.endfields
 И  Журнал учета драгоценных металлов (камней) в МЦ
  (оборотная ведомость с ^ по ^)

  Используемые фильтры :
  Склад     : ^
  МОЛ       : ^
  МЦ        : ^
  Партия    : ^
  Группа МЦ : ^

Лист@NP@
 Ш──────────────────────────┬────────────────────┬────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────
 Наименование МЦ/драгмет. │   Номенкл. номер   │Ед.учета│   ВХОДЯЩИЙ ОСТАТОК   │        ПРИХОД        │        РАСХОД        │   ИСХОДЯЩИЙ ОСТАТОК
──────────────────────────┼────────────────────┼────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────
          (1)             │        (2)         │   (3)  │         (4)          │          (5)         │          (6)         │          (7)
──────────────────────────┴────────────────────┴────────┴──────────────────────┴──────────────────────┴──────────────────────┴────────────────────── Ш
.begin
delete all TmpSaldo2;
end.
.{ CheckEnter TinyParPodr
СКЛАД ^
.{ CheckEnter TinyParMol
МОЛ ^
.{ CheckEnter TinyParMC
 Ш@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ Ш
.{ CheckEnter TinyParParty
 ШПартия: ^ Ш
 Шв учетных единицах                              @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Ш

.begin                  //if VDrag.getFirst NalDrag <>tsOk  { message(мц_рек); TinyPar_003.fcontinue; }
 VDrag._рек  := Партия_рек;
 VDrag._tiDk := 4;
 if VDrag.GetFirst NalDrag <>tsOk
   {
     VDrag._рек  := МЦ_рек;
     VDrag._tiDk := 3;
     if VDrag.GetFirst NalDrag <>tsOk {}
     //message(МЦ_имя);
   }
end.
.{ table 'VDrag.NalDrag'   // вывод ДМ
.fields
   VDrag.KatDrag.Name   VDrag.KatDrag.Kod   VDrag.KatEd.Name
   DoubleToStr(pbk * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(pak * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(psk * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(pek * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
.endfields
.begin  //суммируем для МЦ, МОЛ, склада, общий итог
   InsertTmp2_DM(VDrag.KatDrag.nRec, МЦ_рек,        -1,      -1); //суммируем по по МC
   InsertTmp2_DM(VDrag.KatDrag.nRec,     -1,        -1, мол_рек); //суммируем по по МОЛ
   InsertTmp2_DM(VDrag.KatDrag.nRec,     -1, склад_рек,      -1); //суммируем по подр.
   InsertTmp2_DM(VDrag.KatDrag.nRec,     -1,        -2,      -1); //суммируем общий итог
end.
 Ш @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Ш
.} // table 'VDrag.NalDrag'

.} // Party
 Ш ИТОГО ПО МЦ  Ш
.{ table 'MCDrag.TmpSaldo2'
.fields
   MCDrag.KatDrag.Name   MCDrag.KatDrag.Kod   MCDrag.KatEd.Name
   DoubleToStr(MCDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MCDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MCDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MCDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.} //table 'MСDrag.TmpSaldo2'
.begin
delete TmpSaldo2 where (( МЦ_рек == TmpSaldo2.cMC   (noindex) and
                              -1 == TmpSaldo2.cPodr (noindex) and
                              -1 == TmpSaldo2.cMOL  (noindex) ));
end.
 Ш---------------------------------------------------------- Ш
.} //MC
 ИТОГО ПО МОЛ
.{ table 'MOLDrag.TmpSaldo2'
.fields
   MOLDrag.KatDrag.Name   MOLDrag.KatDrag.Kod   MOLDrag.KatEd.Name
   DoubleToStr(MOLDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MOLDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MOLDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MOLDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.}
.begin
delete TmpSaldo2 where (( мол_рек == TmpSaldo2.cMOL  (noindex) and
                               -1 == TmpSaldo2.cMC   (noindex) and
                               -1 == TmpSaldo2.cPodr (noindex) ));
end.

.} //Mol
ИТОГО ПО СКЛАДУ
.{ table 'PodrDrag.TmpSaldo2'
.fields
   PodrDrag.KatDrag.Name   PodrDrag.KatDrag.Kod   PodrDrag.KatEd.Name
   DoubleToStr(PodrDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(PodrDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(PodrDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(PodrDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.}
 Щ -------------------------------------------------------------------------------------------------------------------------------------------------- Щ
.begin
delete TmpSaldo2 where (( склад_рек == TmpSaldo2.cPodr (noindex) and
                                 -1 == TmpSaldo2.cMC   (noindex) and
                                 -1 == TmpSaldo2.cMOL  (noindex) ));
end.

.} //Podr
ИТОГО ПО ВЕДОМОСТИ
.{ table 'AllDrag.TmpSaldo2'
.fields
   ALLDrag.KatDrag.Name   ALLDrag.KatDrag.Kod   ALLDrag.KatEd.Name
   DoubleToStr(ALLDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(ALLDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(ALLDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(ALLDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.}

   Руководитель предприятия

   Главный бухгалтер

   М.П.
.endform

#doc
С содержанием драгметаллов
#end
.linkform 'TinyPar_0032' prototype is 'TinyPar'
.NameInList 'С содержанием драгметаллов'
.group 'НДЕ'
.PAPER PA4
.ORIENT LANDSCAPE
.DEFO LANDSCAPE
.LL 80
.P 60
.[H SKIP
  Лист@NP@
 Ш──────────────────────────┬────────────────────┬────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────
 Наименование МЦ/драгмет. │   Номенк. номер    │Ед.учета│   ВХОДЯЩИЙ ОСТАТОК   │        ПРИХОД        │        РАСХОД        │   ИСХОДЯЩИЙ ОСТАТОК
──────────────────────────┼────────────────────┼────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────
          (1)             │        (2)         │   (3)  │         (4)          │          (5)         │          (6)         │          (7)
──────────────────────────┴────────────────────┴────────┴──────────────────────┴──────────────────────┴──────────────────────┴────────────────────── Ш
 И.]H
.function if01(_d:double):double;
begin
  if01 := if ( abs(_d) < GetPresision_forKol, 1, _d) ;
end.
.create view VDrag
var _рек : comp;
    _tiDk: word;
from  KatDrag(readonly), NalDrag(readonly), KatEd(readonly)
where
(( _tiDk            == NalDrag.TiDk   and
   _рек             == NalDrag.cKatOS and
   NalDrag.cKatDrag == KatDrag.nRec   and
   KatDrag.cKatEd   == KatEd.nRec

))
;
.create view MCDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( МЦ_рек           == TmpSaldo2.cMC   (noindex) and
   -1               == TmpSaldo2.cPodr (noindex) and
   -1               == TmpSaldo2.cMOL  (noindex) and
   TmpSaldo2.cVal   == KatDrag.nRec   and
   KatDrag.cKatEd   == KatEd.nRec
))
;
.create view MOLDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( мол_рек          == TmpSaldo2.cMOL (noindex) and
   -1               == TmpSaldo2.cMC  (noindex) and
   -1               == TmpSaldo2.cPodr(noindex) and
   TmpSaldo2.cVal   == KatDrag.nRec   and
   KatDrag.cKatEd   == KatEd.nRec
))
;

.create view PodrDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( склад_рек        == TmpSaldo2.cPodr(noindex) and
   -1               == TmpSaldo2.cMC  (noindex) and
   -1               == TmpSaldo2.cMOL (noindex) and
   TmpSaldo2.cVal   == KatDrag.nRec    and
   KatDrag.cKatEd   == KatEd.nRec
))
;

.create view AllDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( -2               == TmpSaldo2.cPodr(noIndex) and
   TmpSaldo2.cVal   == KatDrag.nRec             and
   KatDrag.cKatEd   == KatEd.nRec
))
;

.function InsertTmp2_DM(cDM_, cMC_, cPodr_, cMOL_:comp):boolean;
begin
InsertTmp2_DM := true;

if VDrag.GetFirst TmpSaldo2 where ((cMC_   == TmpSaldo2.cMC   and
                                    cPodr_ == TmpSaldo2.cPodr and
                                    cMOL_  == TmpSaldo2.cMOL  and
                                    cDM_   == TmpSaldo2.cVal(noIndex) ))<>tsOk
  { VDrag.TmpSaldo2.cVal := cDM_;
    VDrag.TmpSaldo2.cMC  := cMC_;
    VDrag.TmpSaldo2.cMOL := cMOL_;
    VDrag.TmpSaldo2.cPodr:= cPodr_;
    VDrag.TmpSaldo2.kol := pbk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolP:= pak * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolR:= psk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.sumP:= pek * VDrag.NalDrag.Kol;

    VDrag.insert current TmpSaldo2;
  }
else
  {
    VDrag.TmpSaldo2.kol := VDrag.TmpSaldo2.kol  + pbk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolP:= VDrag.TmpSaldo2.kolP + pak * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolR:= VDrag.TmpSaldo2.kolR + psk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.sumP:= VDrag.TmpSaldo2.sumP + pek * VDrag.NalDrag.Kol;

    VDrag.update current TmpSaldo2;
  }
end.
.var
  molKolB, molKolA, molKolS, molKolE,
  SklKol, AllKol : double
.endvar
.fields
  дата_начальная
  дата_конечная

  sPodr sMOL sMC sParty sGrMC

  склад_имя

  if(мол_имя='','без МОЛ',мол_имя)

  мц_имя
  мц_ном
!  ед_учт_имя

  партия_имя
  ед_учт_имя
  DoubleToStr(pbk, '[|-]3666`666`666`666.8889999999')
  DoubleToStr(pak, '[|-]3666`666`666`666.8889999999')
  DoubleToStr(psk, '[|-]3666`666`666`666.8889999999')
  DoubleToStr(pek, '[|-]3666`666`666`666.8889999999')
.endfields
 И  Журнал учета драгоценных металлов (камней) в МЦ
  (оборотная ведомость с ^ по ^)

  Используемые фильтры :
  Склад     : ^
  МОЛ       : ^
  МЦ        : ^
  Партия    : ^
  Группа МЦ : ^

Лист@NP@
 Ш──────────────────────────┬────────────────────┬────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────
 Наименование МЦ/драгмет. │   Номенкл. номер   │Ед.учета│   ВХОДЯЩИЙ ОСТАТОК   │        ПРИХОД        │        РАСХОД        │   ИСХОДЯЩИЙ ОСТАТОК
──────────────────────────┼────────────────────┼────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────
          (1)             │        (2)         │   (3)  │         (4)          │          (5)         │          (6)         │          (7)
──────────────────────────┴────────────────────┴────────┴──────────────────────┴──────────────────────┴──────────────────────┴────────────────────── Ш
.begin
delete all TmpSaldo2;
end.
.{ CheckEnter TinyParPodr
СКЛАД ^
.{ CheckEnter TinyParMol
МОЛ ^
.{ CheckEnter TinyParMC
 Ш@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ Ш
.{ CheckEnter TinyParParty
 ШПартия: ^ Ш
 Шв учетных единицах                              @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Ш

.begin                  //if VDrag.getFirst NalDrag <>tsOk  { message(мц_рек); TinyPar_003.fcontinue; }
 VDrag._рек  := Партия_рек;
 VDrag._tiDk := 4;
 if VDrag.GetFirst NalDrag <>tsOk
   {
     VDrag._рек  := МЦ_рек;
     VDrag._tiDk := 3;
     if VDrag.GetFirst NalDrag <>tsOk {}
     //message(МЦ_имя);
   }
end.
.{ table 'VDrag.NalDrag'   // вывод ДМ
.fields
   VDrag.KatDrag.Name   VDrag.KatDrag.Kod   VDrag.KatEd.Name
   DoubleToStr(pbk * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(pak * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(psk * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(pek * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
.endfields
.begin  //суммируем для МЦ, МОЛ, склада, общий итог
   InsertTmp2_DM(VDrag.KatDrag.nRec, МЦ_рек,        -1,      -1); //суммируем по по МC
   InsertTmp2_DM(VDrag.KatDrag.nRec,     -1,        -1, мол_рек); //суммируем по по МОЛ
   InsertTmp2_DM(VDrag.KatDrag.nRec,     -1, склад_рек,      -1); //суммируем по подр.
   InsertTmp2_DM(VDrag.KatDrag.nRec,     -1,        -2,      -1); //суммируем общий итог
end.
 Ш @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Ш
.} // table 'VDrag.NalDrag'

.} // Party
 Ш ИТОГО ПО МЦ  Ш
.{ table 'MCDrag.TmpSaldo2'
.fields
   MCDrag.KatDrag.Name   MCDrag.KatDrag.Kod   MCDrag.KatEd.Name
   DoubleToStr(MCDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MCDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MCDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MCDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.} //table 'MСDrag.TmpSaldo2'
.begin
delete TmpSaldo2 where (( МЦ_рек == TmpSaldo2.cMC   (noindex) and
                              -1 == TmpSaldo2.cPodr (noindex) and
                              -1 == TmpSaldo2.cMOL  (noindex) ));
end.
 Ш---------------------------------------------------------- Ш
.} //MC
 ИТОГО ПО МОЛ
.{ table 'MOLDrag.TmpSaldo2'
.fields
   MOLDrag.KatDrag.Name   MOLDrag.KatDrag.Kod   MOLDrag.KatEd.Name
   DoubleToStr(MOLDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MOLDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MOLDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MOLDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.}
.begin
delete TmpSaldo2 where (( мол_рек == TmpSaldo2.cMOL  (noindex) and
                               -1 == TmpSaldo2.cMC   (noindex) and
                               -1 == TmpSaldo2.cPodr (noindex) ));
end.
.} //Mol
ИТОГО ПО СКЛАДУ
.{ table 'PodrDrag.TmpSaldo2'
.fields
   PodrDrag.KatDrag.Name   PodrDrag.KatDrag.Kod   PodrDrag.KatEd.Name
   DoubleToStr(PodrDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(PodrDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(PodrDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(PodrDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.}
 Щ -------------------------------------------------------------------------------------------------------------------------------------------------- Щ
.begin
delete TmpSaldo2 where (( склад_рек == TmpSaldo2.cPodr (noindex) and
                                 -1 == TmpSaldo2.cMC   (noindex) and
                                 -1 == TmpSaldo2.cMOL  (noindex) ));
end.
.} //Podr
ИТОГО ПО ВЕДОМОСТИ
.{ table 'AllDrag.TmpSaldo2'
.fields
   ALLDrag.KatDrag.Name   ALLDrag.KatDrag.Kod   ALLDrag.KatEd.Name
   DoubleToStr(ALLDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(ALLDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(ALLDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(ALLDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.}

   Руководитель предприятия

   Главный бухгалтер

   М.П.
.endform

#doc
С содержанием драгметаллов
#end
.linkform 'TinyPar_0033' prototype is 'TinyPar'
.NameInList 'С содержанием драгметаллов'
.group 'Валюта отчетов'
.PAPER PA4
.ORIENT LANDSCAPE
.DEFO LANDSCAPE
.LL 80
.P 60
.[H SKIP
  Лист@NP@
 Ш──────────────────────────┬────────────────────┬────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────
 Наименование МЦ/драгмет. │   Номенк. номер    │Ед.учета│   ВХОДЯЩИЙ ОСТАТОК   │        ПРИХОД        │        РАСХОД        │   ИСХОДЯЩИЙ ОСТАТОК
──────────────────────────┼────────────────────┼────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────
          (1)             │        (2)         │   (3)  │         (4)          │          (5)         │          (6)         │          (7)
──────────────────────────┴────────────────────┴────────┴──────────────────────┴──────────────────────┴──────────────────────┴────────────────────── Ш
 И.]H
.function if01(_d:double):double;
begin
  if01 := if ( abs(_d) < GetPresision_forKol, 1, _d) ;
end.
.create view VDrag
var _рек : comp;
    _tiDk: word;

from  KatDrag(readonly), NalDrag(readonly), KatEd(readonly)
where
(( _tiDk            == NalDrag.TiDk   and
   _рек             == NalDrag.cKatOS and
   NalDrag.cKatDrag == KatDrag.nRec   and
   KatDrag.cKatEd   == KatEd.nRec

))
;
.create view MCDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( МЦ_рек           == TmpSaldo2.cMC   (noindex) and
   -1               == TmpSaldo2.cPodr (noindex) and
   -1               == TmpSaldo2.cMOL  (noindex) and
   TmpSaldo2.cVal   == KatDrag.nRec   and
   KatDrag.cKatEd   == KatEd.nRec
))
;
.create view MOLDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( мол_рек          == TmpSaldo2.cMOL (noindex) and
   -1               == TmpSaldo2.cMC  (noindex) and
   -1               == TmpSaldo2.cPodr(noindex) and
   TmpSaldo2.cVal   == KatDrag.nRec   and
   KatDrag.cKatEd   == KatEd.nRec
))
;
.create view PodrDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( склад_рек        == TmpSaldo2.cPodr(noindex) and
   -1               == TmpSaldo2.cMC  (noindex) and
   -1               == TmpSaldo2.cMOL (noindex) and
   TmpSaldo2.cVal   == KatDrag.nRec    and
   KatDrag.cKatEd   == KatEd.nRec
))
;
.create view AllDrag
from  KatDrag(readonly),  KatEd(readonly), TmpSaldo2
where
(( -2               == TmpSaldo2.cPodr(noIndex) and
   TmpSaldo2.cVal   == KatDrag.nRec             and
   KatDrag.cKatEd   == KatEd.nRec
))
;
.function InsertTmp2_DM(cDM_, cMC_, cPodr_, cMOL_:comp):boolean;
begin
InsertTmp2_DM := true;

if VDrag.GetFirst TmpSaldo2 where ((cMC_   == TmpSaldo2.cMC   and
                                    cPodr_ == TmpSaldo2.cPodr and
                                    cMOL_  == TmpSaldo2.cMOL  and
                                    cDM_   == TmpSaldo2.cVal(noIndex) ))<>tsOk
  { VDrag.TmpSaldo2.cVal := cDM_;
    VDrag.TmpSaldo2.cMC  := cMC_;
    VDrag.TmpSaldo2.cMOL := cMOL_;
    VDrag.TmpSaldo2.cPodr:= cPodr_;
    VDrag.TmpSaldo2.kol := pbk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolP:= pak * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolR:= psk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.sumP:= pek * VDrag.NalDrag.Kol;

    VDrag.insert current TmpSaldo2;
  }
else
  {
    VDrag.TmpSaldo2.kol := VDrag.TmpSaldo2.kol  + pbk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolP:= VDrag.TmpSaldo2.kolP + pak * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.kolR:= VDrag.TmpSaldo2.kolR + psk * VDrag.NalDrag.Kol;
    VDrag.TmpSaldo2.sumP:= VDrag.TmpSaldo2.sumP + pek * VDrag.NalDrag.Kol;

    VDrag.update current TmpSaldo2;
  }
end.
.var
  molKolB, molKolA, molKolS, molKolE,
  SklKol, AllKol : double
.endvar
.fields
  дата_начальная
  дата_конечная
  sPodr sMOL sMC sParty sGrMC
  склад_имя
  if(мол_имя='','без МОЛ',мол_имя)
  мц_имя
  мц_ном
!  ед_учт_имя
  партия_имя
  ед_учт_имя
  DoubleToStr(pbk, '[|-]3666`666`666`666.8889999999')
  DoubleToStr(pak, '[|-]3666`666`666`666.8889999999')
  DoubleToStr(psk, '[|-]3666`666`666`666.8889999999')
  DoubleToStr(pek, '[|-]3666`666`666`666.8889999999')
.endfields
 И  Журнал учета драгоценных металлов (камней) в МЦ
  (оборотная ведомость с ^ по ^)
  Используемые фильтры :
  Склад     : ^
  МОЛ       : ^
  МЦ        : ^
  Партия    : ^
  Группа МЦ : ^

  Лист@NP@
 Ш──────────────────────────┬────────────────────┬────────┬──────────────────────┬──────────────────────┬──────────────────────┬──────────────────────
 Наименование МЦ/драгмет. │   Номенкл. номер   │Ед.учета│   ВХОДЯЩИЙ ОСТАТОК   │        ПРИХОД        │        РАСХОД        │   ИСХОДЯЩИЙ ОСТАТОК
──────────────────────────┼────────────────────┼────────┼──────────────────────┼──────────────────────┼──────────────────────┼──────────────────────
          (1)             │        (2)         │   (3)  │         (4)          │          (5)         │          (6)         │          (7)
──────────────────────────┴────────────────────┴────────┴──────────────────────┴──────────────────────┴──────────────────────┴────────────────────── Ш
.begin
delete all TmpSaldo2;
end.
.{ CheckEnter TinyParPodr
СКЛАД ^
.{ CheckEnter TinyParMol
МОЛ ^
.{ CheckEnter TinyParMC
 Ш@@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ Ш
.{ CheckEnter TinyParParty
 ШПартия: ^ Ш
 Шв учетных единицах                              @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Ш

.begin                  //if VDrag.getFirst NalDrag <>tsOk  { message(мц_рек); TinyPar_003.fcontinue; }
 VDrag._рек  := Партия_рек;
 VDrag._tiDk := 4;
 if VDrag.GetFirst NalDrag <>tsOk
   {
     VDrag._рек  := МЦ_рек;
     VDrag._tiDk := 3;
     if VDrag.GetFirst NalDrag <>tsOk {}
     //message(МЦ_имя);
   }
end.
.{ table 'VDrag.NalDrag'   // вывод ДМ
.fields
   VDrag.KatDrag.Name   VDrag.KatDrag.Kod   VDrag.KatEd.Name
   DoubleToStr(pbk * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(pak * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(psk * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(pek * VDrag.NalDrag.Kol, '[|-]3666`666`666`666.8889999999')
.endfields
.begin  //суммируем для МЦ, МОЛ, склада, общий итог
   InsertTmp2_DM(VDrag.KatDrag.nRec, МЦ_рек,        -1,      -1); //суммируем по по МC
   InsertTmp2_DM(VDrag.KatDrag.nRec,     -1,        -1, мол_рек); //суммируем по по МОЛ
   InsertTmp2_DM(VDrag.KatDrag.nRec,     -1, склад_рек,      -1); //суммируем по подр.
   InsertTmp2_DM(VDrag.KatDrag.nRec,     -1,        -2,      -1); //суммируем общий итог
end.
 Ш @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Ш
.} // table 'VDrag.NalDrag'

.} // Party
 Ш ИТОГО ПО МЦ  Ш
.{ table 'MCDrag.TmpSaldo2'
.fields
   MCDrag.KatDrag.Name   MCDrag.KatDrag.Kod   MCDrag.KatEd.Name
   DoubleToStr(MCDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MCDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MCDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MCDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.} //table 'MСDrag.TmpSaldo2'
.begin
delete TmpSaldo2 where (( МЦ_рек == TmpSaldo2.cMC   (noindex) and
                              -1 == TmpSaldo2.cPodr (noindex) and
                              -1 == TmpSaldo2.cMOL  (noindex) ));
end.
 Ш---------------------------------------------------------- Ш
.} //MC
 ИТОГО ПО МОЛ
.{ table 'MOLDrag.TmpSaldo2'
.fields
   MOLDrag.KatDrag.Name   MOLDrag.KatDrag.Kod   MOLDrag.KatEd.Name
   DoubleToStr(MOLDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MOLDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MOLDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(MOLDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.}
.begin
delete TmpSaldo2 where (( мол_рек == TmpSaldo2.cMOL  (noindex) and
                               -1 == TmpSaldo2.cMC   (noindex) and
                               -1 == TmpSaldo2.cPodr (noindex) ));
end.

.} //Mol
ИТОГО ПО СКЛАДУ
.{ table 'PodrDrag.TmpSaldo2'
.fields
   PodrDrag.KatDrag.Name   PodrDrag.KatDrag.Kod   PodrDrag.KatEd.Name
   DoubleToStr(PodrDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(PodrDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(PodrDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(PodrDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.}
 Щ -------------------------------------------------------------------------------------------------------------------------------------------------- Щ
.begin
delete TmpSaldo2 where (( склад_рек == TmpSaldo2.cPodr (noindex) and
                                 -1 == TmpSaldo2.cMC   (noindex) and
                                 -1 == TmpSaldo2.cMOL  (noindex) ));
end.

.} //Podr
ИТОГО ПО ВЕДОМОСТИ
.{ table 'AllDrag.TmpSaldo2'
.fields
   ALLDrag.KatDrag.Name   ALLDrag.KatDrag.Kod   ALLDrag.KatEd.Name
   DoubleToStr(ALLDrag.TmpSaldo2.kol , '[|-]3666`666`666`666.8889999999')
   DoubleToStr(ALLDrag.TmpSaldo2.kolP, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(ALLDrag.TmpSaldo2.kolR, '[|-]3666`666`666`666.8889999999')
   DoubleToStr(ALLDrag.TmpSaldo2.sumP, '[|-]3666`666`666`666.8889999999')
.endfields
 Щ @@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@@@@@@ @@@@@@@@ &&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&&& Щ
.}

   Руководитель предприятия

   Главный бухгалтер

   М.П.
.endform
