#ifndef __SoprDocB_vih__
#define __SoprDocB_vih__

//базовый документ для накладных/актов сбыта и снабжения
#include BaseSoprDoc.vih

#ifdef ComponentVersion
#component "L_SoprDoc"
#end

//******************************************************************************
#doc
  обработка приходных накладных
#end
//******************************************************************************

ObjInterface SoprDocBObj;

//------------------------------------------------------------------------------
#doc
Назначение:
  Связать с накладной акты на услуги
Параметры:
  pNakl     - ссылка на сопроводительный документ
  WithCheck - проверка на наличие актов
#end
//------------------------------------------------------------------------------

Function AktSopUslForm(pNakl : comp; WithCheck : boolean) : boolean;

//------------------------------------------------------------------------------
#doc
Назначение:
  Пересчет сумм в документах, указанных в маркере RecalcKatSopr
Параметры:
  нет
#end
//------------------------------------------------------------------------------

Procedure RecalcSoprDocB;

//------------------------------------------------------------------------------
#doc
Назначение:
  установка вида сопроводительного документа
Параметры:
  wSopr - вид сопроводительного документа
#end
//------------------------------------------------------------------------------

Procedure _SetTypeSopr(wSopr: word);

//------------------------------------------------------------------------------
#doc
Назначение:
  проверка на перед удалением сопр.документа
Параметры:
  pNRec - ссылка на этап ДО
#end
//------------------------------------------------------------------------------

Function CanDeleteSoprDocumentOnBaseDoc(pNRec: comp):boolean;

//------------------------------------------------------------------------------
#doc
Назначение:
  удаление сопр.документа
Параметры:
  pNRec - ссылка на этап ДО
#end
//------------------------------------------------------------------------------

Function DeleteSoprDocument(pNrec:comp):boolean;

//------------------------------------------------------------------------------
#doc
Назначение:
  Формирование приходного ордера
Параметры:
  cSopr_    - ссылка на сопроводительный документ
  needMsg_  - выдача сообщений
  prRozn_   - оприходование в розницу
#end
//------------------------------------------------------------------------------

Function MakeOrderByKatSopr(cSopr_: comp; showMess_: boolean; var prRozn_: boolean): boolean;

//------------------------------------------------------------------------------
#doc
Назначение:
  Формирование приходного ордера
Параметры:
  cSopr_     - ссылка на сопроводительный документ
  needMsg_   - выдача сообщений
  prRozn_    - оприходование в розницу
  PacketMode - пакетный режим
#end
//------------------------------------------------------------------------------
Function MakeOrderByKatSoprMod(cSopr_: comp; showMess_: boolean; var prRozn_: boolean; PacketMode: boolean): boolean;

end;

#ifdef __SKYSHOP__
//******************************************************************************
#doc
  обработка накладных на отпуск (__SKYSHOP__)
  в данный момент не используется
#end
//******************************************************************************

ObjInterface SoprDocBObjSky;
  procedure _SetPosition(KS: comp);
  procedure _DeletePosition;
end;
#end

#include DelSopr.vih

  VipInterface SoprDocB_Release(BaseSoprDoc)
    implements SoprDocBObj
             , objBeforeDelSopr
             #ifdef __SKYSHOP__
             , SoprDocBObjSky
             #end
    licensed
    (
      buy,otprcons,stroy
    )
    SourceFile = "SOPRDOCB_Release.vip";
    Public:
      Procedure InitVars;       // инициализация переменных
      Procedure DoneVars;       // уничтожение переменных
      Procedure TuneEditSopr;
      Procedure ViewFieldSopr;  // показать/скрыть поля визуальных элементов
      Procedure HidePickButton; // показать/скрыть PickButton для полей по которым установлен фильтр
      Function  OtkatToOldState    (Mess: boolean; TW: word): boolean;  // Проверка сопроводительного документа на возможность редактирования
      Procedure CreateSoprKN;                                           // Создание корректирующей накладной
      Function  PickKatNotesBefore : boolean;                           // Вызывается до выбора статуса в документах
      Procedure PickKatNotesAfter  (pOldStatus: word; pOldNote: comp);  // Вызывается после выбора статуса в документах.
      Function  CopySoprDocBefore  : boolean;                           // Вызывается до начала операции копирования
      Procedure CopySoprDocAfter   (pNewDoc: comp; pNewMarker: longint);// Вызывается после завершения операции копирования
      Function  PickHozOperBefore  : boolean;                           // Вызывается до выбора хозоперации в документах.
      Function  PickHozOperAfter   : boolean;                           // Вызывается после выбора хозоперации в документах.
      Function  PickFIOBefore      : boolean;                           // Вызывается до выбора исполнителя в документах
      Function  PickFIOAfter       (pNewPersons: comp): boolean;        // Вызывается после выбора исполнителя в документах
      Function  PickOtvPodrBefore  : boolean;                           // Вызывается до выбора центра ответственности в документах
      Function  PickOtvPodrAfter   (pNewOtvPodr: comp): boolean;        // Вызывается после выбора центра ответственности в документах
      Function  UnBindOtvPodrBefore: boolean;                           // Вызывается до отвязки центра ответственности в документах.
      Procedure CheckSumma         (full: boolean);                     // Пересчет общих сумм по документу
      Function  CheckHead          : boolean;                           // проверка заполнения заголовка
    end;

  VipInterface SoprDocB (SoprDocB_Release);
    Public:
      Procedure InitVars;       // инициализация переменных
      Procedure DoneVars;       // уничтожение переменных
      Procedure TuneEditSopr;
      Procedure ViewFieldSopr;  // показать/скрыть поля визуальных элементов
      Procedure HidePickButton; // показать/скрыть PickButton для полей по которым установлен фильтр
      Function  OtkatToOldState    (Mess: boolean; TW: word): boolean;  // Проверка сопроводительного документа на возможность редактирования
      Procedure CreateSoprKN;                                           // Создание корректирующей накладной
      Function  PickKatNotesBefore : boolean;                           // Вызывается до выбора статуса в документах
      Procedure PickKatNotesAfter  (pOldStatus: word; pOldNote: comp);  // Вызывается после выбора статуса в документах.
      Function  CopySoprDocBefore  : boolean;                           // Вызывается до начала операции копирования
      Procedure CopySoprDocAfter   (pNewDoc: comp; pNewMarker: longint);// Вызывается после завершения операции копирования
      Function  PickHozOperBefore  : boolean;                           // Вызывается до выбора хозоперации в документах.
      Function  PickHozOperAfter   : boolean;                           // Вызывается после выбора хозоперации в документах.
      Function  PickFIOBefore      : boolean;                           // Вызывается до выбора исполнителя в документах
      Function  PickFIOAfter       (pNewPersons: comp): boolean;        // Вызывается после выбора исполнителя в документах
      Function  PickOtvPodrBefore  : boolean;                           // Вызывается до выбора центра ответственности в документах
      Function  PickOtvPodrAfter   (pNewOtvPodr: comp): boolean;        // Вызывается после выбора центра ответственности в документах
      Function  UnBindOtvPodrBefore: boolean;                           // Вызывается до отвязки центра ответственности в документах.
      Procedure CheckSumma         (full: boolean);                     // Пересчет общих сумм по документу
      Function  CheckHead          : boolean;                           // проверка заполнения заголовка
    end;

#end // __SoprDoc_vih__
