//********************************************************************************
//                                                        (c) корпорация Галактика
// Галактика 9.1 - Логистика
//
//********************************************************************************

#ifNdef _DocProtector_vip
#define _DocProtector_vip

#ifdef ComponentVersion
#component "L_COMMON"
#end

const  // _wMode
  cn_DP_ShowAll     = 1;   // Отображать все сообщения и запросы
  cn_DP_ShowRequest = 2;   // Отображать только запросы
  cn_DP_Multi       = 3;   // Для пакетного режима. Отображать только запросы с вариантами ответа "Да, для всех", "Нет, для всех"
  cn_DP_SilentNo    = 4;   // Не отображать сообщения. Для вариантов где требуется запрос считать ответом - "Нет" (запрет редактирвания)
  cn_DP_SilentYes   = 5;   // Не отображать сообщения. Для вариантов где требуется запрос считать ответом - "Да" (разрешить редактирвания)
end;

//****************************************************************************
// Переменные
//  _sProtectorName - наименование интерфейса, реализуещего IProtector_Base
//  _wTable         - таблица документа
//  _wTiDK       - тип ДО
//  _cRec        - ссылка на документ
//  _cSpRec      - ссылка на позицию спецификации документа
//  _wCurCommand - текущее событие (*.inc)
//  _wCurTable   - текущая таблица (*.inc)
//  _wCurFormat  - текущая область (*.inc)
//  _wCurField   - текущее поле (*.inc)
//  _wMode       - режим отображения сообщений
//  _wFunc       - функция (*.inc)
//  _sDopText1   - начальная часть сообщения
//  _sMes        - сообщение
//  _sDopText2   - конечная часть сообщения
//  _wReason     - причина запрета
//****************************************************************************

ObjInterface ObjDocProtector;

#doc
  Инициализация объекта

  Результат: TRUE - инициализация прошла успешно
#end
Function Initialize(_sProtectorName : string; _wTable : integer; _wTiDK : word; _bUseDocCache : boolean) : boolean;

//*****************************************************************************

#doc
  Проверка указанного события на возможность выполнения

  Результат: TRUE - выполнение разрешено
#end
Function CheckCommand(_cRec, cSpRec : comp; _wCurCommand : word; _wCurTable : integer; _wCurFormat, _wCurField, _wMode : word) : boolean;

//*****************************************************************************

#doc
  Выполнение отдельной функции по проверке возможности модификации

  Результат: TRUE - результат выполнения функции
#end
Function RunFunc(_cRec, cSpRec : comp; _wFunc, _wMode : word) : boolean;

//*****************************************************************************

#doc
  Можно ли влиять на события в указанных областях

  Результат: TRUE - да
#end
Function CanManageInput(_wCurTable : integer; _wCurFormat, _wCurField : word) : boolean;

//*****************************************************************************

#doc
  Проверка возможности модификации документа

  Результат: TRUE - модификация разрешена
#end
Function CanEditDoc(_cRec : comp; _wMode : word) : boolean;

//*****************************************************************************

#doc
  Получить текст сообщения последнего запрета модификации
#end
Function GetMessage : string;

//*****************************************************************************

#doc
  Получить код последнего запрета модификации
#end
Function GetReason : word;

//*****************************************************************************

#doc
  Сбросить кэш запросов на модификацию. (Например, при изменении записи или в перед пакетными операциями)
#end
Procedure ClearRequestCache;

#doc
  Сбросить кэш документа. Если _cRec = 0, то весь.
#end
Procedure ClearDocCache(_cRec : comp);

end;

//******************************************************************************

VipInterface iDocProtector implements ObjDocProtector licensed(FREE);

#end
