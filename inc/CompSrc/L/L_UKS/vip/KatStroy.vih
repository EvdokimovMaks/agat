//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 5.84 - Управление капитальными вложениями и строительством
// Каталог объектов строительства
//------------------------------------------------------------------------------

#ifndef __KatStroy_vih__
#define __KatStroy_vih__

#component "L_UKS"

#doc
Содержит методы для работы с каталогом объектов строительства.
#end
ObjInterface KatStroyObj1;

  #doc
  Расчет сумм по всему каталогу.
  #end
  Procedure GlobalSchetSum(Format: boolean); // расчет сумм по всему каталогу

  #doc
  Перестройка описателя иерархии при включении использования классов объектов.
  #end
  Procedure KorrIer;

  #doc
  Вставка объекта строительства при импорте сметы.
  #end
  Function AddNewObjectForSmeta(NmOb: string; var nRecObj: comp): boolean;

  #doc
  Перестройка описателя иерархии.
  #end
  Procedure ReBuildIerarh(Vis: boolean);

  #doc
  Запуск интерфейса каталога объектов с позиционированием на заданный объект.
  #end
  Procedure RunAndSetToObjStroy( pNRec: tNRec );

end;



Const
  // Коды ошибок, возвращаемые методами интерфейса KatStroyObj2
  cgOk             = 0;  // Успешно (без ошибок)
  cgError_Name     = 1;  // Не задано наименование объекта
  cgError_BadRec   = 2;  // Некорректная ссылка на объект
  cgError_Edit     = 3;  // Запрещено редактирование каталога объектов строительства по настройке
  cgError_SelfObj  = 4;  // В качестве вышестоящего выбран тот же объект
  cgError_SelfNode = 5;  // В качестве вышестоящего выбран объект, входящий в состав текущего
  cgError_Level    = 6;  // Нельзя выбрать объект с тем же классом или с большим
  cgError_Docs     = 7;  // У объекта, который должен быть преобразован в стройку или удален, есть привязанные документы или планы
  cgError_KillPlan = 8;  // Ошибка удаления спецификаций планов капстроительства
  cgError_Format   = 9;  // В текущем окне/представлении удаление объекта невозможно
  cgError_State    = 10; // Запрещено редактировать объект в текущем состоянии
  cgError_Status   = 11; // Запрещено редактировать объект в текущем статусе
  cgError_Confirm  = 12; // Пользователь не подтвердил удаление
  cgError_AttrObj  = 13; // Запрещено модифицировать атрибуты объекта при наличии привязанных документов
  cgError_COtvObj  = 14; // Доступ только к своим объектам/стройкам, заявкам, планам
End;

#doc
Методы для редактирования каталога объектов строительства
#end
ObjInterface KatStroyObj2;

  #doc
  Проверка возможности редактирования заданного объекта
  #end
  Function CanEdit(
                    #doc
                    Выдавать ли сообщение в случае ошибки
                    #end
                    bMessage: boolean;

                    #doc
                    Ссылка на редактируемый документ</brief>При нулевом значении выполняется проверка возможности вставки новой записи
                    #end
                    cKatStroy: comp ):
                                       #doc
                                       Код ошибки. 0 - редактирование (вставка) разрешено.
                                       #end
                                       word;

  #doc
  Вставка объекта строительства
  #end
  Function AddObj(
                   #doc
                   Выдавать ли сообщение в случае ошибки
                   #end
                   bMessage: boolean;

                   #doc
                   Наименование создаваемого объекта (не пустая строка)
                   #end
                   sName: string;

                   #doc
                   Код класса создаваемого объекта</brief>
                   При выключенной настройке использования классов объектов передавать 0.
                   #end
                   wLevel: word;

                   #doc
                   Ссылка на вышестоящую стройку
                   #end
                   cStroy: tNRec;

                   #doc
                   Ссылка на созданный объект (возвращаемое значение)
                   #end
                   var cRec: tNRec ):
                                      #doc
                                      Код ошибки. 0 в случае успешной вставки нового объекта строительства.
                                      #end
                                      word;

  #doc
  Редактирование заданного объекта
  #end
  Procedure EditObj(
                     #doc
                     Выдавать ли сообщение в случае ошибки
                     #end
                     bMessage: boolean;

                     #doc
                     Ссылка на редактируемый объект
                     #end
                     cKatStroy: comp );

  #doc
  Смена владельца
  #end
  Function ChangeNode(
                       #doc
                       Выдавать ли сообщение в случае ошибки
                       #end
                       bMessage: boolean;

                       #doc
                       Ссылка на объект, который надо привязать к другому элементу
                       #end
                       cKatStroy: comp;

                       #doc
                       Ссылка на нового родителя
                       #end
                       cStroy: comp ):
                                        #doc
                                        Код ошибки. 0 в случае успешной смены владельца.
                                        #end
                                        word;

  #doc
  Позиционирование на заданный объект
  #end
  Function SelectTreeObj(
                          #doc
                          Ссылка на объект, на который нужно спозиционироваться
                          #end
                          cKatStroy: comp ):
                                             #doc
                                             Успешность позиционирования на заданный объект
                                             #end
                                             boolean;

  #doc
  Проверка возможности удаления заданного объекта со всеми подчиненными
  #end
  Function CanDelete(
                      #doc
                      Выдавать ли сообщение в случае ошибки
                      #end
                      bMessage: boolean;

                      #doc
                      Ссылка на объект, который надо удалить
                      #end
                      cKatStroy: comp ):
                                         #doc
                                         Код ошибки. 0 если удаление разрешено
                                         #end
                                         word;

  #doc
  Удаление заданного объекта со всеми подчиненными
  #end
  Function DeleteObj(
                      #doc
                      Выдавать ли сообщение в случае ошибки
                      #end
                      bMessage: boolean;

                      #doc
                      Запрашивать ли подтверждение перед удалением
                      #end
                      bConfirm: boolean;

                      #doc
                      Ссылка на объект, который надо удалить
                      #end
                      cKatStroy: comp ):
                                         #doc
                                         Код ошибки. 0 в случае успешного удаления
                                         #end
                                         word;

  #doc
  Описание ошибки</brief>
  <br>Ниже приведен список констант ошибок и текстовых описаний им соответствующих<br>
  <ul>
  <li><i>cgError_Name</i> - Не задано наименование объекта строительства
  <li><i>cgError_Edit</i> - Вы не имеете права редактировать каталог по настройке
  <li><i>cgError_BadRec</i> - Некорректная ссылка на объект строительства
  <li><i>cgError_Format</i> - В текущем окне/представлении удаление объекта невозможно
  <li><i>cgError_State</i> - Вы не имеете права редактировать объект в текущем состоянии по настройке прав доступа к документам
  <li><i>cgError_Status</i> - Вы не имеете права редактировать объект в текущем статусе по настройке прав доступа к документам
  <li><i>cgError_SelfObj</i> - Выбран тот же объект
  <li><i>cgError_SelfNode</i> - Не допускается выбор объекта, входящего в состав текущего
  <li><i>cgError_Level</i> - У вышестоящего объекта класс такой же или больший
  <li><i>cgError_Docs</i> - У объекта (или стройки) есть привязанные документы или планы
  <li><i>cgError_KillPlan</i> - Ошибка удаления спецификаций планов капстроительства
  <li><i>cgError_AttrObj</i> - Вы не имеете права модифицировать атрибуты объекта при наличии привязанных документов
  </ul>
  #end
  Function GetError(
                     #doc
                     Код ошибки
                     #end
                     wError: word ):
                                     #doc
                                     Текстовое описание ошибки
                                     #end
                                     string;

end;

VipInterface KatStroy
  implements KatStroyObj1, KatStroyObj2
  licensed (FREE)
  Parameters ( nRecObj: comp; Enter: boolean; cRec: comp; WasDelOrEdit, OkMany, OkStroy: boolean );

ExtensionPoint epCreateKatStroy (TR : KatStroyObj2);

#end // __KatStroy_vih__