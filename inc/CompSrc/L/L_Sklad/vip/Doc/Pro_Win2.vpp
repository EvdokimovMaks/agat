!//********************************************************************************
//                                                        (c) корпорация Галактика
// Галактика 7.12 - логистика - склад - для obj-функции выбора ордеров
// he для окна со списком складских ордеров для выбора
//********************************************************************************
#define pro_win2

#doc
Выбор ордеров
#end
Window PickOrders 'Выбор ордеров' EscClose, Cyan;
  Show at (,,110,31);

#include pro_win.vpp  // браузы

HandleEvent

cmInit:
{
//  begdate    := dGetTune('User.dFilter1');
//  endDate    := dGetTune('User.dFilter2');
//  VOrd 0 -приходные, 1 -расходные

  if (VOrd = 0)
    if ( boGetTune('User.UseFilter') = TRUE )
      SetWindowTitle(PickOrders, 'Выбор приходных ордеров c '+ String(dGetTune('User.dFilter1')) + ' по ' + string(dGetTune('User.dFilter2')) );
    else
      SetWindowTitle(PickOrders, 'Выбор приходных ордеров');

  if (VOrd = 1)
    if ( boGetTune('User.UseFilter') = TRUE )
      SetWindowTitle(PickOrders, 'Выбор расходных ордеров c '+ String(dGetTune('User.dFilter1')) + ' по ' + string(dGetTune('User.dFilter2')) );
    else
      SetWindowTitle(PickOrders, 'Выбор расходных ордеров');
}

cmDefault:
 if pickOrder_regim
   {
     wasPickSklOrder:= true;
     if GetFirst PickSklOrder where ((constPickSklOrder == PickSklOrder.wList)) <>tsOk
      { PickSklOrder.wList:= constPickSklOrder;
        PickSklOrder.cRec := SklOrder.nRec;
        PickSklOrder.nRec := 0;
        insert current PickSklOrder;
      }
     CloseInterface(cmDefault);
   }

cmMarkUnMark:
 {
   if isValid(#PickSklOrder)
     delete current PickSklOrder;
   else
    {
      PickSklOrder.wList := constPickSklOrder;
      PickSklOrder.cRec  := SklOrder.nRec;
      PickSklOrder.nRec  := 0;
      insert current PickSklOrder;
    }

   RedrawCurrentAndGo(GetCurrentFormat, true);
 }

cmSelectAll:  //[+]Все
  {
    delete PickSklOrder where ((constPickSklOrder == PickSklOrder.wList));
    PushPos(#SklOrder);
    StartNewVisual(vtRotateVisual, vfTimer, 'Помечаю записи', 1);
    _LOOP SklOrder
    {
      NextVisual;

      PickSklOrder.wList := constPickSklOrder;
      PickSklOrder.cRec  := SklOrder.nRec;
      PickSklOrder.nRec  := 0;
      insert current PickSklOrder;
    }
    StopVisual('',0);
    PopPos(#SklOrder);
    ReScanPanel(#SklOrder);
    ReDrawPanel(#SklOrder);
    RereadRecord(#SklOrder);
  }

cmUnSelectAll:  //[-]Снять
  {
    if (delete PickSklOrder where ((constPickSklOrder == PickSklOrder.wList))=tsOK){}
    ReScanPanel(#SklOrder);
    ReDrawPanel(#SklOrder);
  }

end;// he
end; // W
//********************************************************************************
