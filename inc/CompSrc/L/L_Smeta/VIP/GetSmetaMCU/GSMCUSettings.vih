//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 8.10
// Параметры интерфейса выбора МЦ/Услуг из смет
//------------------------------------------------------------------------------
#ifndef _GSMCUSettings_vih_
#define _GSMCUSettings_vih_

#include ICompList.vih // Объектный интерфейс для списков значений типа comp

#ifdef ComponentVersion
 #component "L_Smeta"
#end

const
  // Идентификаторы свойств, используемые при генерации события EventSettingChanged,
  // которые определяют, какое свойство изменилось.
  GSMCU_FIRST_PROPERTY_ID         = 1; // значение д.б. равно минимальному значению идентификаторов
  GSMCU_CHECK_REMAINS_ID          = 1;
  GSMCU_MARK_ONE_RES_ID           = 2;
  GSMCU_SHOW_REMAINS_ID           = 3;
  GSMCU_SHOW_REMAINS_READONLY_ID  = 4;
  GSMCU_OBJECTS_FILTER_ID         = 5;
  GSMCU_INDEPEND_MARK_PART_JOB_ID = 6;
  GSMCU_MARK_JOBS_ONLY_ID         = 7;
  GSMCU_APPLY_KOEF_JOB_ID         = 8;
  GSMCU_SHOW_NRANDSP_ID           = 9;
  GSMCU_ADD_NULL_PRICE_ID         = 10;
  GSMCU_LAST_PROPERTY_ID          = 10; // значение д.б. равно максимальному значению идентификаторов

  FLAG_CHECK_REMAINS          = 0000001b; // контроль текущих остатков МЦ
  FLAG_MARK_ONE_RES           = 0000010b; // одиночная пометка ресурса
  FLAG_SHOW_REMAINS           = 0000100b; // показывать текущие остатки МЦ
  FLAG_INDEPEND_MARK_PART_JOB = 0001000b; // независимая пометка разделов/работ
  FLAG_APPLY_KOEF_JOB         = 0010000b; // учитывать коэффициенты по работе
  FLAG_SHOW_NRANDSP           = 0100000b; // показывать накладные расходы и сметную прибыль
  FLAG_ADD_NULL_PRICE         = 1000000b; // не добавлять ресурсы с нулевой расценкой
  FLAG_NONE                   = 0000000b; // ни один из флагов не установлен
end;

// Параметры интерфейса выбора МЦ/Услуг из смет.
// При попытке изменения свойства checkRemains при установленном флаге checkRemainsReadOnly генерируется исключение
// ExReadOnly. Аналогично при попытке изменения objectsFilter, если objectsFilter.isReadOnly = true.
private objinterface IGSMCUSettings;
  property checkRemains:         boolean     read write; // флаг "контроль текущих остатков"
  property markOneRes:           boolean     read write; // флаг "одиночная пометка ресурса"
  property showRemains:          boolean     read write; // флаг "показывать текущие остатки"
  property applyKoefJob:         boolean     read write; // флаг "учитывать коэффициенты по работе"
  property showNRandSP:          boolean     read write; // флаг "показывать накладные расходы и сметную прибыль"
  property addNullPrice:         boolean     read write; // флаг "не добавлять ресурсы с нулевой расценкой"
  property checkRemainsReadOnly: boolean     read;       // является ли флаг "контроль текущих остатков" доступным только на чтение
  property showRemainsReadOnly:  boolean     read;       // является ли флаг "показывать остатки" доступным только на чтение
  property objectsFilter:        ICompListEx read;       // список объектов для фильтра. если список пуст - фильтр не нужен
  property independMarkPartJob:  boolean     read write; // флаг "независимая пометка разделов/работ"
  property independMarkPartJobReadOnly: boolean read;    // является ли флаг "независимая пометка разделов/работ" доступным только на чтение
  property shouldPutPartsIntoPick:      boolean read;    // следует ли добавлять помеченные разделы в таблицу PickSmeta
  property markJobsOnly:         boolean     read;       // интерфейс работает в режиме пометки только работ и их ресурсов

  property strDocType:           string      read; // текущий строковый тип документа
  property objectsType:          word        read; // текущий тип отображаемых при выборе объектов. См. константы GSMCU_OBJ_TYPE_*
  property controlVolumesForAVR: boolean     read; // Контролировать объемы при выборе из смет для актов выполненных работ
  property modified:             boolean     read; // состояние параметров с момента последней загрузки/сохранения

  procedure LoadSettings; // Загрузка сохраненных параметров.
  procedure SaveSettings; // Сохранение параметров
  procedure ShowSetupDialog; // Отображает диалог настройки параметров

  // событие генерируется при изменении свойств (в т.ч. списка объектов для фильтра)
  event procedure EventSettingChanged(_propertyId: word);
end;

private vipinterface GSMCUSettings implements IGSMCUSettings licensed(free);
public:
  constructor Init;
  constructor InitWithOptions(_strDocType: string; _objectsType: word; _object: comp; _forceRemainsMode: word; _workMode: word);
end;

#end
