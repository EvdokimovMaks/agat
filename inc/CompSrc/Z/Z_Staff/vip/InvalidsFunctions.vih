//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика ERP 8.1 - Управление персоналом
// Обработка документов по инвалидности (Passports.SysCode = 560)
//------------------------------------------------------------------------------

#ifndef _InvalidsFunctions_INCLUDED_
#define _InvalidsFunctions_INCLUDED_

#component "Z_Staff"

//******************************************************************************
#doc
Обработка документов по инвалидности (Passports.SysCode = 560)</brief>.
Предполагается, что на каждый момент времени может быть только один действующий документ по инвалидности.
#end
ObjInterface IInvalidsFunctions;

   #doc
   Ссылка на актуальный на заданную дату документ, подтверждающий инвалидность
   #end
   function GetnRecActualDoc(Person: comp // #docl Ссылка на сотрудника
                           ; Our_Date: date // #docl Дата, на которую ищем актуальный документ
                            ): comp; // #docl Ссылка на документ (Passports.NRec)

   #doc
   Является ли документ по инвалидности актуальным на заданную дату
   #end
   function CheckDocOnDate(NrecDoc: comp // #docl Ссылка на документ
                         ; Our_Date: date // #docl дата проверки
                          ): boolean;

   #doc
   Получить величину группы инвалидности по nRec документа по инвалидности</brief>.
   Работает только для документов, введенных в версии 8.1
   #end
   function GetNumGrInv(NrecDoc: comp): string[20];

   #doc
   Получить строковую расшифровку группы инвалидности по nRec документа по инвалидности</brief>.
   Работает только для документов, введенных в версии 8.1
   #end
   function GetStringGrInv(NrecDoc: comp): string[100];

end;

//******************************************************************************
#doc
Расширение №1 интерфейса IInvalidsFunctions
#end
ObjInterface IInvalidsFunctions2;

  #doc
  Поиск документа по инвалидности в заданном периоде
  #end
  function GetnRecInPeriod(Person: comp // #docl Ссылка на сотрудника
                         ; BeginPeriodDate: date // #docl Начало периода
                         ; EndPeriodDate: date // #docl Конец периода
                           #doc
                           Как обходить</brief>:<br>
                           -1 - берем дату EndPeriodDate и движемся последовательно к дате BeginPeriodDate<br>
                           0 - берем последовательно дату BeginPeriodDate, EndPeriodDate и никуда не движемся,
                           если ни на одной из них не обнаружили подходящего документа по инвалидности. Если
                           нашли на BeginPeriodDate, то EndPeriodDate уже не будет обрабатываться<br>
                           1 - берем дату BeginPeriodDate и пойдем к дате EndPeriodDate, пытаясь найти документ,
                           актуальный в этот промежуток времени
                           #end
                         ; TypeStep: integer
                          ): comp;

//------------------------------------------------------------------------------
// а это все методы по доставанию значений (характеристик) документа. Если будет
// в качестве входящего параметра передан 0, то будет считаться, что надо вытянуть
// для текущего, т.е. полученного функциями позиционирования GetnRecActualDoc, GetnRecInPeriod.
// Заметим, что здесь уже не обязательно должны быть только документы по инвалидности.
// Можно использовать для любых - просто передавать Nrec требуемого документа
  #doc
  Серия указанного документа (не только документа по инвалидности)
  #end
  function GetSer(
                  #doc
                  Ссылка на документ</brief>.
                  Если 0, то вернет атрибут актуального документа по инвалидности,
                  предварительно найденного методами GetnRecActualDoc или GetnRecInPeriod.
                  #end
                  NrecDoc: comp
                 ): string[20];

  #doc
  Дата выдачи (начало действия) документа
  #end
  function GetGivenDate(
                  #doc
                  Ссылка на документ</brief>.
                  Если 0, то вернет атрибут актуального документа по инвалидности,
                  предварительно найденного методами GetnRecActualDoc или GetnRecInPeriod.
                  #end
                  NrecDoc: comp
                 ): date;

  #doc
  Номер документа
  #end
  function GetNmb(
                  #doc
                  Ссылка на документ</brief>.
                  Если 0, то вернет атрибут актуального документа по инвалидности,
                  предварительно найденного методами GetnRecActualDoc или GetnRecInPeriod.
                  #end
                  NrecDoc: comp
                 ): string[20];

  #doc
  Кем выдан документ
  #end
  function GetGivenBy(
                  #doc
                  Ссылка на документ</brief>.
                  Если 0, то вернет атрибут актуального документа по инвалидности,
                  предварительно найденного методами GetnRecActualDoc или GetnRecInPeriod.
                  #end
                  NrecDoc: comp
                 ): string[100];

  #doc
  "Код подразделения" документа
  #end
  function GetGivenPodr(
                  #doc
                  Ссылка на документ</brief>.
                  Если 0, то вернет атрибут актуального документа по инвалидности,
                  предварительно найденного методами GetnRecActualDoc или GetnRecInPeriod.
                  #end
                  NrecDoc: comp
                 ): string[20];

  #doc
  Дата окончания (срок действия) документа
  #end
  function GetToDate(
                  #doc
                  Ссылка на документ</brief>.
                  Если 0, то вернет атрибут актуального документа по инвалидности,
                  предварительно найденного методами GetnRecActualDoc или GetnRecInPeriod.
                  #end
                  NrecDoc: comp
                 ): date;

  #doc
  Значение поля LastUser заданного документа
  #end
  function GetLastUser(
                  #doc
                  Ссылка на документ</brief>.
                  Если 0, то вернет атрибут актуального документа по инвалидности,
                  предварительно найденного методами GetnRecActualDoc или GetnRecInPeriod.
                  #end
                  NrecDoc: comp
                 ): string[20];

end;

#doc
Расширение №2 интерфейса IInvalidsFunctions
#end
ObjInterface IInvalidsFunctions3;

  #doc
  Создание основного персонального отпуска на время действия документа об инвалидности и
  корректировка существующих персональных отпусков
  #end
  procedure ReFormPersVacByInvalidDoc(NRecDoc : comp);

end;

#doc
Расширение №3 интерфейса IInvalidsFunctions
#end
ObjInterface IInvalidsFunctionsExt3;

  #doc
  Проверка группы инвалидности в карточке сотрудника. Корректировка, если не совпадает.
  #end
  function CheckGrpInCard(_PersNrec: comp // #docl Ссылка на сотрудника
                        ; _Silently: boolean // #docl Не выдавать запрос
                         ): comp;

end;

#doc
Расширение №4 интерфейса IInvalidsFunctions
#end
ObjInterface IInvalidsFunctionsExt4;

  #doc
  Проверка группы инвалидности по всем сотрудникам. Корректировка, если не совпадает.
  #end
  procedure CheckGrpInv;

  #doc
  Получить величину группы инвалидности для сотрудника</brief>.
  #end
  function GetNumGrInvOnDate(PsnNRec : comp; OnDate : date): string[20];

  #doc
  Получить строковую расшифровку группы инвалидности для сотрудника</brief>.
  #end
  function GetStringGrInvOnDate(PsnNRec : comp; OnDate : date): string[100];
end;


//******************************************************************************
VipInterface InvalidsFunctions
  implements IInvalidsFunctions, IInvalidsFunctions2, IInvalidsFunctions3, IInvalidsFunctionsExt3,
             IInvalidsFunctionsExt4
  licensed (free);

#end
