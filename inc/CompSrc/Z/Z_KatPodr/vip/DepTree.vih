//------------------------------------------------------------------------------
//                                                      (с) корпорация Галактика
// Галактика 5.8 - Заработная плата
// obj-интерфейс обхода иерархии подразделений с учетом зарплатных настроек
// (показывать склады, разграничение прав доступа к подразделениям)
//------------------------------------------------------------------------------

#ifndef _DepTree_vih_INCLUDED_
#define _DepTree_vih_INCLUDED_

#include IDepartmentValidator.obj

#declare TypicalDepartmentListStructure(StructureName)
  table struct #StructureName
  (
    NREC:       comp, // исходный номер записи подразделения
    CPARENT:    comp, // текущий родитель узла
    CROOT:      comp, // реальный родитель узла
    NAME:       string[80],
    CODE:       string[20],
    WAREHOUSE:  word, // признак склада
    LEAF:       boolean  // признак листа
  )
  with index
  (
    #(StructureName)00 = NREC(surrogate)
    , #(StructureName)01 = CPARENT + NAME
    , #(StructureName)02 = CPARENT + CODE
    , #(StructureName)03 = CROOT
  );
#end

#ifdef ComponentVersion
  #component "z_katpodr"
#end

#ifdef ComponentVersionInDict
  #component "Z_Katpodr"
  #include IKATPODR.VIH
  public type TKatPodr = record as table KATPODR;
#else
  type TKatPodr = record as table KATPODR;
#end

// итератор по подразделениям
objinterface IDepartmentIterator;
  procedure IterateDepartments(StartingDepartment: comp; Flags: word);
  event function CollectDepartment(B: TKatPodr): boolean;
end;

// расширенный итератор по подразделениям
objinterface IDepartmentIteratorEx;
  procedure SetExtended(Extended: boolean);
  procedure SetUserName(Value: string);
  event function CollectDepartmentEx(B: TKatPodr; Disabled: boolean): boolean;
end;

vipinterface
  DepartmentIterator
implements
  IDepartmentIterator,
  IDepartmentIteratorEx,
  IDepartmentValidatorEquipped
#ifdef ATL51
  licensed(Free)
#end
;

#end

