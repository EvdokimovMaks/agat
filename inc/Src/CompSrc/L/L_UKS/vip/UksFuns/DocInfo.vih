//------------------------------------------------------------------------------
//                                            (c) 1994,2010 корпорация Галактика
// Галактика 8.10 - Контур логистики. Модуль "L_UKS".
// Сервисные функции для получения информации по различным документам.
//------------------------------------------------------------------------------

#ifndef __DocInfo_vih__
#define __DocInfo_vih__

#component "L_UKS"

#doc
Сервисные функции для получения информации по различным документам.</brief>

<p>Константы, определенные в заголовочном файле интерфейса:<br>

<p>NO_TABLE - Это значение возвращает функция GetDocTableByTiDk, если таблица не найдена.

<p>mdNoTable_Specific, mdSpSchem_Specific<br> - Модификаторы режимов работы функций (параметр _mode).<br>
Дело в том, что получая данные о TiDk и cDoc из различных таблиц, там иногда содержатся специфичная
информация.<br>
  Так, в таблице SpSchem для платежных документов, актов взаимозачетов в SpSchem.cDoc хранится ссылка
на таблицу BaseFin, а не PlPor. Для векселей и кредитов - ссылка на BaseFin, а не coAppVeks.<br>
  Чтобы избавить от анализа таких документов вызывающий код, я добавил эти модификаторы. Например, если
вы ходите получить информацию о документе по таблице SpSchem, делаем вызов
GetExDocInfoByTiDk( SpSchem.TiDk, SpSchem.cDoc, mdSpSchem_Specific )<br>
  Для остальных случаев режим можно не указывать, т.к. параметр _mode имеет значение по умолчанию
mdNoTable_Specific и является необязательным.<br>

<p> Все функции GetXxxxInfo в качестве параметра _cDoc принимают ссылку на искомый документ.<br>
Параметр _docInfo является возвращаемым. В результате работы функции содержит информацию об указанном
документе, либо сообщение, что документ не найден.<br>
Параметр _cFilial является возвращаемым и содержит ссылку на филиал. Если документ не филиальный, или филиал
не задан - возвращает 0.<br>
  Функции возвращают tsOk - если документ найден, в противном случае tsNotFound, либо другой код ошибки,
возвращаемый оператором GetFirst.<br>
#end

const
  NO_TABLE = 0; // см. описание констант выше
  mdNoTable_Specific = 0; // см. описание констант выше
  mdSpSchem_Specific = 1; // см. описание констант выше
end;

ObjInterface objDocInfo;

  #doc
  <brief>Получить информацию о договоре из таблицы Dogovor</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetDogovorInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию о ПКП из таблицы CalPlan</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetPkpInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию о ДО и пр. документам из таблицы BaseDoc</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetBaseDocInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию по накладным и актам из таблицы KatSopr</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetSoprDocInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию об актах изменения целевого назначения МТР (таблица MtrAkt).</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetMtrAktInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию о документе из таблицы BaseFin (платежные док-ты, АВЗ, векселя, кредиты).</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetBaseFinInfo(  _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию о документе из таблицы PlPor (платежные док-ты, АВЗ)</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetPlatDocInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию о документе из таблицы AppVeks (векселя и кредиты)</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetAppVeksInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию о документе из таблицы SklOrder (ордера).</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetSklOrderInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию о документе из таблицы SchFact (счета-фактуры, налоговые накладные).</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetSchFactInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию о документе из таблицы PlanVar (вариант плана строительства).</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetPlanVarInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить информацию о документе из таблицы VvStroy (ввод строительства в эксплуатацию, передача объектов инвестору).</brief>
  Описание параметров см. в описании интерфейса.
  #end
  function GetVvStroyInfo( _cDoc: comp; var _docInfo: string; var _cFilial: comp ): word;

  #doc
  <brief>Получить код таблицы документа, соответствующей общесистемному коду документа.</brief>
  #end
  function GetDocTableByTiDk(
    _tiDk: word; // #docl Общесистемный код документа.
    #doc
    Необязательный параметр. Модификатор режима работы функции. См. описание констант mdXXX_Specific
    в заголовочном файле интерфейса.
    #end
    _mode: word = mdNoTable_Specific
  #doc
  Возвращает код таблицы документа, соответствующей общесистемному коду документа, или константу NO_TABLE,
  если таблица не найдена (см. описание констант в заголовочном файле интерфейса).
  #end
  ): word;

  #doc
  <brief>Получить информацию о документе (обычно: номер, дата).</brief>
  #end
  function GetDocInfoByTable(
    _coTable: word; // #docl Код таблицы искомого документа (например, coKatSopr).
    _cDoc: comp;    // #docl Cсылка на документ (номер записи в указанной таблице).

    #doc
    <b>Возвращаемый параметр</b>. Информация о документе. Если документ не найден, параметр содержит
    соответствующее сообщение. В случае ошибки, параметр содержит сообщение о том, что функционал по
    указанной таблице не реализован.
    #end
    var _docInfo: string;

    #doc
    <b>Возвращаемый параметр</b>. Ссылка на филиал. Если документ не филиальный, или филиал не задан возвращает 0.
    #end
    var _cFilial: comp

  #doc
  tsOk - документ найден, tsNotFound - не найден.<br>
  Если получение информации по указанному документу не реализовано в функции, вернется tsIOError
  и сообщение в _docInfo, о том, что метод получения информации для указанной таблицы не реализован.
  #end
  ): word;

  #doc
  <brief>Проверка существования указанного документа.</brief>
  #end
  function DocExists(
    _tiDk: word; _cDoc: // #docl Общесистемный код документа.

    #doc
    Необязательный параметр. Модификатор режима работы функции. См. описание констант mdXXX_Specific
    в заголовочном файле интерфейса.
    #end
    comp; _mode: word = mdNoTable_Specific
  #doc
  tsOk - если документ найден<br>
  tsNotFound - если документ не найден<br>
  tsIOError  - если поиск указанного документа не реализован (ну или при реальной ошибке ввода/вывода)<br>
  #end
  ): word;


  #doc
  <brief>Получить наименование филиала.</brief>
  #end
  function GetFilialName(
    _cFilial: comp; // #docl Ссылка на филиал ( номер записи в таблице Filials ).
    #doc
    <b>Возвращаемый параметр</b>. Наименование филиала.
    Если филиал не найден - содержит сообщение <филиал не найден>.
    #end
    var _filialName: string
  #doc
  tsOk - если документ найден<br>
  tsNotFound - если документ не найден<br>
  Либо другой код ошибки, который возвращает функция GetFirst.<br>
  #end
  ): word;

  #doc
  <brief>Получить информацию о документе по общесистемному коду документа</brief>
  Обычно: наименование документа, номер документа, дата документа. Для некоторых документов информация
  может отличаться, либо быть полнее, чтобы однозначно идентифицировать документ.
  #end
  function GetExDocInfoByTiDk(
    _tiDk: word; // #docl Общесистемный код документа.
    _cDoc: comp; // #docl Ссылка на документ (номер записи).
    #doc
    <b>Возвращаемый параметр</b>. Информация о документе. Если документ не найден, параметр содержит
    соответствующее сообщение. В случае ошибки, параметр содержит сообщение о том, что функционал по
    указанной таблице не реализован.
    #end
    var _docInfo: string;
    #doc
    <b>Возвращаемый параметр</b>. Ссылка на филиал. Если документ не филиальный, или филиал не задан возвращает 0.
    #end
    var _cFilial: comp;
    #doc
    Необязательный параметр. Модификатор режима работы функции. См. описание констант mdXXX_Specific
    в заголовочном файле интерфейса.
    #end
    _mode: word = mdNoTable_Specific
  #doc
  tsOk - документ найден, tsNotFound - не найден.<br>
  Если получение информации по указанному документу не реализовано в функции, вернется tsIOError
  и сообщение в _docInfo, о том, что метод получения информации для указанной таблицы не реализован.
  Могут быть и другие коды ошибок, которые в состоянии вернуть оператор GetFirst.
  #end
  ): word;

  #doc
  Является ли указанный тип сопроводительного документа (документ на таблице KatSopr)
  - документом УКС (и только УКС).
  #end;
  function IsSoprDocUksOnly(
    _vidSopr: word // #docl Тип сопроводительного документа (KatSopr.VidSopr, SpSopr.VidSopr).
  ): boolean;      // #docl Возвращает TRUE, если указанный сопроводительный документ является документом УКС и только.

  #doc
  Является ли указанный тип документа - документом УКС и только.
  #end
  function IsDocUksOnly(
    _coTable: word; // #docl Код таблицы искомого документа (например, coKatSopr).
    _cDoc: comp     // #docl Cсылка на документ (номер записи).
  ): boolean;       // #docl Возвращает TRUE, если указанный документ является документом УКС и только.
end;

VipInterface DocInfo
  implements objDocInfo
  licensed(free);

#endif
