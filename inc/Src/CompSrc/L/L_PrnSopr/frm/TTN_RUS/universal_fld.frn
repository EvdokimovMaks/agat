!Поля для универсального передаточного документа (universal.rtf)
.function IsNullEI: boolean;
begin
  result := (boGetTune('Doc.SD.Prn.UPD.LineNullEI')) and ((CodeOtpEd = '') or (CodeOtpEd = '-'));
end.
.fields
  Ean13ToEanGnivcTTF(GenerateBarCodeEx(coKatSopr, накладная_нрек))
  oPrnSoprFun.GetSchFactNum (накладная_нрек)
  oPrnSoprFun.GetSchFactDate(накладная_нрек)
  '@'   //символ в конце строки "Приложение №1 к письму ФНС России от 21.10.2013 г. № ММВ-20-3/96@"
#ifdef _UNIVERSALv2_
    if (СчФакт_НРек <> 0, oPrnSoprFun.GetSchFactIsp(СчФакт_НРек, 2), '-')
    if (СчФакт_НРек <> 0 and oPrnSoprFun.GetSchFactIsp(СчФакт_НРек, 2) <> '-', oPrnSoprFun.GetSchFactIsp(СчФакт_НРек, 3), '-')
#else
  #ifndef _UNIVERSAL02_
    if (СчФакт_НРек <> 0, oPrnSoprFun.GetSchFactIsp(СчФакт_НРек, 0), '-')
    if (СчФакт_НРек <> 0 and oPrnSoprFun.GetSchFactIsp(СчФакт_НРек, 0) <> '-', oPrnSoprFun.GetSchFactIsp(СчФакт_НРек, 1), '-')
  #end
#end
  //продавец
  if (СчФакт_НРек <> 0, oPrnSoprFun.GetOrgFullName(oPrnSoprFun.GetSchFactOrgNRec(СчФакт_НРек, 0), 8, 0, Дата), (oPrnSoprFun.GetOrgFullName(накладная_нрек, 0, 1) + oPrnSoprFun.GetOrgFullName(накладная_нрек, 0, 2)))
  LTrim(LTrim(if (СчФакт_НРек <> 0, oPrnSoprFun.GetSchFactOrgAddr(СчФакт_НРек, 0), #AdrFieldsUrUPD(Поставщик,Поставщик_СТАРАНА_КОД)), ','), ' ')

  if (СчФакт_НРек <> 0, '1', '2')

  if (СчФакт_НРек <> 0, oPrnSoprFun.GetSchFactOrgUNN(СчФакт_НРек, 0), (ПоставщикУНН + ' / ' + ПоставщикКПП))
  //грузоотправитель
  if (СчФакт_НРек <> 0, if (Признак_МЦ <> 2, if(oPrnSoprFun.GetSchFactOrgNRec(СчФакт_НРек, 0) <> oPrnSoprFun.GetSchFactOrgNRec(СчФакт_НРек, 2),
                                                                                                 oPrnSoprFun.GetOrgFullName(oPrnSoprFun.GetSchFactOrgNRec(СчФакт_НРек, 2), 8, 0, Дата), 'он же'), '-'),
                        if (Признак_МЦ <> 2, (oPrnSoprFun.GetOrgFullName(накладная_нрек, 1, 1) + oPrnSoprFun.GetOrgFullName(накладная_нрек, 1, 2)), '-'))
  if (СчФакт_НРек <> 0, if (Признак_МЦ <> 2, if(oPrnSoprFun.GetSchFactOrgNRec(СчФакт_НРек, 0) <> oPrnSoprFun.GetSchFactOrgNRec(СчФакт_НРек, 2),
                                                                                                 oPrnSoprFun.GetSchFactOrgAddr(СчФакт_НРек, 2), ''), ''),
                        if (Признак_МЦ <> 2, #AdrFields(Грузоотправитель,Грузоотправитель_СТАРАНА_КОД), ''))
  //грузополучатель
  if (СчФакт_НРек <> 0, if (Признак_МЦ <> 2, oPrnSoprFun.GetOrgFullName(oPrnSoprFun.GetSchFactOrgNRec(СчФакт_НРек, 3), 8, 0, Дата), '-'),
                        if (Признак_МЦ <> 2, (oPrnSoprFun.GetOrgFullName(накладная_нрек, 2, 1) + oPrnSoprFun.GetOrgFullName(накладная_нрек, 2, 2)), '-'))
  if (СчФакт_НРек <> 0, if (Признак_МЦ <> 2, oPrnSoprFun.GetSchFactOrgAddr(СчФакт_НРек, 3), ''),
                        if (Признак_МЦ <> 2, #AdrFields(Грузополучатель,Грузополучатель_СТАРАНА_КОД), ''))

  if (oPrnSoprFun.FindPlat(СчФакт_НРек)<>'', oPrnSoprFun.FindPlat(СчФакт_НРек), '№ - от -')

  //покупатель
  if (СчФакт_НРек <> 0, oPrnSoprFun.GetOrgFullName(oPrnSoprFun.GetSchFactOrgNRec(СчФакт_НРек, 1), 8, 0, Дата), (oPrnSoprFun.GetOrgFullName(накладная_нрек, 3, 1) + oPrnSoprFun.GetOrgFullName(накладная_нрек, 3, 2)))
  LTrim(LTrim(if (СчФакт_НРек <> 0, oPrnSoprFun.GetSchFactOrgAddr(СчФакт_НРек, 1), #AdrFieldsUrUPD(Получатель,Получатель_СТАРАНА_КОД)), ','), ' ')
  if (СчФакт_НРек <> 0, oPrnSoprFun.GetSchFactOrgUNN(СчФакт_НРек, 1), (ПолучательУНН + ' / ' + ГрузополучательКПП))   //ПИР 101.58197

  //Валюта: наименование, код
  if (oPrnSoprFun.GetValName(Валюта_нрек) = '', Trim(sGetTune('Nalog.Rus.NDE_FullName')), oPrnSoprFun.GetValNameUPD(Валюта_нрек))
  if (oPrnSoprFun.GetValCode(Валюта_нрек) = '', sGetTune('NDE.RUBLISO') , oPrnSoprFun.GetValCode(Валюта_нрек))
#ifndef _UNIVERSAL02_
  oPrnSoprFun.GetFullIGKEx(накладная_нрек, СчФакт_НРек)
#end

  Nom
  КодМЦ
  Название
#ifdef _UNIVERSAL_
  if (ТНВЭД ='', '-', ТНВЭД)
#end
#ifdef _UNIVERSALv2_
  if (ТНВЭД ='', '-', ТНВЭД)
#end
  if (CodeOtpEd ='', '-', CodeOtpEd)
  if (IsNullEI, '-', if (ОтпЕд = '', '-', ОтпЕд)) // 2a
  if (IsNullEI, '-', if(abs(Double(DoubleToStr(КолФ, Kol_Pr)) ) < 0.0001, '-', DoubleToStr(КолФ, Kol_Pr)))  // 3
  if (IsNullEI, '-', if(abs(Double(DoubleToStr(КолФ, Kol_Pr)) ) < 0.0001, '-', if(abs(Double(DoubleToStr((СтНакСН - СтНДСНак) / КолФ, Cena_PrU))) < 0.0001, '-', DoubleToStr((СтНакСН - СтНДСНак)/КолФ, Cena_PrU)))) // 4
  DoubleToStr(СтНакСН - СтНДСНак, Cena_PrU)
  if (ЦАкцизНак <> 0, DoubleToStr(ЦАкцизНак*КолФ, Cena_PrU), 'Без акциза')

  if (oPrnSoprFun.GetSFDopInf(СчФакт_НРек, накладная_нрек), 'НДС исчисляется налоговым агентом',if (ПризнакНДС = word(0), sGetTune('Doc.SD.AbbrField.NoNDSStZero')
                          , if (ставка_первого_налога = 0, sGetTune('Doc.SD.AbbrField.NDSStZero'), DoubleToStr(ставка_первого_налога, NDS_St) + '%')))
  if (oPrnSoprFun.GetSFDopInf(СчФакт_НРек, накладная_нрек), '-',if (ПризнакНДС = word(0), sGetTune('Doc.SD.AbbrField.NoNDSSummZero')
                          , if (СтНДСНак = 0, sGetTune('Doc.SD.AbbrField.NDSSummZero'), DoubleToStr(СтНДСНак, Cena_PrU))))
  if (oPrnSoprFun.GetSFDopInf(СчФакт_НРек, накладная_нрек), '-',DoubleToStr(СтНакСН , Cena_PrU))
  //------------
  if (СчФакт_НРек = 0, '-', oPrnSoprFun.PrnSoprGTD(Признак_МЦ, СчФакт_НРек, спецификацияМЦ_нрек, 0))
  if (СчФакт_НРек = 0, '-', oPrnSoprFun.PrnSoprGTD(Признак_МЦ, СчФакт_НРек, спецификацияМЦ_нрек, 1))
  if (СчФакт_НРек = 0, '-', oPrnSoprFun.PrnSoprGTD(Признак_МЦ, СчФакт_НРек, спецификацияМЦ_нрек, 2))

  //------------ Итоги
  DoubleToStr(Sum1Itog, Cena_PrU)
  if (oPrnSoprFun.GetSFDopInf(СчФакт_НРек, накладная_нрек), '-', DoubleToStr(Sum2Itog, Cena_PrU))
  if (oPrnSoprFun.GetSFDopInf(СчФакт_НРек, накладная_нрек), '-', DoubleToStr(Sum3Itog, Cena_PrU))

  //количество листов
  //if (Nom - 36 > 0 , DoubleToStr(Trunc((Nom - 36)/56) + 2, '666'),'1')
  GetCountPage()

  //------------ Подписи
  //ERP-984 - меняем в Check_IP 1 на 8
  if (oPrnSoprFun.Check_IP(накладная_нрек, 8), '',if(sFIO1 <> '', sFIO1, Директор))
  oPrnSoprFun.GetGlBuhName(накладная_нрек, if(sFIO2 <> '', sFIO2, Главный_бухгалтер))
 // if (НомерДовер <>'' or LongInt(ДатаДовер) <> LongInt(0), 'По доверенности № ' + НомерДовер + DateToStr(ДатаДовер, 'от DD mon YYYYг.'), '')
  if (oPrnSoprFun.Check_IP(накладная_нрек, 8), if(sFIO1 <> '', sFIO1, Директор),'')         //Руководитель для ИП
  if (oPrnSoprFun.Check_IP(накладная_нрек, 8), oPrnSoprFun.Write_IP(накладная_нрек, 8),'')  //Атрибут "Реквизиты ИП"

  oPrnSoprFun.GetOsnovPerUPD(накладная_нрек)

  //Груз передал / услуги, результаты работ, права сдал
  if(sPost4 <> '', sPost4, отпуск_разрешил_должность)
  if(sFIO4  <> '', sFIO4 , отпуск_разрешил)

  //Груз получил / услуги, результаты работ, права принял
  if(sPost6<>'',sPost6, if (НомерДовер  <> '', ДовЛицоДолжность, ''))
  if(sPost6<>'',sFio6 , if (НомерДовер  <> '', ДовЛицо, ''))

  if (Дата_Отгрузки = Date(0,0,0), '', DateToStr(Дата_Отгрузки, 'DD'))
  if (Дата_Отгрузки = Date(0,0,0), '', DateToStr(Дата_Отгрузки, 'Mon'))
  if (Дата_Отгрузки = Date(0,0,0), '', DateToStr(Дата_Отгрузки, 'YY'))

  if (oPrnSoprFun.NumData(накладная_нрек, 0)<> '', 'Транспортная накладная № ' + oPrnSoprFun.NumData(накладная_нрек, 0) + ' от '+ oPrnSoprFun.NumData(накладная_нрек, 1), '')

  //Ответственный за правильность оформления факта хозяйственной жизни
  sPost3
  sFIO3

  //Ответственный за правильность оформления факта хозяйственной жизни (контрагент)
  if(sPost5<>'',sPost5,if (НомерДовер  <> '', '', ДовЛицоДолжность))
  if(sPost5<>'',sFio5 ,if (НомерДовер  <> '', '', ДовЛицо))

  if (СчФакт_НРек <> 0, oPrnSoprFun.GetOrgFullName(oPrnSoprFun.GetSchFactOrgNRec(СчФакт_НРек, 0), 8, 0, Дата), (oPrnSoprFun.GetOrgFullName(накладная_нрек, 0, 1) + oPrnSoprFun.GetOrgFullName(накладная_нрек, 0, 2)))
  if (СчФакт_НРек <> 0, ', ИНН/КПП: ' + oPrnSoprFun.GetSchFactOrgUNN(СчФакт_НРек, 0), (', ИНН/КПП: ' + ПоставщикУНН + ' / ' + ПоставщикКПП))
  if (СчФакт_НРек <> 0, oPrnSoprFun.GetOrgFullName(oPrnSoprFun.GetSchFactOrgNRec(СчФакт_НРек, 1), 8, 0, Дата), (oPrnSoprFun.GetOrgFullName(накладная_нрек, 3, 1) + oPrnSoprFun.GetOrgFullName(накладная_нрек, 3, 2)))
  if (СчФакт_НРек <> 0, ', ИНН/КПП: ' + oPrnSoprFun.GetSchFactOrgUNN(СчФакт_НРек, 3), (', ИНН/КПП: ' + ПолучательУНН + ' / ' + ГрузополучательКПП))

  Спецсимвол
.endfields
