//******************************************************************************
//                                                      (c) корпорация Галактика
// Галактика 8.10 - Логистика
// Объект KatSoprFunc: Общие Функции для работы с документами на таблице KatSopr
//
//******************************************************************************
#ifndef _KatSoprFunc_VIH
#define _KatSoprFunc_VIH

#ifdef ComponentVersion
#component "L_SOPRDOC"
#end

const
  // Идентификаторы для методов доступа к флагам (префикс bf - boolean flag)
  // Используются при вызовах методов IsAvrFlagSet, SetAvrFlag
  bfCalcFactUsed = 0; // флаг "участие документа в расчетах факта"
  bfCurrPriceCalcMethod = 1; // флаг "Метод расчета текущих цен"
end;

Type
  MasVidSopr = array [1..200] of word;

//******************************************************************************
#doc
Общие Функции для работы с документами на таблице KatSopr
#end

ObjInterface objKatSoprFunc;

//******************************************************************************
#doc
Назначение:
  Функция возвращает кол-во позиций в сопроводительном документе

Параметры:
  pKatSopr    - ссылка на KatSopr;
  isOldValue  - True - Если последний раз подсчет проводился для pKatSopr,
                то в качестве числа позиций возьмется предыдущее значение
                False - Выполнится новый подсчет числа позиций для pKatSopr

Возвращает:
  Кол-во позиций в спецификации

#end

Function GetKolPosSpSopr (pKatSopr: comp; isOldValue: boolean): word;

//******************************************************************************
#doc
Назначение:
  проверка существования счета-фактуры или налоговой накладной к сопр.документу

Параметры:
  pRecKatSopr - Буфер сопроводительного документа

Возвращает:
  True - есть ссылка на СФ или НН

#end

Function IsSchfactExist (pRecKatSopr: type$KatSopr): boolean;

//******************************************************************************
#doc
Назначение:
  Возвращает буфер налогового акта

Параметры:
  pRecKatSopr - Буфер сопроводительного документа

Возвращает:
  Буфер налогового акта

#end

Function GetNalAkt (pRecKatSopr: type$KatSopr): type$KatSopr;

//******************************************************************************
#doc
Проверяет, установлен ли указанный флаг в указанном АВР
  Параметры:
    bufKatSopr - буфер записи KatSopr, для которой проверяется флаг
    bFlagId    - идентификатор проверяемого булевого флага
  Возвращает:
    Значение булевого флага
#end

function IsAvrFlagSet( bufKatSopr: type$KatSopr; bFlagId: word ): boolean;

//******************************************************************************
#doc
Устанавливает/сбрасывает указанный флаг для АВР
  Параметры:
    bufKatSopr - буфер записи KatSopr, для которой устанавливается флаг.
    bFlagId    - идентификатор задаваемого булевого флага
    isFlagSet  - булевое значение флага, которое будет установлено
  Примечание: update record для KatSopr, при необходимости, нужно делать в коде,
    вызвавшем данную функцию
#end

procedure SetAvrFlag( var bufKatSopr: type$KatSopr; bFlagId: word; isFlagSet: boolean );

//******************************************************************************
#doc
Назначение:
  Возвращает буфер KatSopr

Параметры:
  pRecKatSopr - ссылка на спецификацию

Возвращает:
  Буфер сопроводительного документа

#end

Function GetKatSopr (pRecKatSopr: comp): type$KatSopr;

//******************************************************************************
#doc
Назначение:
  Возвращает массив системных номеров документов на таблице KatSopr

Параметры:
  pCount   - число элементов массива (возвращаемый)
  pListDoc - массив с системными номерами (возвращаемый)

#end

Procedure GetKatSoprListDoc(var pCount: word; var pListDoc: MasVidSopr);

end;

//******************************************************************************
#doc
Общие Функции для работы с документами на таблице KatSopr
#end

ObjInterface objKatSoprFuncV2(objKatSoprFunc);
//******************************************************************************
#doc
Назначение:
  Определяет дату контроля закрытого периода в сопроводительном документе

Параметры:
  pRecKatSopr - Буфер сопроводительного документа

Возвращает:
  Дата контроля закрытого периода в сопроводительном документе

#end

Function GetDateControlClosePeriod (pRecKatSopr: type$KatSopr): Date;

end;

//******************************************************************************
#doc
Общие Функции для работы с документами на таблице KatSopr
#end

ObjInterface objKatSoprFuncV3(objKatSoprFuncV2);

#doc
Назначение:
  Номер последнего документа в году
#end

Function KatSoprGetLastNumBD(pVidSopr, pYear: word): string;

end;

//******************************************************************************
#doc
Общие Функции для работы с документами на таблице KatSopr
#end

ObjInterface objKatSoprFuncV4(objKatSoprFuncV3);

//******************************************************************************
#doc
Назначение:
  Акт на Прием Материалов по Прих.накладной
#end

Function GetAktPriem(pKatSopr: comp; wADoc: word): comp;

//******************************************************************************
#doc
Назначение:
  Ордера по Акту о приемке материалов
#end

Function MakeOrderAktPriem(pAkt, pNakl: comp): boolean;

end;

//******************************************************************************
#doc
Общие Функции для работы с документами на таблице KatSopr
#end

ObjInterface objKatSoprFuncV5(objKatSoprFuncV4);

//******************************************************************************
#doc
Назначение:
  Отмена создания нового документа

Параметры:
  pRecKatSopr - Буфер сопроводительного документа

#end

Procedure AbortNewDoc(pRecKatSopr: type$KatSopr);

end;

//******************************************************************************

VipInterface iKatSoprFunc implements objKatSoprFuncV5 Licensed (FREE);
#end