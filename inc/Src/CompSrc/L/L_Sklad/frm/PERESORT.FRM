
#include Commission.frn

#doc
Реестр актов на пересортицу
#end
.Form 'PSort'
.Hide
.Fields
#CommissionFields
.EndFields
#CommissionBody(PrintPeresortReestr)
.EndForm

#doc
Реестр актов на пересортицу
#end
.LinkForm 'Reestr' Prototype is 'PSort'
.NameInList 'Реестр актов на пересортицу'
#CommissionLinkVar
#CommissionLinkInit(printPeresortReestr)
.Create View bal_t1
As Select
  Pick.*,
  KatSopr.*,
  SpSopr.*,
  SpSopr2.*,
  KatMC.*,
  KatMC2.*,
  KatEd.*,
  KatEd2.*,
  KatPodr.*,
  KatMol.*,
  KatParty.*,
  KatParty2.*,
  KlVal.*,
  KlVal2.*
From
  Pick,
  KatSopr            (ReadOnly),
  SpSopr             (ReadOnly),
  SpSopr SpSopr2     (ReadOnly),
  KatMC              (ReadOnly),
  KatMC KatMC2       (ReadOnly),
  KatEd              (ReadOnly),
  KatEd KatEd2       (ReadOnly),
  KatPodr            (ReadOnly),
  KatMOL             (ReadOnly),
  KatParty           (ReadOnly),
  KatParty KatParty2 (ReadOnly),
  KlVal              (ReadOnly),
  KlVal KlVal2       (ReadOnly)
Where
     ((
       Word(631)            == Pick.wList         and
       KatSopr.NRec        /== Pick.cRec          and
       Word(630)            == KatSopr.VidSopr    and

       KatSopr.Nrec         == SpSopr.cSopr       and
       KatSopr.Nrec         == SpSopr2.cSopr      and
       Word(0)              == SpSopr.prMC        and
       Word(1)              == SpSopr2.prMC       and

       KatSopr.cPodrFrom    == KatPodr.NRec       and
       KatSopr.cMOLFrom     == KatMOL.NRec        and

       SpSopr.cMCUsl        == KatMC.Nrec         and
       KatMC.cEd            == KatEd.NRec         and
       SpSopr.cVal          == KlVal.NRec         and
       SpSopr.cParty        == KatParty.NRec      and

       SpSopr2.cMCUsl       == KatMC2.Nrec        and
       KatMC2.cEd           == KatEd2.NRec        and
       SpSopr2.cVal         == KlVal2.NRec        and
       SpSopr2.cParty       == KatParty2.NRec
     ))
Order by KatSopr.DSopr, KatSopr.NSopr
;
.Var
Sum1, Sum2, Sum3, Sum4, Itog1, Itog2, Itog3, Itog4 : Double
c1 : Boolean
.EndVar
.Begin
  Itog1 := Itog2 := Itog3 := Itog4 := 0;
End.
.Fields
  CommonFormHeader
  bal_t1.KatSopr.DSopr
  bal_t1.KatSopr.NSopr
  bal_t1.KatPodr.Name
  bal_t1.KatMOL.Name
  bal_t1.KatSopr.Name
  Sum1  Sum3  Sum2  Sum4
  Itog1 Itog3 Itog2 Itog4
.EndFields
 Ш^

                                    РЕЕСТР АКТОВ НА ПЕРЕСОРТИЦУ МАТЕРИАЛЬНЫХ ЦЕННОСТЕЙ

──────────┬──────────┬───────────────┬───────────────┬───────────────┬────────────────┬────────────────┬────────────────┬────────────────
   Дата   │  Номер   │ Подразделение │    МОЛ        │  Примечание   │      Сумма     │Сумма к списанию│Сумма к приходу │Сумма к приходу
          │          │               │               │               │   к списанию   │в базовой валюте│                │в базовой валюте
──────────┴──────────┴───────────────┴───────────────┴───────────────┴────────────────┴────────────────┴────────────────┴──────────────── Ш
.Begin
  c1 := bal_t1.GetFirst KatSopr = 0;
End.
.{While(c1)
.Begin
  Sum1 := Sum2 := Sum3 := Sum4 := 0;

  bal_t1._LOOP SpSopr
    Sum1 += bal_t1.SpSopr.KolFact * bal_t1.SpSopr.Price;
    
  bal_t1._LOOP SpSopr2
    Sum2 += bal_t1.SpSopr2.KolFact * bal_t1.SpSopr2.Price;

  InitGetCur;

  Sum3 := pGetBaseCurrency( 0, Sum1, bal_t1.KatSopr.DSopr );
  Sum4 := pGetBaseCurrency( 0, Sum2, bal_t1.KatSopr.DSopr );

  DoneGetCur;

  Itog1 += Sum1;
  Itog2 += Sum2;
  Itog3 += Sum3;
  Itog4 += Sum4;
End.
 Ш@@@@@@@@@@ @@@@@@@@@@ @@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@ @@@@@@@@@@@@@@@ &'&&&&&&&&&&&.&& &'&&&&&&&&&&&.&& &'&&&&&&&&&&&.&& &'&&&&&&&&&&&.&& Ш
.Begin
  c1 := bal_t1.GetNext KatSopr = 0;
End.
.}
 Ш─────────────────────────────────────────────────────────────────────┬────────────────┬────────────────┬────────────────┬────────────────
 ИТОГО                                                               │ Б&'&&&&&&&&&&&.&& Б│ Б&'&&&&&&&&&&&.&& Б│ Б&'&&&&&&&&&&&.&& Б│ Б&'&&&&&&&&&&&.&& Б
─────────────────────────────────────────────────────────────────────┴────────────────┴────────────────┴────────────────┴──────────────── Ш

 Ш.fields
  Председатель_комиссии_Должность
  Председатель_комиссии_ФИО
.endfields
 Председатель комиссии            Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д  ________________________   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
                                            Должность                       подпись                       расшифровка подписи
.{While (Номер_члена_комиссии < Количество_членов_комиссии)
.begin
  Номер_члена_комиссии := Номер_члена_комиссии + 1;
end.
.fields
  if (Номер_члена_комиссии = word(1), 'Члены комиссии:', '')
  Массив_Член_комиссии_Должность [Номер_члена_комиссии]
  Массив_Член_комиссии_ФИО       [Номер_члена_комиссии]
.endfields
 @@@@@@@@@@@@@@@                  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д  ________________________  Д @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
                                            Должность                       подпись                       расшифровка подписи
.} Ш
 Ш.{?INTERNAL;(Количество_членов_комиссии = 0)
 Члены комиссии:                ________________________________  _________________________  _____________________________________________
                                            Должность                       подпись                       расшифровка подписи
                                 _______________________________  _________________________  _____________________________________________
                                            Должность                       подпись                       расшифровка подписи
                                 _______________________________  _________________________  _____________________________________________
                                            Должность                       подпись                       расшифровка подписи
.} Ш
.EndForm

#doc
Реестр актов на пересортицу со спецификациями
#end
.LinkForm 'ActPeresort' Prototype is 'PSort'
.NameInList 'Реестр актов на пересортицу со спецификациями'
#CommissionLinkVar
#CommissionLinkInit(printPeresortReestr)
.Create View bal_t2
As Select
  Pick.*,
  KatSopr.*,
  SpSopr.*,
  SpSopr2.*,
  KatMC.*,
  KatMC2.*,
  KatEd.*,
  KatEd2.*,
  KatPodr.*,
  KatMol.*,
  KatParty.*,
  KatParty2.*,
  KlVal.*,
  KlVal2.*
From
  Pick,
  KatSopr            (ReadOnly),
  SpSopr             (ReadOnly),
  SpSopr SpSopr2     (ReadOnly),
  KatMC              (ReadOnly),
  KatMC KatMC2       (ReadOnly),
  KatEd              (ReadOnly),
  KatEd KatEd2       (ReadOnly),
  KatPodr            (ReadOnly),
  KatMOL             (ReadOnly),
  KatParty           (ReadOnly),
  KatParty KatParty2 (ReadOnly),
  KlVal              (ReadOnly),
  KlVal KlVal2       (ReadOnly)
Where
     ((
       Word(631)            == Pick.wList         and
       KatSopr.NRec        /== Pick.cRec          and
       Word(630)            == KatSopr.VidSopr    and

       KatSopr.Nrec         == SpSopr.cSopr       and
       KatSopr.Nrec         == SpSopr2.cSopr      and
       Word(0)              == SpSopr.prMC        and
       Word(1)              == SpSopr2.prMC       and

       KatSopr.cPodrFrom    == KatPodr.NRec       and
       KatSopr.cMOLFrom     == KatMOL.NRec        and

       SpSopr.cMCUsl        == KatMC.Nrec         and
       KatMC.cEd            == KatEd.NRec         and
       SpSopr.cVal          == KlVal.NRec         and
       SpSopr.cParty        == KatParty.NRec      and

       SpSopr2.cMCUsl       == KatMC2.Nrec        and
       KatMC2.cEd           == KatEd2.NRec        and
       SpSopr2.cVal         == KlVal2.NRec        and
       SpSopr2.cParty       == KatParty2.NRec
     ))
Order by KatSopr.DSopr, KatSopr.NSopr
;
.Var
Sum1, Sum2, Sum3, Sum4 : Double
c1, c2 : Boolean
.EndVar
.Fields
  CommonFormHeader
  bal_t2.KatSopr.DSopr
  bal_t2.KatSopr.NSopr
  bal_t2.KatSopr.Name
  bal_t2.KatPodr.Name
  bal_t2.KatMOL.Name

  bal_t2.KatMC.Name
  bal_t2.KatMC.Barkod
  bal_t2.KatEd.Name
  bal_t2.KatParty.Name
  bal_t2.SpSopr.KolFact
  bal_t2.SpSopr.Price
  bal_t2.SpSopr.KolFact*bal_t2.SpSopr.Price
  bal_t2.KlVal.SimvolV
  bal_t2.SpSopr.VPrice
  bal_t2.SpSopr.KolFact*bal_t2.SpSopr.VPrice
  Sum3
  Sum1

  bal_t2.KatMC2.Name
  bal_t2.KatMC2.Barkod
  bal_t2.KatEd2.Name
  bal_t2.KatParty2.Name
  bal_t2.SpSopr2.KolFact
  bal_t2.SpSopr2.Price
  bal_t2.SpSopr2.KolFact*bal_t2.SpSopr2.Price
  bal_t2.KlVal2.SimvolV
  bal_t2.SpSopr2.VPrice
  bal_t2.SpSopr2.KolFact*bal_t2.SpSopr2.VPrice
  Sum4
  Sum2
.EndFields
.Begin
  c1 := bal_t2.GetFirst KatSopr = 0;
End.
 Ш^ Ш
.{While (c1)
.Begin
  Sum1 := Sum2 := Sum3 := Sum4 := 0;

  bal_t2._LOOP SpSopr
    Sum1 += bal_t2.SpSopr.KolFact*bal_t2.SpSopr.Price;

  bal_t2._LOOP SpSopr2
   Sum2 += bal_t2.SpSopr2.KolFact*bal_t2.SpSopr2.Price;

  InitGetCur;

  Sum3 := pGetBaseCurrency( 0, Sum1, bal_t2.KatSopr.DSopr );
  Sum4 := pGetBaseCurrency( 0, Sum2, bal_t2.KatSopr.DSopr );

  DoneGetCur;
End.
 Ш              АКТ НА ПЕРЕСОРТИЦУ МАТЕРИАЛЬНЫХ ЦЕННОСТЕЙ  Б^  ^ Б

 Б^ Б

Подразделение  Б^ Б
МОЛ            Б^ Б

 Спецификация к списанию
─────────────────────────┬──────────┬─────┬───────────────┬─────────────┬─────────────┬────────────────┬───┬─────────────┬────────────────
     Наименование МЦ     │   Код    │ЕдИзм│    Партия     │ Количество  │    Цена     │     Сумма      │Вал│Цена в валюте│ Сумма в валюте
─────────────────────────┴──────────┴─────┴───────────────┴─────────────┴─────────────┴────────────────┴───┴─────────────┴──────────────── Ш
.Begin
  c2 := bal_t2.GetFirst SpSopr = 0;
End.
.{While (c2)
 Ш@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@ @@@@@ @@@@@@@@@@@@@@@ &&&&&&&&&&&&& &&&&&&&&&&.&& &'&&&&&&&&&&&.&& @@@ &&&&&&&&&&.&& &'&&&&&&&&&&&.&& Ш
.Begin
  c2 := bal_t2.GetNext SpSopr = 0;
End.
.}
 Ш──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
 ИТОГО                 в базовой валюте    Б&'&&&&&&&&&&&.&& Б                             Б &'&&&&&&&&&&&.&& Б

 Спецификация к оприходованию
─────────────────────────┬──────────┬─────┬───────────────┬─────────────┬─────────────┬────────────────┬───┬─────────────┬────────────────
     Наименование МЦ     │   Код    │ЕдИзм│    Партия     │ Количество  │    Цена     │     Сумма      │Вал│Цена в валюте│ Сумма в валюте
─────────────────────────┴──────────┴─────┴───────────────┴─────────────┴─────────────┴────────────────┴───┴─────────────┴──────────────── Ш
.Begin
  c2 := bal_t2.GetFirst SpSopr2 = 0;
End.
.{While (c2)
 Ш@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@ @@@@@ @@@@@@@@@@@@@@@ &&&&&&&&&&&&& &&&&&&&&&&.&& &'&&&&&&&&&&&.&& @@@ &&&&&&&&&&.&& &'&&&&&&&&&&&.&& Ш
.Begin
  c2 := bal_t2.GetNext SpSopr2 = 0;
End.
.}
 Ш──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
 ИТОГО                 в базовой валюте    Б&'&&&&&&&&&&&.&& Б                              Б&'&&&&&&&&&&&.&& Щ


.Begin
  c1 := bal_t2.GetNext KatSopr = 0;
End.
.}

 Ш.fields
  Председатель_комиссии_Должность
  Председатель_комиссии_ФИО
.endfields
 Председатель комиссии            Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д  ________________________   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
                                            Должность                       подпись                       расшифровка подписи
.{While (Номер_члена_комиссии < Количество_членов_комиссии)
.begin
  Номер_члена_комиссии := Номер_члена_комиссии + 1;
end.
.fields
  if (Номер_члена_комиссии = word(1), 'Члены комиссии:', '')
  Массив_Член_комиссии_Должность [Номер_члена_комиссии]
  Массив_Член_комиссии_ФИО       [Номер_члена_комиссии]
.endfields
 @@@@@@@@@@@@@@@                  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д  ________________________  Д @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
                                            Должность                       подпись                       расшифровка подписи
.} Ш
 Ш.{?INTERNAL;(Количество_членов_комиссии = 0)
 Члены комиссии:                ________________________________  _________________________  _____________________________________________
                                            Должность                       подпись                       расшифровка подписи
                                 _______________________________  _________________________  _____________________________________________
                                            Должность                       подпись                       расшифровка подписи
                                 _______________________________  _________________________  _____________________________________________
                                            Должность                       подпись                       расшифровка подписи
.} Ш
.EndForm



#doc
Акт на пересортицу
#end
.Set Name = 'pact'
.Hide
.Fields
 nRecKatSopr :Comp

 НомерАкта
 ДатаАкта
 Организация
 Валюта_НДЕ
 Валюта_спец
 Примечание

 Подразделение
 МОЛ
 Подразделение2
 МОЛ2
#CommissionFields

!.{
 nRecSpSopr :Comp

 Наименование
 Код
 ЕдИзм
 Партия
 Количество
 Цена
 Сумма
 Валюта
 ЦенаВал
 СуммаВал
!.}
 ИтогоНДЕ
 ИтогоБазВал

!.{
 nRecSpSopr2 :Comp

 Наименование2
 Код2
 ЕдИзм2
 Партия2
 Количество2
 Цена2
 Сумма2
 Валюта2
 ЦенаВал2
 СуммаВал2
!.}

 ИтогоНДЕ2
 ИтогоБазВал2
.EndFields
nRecKatSopr ^
^ ^ ^ ^ ^ ^
^ ^
^ ^
#CommissionBody(PrintPeresort)

.{
nRecSpSopr ^
^ ^ ^ ^ ^ ^ ^ ^ ^ ^
.}
^ ^

.{
nRecSpSopr2 ^
^ ^ ^ ^ ^ ^ ^ ^ ^ ^
.}
^ ^
.EndForm

#doc
Акт на пересортицу
#end
.LinkForm 'Act1' Prototype is 'pact'
.NameInList 'Акт на пересортицу'
#CommissionLinkVar
#CommissionLinkInit(printPeresort)
.Fields
 CommonFormHeader
 Организация
 НомерАкта
 ДатаАкта
 Примечание
 Подразделение
 МОЛ
 Подразделение2
 МОЛ2
 Валюта_НДЕ
 Валюта_НДЕ
 Валюта_спец
 Валюта_спец

 Наименование
 Код
 ЕдИзм
 Партия
 Количество
 Цена
 Сумма
 ЦенаВал
 СуммаВал
 ИтогоНДЕ
 ИтогоБазВал

 Валюта_НДЕ
 Валюта_НДЕ
 Валюта_спец
 Валюта_спец

 Наименование2
 Код2
 ЕдИзм2
 Партия2
 Количество2
 Цена2
 Сумма2
 ЦенаВал2
 СуммаВал2
 итогонде2
 ИтогоБазВал2
.EndFields
 Ш^
^
              АКТ НА ПЕРЕСОРТИЦУ МАТЕРИАЛЬНЫХ ЦЕННОСТЕЙ  Б^  ^ Б

 Б^ Б

Подразделение списания:       Б^ Б
МОЛ списания:                 Б^ Б
Подразделение оприходования:  Б^ Б
МОЛ оприходования:            Б^ Б

 Спецификация к списанию
─────────────────────────┬──────────┬─────┬───────────────┬─────────────┬─────────────┬────────────────┬─────────────┬────────────────
     Наименование МЦ     │   Код    │ЕдИзм│    Партия     │ Количество  │ Цена, @@@@  │   Сумма, @@@@  │  Цена, @@@@ │  Сумма, @@@@
─────────────────────────┴──────────┴─────┴───────────────┴─────────────┴─────────────┴────────────────┴─────────────┴──────────────── Ш
.{
 Ш@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@ @@@@@ @@@@@@@@@@@@@@@ &&&&&&&&&&&&& &&&&&&&&&&.&& &'&&&&&&&&&&&.&& &&&&&&&&&&.&& &'&&&&&&&&&&&.&& Ш
.}
 Ш──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
 ИТОГО                                                                                 Б &'&&&&&&&&&&&.&& Б               Б &'&&&&&&&&&&&.&& Б


 Спецификация к оприходованию
─────────────────────────┬──────────┬─────┬───────────────┬─────────────┬─────────────┬────────────────┬─────────────┬────────────────
     Наименование МЦ     │   Код    │ЕдИзм│    Партия     │ Количество  │ Цена, @@@@  │   Сумма, @@@@  │  Цена, @@@@ │  Сумма, @@@@
─────────────────────────┴──────────┴─────┴───────────────┴─────────────┴─────────────┴────────────────┴─────────────┴──────────────── Ш
.{
 Ш@@@@@@@@@@@@@@@@@@@@@@@@@ @@@@@@@@@@ @@@@@ @@@@@@@@@@@@@@@ &&&&&&&&&&&&& &&&&&&&&&&.&& &'&&&&&&&&&&&.&& &&&&&&&&&&.&& &'&&&&&&&&&&&.&& Ш
.}
 Ш──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
 ИТОГО                  Б                                                                &'&&&&&&&&&&&.&& Б                Б&'&&&&&&&&&&&.&& Щ

 Ш.fields
  Председатель_комиссии_Должность
  Председатель_комиссии_ФИО
.endfields
 Председатель комиссии            Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д  ____________________   Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
                                            Должность                       подпись                       расшифровка подписи
.{While (Номер_члена_комиссии < Количество_членов_комиссии)
.begin
  Номер_члена_комиссии := Номер_члена_комиссии + 1;
end.
.fields
  if (Номер_члена_комиссии = word(1), 'Члены комиссии:', '')
  Массив_Член_комиссии_Должность [Номер_члена_комиссии]
  Массив_Член_комиссии_ФИО       [Номер_члена_комиссии]
.endfields
 @@@@@@@@@@@@@@@                  Д@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д  ____________________  Д @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Д
                                            Должность                       подпись                       расшифровка подписи
.} Ш
 Ш.{?INTERNAL;(Количество_членов_комиссии = 0)
 Члены комиссии:                ________________________________  _________________________  _____________________________________________
                                            Должность                       подпись                       расшифровка подписи
                                 _______________________________  _________________________  _____________________________________________
                                            Должность                       подпись                       расшифровка подписи
                                 _______________________________  _________________________  _____________________________________________
                                            Должность                       подпись                       расшифровка подписи
.} Ш

.EndForm
