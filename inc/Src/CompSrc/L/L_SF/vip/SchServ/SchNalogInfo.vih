/*
 ╔═══════════════════════════════════════════════════════════════════════════╗
 ║                     (c) 09/17/03  корпорация ГАЛАКТИКА                    ║
 ║ Проект        : ГАЛАКТИКА                                                 ║
 ║ Система       : Оперативный контур                                        ║
 ║ Версия        : 8.0                                                       ║
 ║ Назначение    : Расчет налогов                                            ║
 ║ Ответственный : Полежай Алексей Геннадьевич                               ║
 ╚═══════════════════════════════════════════════════════════════════════════╝
*/

#ifdef ComponentVersion
#component "L_SF"
#end

#include SchMacros.inc

type
#doc
информация о налоге
#end
  TTax = record
    Value  : Double;
    Rate   : Double;
    isExist: Boolean;
  end;

#doc
информация о налогах, необходимых при создании СФ
#end
  TNalogInfo = record
    Price     : Double;
    RPrice    : Double;
    NDS       : TTax;
    Excise    : TTax;
    SaleTax   : TTax;
    OtherTax  : Double;
    cVal      : Comp;
    cGrNal    : Comp;
#ifdef Gal9_1
    cUpOrg    : Comp;
    IsTaxIn   : Boolean;
    ManualTax : Word;
#end
  end;

// базовый obj интерфейс - должен быть реализован каждым vip
// интерфейсом расчета налогов по позиции документа
#doc
Методы для расчета налогов
#end
ObjInterface ISchNalogInfo;

  #doc
  Расчет налогов по позиции
  #end
  function getInfo(p: PositionHandle; var recInfo: TNalogInfo): Boolean;

end;

// базовый vip интерфейс расчета налогов - использовать при расчете
// нужно какой-нибудь из его потомков
VipInterface SchNalogBase
 LICENSED (FREE)
;
public:

  #doc
  Режим "В валюте документа" (по умолчанию)
  #end
  property DEF_MODE: LongInt read;

  #doc
  Режим "В НДЕ"
  #end
  property NDE_MODE: LongInt read;

  #doc
  Конструктор объектного интерфейса
  #end
  constructor Init;

  #doc
  Деструктор объектного интерфейса
  #end
  destructor Done;

  #doc
  Установка режима расчета налогов
  #end
  procedure setMode(wMode: Word);

  #doc
  Установка режима расчета налогов согласно заданной валюте
  #end
  procedure setModeByVal(cVal: Comp; wMode: Word);

  #doc
  Удаление временные данные о налогах
  #end
  function deleteCustomTaxes(cRec: Comp): Boolean;

  #doc
  Расчет налогов по группе, заполнение таблицы SpDocNal
  #end
  function recalcCustomTaxes(cGroupNal: Comp; isTaxIn: Boolean; cDoc: Comp; cSpDoc: Comp;
    cOrg: Comp; cOtpEd: Comp; cVal: Comp; kol: Double; dRate: Date; rate: Double;
    price: Double; vprice: Double; cPayment: Comp): Boolean;

end;

// интерфейс расчета налогов по позиции накладной
VipInterface SchNalogKS(SchNalogBase) implements ISchNalogInfo
 LICENSED (FREE)
;
public:

  #doc
  Режим "По группе налогов из каталога МЦ"
  #end
  property KATMC_MODE: LongInt read;

  #doc
  Режим "По разноске платежа"
  #end
  property SPHOZ_MODE: LongInt read;

  #doc
  Режим "Расчет налогов для ГТД"
  #end
  property GTD_MODE  : LongInt read;

  #doc
  Режим "Расчет налогов без учета формы расчета сопроводительного документа"
  #end
  property NotUsePayment : LongInt read;

  #doc
  Конструктор объектного интерфейса
  #end
  constructor Init;

end;

// интерфейс расчета налогов по позиции ДО
VipInterface SchNalogBD(SchNalogBase) implements ISchNalogInfo
 LICENSED (FREE)
;
public:

  #doc
  Конструктор объектного интерфейса
  #end
  constructor Init;

  #doc
  Расчет цены и количества по позиции спецификации ДО
  #end
  function getPrice(cSpStep: Comp; var kolDO: Double): Double;

end;

// интерфейс расчета налогов по позиции СФ
VipInterface SchNalogSF(SchNalogBase) implements ISchNalogInfo
 LICENSED (FREE)
;
public:

  #doc
  Режим по "временным" налогам по позиции СФ
  #end
  property CUSTOM_MODE: LongInt read;

  #doc
  Конструктор объектного интерфейса
  #end
  constructor Init;

end;

// интерфейс расчета налогов по позициям документов модуля "Капстрой"
VipInterface SchNalogUKS(SchNalogBase) implements ISchNalogInfo
 LICENSED (FREE)
;
public:
  #doc
  Конструктор объектного интерфейса
  #end
  constructor Init;
end;

// Интерфейс расчета налогов по спецификации договора/соглашения, ПКП
VipInterface SchNalogDog(SchNalogBase) implements ISchNalogInfo
 LICENSED (FREE)
;
public:

  #doc
  Конструктор объектного интерфейса
  #end
  constructor Init;

  #doc
  Расчет цены и количества по позиции спецификации договора/соглашения, ПКП
  #end
  function GetPrice(aSpDocs : Comp; var KolDog : Double) : Double;

end;
