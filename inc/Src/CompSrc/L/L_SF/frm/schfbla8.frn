//********************************************************************************
//                                                        (c) корпорация Галактика
// Галактика 8.1
// Печатные формы счетов-фактур (бланки СФ, с 01.01.2012)
//********************************************************************************

#doc
Счет-фактура (формат A4), с 24.01.2012
#end
.linkform 'Schfrees_81' prototype is 'Schfrees'
.NameInList 'Счет-фактура (формат A4), с 24.01.2012'
.Group 'Бланки счетов-фактур (с 2012г.)'
.Group 'Country' subGroup 'Russia'
.set filler '-'
!-------------------------------------------------------------------
.create view vSchf
From
  SchFact
where
((
  nSchFact == SchFact.nRec
));
!-------------------------------------------------------------------
.var
  StrPrim1, StrPrim2 : String;
  EmptyField : string;

  NumSigner  : word;
  KolSigners : word;
  arrFIO_Dir      : array[1..10] of string;
  arrPosition_Dir : array[1..10] of string;
  arrDover_Dir    : array[1..10] of string;
  arrFIO_Buh      : array[1..10] of string;
  arrPosition_Buh : array[1..10] of string;
  arrDover_Buh    : array[1..10] of string;
  isDirector      : boolean;
  isBuh           : boolean;
  wTipUser        : word;
  sDirector       : string;
  sMainBuh        : string;
  isPostAddr      : boolean;
  sIP_Under_Info1 : string;
  sIP_Under_Info2 : string;

  isExistNDS_InList : boolean;
  sSpNDS            : string;
  isNalAg           : boolean;
  isDopol           : boolean;
.endvar
.begin
  isPostAddr := (ppPrintField and 1) <> 0;
  EmptyField := if(wCountry=0,'-','');
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  if (vSchf.GetFirst SchFact = 0)
    wTipUser := SchFact.TipUser;
  isNalAg := ((wTipUser = 7228) or (wTipUser = 7229) or (wTipUser = 7230));

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Dir     [NumSigner] := '';
    arrPosition_Dir[NumSigner] := '';
    arrDover_Dir   [NumSigner] := '';
  }

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Buh     [NumSigner] := '';
    arrPosition_Buh[NumSigner] := '';
    arrDover_Buh   [NumSigner] := '';
  }

  NumSigner := 0;
  isExistNDS_InList := false;
  isDopol := false;
end.
.fields
  NSF
  if(longint(dFact)<>0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')
  #f_(nRevision)
  if(longint(dRevision)<>0, DateToStr(dRevision, '"DD" Mon YYYY г.'),'-')

  if (Direct = 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 Ш                                                                                                                                        Приложение № 1 Ш
 Ш                                                                                                                         к постановлению Правительства Ш
 Ш                                                                                                                                  Российской Федерации Ш
 Ш                                                                                                                          от 26 декабря 2011 г. № 1137 Ш


 Й               СЧЕТ-ФАКТУРА № @~@@@@@@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@@ (1) Й
 Й                ИСПРАВЛЕНИЕ № @~@@@@@@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@ (1а) Й

 Й Продавец   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (2) Й
.{?internal; isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct = 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 Й Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) Й
 Й       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      Й
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 Й Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) Й
.}
.fields
  if (Direct = 1, UnnORInn, OrgUnnORInn) + '/КПП продавца'

  if (Direct = 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

!  #f_ не использовать, т.к. мемо
  GruzFrom +GruzFromAddr
  GruzTo   +GruzToAddr

  if(PlatNo_Date <> '', PlatNo_Date, '№  -  от  -')

  if (Direct <> 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 Й @@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2б) Й
 Й Грузоотправитель и его адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (3) Й
 Й Грузополучатель и его адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (4) Й
 Й К платежно-расчетному документу   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (5) Й
 Й Покупатель   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (6) Й
.{?internal; isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct <> 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 Й Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (6а) Й
 Й       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      Й
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 Й Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (6а) Й
.}
.fields
  if (Direct <> 1, UnnORInn, OrgUnnORInn) + '/КПП покупателя'

  if (Direct <> 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN   + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

  Dollar + ', ' + ISO
.endfields
 Й @@@@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (6б) Й
 Й Валюта: наименование, код   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (7) Й
.if Dopol
.begin
  isDopol := true;
end.
.end
.{ CheckEnter FeeSignersMember_Schfrees_Dir
.begin
  NumSigner++;
  arrFIO_Dir[NumSigner] := Signer_FIO_Director;
  arrPosition_Dir[NumSigner] := Signer_Position_Director;
  if (Signer_Dover_Director <> '')
    arrDover_Dir[NumSigner] := '(' + Signer_Dover_Director + ')';
end.
.}
.begin
  NumSigner := 0;
end.
.{ CheckEnter FeeSignersMember_Schfrees_Buh
.begin
  NumSigner++;
  arrFIO_Buh[NumSigner] := Signer_FIO_MainBuh;
  arrPosition_Buh[NumSigner] := Signer_Position_MainBuh;
  if (Signer_Dover_MainBuh <> '')
    arrDover_Buh[NumSigner] := '(' + Signer_Dover_MainBuh + ')';
end.
.}
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌─────────────────────┬────────────────┬──────────┬────────────┬───────────────┬──────────┬──────┬─────────────┬───────────────┬──────────────┬─────────┐ Ш
 Ш│ Наименование товара │     Единица    │Количество│   Цена     │   Стоимость   │  В том   │Нало- │Сумма налога,│   Стоимость   │    Страна    │  Номер  │ Ш
 Ш│(описание выполненных│    измерения   │ (объем)  │ (тариф) за │ товаров (ра-  │  числе   │говая │предъявляемая│ товаров (ра-  │ происхождения│ таможен-│ Ш
 Ш│  работ, оказанных   ├─────┬──────────┤          │ единицу из-│ бот, услуг),  │  сумма   │ставка│ покупателю  │ бот, услуг),  │    товара    │ ной дек-│ Ш
 Ш│ услуг), имуществен- │ Код │ Условное │          │ мерения    │ имущественных │  акциза  │      │             │ имущественных ├──────┬───────┤ ларации │ Ш
 Ш│     ного права      │     │ обозначе-│          │            │     прав      │          │      │             │  прав с нало- │Цифро-│Краткое│         │ Ш
 Ш│                     │     │ние(нацио-│          │            │  без налога - │          │      │             │  гом - всего  │ вой  │ наиме-│         │ Ш
 Ш│                     │     │ нальное) │          │            │     всего     │          │      │             │               │ код  │нование│         │ Ш
 Ш├─────────────────────┼─────┼──────────┼──────────┼────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┼──────┼───────┼─────────┤ Ш
 Ш│          1          │  2  │    2а    │     3    │      4     │       5       │     6    │   7  │      8      │       9       │  10  │  10а  │    11   │ Ш
 Ш├─────────────────────┼─────┼──────────┼──────────┼────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┼──────┼───────┼─────────┤ Ш
.{CheckEnter SpSchf
.begin
  sSpNDS := if (SpPrMC = 101, '-',
              if (SpPrMC = 102, if (SpPerc = -1, 'без НДС', DoubleToStr(SpNDS, '\2p[|-]3666666666666666666.88')),
                if (SpExistNDS or Abs(SpPerc) >= 0.01,
                  DoubleToStr(SpNDS, '\2p[|-]3666666666666666666.88'), 'без НДС')));

  if(not isExistNDS_InList)
    isExistNDS_InList := (sSpNDS <> 'без НДС');
end.
.fields
  #f_(SpName + if (SpTNVED <> '', ', ВЭД ' + SpTNVED, '') + if (SpDopol <> '', ' ' + SpDopol, ''))
  #f_(if (SpPrMC = 3, '', SpKodEd))
  #f_(if (SpPrMC = 3, '', SpABBREd))
  if (SpPrMC = 101 or SpPrMC = 102, '-',
    if (SpPrMC = 3, '-', if (abs(SpKol) >= dMinKol, string(SpKol, 0, Kol_Pr), '-')))
  if (SpPrMC = 3 or #isPrnPrice or #IsPeny, 0.0, SpPrNoNds)
  if (#IsPeny, 0.0, SpSumNoNDS)
  if (((SpPrMC = 101 or SpPrMC = 102) and (not IsNalAg)), '-', if ((Abs(SpAkciz) >= 0.00001), DoubleToStr(SpAkciz, '\2p[|-]3666666666666666666.88'),
                                                                   if ((Abs(SpSumma) >= 0.00001), 'без акциза', '-')))
  sSpPerc
  sSpNDS
  SpSumma
  GTDKod
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│@~@@@│@~@@@@@@@@│&#&&&&&&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&.&&│@~#@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@│@~@@@@@│@~@@@@@@@│ Ш
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.fields
  if (Abs(ItSumNoNDS) >= 0.01, DoubleToStr(ItSumNoNDS, '\2p[|-]3666666666666666666.88'), '')
  if (isExistNDS_InList, DoubleToStr(ItNDS, '\2p[|-]3666666666666666666.88'), '-')
  ItSumma
.endfields
 Ш├─────────────────────┴─────┴──────────┴──────────┴────────────┼───────────────┼──────────┴──────┼─────────────┼───────────────┼──────┴───────┴─────────┘ Ш
 Ш│  Всего к оплате                                              │&#&&&&&&&&&&.&&│        X        │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш└──────────────────────────────────────────────────────────────┴───────────────┴─────────────────┴─────────────┴───────────────┘ Ш
.begin
  NumSigner  := 1;
  KolSigners := if(KolSigners_Director >= KolSigners_MainBuh, KolSigners_Director, KolSigners_MainBuh);

  sDirector := if (KolSigners_Director > 0, arrFIO_Dir[NumSigner], Director);
  sMainBuh  := if (KolSigners_MainBuh  > 0, arrFIO_Buh[NumSigner], Main_Buh);
end.
.fields
   sDirector
   sMainBuh
   arrDover_Dir[NumSigner]
   arrDover_Buh[NumSigner]
.endfields

 Ш
       Руководитель организации                                                  Главный бухгалтер
       или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{While (NumSigner < KolSigners)
.begin
  NumSigner++;
  IsDirector := if(KolSigners_Director >= NumSigner, true, false);
  IsBuh := if(KolSigners_MainBuh >= NumSigner, true, false);
end.
.{?internal; (isDirector and isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Dir   [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (isDirector and not isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrDover_Dir   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (not isDirector and isBuh)
.fields
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш                                                                                 @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                                 (подпись)           (Ф.И.О.)
                                                                                                         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.}
.begin
  sIP_Under_Info1 := '(реквизиты свидетельства о государственной регистрации';
  sIP_Under_Info2 := 'индивидуального предпринимателя)';
end.
.fields
  IP_FIO
  IP_Info
  sIP_Under_Info1
  sIP_Under_Info2
.endfields
 Ш     Индивидуальный предприниматель  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{?internal; (isDopol)
.fields
  Nazn
.endfields
 Ш
 Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.)
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.}
.fields
  MemoIP_Info
.endfields
 Ш
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

 Ш

.} // Schf
.endform
#doc
Корректировочный счет-фактура (с 24.01.2012)
#end
.linkform 'Schfrees_82' prototype is 'Schfrees'
.NameInList 'Корректировочный счет-фактура (c 24.01.2012)'
.Group 'Бланки корректировочных счетов-фактур'
.Group 'Country' subGroup 'Russia'
.set filler '-'
!-------------------------------------------------------------------
.create view vSchf
From
  SchFact
where
((
  nSchFact == SchFact.nRec
));
!-------------------------------------------------------------------
.var
  StrPrim1, StrPrim2 : String;
  EmptyField : string;

  NumSigner  : word;
  KolSigners : word;
  arrFIO_Dir      : array[1..10] of string;
  arrPosition_Dir : array[1..10] of string;
  arrDover_Dir    : array[1..10] of string;
  arrFIO_Buh      : array[1..10] of string;
  arrPosition_Buh : array[1..10] of string;
  arrDover_Buh    : array[1..10] of string;
  isDirector      : boolean;
  isBuh           : boolean;
  wTipUser        : word;
  sDirector       : string;
  sMainBuh        : string;
  Sign            : double;
  isPostAddr      : boolean;
  sIP_Under_Info1 : string;
  sIP_Under_Info2 : string;
  isDopol         : boolean;
.endvar
.begin
  isPostAddr := (ppPrintField and 1) <> 0;
  EmptyField := if(wCountry=0,'-','');
  isDopol    := false;
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  if (vSchf.GetFirst SchFact = 0)
    wTipUser := SchFact.TipUser;

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Dir     [NumSigner] := '';
    arrPosition_Dir[NumSigner] := '';
    arrDover_Dir   [NumSigner] := '';
  }

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Buh     [NumSigner] := '';
    arrPosition_Buh[NumSigner] := '';
    arrDover_Buh   [NumSigner] := '';
  }

  NumSigner := 0;
end.
.fields
  NSF_CorrV
  if (LongInt(dFact_CorrV) <> 0, DateToStr(dFact_CorrV, '"DD" Mon YYYY г.'), '-')
  #f_(nRevision_CorrV)
  if (LongInt(dRevision_CorrV) <> 0, DateToStr(dRevision_CorrV, '"DD" Mon YYYY г.'), '-')
    SF_Src_List
  #f_(nRevision)
  if (LongInt(dRevision) <> 0, DateToStr(dRevision, '"DD" Mon YYYY г.'), '-')

  if (Direct = 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 Ш                                                                                                                                        Приложение № 2 Ш
 Ш                                                                                                                         к постановлению Правительства Ш
 Ш                                                                                                                                  Российской Федерации Ш
 Ш                                                                                                                          от 26 декабря 2011 г. № 1137 Ш
 Ш                                                                                           (в ред. Постановления Правительства РФ от 24.10.2013 № 952) Ш


 С КОРРЕКТИРОВОЧНЫЙ СЧЕТ-ФАКТУРА № @~@@@@@@@@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@                                     (1) С
 С ИСПРАВЛЕНИЕ КОРРЕКТИРОВОЧНОГО СЧЕТА-ФАКТУРЫ № @~@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@                             (1а) С
 С к СЧЕТУ-ФАКТУРЕ(СЧЕТАМ-ФАКТУРАМ) № @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      С
 С с учетом исправления № @~@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@                                                                 (1б) С


 С Продавец   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2) С
.{?internal; isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct = 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 С Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) С
 С       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      С
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 С Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) С
.}
.fields
  if (Direct = 1, UnnORInn, OrgUnnORInn) + '/КПП продавца'

  if (Direct = 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN   + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

  if (Direct <> 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 С @@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2б) С
 С Покупатель   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3) С
.{?internal; isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct <> 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 С Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3а) С
 С       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      С
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 С Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3а) С
.}
.fields
  if (Direct <> 1, UnnORInn, OrgUnnORInn) + '/КПП покупателя'

  if (Direct <> 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN   + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

  Dollar + ', ' + ISO
.endfields
 С @@@@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3б) С
 С Валюта: наименование, код   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (4) С
.if Dopol
.begin
  isDopol := true;
end.
.end
.{ CheckEnter FeeSignersMember_Schfrees_Dir
.begin
  NumSigner++;
  arrFIO_Dir[NumSigner] := Signer_FIO_Director;
  arrPosition_Dir[NumSigner] := Signer_Position_Director;
  if (Signer_Dover_Director <> '')
    arrDover_Dir[NumSigner] := '(' + Signer_Dover_Director + ')';
end.
.}
.begin
  NumSigner := 0;
end.
.{ CheckEnter FeeSignersMember_Schfrees_Buh
.begin
  NumSigner++;
  arrFIO_Buh[NumSigner] := Signer_FIO_MainBuh;
  arrPosition_Buh[NumSigner] := Signer_Position_MainBuh;
  if (Signer_Dover_MainBuh <> '')
    arrDover_Buh[NumSigner] := '(' + Signer_Dover_MainBuh + ')';
end.
.}
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌──────────────────────┬──────────────────────┬────────────────┬──────────┬─────────────┬───────────────┬──────────┬──────┬─────────────┬───────────────┐ Ш
 Ш│  Наименование товара │ Показатели в связи с │     Единица    │Количество│    Цена     │   Стоимость   │  В том   │Нало- │Сумма налога │   Стоимость   │ Ш
 Ш│(описание выполненных │ изменением стоимости │    измерения   │ (объем)  │  (тариф) за │ товаров (ра-  │  числе   │говая │             │ товаров (ра-  │ Ш
 Ш│   работ, оказанных   │ отгруженных товаров  ├─────┬──────────┤          │ единицу из- │ бот, услуг),  │  сумма   │ставка│             │ бот, услуг),  │ Ш
 Ш│услуг), имущественного│ (выполненных работ,  │ Код │ Условное │          │   мерения   │ имущественных │  акциза  │      │             │ имущественных │ Ш
 Ш│        права         │   оказанных услуг),  │     │ обозначе-│          │             │     прав      │          │      │             │  прав с нало- │ Ш
 Ш│                      │      переданных      │     │ние(нацио-│          │             │  без налога - │          │      │             │  гом - всего  │ Ш
 Ш│                      │  имущественных прав  │     │ нальное) │          │             │     всего     │          │      │             │               │ Ш
 Ш├──────────────────────┼──────────────────────┼─────┼──────────┼──────────┼─────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
 Ш│           1          │          1а          │  2  │    2а    │     3    │      4      │       5       │     6    │   7  │      8      │       9       │ Ш
 Ш├──────────────────────┼──────────────────────┼─────┼──────────┼──────────┼─────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
.{CheckEnter SpSchf
.begin
  Sign := if (SpSumma < 0, -1.0, 1.0);
end.
.fields
  #f_(SpName + if (SpTNVED <> '', ', ВЭД ' + SpTNVED, '') + if (SpDopol <> '', ' ' + SpDopol, ''))
  #f_(if (SpPrMC = 3, '', SpKodEd))
  #f_(if (SpPrMC = 3, '', SpABBREd))

  if (SpPrMC = 3, '-', if (abs(SpKol_Src) >= dMinKol, string(SpKol_Src, 0, Kol_Pr), '-'))
  if (SpPrMC = 3 or #isPrnPrice, 0.0, SpPrNoNds_Src)
  SpSumNoNds_Src
  if (abs(SpAkciz_Src) >= 0.00001, DoubleToStr(SpAkciz_Src, '\2p[|-]3666666666666666666.88'), 'без акциза')
  sSpPerc
  if (SpExistNDS or Abs(SpPerc) >= 0.01, DoubleToStr(SpNDS_Src, '\2p[|-]3666666666666666666.88'), 'без НДС')
  SpSumma_Src

  #f_(if (SpPrMC = 3, '', SpKodEd))
  #f_(if (SpPrMC = 3, '', SpABBREd))

  if (SpPrMC = 3, '0.0', if (abs(SpKol_Src + SpKol) >= dMinKol, string(SpKol_Src + SpKol, 0, Kol_Pr), '-'))
  if (SpPrMC = 3 or #isPrnPrice, 0.0,
    if (abs(SpKol) >= dMinKol, (SpPrNoNds_Src * SpKol_Src + SpPrNoNds * SpKol) / (SpKol_Src + SpKol), (SpPrNoNds_Src + SpPrNoNds)))
  (SpSumNoNds_Src + SpSumNoNDS)
  if (abs(SpAkciz_Src + SpAkciz) >= 0.00001, DoubleToStr(SpAkciz_Src + SpAkciz, '\2p[|-]3666666666666666666.88'), 'без акциза')
  sSpPerc
  if ((SpExistNDS or Abs(SpPerc) >= 0.01), DoubleToStr(SpNDS_Src + SpNDS, '\2p[|-]3666666666666666666.88'), 'без НДС')
  (SpSumma_Src + SpSumma)

  if (Sign > 0, Sign * SpSumNoNDS, 0.0)
  if (Sign > 0, Sign * SpAkciz, 0.0)
  if (Sign > 0, if (SpExistNDS or Abs(SpPerc) >= 0.01, DoubleToStr(Sign * SpNDS, '\2p[|-]3666666666666666666.88'), '-'), '-')
  if (Sign > 0, Sign * SpSumma, 0.0)

  if (Sign < 0, Sign * SpSumNoNDS, 0.0)
  if (Sign < 0, Sign * SpAkciz, 0.0)
  if (Sign < 0, if (SpExistNDS or Abs(SpPerc) >= 0.01, DoubleToStr(Sign * SpNDS, '\2p[|-]3666666666666666666.88'), '-'), '-')
  if (Sign < 0, Sign * SpSumma, 0.0)
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@│А (до изменения)      │@~@@@│@~@@@@@@@@│&#&&&&&&&&│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&.&&│@~#@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш│                      │Б (после изменения)   │@~@@@│@~@@@@@@@@│&#&&&&&&&&│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&.&&│@~#@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш│                      │В (увеличение)        │  X  │     X    │     X    │      X      │&#&&&&&&&&&&.&&│&#&&&&&.&&│   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш│                      │Г (уменьшение)        │  X  │     X    │     X    │      X      │&#&&&&&&&&&&.&&│&#&&&&&.&&│   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.fields
   ItSumNoNDS_Dop
   ItNDS_Dop
   ItSumma_Dop

   ItSumNoNDS
   ItNDS
   ItSumma
.endfields
 Ш├──────────────────────┴──────────────────────┴─────┴──────────┴──────────┴─────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
 Ш│  Всего увеличение (сумма строк В)                                                     │&#&&&&&&&&&&.&&│     X    │   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш├───────────────────────────────────────────────────────────────────────────────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
 Ш│  Всего уменьшение (сумма строк Г)                                                     │&#&&&&&&&&&&.&&│     X    │   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш└───────────────────────────────────────────────────────────────────────────────────────┴───────────────┴──────────┴──────┴─────────────┴───────────────┘ Ш
.begin
  NumSigner  := 1;
  KolSigners := if(KolSigners_Director >= KolSigners_MainBuh, KolSigners_Director, KolSigners_MainBuh);

  sDirector := if (KolSigners_Director > 0, arrFIO_Dir[NumSigner], Director);
  sMainBuh  := if (KolSigners_MainBuh  > 0, arrFIO_Buh[NumSigner], Main_Buh);
end.
.fields
   sDirector
   sMainBuh
   arrDover_Dir[NumSigner]
   arrDover_Buh[NumSigner]
.endfields

 Ш
       Руководитель организации                                                  Главный бухгалтер
       или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{While (NumSigner < KolSigners)
.begin
  NumSigner++;
  IsDirector := if(KolSigners_Director >= NumSigner, true, false);
  IsBuh := if(KolSigners_MainBuh >= NumSigner, true, false);
end.
.{?internal; (isDirector and isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Dir   [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (isDirector and not isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrDover_Dir   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (not isDirector and isBuh)
.fields
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш                                                                                 @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                                 (подпись)           (Ф.И.О.)
                                                                                                         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.}
.begin
  sIP_Under_Info1 := '(реквизиты свидетельства о государственной регистрации';
  sIP_Under_Info2 := 'индивидуального предпринимателя)';
end.
.fields
  IP_FIO
  IP_Info
  sIP_Under_Info1
  sIP_Under_Info2
.endfields
 Ш     Индивидуальный предприниматель  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{?internal; (isDopol)
.fields
  Nazn
.endfields
 Ш
 Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.)
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.}
.fields
  MemoIP_Info
.endfields
 Ш
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

 Ш

.} // Schf
.endform
#doc
Счет-фактура (формат A4), с 01.07.2017г.
#end
.linkform 'Schfrees_83' prototype is 'Schfrees'
.NameInList 'Счет-фактура (формат A4), с 01.07.2017г.'
.Group 'Бланки счетов-фактур (с 2017г.)'
.Group 'Country' subGroup 'Russia'
.set filler '-'
!-------------------------------------------------------------------
.create view vSchf
From
  SchFact
where
((
  nSchFact == SchFact.nRec
));
!-------------------------------------------------------------------
.var
  StrPrim1, StrPrim2 : String;
  EmptyField : string;

  NumSigner  : word;
  KolSigners : word;
  arrFIO_Dir      : array[1..10] of string;
  arrPosition_Dir : array[1..10] of string;
  arrDover_Dir    : array[1..10] of string;
  arrFIO_Buh      : array[1..10] of string;
  arrPosition_Buh : array[1..10] of string;
  arrDover_Buh    : array[1..10] of string;
  isDirector      : boolean;
  isBuh           : boolean;
  wTipUser        : word;
  sDirector       : string;
  sMainBuh        : string;
  isPostAddr      : boolean;
  sIP_Under_Info1 : string;
  sIP_Under_Info2 : string;

  isExistNDS_InList : boolean;
  sSpNDS            : string;
  isNalAg           : boolean;
  isDopol           : boolean;
.endvar
.begin
  isPostAddr := (ppPrintField and 1) <> 0;
  EmptyField := if(wCountry=0,'-','');
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  if (vSchf.GetFirst SchFact = 0)
    wTipUser := SchFact.TipUser;
  isNalAg := ((wTipUser = 7228) or (wTipUser = 7229) or (wTipUser = 7230));

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Dir     [NumSigner] := '';
    arrPosition_Dir[NumSigner] := '';
    arrDover_Dir   [NumSigner] := '';
  }

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Buh     [NumSigner] := '';
    arrPosition_Buh[NumSigner] := '';
    arrDover_Buh   [NumSigner] := '';
  }

  NumSigner := 0;
  isExistNDS_InList := false;
  isDopol := false;
end.
.fields
  NSF
  if(longint(dFact)<>0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')
  #f_(nRevision)
  if(longint(dRevision)<>0, DateToStr(dRevision, '"DD" Mon YYYY г.'),'-')

  if (Direct = 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 Ш                                                                                                                                        Приложение № 1 Ш
 Ш                                                                                                                         к постановлению Правительства Ш
 Ш                                                                                                                                  Российской Федерации Ш
 Ш                                                                                                                          от 26 декабря 2011 г. № 1137 Ш
 Ш                                                                                           (в ред. Постановления Правительства РФ от 25.05.2017 № 625) Ш


 Й               СЧЕТ-ФАКТУРА № @~@@@@@@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@@ (1) Й
 Й                ИСПРАВЛЕНИЕ № @~@@@@@@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@ (1а) Й

 Й Продавец   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (2) Й
.{?internal; isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct = 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 Й Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) Й
 Й       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      Й
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 Й Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) Й
.}
.fields
  if (Direct = 1, UnnORInn, OrgUnnORInn) + '/КПП продавца'

  if (Direct = 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

!  #f_ не использовать, т.к. мемо
  GruzFrom +GruzFromAddr
  GruzTo   +GruzToAddr

  if(PlatNo_Date <> '', PlatNo_Date, '№  -  от  -')

  if (Direct <> 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 Й @@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2б) Й
 Й Грузоотправитель и его адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (3) Й
 Й Грузополучатель и его адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (4) Й
 Й К платежно-расчетному документу   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (5) Й
 Й Покупатель   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (6) Й
.{?internal; isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct <> 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 Й Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (6а) Й
 Й       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      Й
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 Й Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (6а) Й
.}
.fields
  if (Direct <> 1, UnnORInn, OrgUnnORInn) + '/КПП покупателя'

  if (Direct <> 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN   + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

  Dollar + ', ' + ISO
  IGK
.endfields
 Й @@@@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (6б) Й
 Й Валюта: наименование, код   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (7) Й
 Й Идентификатор государственного                                                               Й
 Й контракта, договора (соглашения)  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (8) Й
.if Dopol
.begin
  isDopol := true;
end.
.end
.{ CheckEnter FeeSignersMember_Schfrees_Dir
.begin
  NumSigner++;
  arrFIO_Dir[NumSigner] := Signer_FIO_Director;
  arrPosition_Dir[NumSigner] := Signer_Position_Director;
  if (Signer_Dover_Director <> '')
    arrDover_Dir[NumSigner] := '(' + Signer_Dover_Director + ')';
end.
.}
.begin
  NumSigner := 0;
end.
.{ CheckEnter FeeSignersMember_Schfrees_Buh
.begin
  NumSigner++;
  arrFIO_Buh[NumSigner] := Signer_FIO_MainBuh;
  arrPosition_Buh[NumSigner] := Signer_Position_MainBuh;
  if (Signer_Dover_MainBuh <> '')
    arrDover_Buh[NumSigner] := '(' + Signer_Dover_MainBuh + ')';
end.
.}
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌─────────────────────┬────────────────┬──────────┬────────────┬───────────────┬──────────┬──────┬─────────────┬───────────────┬──────────────┬─────────┐ Ш
 Ш│ Наименование товара │     Единица    │Количество│   Цена     │   Стоимость   │  В том   │Нало- │Сумма налога,│   Стоимость   │    Страна    │  Номер  │ Ш
 Ш│(описание выполненных│    измерения   │ (объем)  │ (тариф) за │ товаров (ра-  │  числе   │говая │предъявляемая│ товаров (ра-  │ происхождения│ таможен-│ Ш
 Ш│  работ, оказанных   ├─────┬──────────┤          │ единицу из-│ бот, услуг),  │  сумма   │ставка│ покупателю  │ бот, услуг),  │    товара    │ ной дек-│ Ш
 Ш│ услуг), имуществен- │ Код │ Условное │          │ мерения    │ имущественных │  акциза  │      │             │ имущественных ├──────┬───────┤ ларации │ Ш
 Ш│     ного права      │     │ обозначе-│          │            │     прав      │          │      │             │  прав с нало- │Цифро-│Краткое│         │ Ш
 Ш│                     │     │ние(нацио-│          │            │  без налога - │          │      │             │  гом - всего  │ вой  │ наиме-│         │ Ш
 Ш│                     │     │ нальное) │          │            │     всего     │          │      │             │               │ код  │нование│         │ Ш
 Ш├─────────────────────┼─────┼──────────┼──────────┼────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┼──────┼───────┼─────────┤ Ш
 Ш│          1          │  2  │    2а    │     3    │      4     │       5       │     6    │   7  │      8      │       9       │  10  │  10а  │    11   │ Ш
 Ш├─────────────────────┼─────┼──────────┼──────────┼────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┼──────┼───────┼─────────┤ Ш
.{CheckEnter SpSchf
.begin
  sSpNDS := if (SpPrMC = 101, '-',
              if (SpPrMC = 102, if (SpPerc = -1, 'без НДС', DoubleToStr(SpNDS, '\2p[|-]3666666666666666666.88')),
                if (SpExistNDS or Abs(SpPerc) >= 0.01,
                  DoubleToStr(SpNDS, '\2p[|-]3666666666666666666.88'), 'без НДС')));

  if(not isExistNDS_InList)
    isExistNDS_InList := (sSpNDS <> 'без НДС');
end.
.fields
  #f_(SpName + if (SpTNVED <> '', ', ВЭД ' + SpTNVED, '') + if (SpDopol <> '', ' ' + SpDopol, ''))
  #f_(if (SpPrMC = 3, '', SpKodEd))
  #f_(if (SpPrMC = 3, '', SpABBREd))
  if (SpPrMC = 101 or SpPrMC = 102, '-',
    if (SpPrMC = 3, '-', if (abs(SpKol) >= dMinKol, string(SpKol, 0, Kol_Pr), '-')))
  if (SpPrMC = 3 or #isPrnPrice or #IsPeny, 0.0, SpPrNoNds)
  if (#IsPeny, 0.0, SpSumNoNDS)
  if (((SpPrMC = 101 or SpPrMC = 102) and (not IsNalAg)), '-', if ((Abs(SpAkciz) >= 0.00001), DoubleToStr(SpAkciz, '\2p[|-]3666666666666666666.88'),
                                                                   if ((Abs(SpSumma) >= 0.00001), 'без акциза', '-')))
  sSpPerc
  sSpNDS
  SpSumma
  GTDKod
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@│@~@@@│@~@@@@@@@@│&#&&&&&&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&.&&│@~#@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@│@~@@@@@│@~@@@@@@@│ Ш
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.fields
  if (Abs(ItSumNoNDS) >= 0.01, DoubleToStr(ItSumNoNDS, '\2p[|-]3666666666666666666.88'), '')
  if (isExistNDS_InList, DoubleToStr(ItNDS, '\2p[|-]3666666666666666666.88'), '-')
  ItSumma
.endfields
 Ш├─────────────────────┴─────┴──────────┴──────────┴────────────┼───────────────┼──────────┴──────┼─────────────┼───────────────┼──────┴───────┴─────────┘ Ш
 Ш│  Всего к оплате                                              │&#&&&&&&&&&&.&&│        X        │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш└──────────────────────────────────────────────────────────────┴───────────────┴─────────────────┴─────────────┴───────────────┘ Ш
.begin
  NumSigner  := 1;
  KolSigners := if(KolSigners_Director >= KolSigners_MainBuh, KolSigners_Director, KolSigners_MainBuh);

  sDirector := if (KolSigners_Director > 0, arrFIO_Dir[NumSigner], Director);
  sMainBuh  := if (KolSigners_MainBuh  > 0, arrFIO_Buh[NumSigner], Main_Buh);
end.
.fields
   sDirector
   sMainBuh
   arrDover_Dir[NumSigner]
   arrDover_Buh[NumSigner]
.endfields

 Ш
       Руководитель организации                                                  Главный бухгалтер
       или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{While (NumSigner < KolSigners)
.begin
  NumSigner++;
  IsDirector := if(KolSigners_Director >= NumSigner, true, false);
  IsBuh := if(KolSigners_MainBuh >= NumSigner, true, false);
end.
.{?internal; (isDirector and isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Dir   [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (isDirector and not isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrDover_Dir   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (not isDirector and isBuh)
.fields
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш                                                                                 @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                                 (подпись)           (Ф.И.О.)
                                                                                                         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.}
.begin
  sIP_Under_Info1 := '(реквизиты свидетельства о государственной регистрации';
  sIP_Under_Info2 := 'индивидуального предпринимателя)';
end.
.fields
  IP_FIO
  IP_Info
  sIP_Under_Info1
  sIP_Under_Info2
.endfields
 Ш     Индивидуальный предприниматель  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{?internal; (isDopol)
.fields
  Nazn
.endfields
 Ш
 Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.)
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.}
.fields
  MemoIP_Info
.endfields
 Ш
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

 Ш

.} // Schf
.endform

#doc
Корректировочный счет-фактура (с 01.07.2017)
#end
.linkform 'Schfrees_84' prototype is 'Schfrees'
.NameInList 'Корректировочный счет-фактура (c 01.07.2017)'
.Group 'Бланки корректировочных счетов-фактур'
.Group 'Country' subGroup 'Russia'
.set filler '-'
!-------------------------------------------------------------------
.create view vSchf
From
  SchFact
where
((
  nSchFact == SchFact.nRec
));
!-------------------------------------------------------------------
.var
  StrPrim1, StrPrim2 : String;
  EmptyField : string;

  NumSigner  : word;
  KolSigners : word;
  arrFIO_Dir      : array[1..10] of string;
  arrPosition_Dir : array[1..10] of string;
  arrDover_Dir    : array[1..10] of string;
  arrFIO_Buh      : array[1..10] of string;
  arrPosition_Buh : array[1..10] of string;
  arrDover_Buh    : array[1..10] of string;
  isDirector      : boolean;
  isBuh           : boolean;
  wTipUser        : word;
  sDirector       : string;
  sMainBuh        : string;
  Sign            : double;
  isPostAddr      : boolean;
  sIP_Under_Info1 : string;
  sIP_Under_Info2 : string;
  isDopol         : boolean;
.endvar
.begin
  isPostAddr := (ppPrintField and 1) <> 0;
  EmptyField := if(wCountry=0,'-','');
  isDopol    := false;
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  if (vSchf.GetFirst SchFact = 0)
    wTipUser := SchFact.TipUser;

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Dir     [NumSigner] := '';
    arrPosition_Dir[NumSigner] := '';
    arrDover_Dir   [NumSigner] := '';
  }

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Buh     [NumSigner] := '';
    arrPosition_Buh[NumSigner] := '';
    arrDover_Buh   [NumSigner] := '';
  }

  NumSigner := 0;
end.
.fields
  NSF_CorrV
  if (LongInt(dFact_CorrV) <> 0, DateToStr(dFact_CorrV, '"DD" Mon YYYY г.'), '-')
  #f_(nRevision_CorrV)
  if (LongInt(dRevision_CorrV) <> 0, DateToStr(dRevision_CorrV, '"DD" Mon YYYY г.'), '-')
    SF_Src_List
  #f_(nRevision)
  if (LongInt(dRevision) <> 0, DateToStr(dRevision, '"DD" Mon YYYY г.'), '-')

  if (Direct = 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 Ш                                                                                                                                        Приложение № 2 Ш
 Ш                                                                                                                         к постановлению Правительства Ш
 Ш                                                                                                                                  Российской Федерации Ш
 Ш                                                                                                                          от 26 декабря 2011 г. № 1137 Ш
 Ш                                                                                           (в ред. Постановления Правительства РФ от 24.10.2013 № 952, Ш
 Ш                                                                                                                                  от 25.05.2017 № 625) Ш


 С КОРРЕКТИРОВОЧНЫЙ СЧЕТ-ФАКТУРА № @~@@@@@@@@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@                                     (1) С
 С ИСПРАВЛЕНИЕ КОРРЕКТИРОВОЧНОГО СЧЕТА-ФАКТУРЫ № @~@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@                             (1а) С
 С к СЧЕТУ-ФАКТУРЕ(СЧЕТАМ-ФАКТУРАМ) № @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      С
 С с учетом исправления № @~@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@                                                                 (1б) С


 С Продавец   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2) С
.{?internal; isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct = 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 С Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) С
 С       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      С
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 С Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) С
.}
.fields
  if (Direct = 1, UnnORInn, OrgUnnORInn) + '/КПП продавца'

  if (Direct = 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN   + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

  if (Direct <> 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 С @@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2б) С
 С Покупатель   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3) С
.{?internal; isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct <> 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 С Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3а) С
 С       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      С
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 С Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3а) С
.}
.fields
  if (Direct <> 1, UnnORInn, OrgUnnORInn) + '/КПП покупателя'

  if (Direct <> 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN   + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

  Dollar + ', ' + ISO
  IGK
.endfields
 С @@@@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3б) С
 С Валюта: наименование, код   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (4) С
 С Идентификатор государственного контракта, договора (соглашения)   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (5) С
.if Dopol
.begin
  isDopol := true;
end.
.end
.{ CheckEnter FeeSignersMember_Schfrees_Dir
.begin
  NumSigner++;
  arrFIO_Dir[NumSigner] := Signer_FIO_Director;
  arrPosition_Dir[NumSigner] := Signer_Position_Director;
  if (Signer_Dover_Director <> '')
    arrDover_Dir[NumSigner] := '(' + Signer_Dover_Director + ')';
end.
.}
.begin
  NumSigner := 0;
end.
.{ CheckEnter FeeSignersMember_Schfrees_Buh
.begin
  NumSigner++;
  arrFIO_Buh[NumSigner] := Signer_FIO_MainBuh;
  arrPosition_Buh[NumSigner] := Signer_Position_MainBuh;
  if (Signer_Dover_MainBuh <> '')
    arrDover_Buh[NumSigner] := '(' + Signer_Dover_MainBuh + ')';
end.
.}
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌──────────────────────┬──────────────────────┬────────────────┬──────────┬─────────────┬───────────────┬──────────┬──────┬─────────────┬───────────────┐ Ш
 Ш│  Наименование товара │ Показатели в связи с │     Единица    │Количество│    Цена     │   Стоимость   │  В том   │Нало- │Сумма налога │   Стоимость   │ Ш
 Ш│(описание выполненных │ изменением стоимости │    измерения   │ (объем)  │  (тариф) за │ товаров (ра-  │  числе   │говая │             │ товаров (ра-  │ Ш
 Ш│   работ, оказанных   │ отгруженных товаров  ├─────┬──────────┤          │ единицу из- │ бот, услуг),  │  сумма   │ставка│             │ бот, услуг),  │ Ш
 Ш│услуг), имущественного│ (выполненных работ,  │ Код │ Условное │          │   мерения   │ имущественных │  акциза  │      │             │ имущественных │ Ш
 Ш│        права         │   оказанных услуг),  │     │ обозначе-│          │             │     прав      │          │      │             │  прав с нало- │ Ш
 Ш│                      │      переданных      │     │ние(нацио-│          │             │  без налога - │          │      │             │  гом - всего  │ Ш
 Ш│                      │  имущественных прав  │     │ нальное) │          │             │     всего     │          │      │             │               │ Ш
 Ш├──────────────────────┼──────────────────────┼─────┼──────────┼──────────┼─────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
 Ш│           1          │          1а          │  2  │    2а    │     3    │      4      │       5       │     6    │   7  │      8      │       9       │ Ш
 Ш├──────────────────────┼──────────────────────┼─────┼──────────┼──────────┼─────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
.{CheckEnter SpSchf
.begin
  Sign := if (SpSumma < 0, -1.0, 1.0);
end.
.fields
  #f_(SpName + if (SpTNVED <> '', ', ВЭД ' + SpTNVED, '') + if (SpDopol <> '', ' ' + SpDopol, ''))
  #f_(if (SpPrMC = 3, '', SpKodEd))
  #f_(if (SpPrMC = 3, '', SpABBREd))

  if (SpPrMC = 3, '-', if (abs(SpKol_Src) >= dMinKol, string(SpKol_Src, 0, Kol_Pr), '-'))
  if (SpPrMC = 3 or #isPrnPrice, 0.0, SpPrNoNds_Src)
  SpSumNoNds_Src
  if (abs(SpAkciz_Src) >= 0.00001, DoubleToStr(SpAkciz_Src, '\2p[|-]3666666666666666666.88'), 'без акциза')
  sSpPerc
  if (SpExistNDS or Abs(SpPerc) >= 0.01, DoubleToStr(SpNDS_Src, '\2p[|-]3666666666666666666.88'), 'без НДС')
  SpSumma_Src

  #f_(if (SpPrMC = 3, '', SpKodEd))
  #f_(if (SpPrMC = 3, '', SpABBREd))

  if (SpPrMC = 3, '0.0', if (abs(SpKol_Src + SpKol) >= dMinKol, string(SpKol_Src + SpKol, 0, Kol_Pr), '-'))
  if (SpPrMC = 3 or #isPrnPrice, 0.0,
    if (abs(SpKol) >= dMinKol, (SpPrNoNds_Src * SpKol_Src + SpPrNoNds * SpKol) / (SpKol_Src + SpKol), (SpPrNoNds_Src + SpPrNoNds)))
  (SpSumNoNds_Src + SpSumNoNDS)
  if (abs(SpAkciz_Src + SpAkciz) >= 0.00001, DoubleToStr(SpAkciz_Src + SpAkciz, '\2p[|-]3666666666666666666.88'), 'без акциза')
  sSpPerc
  if ((SpExistNDS or Abs(SpPerc) >= 0.01), DoubleToStr(SpNDS_Src + SpNDS, '\2p[|-]3666666666666666666.88'), 'без НДС')
  (SpSumma_Src + SpSumma)

  if (Sign > 0, Sign * SpSumNoNDS, 0.0)
  if (Sign > 0, Sign * SpAkciz, 0.0)
  if (Sign > 0, if (SpExistNDS or Abs(SpPerc) >= 0.01, DoubleToStr(Sign * SpNDS, '\2p[|-]3666666666666666666.88'), '-'), '-')
  if (Sign > 0, Sign * SpSumma, 0.0)

  if (Sign < 0, Sign * SpSumNoNDS, 0.0)
  if (Sign < 0, Sign * SpAkciz, 0.0)
  if (Sign < 0, if (SpExistNDS or Abs(SpPerc) >= 0.01, DoubleToStr(Sign * SpNDS, '\2p[|-]3666666666666666666.88'), '-'), '-')
  if (Sign < 0, Sign * SpSumma, 0.0)
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@@@│А (до изменения)      │@~@@@│@~@@@@@@@@│&#&&&&&&&&│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&.&&│@~#@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш│                      │Б (после изменения)   │@~@@@│@~@@@@@@@@│&#&&&&&&&&│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&.&&│@~#@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш│                      │В (увеличение)        │  X  │     X    │     X    │      X      │&#&&&&&&&&&&.&&│&#&&&&&.&&│   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш│                      │Г (уменьшение)        │  X  │     X    │     X    │      X      │&#&&&&&&&&&&.&&│&#&&&&&.&&│   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.fields
   ItSumNoNDS_Dop
   ItNDS_Dop
   ItSumma_Dop

   ItSumNoNDS
   ItNDS
   ItSumma
.endfields
 Ш├──────────────────────┴──────────────────────┴─────┴──────────┴──────────┴─────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
 Ш│  Всего увеличение (сумма строк В)                                                     │&#&&&&&&&&&&.&&│     X    │   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш├───────────────────────────────────────────────────────────────────────────────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
 Ш│  Всего уменьшение (сумма строк Г)                                                     │&#&&&&&&&&&&.&&│     X    │   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш└───────────────────────────────────────────────────────────────────────────────────────┴───────────────┴──────────┴──────┴─────────────┴───────────────┘ Ш
.begin
  NumSigner  := 1;
  KolSigners := if(KolSigners_Director >= KolSigners_MainBuh, KolSigners_Director, KolSigners_MainBuh);

  sDirector := if (KolSigners_Director > 0, arrFIO_Dir[NumSigner], Director);
  sMainBuh  := if (KolSigners_MainBuh  > 0, arrFIO_Buh[NumSigner], Main_Buh);
end.
.fields
   sDirector
   sMainBuh
   arrDover_Dir[NumSigner]
   arrDover_Buh[NumSigner]
.endfields

 Ш
       Руководитель организации                                                  Главный бухгалтер
       или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{While (NumSigner < KolSigners)
.begin
  NumSigner++;
  IsDirector := if(KolSigners_Director >= NumSigner, true, false);
  IsBuh := if(KolSigners_MainBuh >= NumSigner, true, false);
end.
.{?internal; (isDirector and isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Dir   [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (isDirector and not isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrDover_Dir   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (not isDirector and isBuh)
.fields
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш                                                                                 @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                                 (подпись)           (Ф.И.О.)
                                                                                                         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.}
.begin
  sIP_Under_Info1 := '(реквизиты свидетельства о государственной регистрации';
  sIP_Under_Info2 := 'индивидуального предпринимателя)';
end.
.fields
  IP_FIO
  IP_Info
  sIP_Under_Info1
  sIP_Under_Info2
.endfields
 Ш     Индивидуальный предприниматель  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{?internal; (isDopol)
.fields
  Nazn
.endfields
 Ш
 Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.)
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.}
.fields
  MemoIP_Info
.endfields
 Ш
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

 Ш

.} // Schf
.endform

#doc
Счет-фактура (формат A4), с 01.10.2017г.
#end
.linkform 'Schfrees_85' prototype is 'Schfrees'
.NameInList 'Счет-фактура (формат A4), с 01.10.2017г.'
.Group 'Бланки счетов-фактур (с 2017г.)'
.Group 'Country' subGroup 'Russia'
.set filler '-'
!-------------------------------------------------------------------
.create view vSchf
From
  SchFact
where
((
  nSchFact == SchFact.nRec
));
!-------------------------------------------------------------------
.var
  StrPrim1, StrPrim2 : String;
  EmptyField : string;

  NumSigner  : word;
  KolSigners : word;
  arrFIO_Dir      : array[1..10] of string;
  arrPosition_Dir : array[1..10] of string;
  arrDover_Dir    : array[1..10] of string;
  arrFIO_Buh      : array[1..10] of string;
  arrPosition_Buh : array[1..10] of string;
  arrDover_Buh    : array[1..10] of string;
  isDirector      : boolean;
  isBuh           : boolean;
  wTipUser        : word;
  sDirector       : string;
  sMainBuh        : string;
  isPostAddr      : boolean;
  sIP_Under_Info1 : string;
  sIP_Under_Info2 : string;

  isExistNDS_InList : boolean;
  sSpNDS            : string;
  isNalAg           : boolean;
  isDopol           : boolean;
.endvar
.begin
  isPostAddr := (ppPrintField and 1) <> 0;
  EmptyField := if(wCountry=0,'-','');
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  if (vSchf.GetFirst SchFact = 0)
    wTipUser := SchFact.TipUser;
  isNalAg := ((wTipUser = 7228) or (wTipUser = 7229) or (wTipUser = 7230));

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Dir     [NumSigner] := '';
    arrPosition_Dir[NumSigner] := '';
    arrDover_Dir   [NumSigner] := '';
  }

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Buh     [NumSigner] := '';
    arrPosition_Buh[NumSigner] := '';
    arrDover_Buh   [NumSigner] := '';
  }

  NumSigner := 0;
  isExistNDS_InList := false;
  isDopol := false;
end.
.fields
  NSF
  if(longint(dFact)<>0, DateToStr(dFact, '"DD" Mon YYYY г.'), '')
  #f_(nRevision)
  if(longint(dRevision)<>0, DateToStr(dRevision, '"DD" Mon YYYY г.'),'-')

  if (Direct = 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 Ш                                                                                                                                        Приложение № 1 Ш
 Ш                                                                                                                         к постановлению Правительства Ш
 Ш                                                                                                                                  Российской Федерации Ш
 Ш                                                                                                                          от 26 декабря 2011 г. № 1137 Ш
 Ш                                                                                           (в ред. Постановления Правительства РФ от 19.08.2017 № 981) Ш


 Й               СЧЕТ-ФАКТУРА № @~@@@@@@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@@ (1) Й
 Й                ИСПРАВЛЕНИЕ № @~@@@@@@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@ (1а) Й

 Й Продавец   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (2) Й
.{?internal; isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct = 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 Й Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) Й
 Й       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      Й
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 Й Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) Й
.}
.fields
  if (Direct = 1, UnnORInn, OrgUnnORInn) + '/КПП продавца'

  if (Direct = 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

!  #f_ не использовать, т.к. мемо
  //WideString(GruzFrom)+WideString(GruzFromAddr) - приводит к такому, но выводит все.
  // Грузоотправитель и его адрес  _______________________________________________        (3)
  // Грузоотправитель и его адрес  _______________________________________________
  // Грузоотправитель и его адрес  _______________________________________________

  GruzFrom
  Substr(GruzFromAddr,3,255) // Нужно вырезать ", "
  GruzTo
  Substr(GruzToAddr,3,255) // Нужно вырезать ", "

  if(PlatNo_Date <> '', PlatNo_Date, '№  -  от  -')

  if (Direct <> 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 Й @@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2б) Й
 Й Грузоотправитель и его адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (3) Й
.{?Internal; GruzFromAddr<>''
 Й                                Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      Й
.}
 Й Грузополучатель и его адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (4) Й
.{?Internal; GruzToAddr<>''
 Й                               Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      Й
.}
 Й К платежно-расчетному документу   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (5) Й
 Й Покупатель   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (6) Й
.{?internal; isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct <> 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 Й Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (6а) Й
 Й       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      Й
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 Й Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (6а) Й
.}
.fields
  if (Direct <> 1, UnnORInn, OrgUnnORInn) + '/КПП покупателя'

  if (Direct <> 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN   + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

  Dollar + ', ' + ISO
  IGK
.endfields
 Й @@@@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (6б) Й
 Й Валюта: наименование, код   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (7) Й
 Й Идентификатор государственного контракта,                                                    Й
 Й договора (соглашения)(при наличии)  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (8) Й
.if Dopol
.begin
  isDopol := true;
end.
.end
.{ CheckEnter FeeSignersMember_Schfrees_Dir
.begin
  NumSigner++;
  arrFIO_Dir[NumSigner] := Signer_FIO_Director;
  arrPosition_Dir[NumSigner] := Signer_Position_Director;
  if (Signer_Dover_Director <> '')
    arrDover_Dir[NumSigner] := '(' + Signer_Dover_Director + ')';
end.
.}
.begin
  NumSigner := 0;
end.
.{ CheckEnter FeeSignersMember_Schfrees_Buh
.begin
  NumSigner++;
  arrFIO_Buh[NumSigner] := Signer_FIO_MainBuh;
  arrPosition_Buh[NumSigner] := Signer_Position_MainBuh;
  if (Signer_Dover_MainBuh <> '')
    arrDover_Buh[NumSigner] := '(' + Signer_Dover_MainBuh + ')';
end.
.}
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌───────────────────┬─────┬────────────────┬──────────┬────────────┬───────────────┬─────────┬──────┬─────────────┬───────────────┬──────────────┬─────────┐ Ш
 Ш│Наименование товара│ Код │    Единица     │Количество│   Цена     │   Стоимость   │  В том  │Нало- │Сумма налога,│   Стоимость   │    Страна    │Регистра-│ Ш
 Ш│(описание выполнен-│вида │    измерения   │ (объем)  │ (тариф) за │ товаров (ра-  │  числе  │говая │предъявляемая│ товаров (ра-  │ происхождения│ ционный │ Ш
 Ш│ных работ, оказан- │това-├─────┬──────────┤          │ единицу из-│ бот, услуг),  │  сумма  │ставка│ покупателю  │ бот, услуг),  │    товара    │  номер  │ Ш
 Ш│     ных услуг),   │ ра  │ Код │ Условное │          │ мерения    │ имущественных │  акциза │      │             │ имущественных ├──────┬───────┤таможен- │ Ш
 Ш│  имущественного   │     │     │ обозначе-│          │            │     прав      │         │      │             │  прав с нало- │Цифро-│Краткое│ной дек- │ Ш
 Ш│      права        │     │     │ние(нацио-│          │            │  без налога - │         │      │             │  гом - всего  │ вой  │ наиме-│ ларации │ Ш
 Ш│                   │     │     │ нальное) │          │            │     всего     │         │      │             │               │ код  │нование│         │ Ш
 Ш├───────────────────┼─────┼─────┼──────────┼──────────┼────────────┼───────────────┼─────────┼──────┼─────────────┼───────────────┼──────┼───────┼─────────┤ Ш
 Ш│          1        │ 1а  │  2  │    2а    │     3    │      4     │       5       │    6    │   7  │      8      │       9       │  10  │  10а  │    11   │ Ш
 Ш├───────────────────┼─────┼─────┼──────────┼──────────┼────────────┼───────────────┼─────────┼──────┼─────────────┼───────────────┼──────┼───────┼─────────┤ Ш
.{CheckEnter SpSchf
.begin
  sSpNDS := if (SpPrMC = 101 or isNDS_NA, '-',
              if (SpPrMC = 102, if (SpPerc = -1, 'без НДС', DoubleToStr(SpNDS, '\2p[|-]3666666666666666666.88')),
                if (SpExistNDS or Abs(SpPerc) >= 0.01,
                  DoubleToStr(SpNDS, '\2p[|-]3666666666666666666.88'), 'без НДС')));

  if(not isExistNDS_InList)
    isExistNDS_InList := (sSpNDS <> 'без НДС');
end.
.fields
  #f_(SpName + if (SpDopol <> '', ' ' + SpDopol, ''))
  #f_(SpTNVED)
  #f_(if (SpPrMC = 3, '', SpKodEd))
  #f_(if (SpPrMC = 3, '', SpABBREd))
  if (SpPrMC = 101 or SpPrMC = 102, '-',
    if (SpPrMC = 3, '-', if (abs(SpKol) >= dMinKol, string(SpKol, 0, Kol_Pr), '-')))
  if (SpPrMC = 3 or #isPrnPrice or #IsPeny, 0.0, SpPrNoNds)
  if (#IsPeny, 0.0, SpSumNoNDS)
  if (((SpPrMC = 101 or SpPrMC = 102) and (not IsNalAg)), '-', if ((Abs(SpAkciz) >= 0.00001), DoubleToStr(SpAkciz, '\2p[|-]3666666666666666666.88'),
                                                                   if ((Abs(SpSumma) >= 0.00001), 'без акциза', '-')))
  if (isNDS_NA, 'НДС исчис-ляется нало- говым аген- том', sSpPerc)
  sSpNDS
  if (isNDS_NA, '-', DoubleToStr(SpSumma, '\2p[|-]3666666666666666666.88'))
  GTDKod
  GTDCountry
  GTDNomer
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@│@@@@@│@~@@@│@~@@@@@@@@│&#&&&&&&&&│&#&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&.&&│@~#@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│@~@@@@│@~@@@@@│@~@@@@@@@│ Ш
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.fields
  if (Abs(ItSumNoNDS) >= 0.01, DoubleToStr(ItSumNoNDS, '\2p[|-]3666666666666666666.88'), '')
  if (isExistNDS_InList, if (isNDS_NA, '-', DoubleToStr(ItNDS, '\2p[|-]3666666666666666666.88')), 'без НДС')
  if (isNDS_NA, '-', DoubleToStr(ItSumma, '\2p[|-]3666666666666666666.88'))
.endfields
 Ш├───────────────────┴─────┴─────┴──────────┴──────────┴────────────┼───────────────┼─────────┴──────┼─────────────┼───────────────┼──────┴───────┴─────────┘ Ш
 Ш│  Всего к оплате                                                  │&#&&&&&&&&&&.&&│       X        │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш└──────────────────────────────────────────────────────────────────┴───────────────┴────────────────┴─────────────┴───────────────┘ Ш
.begin
  NumSigner  := 1;
  KolSigners := if(KolSigners_Director >= KolSigners_MainBuh, KolSigners_Director, KolSigners_MainBuh);

  sDirector := if (KolSigners_Director > 0, arrFIO_Dir[NumSigner], Director);
  sMainBuh  := if (KolSigners_MainBuh  > 0, arrFIO_Buh[NumSigner], Main_Buh);
end.
.fields
   sDirector
   sMainBuh
   arrDover_Dir[NumSigner]
   arrDover_Buh[NumSigner]
.endfields

 Ш
       Руководитель организации                                                  Главный бухгалтер
       или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{While (NumSigner < KolSigners)
.begin
  NumSigner++;
  IsDirector := if(KolSigners_Director >= NumSigner, true, false);
  IsBuh := if(KolSigners_MainBuh >= NumSigner, true, false);
end.
.{?internal; (isDirector and isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Dir   [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (isDirector and not isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrDover_Dir   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (not isDirector and isBuh)
.fields
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш                                                                                 @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                                 (подпись)           (Ф.И.О.)
                                                                                                         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.}
.begin
  sIP_Under_Info1 := '(реквизиты свидетельства о государственной регистрации';
  sIP_Under_Info2 := 'индивидуального предпринимателя)';
end.
.fields
  IP_FIO
  IP_Info
  sIP_Under_Info1
  sIP_Under_Info2
.endfields
 Ш     Индивидуальный предприниматель
     или иное уполномоченное лицо     _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{?internal; (isDopol)
.fields
  Nazn
.endfields
 Ш
 Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.)
 @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.}
.fields
  MemoIP_Info
.endfields
 Ш @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.} // Schf
.endform

#doc
Корректировочный счет-фактура (с 01.10.2017)
#end
.linkform 'Schfrees_86' prototype is 'Schfrees'
.NameInList 'Корректировочный счет-фактура (c 01.10.2017)'
.Group 'Бланки корректировочных счетов-фактур'
.Group 'Country' subGroup 'Russia'
.set filler '-'
!-------------------------------------------------------------------
.create view vSchf
From
  SchFact
where
((
  nSchFact == SchFact.nRec
));
!-------------------------------------------------------------------
.var
  StrPrim1, StrPrim2 : String;
  EmptyField : string;

  NumSigner  : word;
  KolSigners : word;
  arrFIO_Dir        : array[1..10] of string;
  arrPosition_Dir   : array[1..10] of string;
  arrDover_Dir      : array[1..10] of string;
  arrFIO_Buh        : array[1..10] of string;
  arrPosition_Buh   : array[1..10] of string;
  arrDover_Buh      : array[1..10] of string;
  isDirector        : boolean;
  isBuh             : boolean;
  wTipUser          : word;
  sDirector         : string;
  sMainBuh          : string;
  Sign              : double;
  isPostAddr        : boolean;
  sIP_Under_Info1   : string;
  sIP_Under_Info2   : string;
  isDopol           : boolean;
  isExistNDS_InList : boolean;
.endvar
.begin
  isPostAddr := (ppPrintField and 1) <> 0;
  EmptyField := if(wCountry=0,'-','');
  isDopol    := false;
end.
!-------------------------------------------------------------------
.if SetDateRange
.end
.{CheckEnter Schf
.if HeaderGroup
.end
.begin
  if (vSchf.GetFirst SchFact = 0)
    wTipUser := SchFact.TipUser;

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Dir     [NumSigner] := '';
    arrPosition_Dir[NumSigner] := '';
    arrDover_Dir   [NumSigner] := '';
  }

  for (NumSigner := 1; NumSigner <= 10; NumSigner++)
  {
    arrFIO_Buh     [NumSigner] := '';
    arrPosition_Buh[NumSigner] := '';
    arrDover_Buh   [NumSigner] := '';
  }

  NumSigner := 0;

  isExistNDS_InList := false;
end.
.fields
  NSF_CorrV
  if (LongInt(dFact_CorrV) <> 0, DateToStr(dFact_CorrV, '"DD" Mon YYYY г.'), '-')
  #f_(nRevision_CorrV)
  if (LongInt(dRevision_CorrV) <> 0, DateToStr(dRevision_CorrV, '"DD" Mon YYYY г.'), '-')
    SF_Src_List
  #f_(nRevision)
  if (LongInt(dRevision) <> 0, DateToStr(dRevision, '"DD" Mon YYYY г.'), '-')

  if (Direct = 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 Ш                                                                                                                                        Приложение № 2 Ш
 Ш                                                                                                                         к постановлению Правительства Ш
 Ш                                                                                                                                  Российской Федерации Ш
 Ш                                                                                                                          от 26 декабря 2011 г. № 1137 Ш
 Ш                                                                                           (в ред. Постановления Правительства РФ от 19.08.2017 № 981) Ш


 С КОРРЕКТИРОВОЧНЫЙ СЧЕТ-ФАКТУРА № @~@@@@@@@@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@                                     (1) С
 С ИСПРАВЛЕНИЕ КОРРЕКТИРОВОЧНОГО СЧЕТА-ФАКТУРЫ № @~@@@@@@@@@@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@@@@@                             (1а) С
 С к СЧЕТУ-ФАКТУРЕ(СЧЕТАМ-ФАКТУРАМ) № @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      С
 С с учетом исправления № @~@@@@@@@@ от @@@@@@@@@@@@@@@@@@@@@@                                                                 (1б) С


 С Продавец   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2) С
.{?internal; isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct = 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 С Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) С
 С       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      С
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct = 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct = 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 С Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2а) С
.}
.fields
  if (Direct = 1, UnnORInn, OrgUnnORInn) + '/КПП продавца'

  if (Direct = 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN   + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

  if (Direct <> 1,
      #f_(MyOrgName),
      #f_(OrgName))
.endfields
 С @@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (2б) С
 С Покупатель   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3) С
.{?internal; isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) <> '')
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))

  if (Direct <> 1,
      #f_(MyPostAddr),
      #f_(PostAddr))
.endfields
 С Адрес юридический  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3а) С
 С       почтовый  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б      С
.}
.{?internal; (not isPostAddr) or (isPostAddr and (Trim(if (Direct <> 1, MyPostAddr, PostAddr)) = ''))
.fields
  if (Direct <> 1,
      #f_(MyOrgAddr),
      #f_(OrgAddr))
.endfields
 С Адрес   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3а) С
.}
.fields
  if (Direct <> 1, UnnORInn, OrgUnnORInn) + '/КПП покупателя'

  if (Direct <> 1,
      #f_(if ((ltrim(trim(MyOrgINN), '-') = '') and (ltrim(trim(MyOrgKPP), '-') = ''), '-', MyOrgINN + if ((trim(MyOrgKPP) <> ''), ' / ' + MyOrgKPP, ''))),
      #f_(if ((ltrim(trim(OrgINN), '-') = '') and (ltrim(trim(OrgKPP), '-') = ''), '-', OrgINN   + if ((trim(OrgKPP)   <> ''), ' / ' + OrgKPP  , ''))))

  Dollar + ', ' + ISO
  IGK
.endfields
 С @@@@@@@@@@@@@@@@@@@  Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б (3б) С
 С Валюта: наименование, код   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (4) С
 С Идентификатор государственного контракта, договора (соглашения) (при наличии)   Б@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Б  (5) С
.if Dopol
.begin
  isDopol := true;
end.
.end
.{ CheckEnter FeeSignersMember_Schfrees_Dir
.begin
  NumSigner++;
  arrFIO_Dir[NumSigner] := Signer_FIO_Director;
  arrPosition_Dir[NumSigner] := Signer_Position_Director;
  if (Signer_Dover_Director <> '')
    arrDover_Dir[NumSigner] := '(' + Signer_Dover_Director + ')';
end.
.}
.begin
  NumSigner := 0;
end.
.{ CheckEnter FeeSignersMember_Schfrees_Buh
.begin
  NumSigner++;
  arrFIO_Buh[NumSigner] := Signer_FIO_MainBuh;
  arrPosition_Buh[NumSigner] := Signer_Position_MainBuh;
  if (Signer_Dover_MainBuh <> '')
    arrDover_Buh[NumSigner] := '(' + Signer_Dover_MainBuh + ')';
end.
.}
.{CheckEnter SchfKatSopr
.{CheckEnter SchfSpSopr
.{CheckEnter SchfSpSoprNalog
.} // SchfSpSoprNalog
.} // SchfSpSopr
.} // SchfKatSopr

 Ш┌────────────────────┬────────────────────┬─────┬────────────────┬──────────┬─────────────┬───────────────┬──────────┬──────┬─────────────┬───────────────┐ Ш
 Ш│ Наименование товара│Показатели в связи с│ Код │    Единица     │Количество│    Цена     │   Стоимость   │  В том   │Нало- │Сумма налога │   Стоимость   │ Ш
 Ш│ (описание выполнен-│изменением стоимости│вида │    измерения   │ (объем)  │  (тариф) за │ товаров (ра-  │  числе   │говая │             │ товаров (ра-  │ Ш
 Ш│ных работ, оказанных│отгруженных товаров │това-├─────┬──────────┤          │ единицу из- │ бот, услуг),  │  сумма   │ставка│             │ бот, услуг),  │ Ш
 Ш│услуг), имуществен- │(выполненных работ, │ ра  │ Код │ Условное │          │   мерения   │ имущественных │  акциза  │      │             │ имущественных │ Ш
 Ш│     ного права     │  оказанных услуг), │     │     │ обозначе-│          │             │     прав      │          │      │             │  прав с нало- │ Ш
 Ш│                    │     переданных     │     │     │ние(нацио-│          │             │  без налога - │          │      │             │  гом - всего  │ Ш
 Ш│                    │ имущественных прав │     │     │ нальное) │          │             │     всего     │          │      │             │               │ Ш
 Ш├────────────────────┼────────────────────┼─────┼─────┼──────────┼──────────┼─────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
 Ш│           1        │          1а        │  1б │  2  │    2а    │     3    │      4      │       5       │     6    │   7  │      8      │       9       │ Ш
 Ш├────────────────────┼────────────────────┼─────┼─────┼──────────┼──────────┼─────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
.{CheckEnter SpSchf
.begin
  Sign := if (SpSumma < 0, -1.0, 1.0);

  if (not isExistNDS_InList)
    isExistNDS_InList := (SpExistNDS or Abs(SpPerc) >= 0.01);
end.
.fields
  #f_(SpName + if (SpDopol <> '', ' ' + SpDopol, ''))
  //До изменения
  #f_(SpTNVED)
  #f_(if (SpPrMC = 3, '', SpKodEd))
  #f_(if (SpPrMC = 3, '', SpABBREd))

  if (SpPrMC = 3, '-', if (abs(SpKol_Src) >= dMinKol, string(SpKol_Src, 0, Kol_Pr), '-'))
  if (SpPrMC = 3 or #isPrnPrice, 0.0, SpPrNoNds_Src)
  SpSumNoNds_Src
  if (abs(SpAkciz_Src) >= 0.00001, DoubleToStr(SpAkciz_Src, '\2p[|-]3666666666666666666.88'), 'без акциза')
  if ((Flag and 1) > 0, String(SpPerc_Src),
    if (isNDS_NA, 'НДС исчис-ляется нало- говым аген- том', sSpPerc))
  if (isNDS_NA, '-', if (SpExistNDS or (Abs(SpPerc) >= 0.01) or ((Flag and 1) > 0), DoubleToStr(SpNDS_Src, '\2p[|-]3666666666666666666.88'), 'без НДС'))
  if (isNDS_NA, '-', DoubleToStr(SpSumma_Src, '\2p[|-]3666666666666666666.88'))

  //После изменения
  #f_(SpTNVED)
  #f_(if (SpPrMC = 3, '', SpKodEd))
  #f_(if (SpPrMC = 3, '', SpABBREd))

  if (SpPrMC = 3, '0.0', if (abs(SpKol_Src + SpKol) >= dMinKol, string(SpKol_Src + SpKol, 0, Kol_Pr), '-'))
  if (SpPrMC = 3 or #isPrnPrice, 0.0,
      if (abs(SpKol+SpKol_Src) >= dMinKol //ERP-1336 -если кол-во 0, цену берем из до abs(SpKol) >= dMinKol
                               , (SpPrNoNds_Src * SpKol_Src + SpPrNoNds * if ((Flag and 2) = 0, SpKol, -1 * SpKol)) / (SpKol_Src + SpKol)
                               , if(SpKol_Src=0, (SpPrNoNds_Src + SpPrNoNds) ,SpPrNoNds_Src) // если кол-во до не 0, выведем цену до
         )
    )
  (SpSumNoNds_Src + SpSumNoNDS)
  if (abs(SpAkciz_Src + SpAkciz) >= 0.00001, DoubleToStr(SpAkciz_Src + SpAkciz, '\2p[|-]3666666666666666666.88'), 'без акциза')
  if (isNDS_NA, 'НДС исчис-ляется нало- говым аген- том', sSpPerc)
  if (isNDS_NA, '-', if ((SpExistNDS or Abs(SpPerc) >= 0.01), DoubleToStr(SpNDS_Src + SpNDS, '\2p[|-]3666666666666666666.88'), 'без НДС'))
  if (isNDS_NA, '-', DoubleToStr((SpSumma_Src + SpSumma), '\2p[|-]3666666666666666666.88'))

  if (Sign > 0, Sign * SpSumNoNDS, 0.0)
  if (Sign > 0, Sign * SpAkciz, 0.0)
  if (Sign > 0, if (isNDS_NA, '-', if (SpExistNDS or Abs(SpPerc) >= 0.01, DoubleToStr(Sign * SpNDS, '\2p[|-]3666666666666666666.88'), '-')), if(isNDS_NA, '', '-'))
  if (Sign > 0, if (isNDS_NA, '-', DoubleToStr(Sign * SpSumma, '\2p[|-]3666666666666666666.88')), if (isNDS_NA, '', '-'))

  if (Sign < 0, Sign * SpSumNoNDS, 0.0)
  if (Sign < 0, Sign * SpAkciz, 0.0)
  if (Sign < 0, if(isNDS_NA, '-', if (SpExistNDS or Abs(SpPerc) >= 0.01, DoubleToStr(Sign * SpNDS, '\2p[|-]3666666666666666666.88'), '-')), if (isNDS_NA, '', '-'))
  if (Sign < 0, if (isNDS_NA, '-', DoubleToStr(Sign * SpSumma, '\2p[|-]3666666666666666666.88')), if (isNDS_NA, '', '-'))
.endfields
 Ш│@@@@@@@@@@@@@@@@@@@@│А (до изменения)    │@@@@@│@~@@@│@~@@@@@@@@│&#&&&&&&&&│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&.&&│@~#@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш│                    │Б (после изменения) │@@@@@│@~@@@│@~@@@@@@@@│&#&&&&&&&&│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│&#&&&&&.&&│@~#@@@│&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш│                    │В (увеличение)      │     │  X  │     X    │     X    │      X      │&#&&&&&&&&&&.&&│&#&&&&&.&&│   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш│                    │Г (уменьшение)      │     │  X  │     X    │     X    │      X      │&#&&&&&&&&&&.&&│&#&&&&&.&&│   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
.} // SpSchf
.{CheckEnter KazSt
.}
.{CheckEnter NalogFinSchf
.} // NalogFinSchf
.if ItogoGroup       // итого по группе. Если true, то не печатать Итого
.end
.fields
   ItSumNoNDS_Dop
   if ((Flag and 1) > 0, DoubleToStr(SpNDS, '\2p[|-]3666666666666666666.88'),
     if (Abs(ItNDS_Dop) > 0.001, if (isNDS_NA, '-', DoubleToStr(ItNDS_Dop, '\2p[|-]3666666666666666666.88')), if (isNDS_NA, '', '-')))
   if ((Flag and 1) > 0, DoubleToStr(SpSumma, '\2p[|-]3666666666666666666.88'),
     if (Abs(ItSumma_Dop) > 0.001, if (isNDS_NA, '-', DoubleToStr(ItSumma_Dop, '\2p[|-]3666666666666666666.88')), if (isNDS_NA, '', '-')))

   ItSumNoNDS
   if (Abs(ItNDS) > 0.001, if (isNDS_NA, '-', DoubleToStr(ItNDS, '\2p[|-]3666666666666666666.88')), if (isNDS_NA, '', '-'))
   if (Abs(ItSumma) > 0.001, if (isNDS_NA, '-', DoubleToStr(ItSumma, '\2p[|-]3666666666666666666.88')), if (isNDS_NA, '', '-'))
.endfields
 Ш├────────────────────┴────────────────────┴─────┴─────┴──────────┴──────────┴─────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
 Ш│  Всего увеличение (сумма строк В)                                                       │&#&&&&&&&&&&.&&│     X    │   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш├─────────────────────────────────────────────────────────────────────────────────────────┼───────────────┼──────────┼──────┼─────────────┼───────────────┤ Ш
 Ш│  Всего уменьшение (сумма строк Г)                                                       │&#&&&&&&&&&&.&&│     X    │   X  │&#&&&&&&&&.&&│&#&&&&&&&&&&.&&│ Ш
 Ш└─────────────────────────────────────────────────────────────────────────────────────────┴───────────────┴──────────┴──────┴─────────────┴───────────────┘ Ш
.begin
  NumSigner  := 1;
  KolSigners := if(KolSigners_Director >= KolSigners_MainBuh, KolSigners_Director, KolSigners_MainBuh);

  sDirector := if (KolSigners_Director > 0, arrFIO_Dir[NumSigner], Director);
  sMainBuh  := if (KolSigners_MainBuh  > 0, arrFIO_Buh[NumSigner], Main_Buh);
end.
.fields
   sDirector
   sMainBuh
   arrDover_Dir[NumSigner]
   arrDover_Buh[NumSigner]
.endfields

 Ш
       Руководитель организации                                                  Главный бухгалтер
       или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   или иное уполномоченное лицо  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{While (NumSigner < KolSigners)
.begin
  NumSigner++;
  IsDirector := if(KolSigners_Director >= NumSigner, true, false);
  IsBuh := if(KolSigners_MainBuh >= NumSigner, true, false);
end.
.{?internal; (isDirector and isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Dir   [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                                              (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@                           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (isDirector and not isBuh)
.fields
  arrPosition_Dir[NumSigner]
  arrFIO_Dir     [NumSigner]
  arrDover_Dir   [NumSigner]
.endfields
 Ш       @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)
                               @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.{?internal; (not isDirector and isBuh)
.fields
  arrPosition_Buh[NumSigner]
  arrFIO_Buh     [NumSigner]
  arrDover_Buh   [NumSigner]
.endfields
 Ш                                                                                 @@@@@@@@@@@@@@@@@@@@@@@@@@@@  _____________   @@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                                 (подпись)           (Ф.И.О.)
                                                                                                         @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.}
.}
.begin
  sIP_Under_Info1 := '(реквизиты свидетельства о государственной регистрации';
  sIP_Under_Info2 := 'индивидуального предпринимателя)';
end.
.fields
  IP_FIO
  IP_Info
  sIP_Under_Info1
  sIP_Under_Info2
.endfields
 Ш     Индивидуальный предприниматель
     или иное уполномоченное лицо    _____________  @@@@@@@@@@@@@@@@@@@@@@@@@@   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                       (подпись)           (Ф.И.О.)                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
                                                                                                      @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.{?internal; (isDopol)
.fields
  Nazn
.endfields
 Ш  Дополнение (условия оплаты по договору (контракту), способ отправления и т.п.)
  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш
.}
.fields
  MemoIP_Info
.endfields
 Ш  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ Ш

.} // Schf
.endform
