
.function KolAddInStr(var Str:String;LengthStr:byte;UpdateStr:boolean):byte;
var
  iLine, KolSpace, KolOdd: word;
  TempStr        : String;
!Первый параметр - поле, второй длина поля (в RTF- формате использовать шрифт Courier New)
!Третий параметр - изменять или нет Str
!Ставит пробел в строке Str ч.з. каждые LtngthStr+1 символов (при печати этот пробел 'съедается' редактором
Begin
  TempStr := Str;

  if (Length(Str) <= LengthStr)
    Result := 0
  else
  {
    iLine := LengthStr;
    iLine++; //LengthStr + 1

    KolSpace := 0;

    do
    {
      KolOdd := 0;

      if (SubStr(Str, byte(iLine), 1) <> ' ') OR (iLine > 255)
      {
        var s1, s2: String;
        var l1, l2: byte;

        s1  := SubStr(Str, 1, if(iLine > 255, 255, byte(iLine - 1)));
        l1  := Length(s1);

        s2  := SubStr(Str, byte(iLine), 255);
        l2  := Length(s2);

        if (l1 + l2 + 1 > 255)
        {
          KolOdd := l1 + l2 - 254;
          s2 := SubStr(s2, 1, byte(l2 - KolOdd));
        }

        Str := s1 + ' ' + s2;
      }

      KolSpace++;//подсчитаем к-во пробелов

      iLine += LengthStr + 1;
    }
    while Length(Str) >= iLine //ставит в конце каждой строки пробел
!length(Str) >iLine - можно написать и так,тогда последнее слово в строке
!будет переходить на новую строку. Это не повлияет на подсчет строк...
    Result := byte((length(Str)-1-KolSpace) div LengthStr);// к-во доп. строк в наим. МЦ
  }

  if (NOT UpdateStr)
    Str := TempStr;
end.
