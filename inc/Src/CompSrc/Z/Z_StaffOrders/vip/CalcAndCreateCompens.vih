//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика ERP 8.10 - Управление персоналом
// Расчет дней компенсации по видам отпусков
//------------------------------------------------------------------------------

#ifndef _CalcAndCreateCompens_INCLUDED_
#define _CalcAndCreateCompens_INCLUDED_

#component "Z_StaffOrders"

table struct tpMsgCalc
(
  NPP           : word,
  MsgFlag       : longint,
  MsgCalc       : string,
  cPutVac       : comp,
  cWorkPeriod   : comp
)
with index
(
  tpMsgCalc01 = cWorkPeriod + NPP,
  tpMsgCalc02 = cPutVac + MsgFlag + NPP,
  tpMsgCalc03 = cPutVac + MsgFlag,
  tpMsgCalc04 = cWorkPeriod,
  tpMsgCalc05 = cPutVac + cWorkPeriod + MsgFlag
);

#doc
Расчет дней компенсации по видам отпусков
#end
ObjInterface oiCalcAndCreateCompens;

  #doc
  Расчет и заполнение списка компенсаций при увольнении
  #end
  public function CreateCompensationList(wSource : word; cSource : comp; dDisDate : date): boolean;
  deprecated 'вместо CreateCompensationList рекомендуется использовать метод CreateCompensationList_2';

  #doc
  Формирование фактического компенсаций при увольнении по списку рассчитанных (таблица PutVacCon)
  Перед запуском данного метода обязательна инициализация PrVidInit(100, 1), а после DoneVx(100) - иначе runtime
  #end
  public function CreateFactCompByPutVacCon(wSource : word; cSource : comp; dCompDate :date): comp;

  #doc
  Перенесенный из OtpuskCompens старый метод для поддержания функционала
  #end
  function GetFactCompensation( cFactNRec : comp ): double;
  #doc
  Перенесенный из OtpuskCompens старый метод для поддержания функционала
  #end
  function GetPlanCompensation( cPlanNRec: comp): double;
  #doc
  Перенесенный из OtpuskCompens старый метод для поддержания функционала
  #end
  function GetCompensation(cOtpNRec: comp): double;

end;

ObjInterface oiCalcAndCreateCompens1;

  #doc
  Заполнение ссылки на запись протокола расчета
  #end
  procedure SetMsgRec(cMsgR :comp);

  #doc
  Вывод в протокол расчета списка фактических отпусков из маркера liVacMark
  Перед использованием метода должен быть запуск SetMsgRec
  #end
  procedure ProtocolFactOtpuskList(liVacMark : TPtr);

  #doc
  Расчет пропорции отпускного стажа с начала РП по дату расчетную дату
  cWPer      - ссылка на рабочий период
  dCalc      - расчетная дата, по которую считается отпускной стаж
  Внутри метода происходит заполнение протокола при наличии ссылки на него, поэтому перед использованием метода обязателен
  запуск SetMsgRec с указанием ссылки на созданную запись протокола; если формировать протокол не надо - передать 0
  #end
  function CaclVacProportion(cWPer : comp; dCalc : date) : double;

  #doc
  Расчет количества дней (по алгоритму компенсаций) по полагающемуся отпуску
  cPutVacation - ссылка на полагающийся отпуск
  dCalcDate    - расчетная дата, на которую будет рассчитываться количество дней
  doProp       - пропорция отпускного стажа
  liVacMrk - маркер фактических отпусков, для вывода списка фактических отпусков после расчета всех полагающихся
  wNPP     - порядковый номер для вывода в протокол расчета
  Внутри метода происходит заполнение протокола при наличии ссылки на него, поэтому перед использованием метода обязателен
  запуск SetMsgRec с указанием ссылки на созданную запись протокола; если формировать протокол не надо - передать 0
  #end
  function CalcCountDaysLikeCompens(cPutVacation : comp; dCalcDate : date; doProp : double; liVacMrk : TPtr; wNPP : word): double;

end;

ObjInterface oiCalcAndCreateCompensEx2;

#doc
  Расчет количества дней (по алгоритму компенсаций) по полагающемуся отпуску
  cPutVacation - ссылка на полагающийся отпуск
  dCalcDate    - расчетная дата, на которую будет рассчитываться количество дней полагающихся
  dCalcFactDate - расчетная дата, на которую будет рассчитываться количество дней предоставленных
  doProp       - пропорция отпускного стажа
  liVacMrk - маркер фактических отпусков, для вывода списка фактических отпусков после расчета всех полагающихся
  wNPP     - порядковый номер для вывода в протокол расчета
  Внутри метода происходит заполнение протокола при наличии ссылки на него, поэтому перед использованием метода обязателен
  запуск SetMsgRec с указанием ссылки на созданную запись протокола; если формировать протокол не надо - передать 0
#end
  public function CalcCountDaysLikeCompensWithFactDate(cPutVacation : comp; dCalcDate, dCalcFactDate: date; doProp : double; liVacMrk : TPtr; wNPP : word): double;

end;

ObjInterface oiCalcAndCreateCompensEx3;

#doc
  Расчет отработанных месяцев с даты (dWPBeg) по дату (dDisMiss). Функция не предназначена для РБ и Украины.
    cLSchet  - ссылка на л/с сотрудника
    wFlCheck - флаги: 1й бит - проверять системные сдвиги или нет (сдвиги есть для РФ и если нет исскуственного)
                      2й бит - не превращать 11 месяцев в полный год (для расчета пропорций в ОО)
    iChDays  - возвращаемое количество дней, добавленных до полного месяца или отброшенных при оценке остатка дней

  Внутри метода происходит заполнение протокола при наличии ссылки на него, поэтому перед использованием метода обязателен
  запуск SetMsgRec с указанием ссылки на созданную запись протокола; если формировать протокол не надо - передать 0
#end
  public function CalcKolFullMonth (dWPBeg, dDisMiss :date; wFlCheck : word; cLSchet : comp; var iChDays : integer) : word;

end;

ObjInterface oiCalcAndCreateCompensEx4;

#doc
  Расчет отработанных месяцев с даты (dWPBeg) по дату (dDisMiss), исходя из среднемесячного количества дней. Функция предназначена для РБ.
    cLSchet  - ссылка на л/с сотрудника
    wFlCheck - флаги: 1й бит - проверять системные сдвиги или нет (если есть искусственный, не проверять)

  Внутри метода происходит заполнение протокола при наличии ссылки на него, поэтому перед использованием метода обязателен
  запуск SetMsgRec с указанием ссылки на созданную запись протокола; если формировать протокол не надо - передать 0
#end

  public function CalcKolFullMonth_Bel (dWPBeg, dDisMiss :date; cLSchet : comp; wFlCheck : word) : word;

end;

ObjInterface oiCalcAndCreateCompensEx5;
  public function CaclProportionForPropVac(cPutVacation: comp; dBeg, dEnd : date) : double;
end;

ObjInterface oiCalcAndCreateCompensEx6;

#doc
  Расчет и заполнение списка компенсаций при увольнении с учетом компенсации 100%
#end

  public function CreateCompensationList_2(wSource : word; cSource : comp; dDisDate : date; is100PercComp : word) : boolean;

end;

VipInterface CalcAndCreateCompens
  implements oiCalcAndCreateCompens,    oiCalcAndCreateCompens1,   oiCalcAndCreateCompensEx2,
             oiCalcAndCreateCompensEx3, oiCalcAndCreateCompensEx4, oiCalcAndCreateCompensEx5,
             oiCalcAndCreateCompensEx6
  Licensed (free);

#end
