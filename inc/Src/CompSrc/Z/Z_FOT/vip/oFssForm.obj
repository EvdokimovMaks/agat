//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика ERP 9.1 - Заработная плата
// Формирование данных для ФСС
//------------------------------------------------------------------------------

// Если нужно подключить отдельно, то потребуется oFss_Params.
// В таком случае нужно использовать FssFormObj.vih

objInterface oFssForm;

  // Выплаты пособий по временной нетрудоспособности
  property prIncidentCount_IllNess: longint read;
  property prPaymentDay_IllNess: double read;
  property prTotalSum_IllNess: double read;
  property prTotalSum_IllNess_FB: double read;

  // Выплаты пособий по временной нетрудоспособности (совместительство)
  property prIncidentCount_Sovm_IllNess: longint read;
  property prPaymentDay_Sovm_IllNess: double read;
  property prTotalSum_Sovm_IllNess: double read;
  property prTotalSum_Sovm_IllNess_FB: double read;

  // Выплаты пособий по временной нетрудоспособности иностранным гражданам,
  // временно пребывающим в РФ
  property prIncidentCount_TempArriving_Un_HighQualified_Illness: longint read;
  property prPaymentDay_TempArriving_Un_HighQualified_Illness: double read;
  property prTotalSum_TempArriving_Un_HighQualified_Illness: double read;

  // Выплаты пособий по временной нетрудоспособности иностранным гражданам,
  // временно пребывающим в РФ (совместительство)
  property prIncidentCount_Sovm_TempArriving_Un_HighQualified_Illness: longint read;
  property prPaymentDay_Sovm_TempArriving_Un_HighQualified_Illness: double read;
  property prTotalSum_Sovm_TempArriving_Un_HighQualified_Illness: double read;

  // Выплаты пособий по беременности и родам
  property prIncidentCount_ChildBearing: longint read;
  property prPaymentDay_ChildBearing: double read;
  property prTotalSum_ChildBearing: double read;
  property prTotalSum_ChildBearing_FB: double read;

  // Выплаты пособий по беременности и родам (совместители)
  property prIncidentCount_Sovm_ChildBearing: longint read;
  property prPaymentDay_Sovm_ChildBearing: double read;
  property prTotalSum_Sovm_ChildBearing: double read;
  property prTotalSum_Sovm_ChildBearing_FB: double read;

  // Выплаты пособий женщинам, вставших на учет в ранние сроки беременности
  property prPensionCount_EarlyChildBearing: longint read;
  property prTotalSum_EarlyChildBearing: double read;

  // Единовременно пособие при рождении ребенка
  property prPensionCount_Birth: longint read;
  property prTotalSum_Birth: double read;

  // Ежемесячное пособие по уходу за ребенком (общая информация)
  property prIncidentCount_AllChildCare: longint read;
  property prPaymentCount_AllChildCare: double read;
  property prTotalSum_AllChildCare: double read;
  property prTotalSum_AllChildCare_FB: double read;

  // Ежемесячное пособие по уходу за ребенком (первый ребенок)
  property prIncidentCount_FirstChildCare: longint read;
  property prPaymentCount_FirstChildCare: longint read;
  property prTotalSum_FirstChildCare: double read;
  property prTotalSum_FirstChildCare_FB: double read;

  // Ежемесячное пособие по уходу за ребенком (второй+ ребенок)
  property prIncidentCount_SecondOrMoreChildCare: longint read;
  property prPaymentCount_SecondOrMoreChildCare: longint read;
  property prTotalSum_SecondOrMoreChildCare: double read;
  property prTotalSum_SecondOrMoreChildCare_FB: double read;

  // Оплата дополнительных выходных дней для ухода за детьми - инвалидами
  property prPaymentDay_ExtraDayOff4Child: double read;
  property prTotalSum_ExtraDayOff4Child: double read;
  property prTotalSum_ExtraDayOff4Child_FB: double read;

  // Страховые взносы в государственные внебюджетные фонды
  property prTotalSum_GosFond: double read;
  property prTotalSum_GosFond_FB: double read;

  // Социальное пособие на погребение
  property prPensionCount_Inhumation: longint read;
  property prTotalSum_Inhumation: double read;
  property prTotalSum_Inhumation_FB: double read;

  // Сумма выплат и иных вознаграждений начисленных в пользу  иностранных граждан
  // и лиц без гражданства, временно пребывающих в РФ, кроме лиц,
  // являющихся гражданами государств-членов ЕАЭС
  property prTotalPayment_TempArriving_Un_HighQualified: double read;

  // Пособия по временной нетрудоспособности в связи
  // с несчастными случаями на производстве, всего
  property prPaymentDay_IllNessTrauma: double read;
  property prTotalSum_IllNessTrauma: double read;

  // Пособия по временной нетрудоспособности в связи
  // с несчастными случаями на производстве ** по внешнему совместительству **
  property prPaymentDay_Sovm_IllNessTrauma: double read;
  property prTotalSum_Sovm_IllNessTrauma: double read;

  // Пособия по временной нетрудоспособности в связи
  // с несчастными случаями на производстве ** пострадавшим в другой организации **
  property prPaymentDay_OtherSubject_IllNessTrauma: double read;
  property prTotalSum_OtherSubject_IllNessTrauma: double read;

  // Пособия по временной нетрудоспособности в связи
  // с профессиональными заболеваниями, всего
  property prPaymentDay_ProffIllNessTrauma: double read;
  property prTotalSum_ProffIllNessTrauma: double read;

  // Пособия по временной нетрудоспособности в связи
  // с профессиональными заболеваниями ** по внешнему совместительству **
  property prPaymentDay_Sovm_ProffIllNessTrauma: double read;
  property prTotalSum_Sovm_ProffIllNessTrauma: double read;

  // Пособия по временной нетрудоспособности в связи
  // с профессиональными заболеваниями ** пострадавшим в другой организации **
  property prPaymentDay_OtherSubject_ProffIllNessTrauma: double read;
  property prTotalSum_OtherSubject_ProffIllNessTrauma: double read;

  // Оплата отпуска для санаторно-курортного лечения застрахованным
  // (сверх ежегодного оплачиваемого отпуска, установленного законодательством РФ)
  property prPaymentDay_VacationTrauma: double read;
  property prTotalSum_VacationTrauma: double read;

  // Оплата отпуска для санаторно-курортного лечения застрахованным
  // (сверх ежегодного оплачиваемого отпуска, установленного законодательством РФ)
  // ** пострадавшим в другой организации **
  property prPaymentDay_OtherSubject_VacationTrauma: double read;
  property prTotalSum_OtherSubject_VacationTrauma: double read;

  // Финансирование предупредительных мер по сокращению
  // производственного травматизма и профзаболеваний
  property prTotalSum_PreventionTrauma: double read;

  // Загрузка данных
  // Два режима AMode:
  // - dltLschet: загрузка по всем лицевым счетам
  // - dltForMarks: загрузка по "помеченным" лицевым счетам (записи должны располагаться
  //                в таблице ForMarks под Choice = cReportFss)
  procedure LoadData(AMode: byte; AYear, AMonth1, AMonth2: word);
  // Очистка данных по расшифровке
  procedure ClearNote;
  // Установка расшифровки по таблице
  // ATable - побитовая маска (необходимо использовать константы dcTable{Х}).
  procedure SetNoteMode(ATable: longint);
  // Формирование данных для таблицы 2
  procedure CalcDataTable2(ALschet: comp; AMonth: word);
  // Формирование данных для таблицы 8
  procedure CalcDataTable8(ALschet: comp; AMonth: word);
  // Загрузка параметров формирования отчета
  procedure LoadParams;
end;

objInterface oFssForm2;

  // Численность пострадавших в связи со страх. случаями (таб. 4)
  property prAccidentCount: longint read;
  property prAccidentCount_death: double read;
  property prOccupational_Illness: double read;
  property prInsured_IllNess: double read;

  // для заполнения полей таблицы 1
  property prVsegoTravmatizm: double read;
  property prVsegoTravmatizmInvalid: double read;
  property prVsegoNeTravmatizm: double read;
  property prVsegoTravmatizmMes1: double read;
  property prVsegoTravmatizmInvalidMes1: double read;
  property prVsegoNeTravmatizmMes1: double read; 
  property prVsegoTravmatizmMes2: double read;
  property prVsegoTravmatizmInvalidMes2: double read;
  property prVsegoNeTravmatizmMes2: double read; 
  property prVsegoTravmatizmMes3: double read;
  property prVsegoTravmatizmInvalidMes3: double read;
  property prVsegoNeTravmatizmMes3: double read; 

  // для заполнения полей таблицы 2
  property prCosts_Month1: string read;
  property prCosts_Month2: string read;
  property prCosts_Month3: string read;
  property prCosts_Month1_Sum: double read;
  property prCosts_Month2_Sum: double read;
  property prCosts_Month3_Sum: double read;

  // Процент по травматизму
  property prProcTravm: double read;  

  // для заполнения полей с помощью ПАТ-формул таблицы 1
  property prFormula_NeTravmatizm: double read;
  property prFormula_NeTravmatizmMes1: double read;
  property prFormula_NeTravmatizmMes2: double read;
  property prFormula_NeTravmatizmMes3: double read;

  property prf1_debtStrah_PeriodBeg: string  read;
  property prf1_NachislPayment_ReportPeriodBeginnig: string  read;
  property prf2_NachislPayment_ReportPeriodBeginnig: string  read;
  property prf1_NachislPayment_1: string  read;
  property prf2_NachislPayment_1: string  read;
  property prf1_NachislPayment_2: string  read;
  property prf2_NachislPayment_2: string  read;
  property prf1_NachislPayment_3: string  read;
  property prf2_NachislPayment_3: string  read;
  property prf1_DebtOnReportPeriodEnding: string  read;
  property prf1_DebtOnReportPeriodBeginning: string  read;
  property prf1_CostsOnInsurance_OnReportPeriodBeginnig: string  read;
  property prf1_CostsOnInsurance_Month1: string  read;
  property prf1_CostsOnInsurance_Month2: string  read;
  property prf1_CostsOnInsurance_Month3: string  read;
  property prf1_Costs_OnReportPeriodBeginnig: string  read;
  property prf1_Costs_Month1_Sum: string  read;
  property prf1_Costs_Month2_Sum: string  read;
  property prf1_Costs_Month3_Sum: string  read;
  property prf1_Halyava: string  read;
  property prf1_DebtInsuranceOnReportPeriodEnding: string  read;

  // возращает ОКВЭД взависимости от DiffThirdRazdel.nrec
  function ServiceOKVED(DiffThirdRazdel_nrec: comp): string; 

  // Передача параметров и формирование данных для нового 4ФСС
  procedure LoadDataFSS(AMode: byte; ARef: Fss4;cRecDocum4FSS: comp);

  // вычисляет ПАТ-формулы для таблицы 1
  procedure CalcSheetFolmulasTable1(NameList: string);  

  procedure InitFormula(ARef: oFss_Params);
  function GetFormulaT(ANum: word): string;
  procedure FillSheetFolmulas(ARef: oFss_Params; ASheetName: string);
  procedure FillFolmulas(ARef: oFss_Params);
  function fGetSumExtraFormulas(s1, s2: string): double; 
  
  //В функции проверяется у всех выбранных подразделений
  // есть ли льгота с одинаковым процентом 
  function fProvProcLgota ( var proc : double) : boolean; 
end;

objInterface oFssForm3;

  procedure FillFolmulasTabl1(ARef: oFss_Params; fXlsBook_: string);
  Procedure PrintTable1(ARef: oFss_Params; fXlsBook_: string; tmpSumAll, tmpSum1, tmpSum2, tmpSum3: double);
  procedure LoadParametersFss(ARef: Fss4); 
end;

objInterface oFssForm4;
  // загрузка данных по таблице 3
  procedure LoadDataByTbl3;
  // загрузка документов сотрудников
  procedure pInintPasspDocuments;
  // инициализация массивов для таблицы 5
  procedure InitArraTbl5;
  // загрузка данных по таблице 5 с таблицей 2
  // (если отдельно грузить табл. 5, то несчитаются дни выплат)
  property prFormTbl2WithTbl5 : boolean write;
  // Сумма выплат, исчисленных в пользу физических лиц
  function Get_Tbl3_SumPay( wMon : word ) : double;
  // Количество физических лиц
  function Get_Tbl3_CountFL( wMon : word ) : longInt;
  // Сумма, не подлежащая обложению
  function Get_Tbl3_SumNePodl( wMon : word ) : double;
  // Суммы, превышающие предельную величину
  function Get_Tbl3_SumUpper( wMon : word ) : double;
  //  База иностранным гражданам
  function Get_Tbl3_BaseForeigner( wMon : word ) : double;
  // Суммы по таблице 5
  function Get_Tbl5_Sum( wVhod, wData : word ) : double;

  // ПАТ-формулы для РСВ
  property prf1_NachislPayment_Month1 : string  read;
  property prf2_NachislPayment_Month1 : string  read;
  property prf1_NachislPayment_Month2 : string  read;
  property prf2_NachislPayment_Month2 : string  read;
  property prf1_NachislPayment_Month3 : string  read;
  property prf2_NachislPayment_Month3 : string  read;
  property prf1_Costs_All    : string  read;
  property prf1_Costs_Month1 : string  read;
  property prf1_Costs_Month2 : string  read;
  property prf1_Costs_Month3 : string  read;
  property prf1_MoneyFromFond_All : string  read;
  property prf1_MoneyFromFond_Month1 : string  read;
  property prf1_MoneyFromFond_Month2 : string  read;
  property prf1_MoneyFromFond_Month3 : string  read;
  property prf1_Debt_PeriodEnding : string read;
  property prf1_Debt_Month1 : string read;
  property prf1_Debt_Month2 : string read;
  property prf1_Debt_Month3 : string read;

  // Добавление ПАТ-формул для РСВ
  procedure FillFolmulasRSV(ARef: oFss_Params);
end;
