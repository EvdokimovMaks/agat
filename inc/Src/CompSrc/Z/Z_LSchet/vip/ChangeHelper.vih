//******************************************************************************
//                                                      (с) корпорация Галактика
// Галактика 7.12 - Заработная плата
// Объектный интерфейс вспомогательного функционала для работы с переходами в
// межпериод и декларация его стандартной реализации
//******************************************************************************

#ifndef _CHANGEHELPER_INCLUDED_
#define _CHANGEHELPER_INCLUDED_

#include SHPZ.VIH // декларация объектного интерфейса "Шифры производственных доплат"

#component "z_lschet"

#define TPerexod type$PEREXOD

#doc
  Объектный интерфейс с набором методов для работы с переходами в межпериод.
#end
objinterface IChangeHelper;

  #doc
    Возвращает тип перехода по датам его начала, окончания и дате начала
    расчетного периода.<brief>

    <p>
    Типы переходов:
    <ul>
    <li> ctPermanent (0) - постоянный;
    <li> ctTemporary (1) - временный;
    <li> ctArchivePermanent (3) - архивный постоянный;
    <li> ctArchiveTemporary (4) - архивный временный.
    </ul>

    Постоянным считается переход с открытой датой окончания, либо переход,
    покрывающий более одного месяца </p>
  #end
  public function GetChangeType(ChangeBeginning, ChangeEnding, PeriodBeginning: date): word;

  #doc
    Рассчитывает и возвращает дату окончания перехода (участвующую в расчетах)
    по датам его начала, действительного окончания и дате начала расчетного
    периода.
  #end
  public function GetChangeEnding(ChangeBeginning, ChangeEnding, PeriodBeginning: date): date;

  #doc
    Возвращает true, если тип перехода "постоянный" или "архивный постоянный".
  #end
  public function IsPermanent(ChangeType: word): boolean;

  #doc
    Возвращает true, если тип перехода "архивный постоянный" или "архивный
    временный".
  #end
  public function IsArchive(ChangeType: word): boolean;

  #doc
    Возвращает название типа перехода в именительном падеже.
  #end
  public function GetChangeTypeStr(ChangeType: word): string;

  #doc
    Заполняет буфер перехода и ШПЗ значениями по умолчанию с учетом
    даты.</brief>

    <p>ШПЗ записывается только в oSHPZ.</p>
    <p>Перед вызовом метода в буфере обязательно должна быть заполнена ссылка
    на лицевой счет.</p>
    <p>Если есть необходимость заполнить параметры на дату, игнорируя
    какие-либо переходы или табели, нужно перед вызовом данного метода
    настроить <link article c_extfun.chm|PADAPI_About>функции получения параметров ЛС на дату</link>
    на лицевой счёт, к которому относится данный переход, и установить нужные ограничения
    (функции <link externalFunction c_extfun.chm|PA_AddIgnored>PA_AddIgnored</link> и т.п.)
    </p>
  #end
  public procedure SetDefault(var B: #TPerexod; Accounting: oSHPZ; OnDate: date);
end;

objinterface IChangeHelper2;
  #doc
    Заполняет буфер перехода и ШПЗ значениями по умолчанию с учетом
    даты.</brief>

    <p>ШПЗ записывается только в oSHPZ.</p>

    <p>Если есть необходимость заполнить параметры на дату, игнорируя
    какие-либо переходы или табели, нужно перед вызовом данного метода
    настроить <link article c_extfun.chm|PADAPI_About>функции получения параметров ЛС на дату</link>
    на лицевой счёт, к которому относится данный переход, и установить нужные ограничения
    (функции <link externalFunction c_extfun.chm|PA_AddIgnored>PA_AddIgnored</link> и т.п.)
    </p>

    <p>IgnoreChanges - устаревший параметр для игнорирования переходов.
    В настоящее время с данной целью можно использовать описанный выше способ.</p>
  #end
  public procedure SetDefault2(var B: #TPerexod; Accounting: oSHPZ; OnDate: date; IgnoreChanges: boolean = false);
end;

objInterface IChangeHelper3;
  #doc
    <brief>Заполняет буфер перехода значениями по умолчанию на дату OnDate.</brief>

    <p>В отличие от IChangeHelper.SetDefault и IChangeHelper2.SetDefault2,
    не требует использование специального объекта для записи в него ШПЗ.
    ШПЗ сразу заполняется в буфере перехода.</p>

    <p>Если есть необходимость заполнить параметры на дату, игнорируя
    какие-либо переходы или табели, нужно перед вызовом данного метода
    настроить <link article c_extfun.chm|PADAPI_About>функции получения параметров ЛС на дату</link>
    на лицевой счёт, к которому относится данный переход, и установить нужные ограничения
    (функции <link externalFunction c_extfun.chm|PA_AddIgnored>PA_AddIgnored</link> и т.п.)
    </p>

    <p>IgnoreChanges - устаревший параметр для игнорирования переходов.
    В настоящее время с данной целью можно использовать описанный выше способ.</p>
  #end
  public procedure SetDefaultSimple(var B: #TPerexod; OnDate: date; IgnoreChanges: boolean = false);
end;

#doc
  Стандартная реализация объектного интерфейса для работы с переходами в межпериод.
#end
vipinterface ChangeHelper implements IChangeHelper, IChangeHelper2, IChangeHelper3
#ifdef ATL51
  licensed(free)
#end
;
#end
