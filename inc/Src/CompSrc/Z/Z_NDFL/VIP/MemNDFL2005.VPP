//-----------------------------------------------------------------------------
//                                                     (c) корпорация ГАЛАКТИКА
// Галактика 7.12 - заработная плата
// Дополнительные таблицы в памяти для формирования НДФЛ-2 2005 года
//-----------------------------------------------------------------------------

//Временная таблица для хранения реестров по ЛС
table struct tmpSpPlBan
(
   NRecSpPlBan : comp      //  NRec таблицы SpPlBan
  ,NRecSbBan   : comp      //  NRec таблицы SbBan
  ,DataN       : date      //  дата формирования реестра
  ,wMes        : word      //  месяц формирования реестра
  ,Prefix      : string    //  префикс реестра
  ,Perech      : word      //  признак - реестр по перечислению или нет
  ,NoDoc       : string    //  номер платежного документа
  ,Prizpr      : word      //  тип оплаты 0- реестр, 1 - ведомость
)
 with index
(
  tmpSpPlBan01 = wMes + Perech,
  tmpSpPlBan02 = wMes + Prizpr,
  tmpSpPlBan03 = wMes + Prizpr+ Perech
);

//Временная таблица, в которой хранится информация о реестрах
//используется для определения даты выплаты дохода по реестрам.
table struct tmpDataPayRoll
(
   Month:       integer   //  "Месяц"
  ,Year:        integer   //  "Год"
  ,CodeIncome:  string[5] //  "Код вида дохода"
  ,MonthSum:    double    //  "Сумма дохода за месяц"
  ,cFpStBud:   comp      //  ссылка на FpStBud
  ,DateVipl:    date      //  "дата получения - выплаты дохода"
  ,Prefix:      string[6] //  префикс реестра
  ,SubPrefix:   string[1] //  последняя буква префикса реестра
)
 with index
(
   DivIncomeByDate01 = CodeIncome + Year + Month + cFpStBud,
   DivIncomeByDate02 = Prefix,
   DivIncomeByDate03 = SubPrefix,
   DivIncomeByDate04 = SubPrefix + Month + cFpStBud
);


// виды доходов и скидки с них
table struct InDiscountNDFL
(
   cSumCexoz:        comp
  ,cLsch:            comp
  ,MycLsch:          comp
  ,cFpStBud:         comp     //  ссылка на FpStBud
  ,MonthINCOME:      integer  //  "Месяц"
  ,YearIncome:       integer  //  "Год"
  ,INCOMECODE:       longint  //  "Код вида дохода системный"
  ,INCOMEMonthSum:   double   //  "Сумма дохода за месяц"
  ,DISCOUNTCODE:     string[7]//  "Код вида скидки пользовательский"
  ,DISCOUNTMonthSum: double   //  "Cумма скидки за месяц"
  ,NeoblMonthSum:    double   //  "Необлагаемая НДФЛ сумма дохода при наличии зарубежного представительства"
  ,Date1:            date     //  "дата получения - выплаты дохода"
  ,DataN:            date     //  "дата начала выплаты дохода"
  ,OsnOpl:           word     //  основная сумма, не межпериод
  ,MesN:             word     //  месяц В котором начислено
  ,SumObl:           double
)
 with index
(
   InDiscountNDFL01 = cLsch   + INCOMECODE  + YearIncome  + MonthINCOME + INCOMEMonthSum,
   InDiscountNDFL02 = cLsch   + YearIncome  + MonthINCOME + INCOMEMonthSum,
   InDiscountNDFL03 = MycLsch + INCOMECODE  + YearIncome  + MonthINCOME,
   InDiscountNDFL04 = cLsch   + INCOMECODE  + YearIncome  + MonthINCOME + DISCOUNTCode + INCOMEMonthSum,
   InDiscountNDFL05 = cLsch   + cSumCexoz   + YearIncome  + MonthINCOME + INCOMECODE,
   InDiscountNDFL06 = cSumCexoz
);

table struct InDiscountNDFLRez
(
   cSumCexoz:        comp
  ,cLsch:            comp
  ,MycLsch:          comp
  ,cFpStBud:         comp     //  ссылка на FpStBud
  ,MonthINCOME:      integer  //  "Месяц"
  ,YearIncome:       integer  //  "Год"
  ,INCOMECODE:       longint  //  "Код вида дохода системный"
  ,INCOMEMonthSum:   double   //  "Сумма дохода за месяц"
  ,DISCOUNTCODE:     string[7]//  "Код вида скидки пользовательский"
  ,DISCOUNTMonthSum: double   //  "Cумма скидки за месяц"
  ,NeoblMonthSum:    double   //  "Необлагаемая НДФЛ сумма дохода при наличии зарубежного представительства"
  ,Date1:            date     //  "дата получения - выплаты дохода"
  ,DataN:            date     //  "дата начала выплаты дохода"
  ,OsnOpl:           word     //  основная сумма, не межпериод
  ,MesN:             word     //  месяц в котором начислено
)
 with index
(
   InDiscountNDFLRez01 = cLsch + INCOMECODE + YearIncome + MonthINCOME + INCOMEMonthSum,
   InDiscountNDFLRez02 = cLsch + YearIncome + MonthINCOME + INCOMEMonthSum,
   InDiscountNDFLRez03 = MycLsch + INCOMECODE + YearIncome + MonthINCOME,
   InDiscountNDFLRez04 = cLsch   + cSumCexoz + INCOMECODE + YearIncome + MonthINCOME + INCOMEMonthSum,
   InDiscountNDFLRez05 = MycLsch + cSumCexoz + INCOMECODE + YearIncome + MonthINCOME,
   InDiscountNDFLRez06 = cLsch   + cSumCexoz + YearIncome + MonthINCOME
);

table struct InDiscountNDFLNoRez
(
   cSumCexoz:        comp
  ,cLsch:            comp
  ,MycLsch:          comp
  ,cFpStBud:         comp
  ,MonthINCOME:      integer  //  "Месяц"
  ,YearIncome:       integer  //  "Год"
  ,INCOMECODE:       longint  //  "Код вида дохода системный"
  ,INCOMEMonthSum:   double   //  "Сумма дохода за месяц"
  ,DISCOUNTCODE:     string[7]//  "Код вида скидки пользовательский"
  ,DISCOUNTMonthSum: double   //  "Cумма скидки за месяц"
  ,NeoblMonthSum:    double   //  "Необлагаемая НДФЛ сумма дохода при наличии зарубежного представительства"
  ,Date1:            date     //  "дата получения - выплаты дохода"
  ,DataN:            date     //  "дата начала выплаты дохода"
  ,OsnOpl:           word     //  основная сумма, не межпериод
  ,MesN:             word     // месяц в котором начислено
)
 with index
(
   InDiscountNoRez01 = cLsch + INCOMECODE + YearIncome + MonthINCOME + INCOMEMonthSum,
   InDiscountNoRez02 = cLsch + YearIncome + MonthINCOME + INCOMEMonthSum,
   InDiscountNoRez03 = MycLsch + INCOMECODE + YearIncome + MonthINCOME,
   InDiscountNoRez04 = cLsch   + cSumCexoz + INCOMECODE + YearIncome + MonthINCOME + INCOMEMonthSum,
   InDiscountNoRez05 = MycLsch + cSumCexoz + INCOMECODE + YearIncome + MonthINCOME
);

// дивиденды
table struct DivNDFL
(
   cSumCexoz:        comp
  ,cLsch:            comp
  ,MycLsch:          comp
  ,cFpStBud:         comp
  ,YearIncome:       integer  //  "Год"
  ,MonthINCOME:      integer  //  "Месяц"
  ,INCOMECODE:       longint  //  "Код вида дохода системный"
  ,INCOMEMonthSum:   double   //  "Сумма дохода за месяц"
  ,DISCOUNTCODE:     string[7]//  "Код вида скидки пользовательский"
  ,DISCOUNTMonthSum: double   //  "Облагаемая сумма"
  ,VychetMonthSum:   double   //  "Cумма скидки за месяц"
  ,Date1:            date     //  "дата получения - выплаты дохода"
  ,DataN:            date     //  "дата начала выплаты дохода"
)
 with index
(
   DivNDFL01 = cLsch + INCOMECODE + YearIncome + MonthINCOME,
   DivNDFL02 = cLsch + cSumCexoz  + INCOMECODE + YearIncome + MonthINCOME,
   DivNDFL03 = cSumCexoz
);

table struct DivNDFLRez
(
   cSumCexoz:        comp
  ,cLsch:            comp
  ,MycLsch:          comp
  ,cFpStBud:         comp
  ,YearIncome:       integer  //  "Год"
  ,MonthINCOME:      integer  //  "Месяц"
  ,INCOMECODE:       longint  //  "Код вида дохода системный"
  ,INCOMEMonthSum:   double   //  "Сумма дохода за месяц"
  ,DISCOUNTCODE:     string[7]//  "Код вида скидки пользовательский"
  ,DISCOUNTMonthSum: double   //  "Облагаемая сумма"
  ,VychetMonthSum:   double   //  "Cумма скидки за месяц"
  ,Date1:            date     //  "дата получения - выплаты дохода"
  ,DataN:            date     //  "дата начала выплаты дохода"
)
 with index
(
   DivNDFLRez01 = cLsch + INCOMECODE + YearIncome + MonthINCOME,
   DivNDFLRez02 = cLsch + cSumCexoz  + INCOMECODE + YearIncome + MonthINCOME
);

table struct DivNDFLNoRez
(
   cSumCexoz:        comp
  ,cLsch:            comp
  ,MycLsch:          comp
  ,cFpStBud:         comp
  ,YearIncome:       integer  //  "Год"
  ,MonthINCOME:      integer  //  "Месяц"
  ,INCOMECODE:       longint  //  "Код вида дохода системный"
  ,INCOMEMonthSum:   double   //  "Сумма дохода за месяц"
  ,DISCOUNTCODE:     string[7]//  "Код вида скидки пользовательский"
  ,DISCOUNTMonthSum: double   //  "Облагаемая сумма"
  ,VychetMonthSum:   double   //  "Cумма скидки за месяц"
  ,Date1:            date     //  "дата получения - выплаты дохода"
  ,DataN:            date     //  "дата начала выплаты дохода"
)
 with index
(
   DivNDFLNoRez01 = cLsch + INCOMECODE + YearIncome + MonthINCOME,
   DivNDFLNoRez02 = cLsch + cSumCexoz  + INCOMECODE + YearIncome + MonthINCOME
);

table struct Doh35  // доход, облагаемый по ставке 35%
(
  cSumCexoz: comp,
  cLsch:     comp,
  cFpStBud:  comp,
  Mes:       word,
  Code35Sys: longint,   // Код вида дохода системный
  Summa35:   double,    // суммы дохода, облагаемого по ставке 35% по видам доходов
  CodSkid35: string[7], // пользовательский код скидки с дохода, облагаемого по ставке 35% по видам доходов
  Skid35:    double     // суммы скидки с дохода, облагаемого по ставке 35% по видам доходов
 ,Date1:     date       //  "дата получения - выплаты дохода"
 ,DataN:     date       //  "дата начала выплаты дохода"
)
with index
(
  Doh3501 = cLsch + Code35Sys + Mes,
  Doh3502 = cLsch + cSumCexoz + Code35Sys + Mes
);

table struct tpPlPor
(
  cPlPor    : comp,
  OKATO     : string[20],
  KPP       : string[9],
  DebSchet  : string,
  DebSubSch : string,
  NoDOK     : tNoDok,
  DatOB     : date,
  bMes      : byte,
  SumMonth  : array [1..12] of double, //сумма за месяц для печати
  Summa     : double, //сумма за месяц в плат поручении
  VidUd182  : word,
  VidUd183  : word,
  VidUd184  : word,
  #ifdef Gal9_1
  VidUd110  : word,
  NDFL_Extra: word      //Вид удержания для дополнительной шкалы НДФЛ
  #else
  VidUd110  : word
  #endif
)
with index
(
  tpPlPor01 = cPlPor,
  tpPlPor02 = Okato + Kpp + bMes + VidUd110,
  tpPlPor03 = DebSchet + DebSubSch,
  tpPlPor04 = Okato + Kpp + VidUd110,
  tpPlPor05 = Okato + Kpp + bMes + VidUd184
);
table struct tpUder
(
  cLsch     : comp,
  ctpPodrUch:  comp,
  OKATO     : string[20],
  KPP       : string[9],
  bMes      : byte,
  OsnOpl    : word,                   //признак выплаты в м е ж п е р и о д (cn_MegPeriod)
  Summa     : double,                 //сумма за месяц в плат поручении
  VidUds    : word                    //код удержания
)
with index
(
  tpUder01 = cLsch,
  tpUder02 = cLsch + OKATO + KPP + bMes + VidUds,
  tpUder03 = cLsch + bMes + OsnOpl + VidUds + ctpPodrUch + OKATO + KPP
);

table struct tpSchetUd
(
  SchetK    : tSchet19,
  SubSchK   : tSubSch,
  VidUd182  : word,
  VidUd183  : word,
  VidUd184  : word,
  #ifdef Gal9_1
  VidUd110  : word,
  NDFL_Extra: word      //Вид удержания для дополнительной шкалы НДФЛ
  #else
  VidUd110  : word
  #endif
)
with index
(
  tpSchetUd01 = SchetK + SubSchK
);

table struct tp_WrPlPor
(
  iNpp      : integer,
  NoDOK     : tNoDok,
  DatOB     : date,
  wMonth    : word,
  Summa     : double
)
with index
(
  tp_WrPlPor01 = iNpp + wMonth,
  tp_WrPlPor02 = wMonth
);

table struct tp_VidOpl
(
  VidOplS : tVidOpl,
  SysCode : tVidOpl,
  VidOplP : tVidOpl,
  VHVO1   : s1,
  VHVO2   : s1,
  VHVOE9  : s1,
  VHVOE19 : s1,
  VHVOE20 : s1,
  VHOD1   : s1,
  VHOD3   : s1,
  SkidImu : s5,
  Vichet  : boolean,
  flag    : boolean
)
with index
(
  tp_VidOpl01 = VidOplS
);

table struct tp_VichD
(
  cLsch     : comp,
  cPsnLinks : comp,
  wCode     : word,
  SumMonth  : array [1..12] of double,
  SummV     : double,
  SummTrunc : double
)
 with index
(
  tp_VichD01 = cLsch + wCode
);

table struct tpSp_VichD
(
  cLsch     : comp,
  cSumCexOz : comp,
  cPsnLinks : comp,
  wCode     : word,
  SumMonth  : array [1..12] of double,
  SummV     : double,
  SummTrunc : double
)
 with index
(
  tp_VichD01 = cLsch + cSumCexOz + wCode
);

table struct tpLsch_Nal
(
  cLsch     : comp,
  SumObl_M  : array [1..12] of double,
  SumObl_P  : double,
  sCode     : array [1..12] of string[5],
  SumV      : array [1..12] of double,
  SumVD     : array [1..12] of double,
  SumV_P    : double
)
 with index
(
  tpLsch_Nal01 = cLsch
);

table struct tpSpLsch_Nal
(
  cLsch     : comp,
  cSumCexoz : comp,
  sCode     : array [1..12] of string[5],
  SumV      : array [1..12] of double,
  SumVD     : array [1..12] of double
)
 with index
(
  tpSpLsch_Nal01 = cLsch + cSumCexoz
);
