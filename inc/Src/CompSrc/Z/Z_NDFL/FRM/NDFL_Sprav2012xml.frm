//-----------------------------------------------------------------------------
//                                                     (c) корпорация ГАЛАКТИКА
// Галактика 8.10 - заработная плата
// Форма прототип для формирования справки 2-НДФЛ
//-----------------------------------------------------------------------------
#doc
НДФЛ-2
#end
.Linkform 'NDFL2_XML' prototype 'NDFL2_prototype'
.nameinlist 'Файл обмена в формате XML c 2012 года'
.F 'NdflX2012.XML'
.group 'Ndfl_2012'
.var 
 Долг1             : double;
 Долг2             : double; 
 boPrint, 
 VichPrint         : boolean;
.endvar
.fields
ANSI2OEM(Имя_файла)
.endFields
.{ Main_Cycle_2NDFL CheckEnter
<?xml version="1.0" encoding="windows-1251"?>
<Файл ИдФайл="^" ВерсПрог="Галактика 8.10" ВерсФорм="5.02">
.fields
 ОКАТО
 Год
 Признак
 ИНН
 КПП 
.endfields
  <СвРекв ОКАТО="^" ОтчетГод="^" ПризнакФ = "^">
    <СвЮЛ ИННЮЛ="^" КПП="^"></СвЮЛ>
  </СвРекв>
.{ Person_Cycle_2NDFL CheckEnter
.fields
  Дата
  Год  
  Номер
  Признак
  ИФНС
  ОКАТО  
  Телефон  
  Replace(Организация, '"', '&quot;')
  ИНН
  КПП
.endfields
  <Документ КНД="1151078" ДатаДок="^" ОтчетГод="^" НомСпр="^" Признак="^" КодНО="^">
    <СвНА ОКАТО="^"
.{?INTERNAL; (Trim(Телефон) <> '')
    Тлф="^"
.}
    >
      <СвНАЮЛ НаимОрг="^" ИННЮЛ="^" КПП="^"></СвНАЮЛ>
    </СвНА>
.fields  
  ИНН_налогоплательщика
  Статус
  Дата_рождения
  Гражданство
.endfields
    <ПолучДох
.{?internal; (Trim(ИНН_налогоплательщика) <> '')
      ИННФЛ="^"
.}
      Статус="^" ДатаРожд="^" Гражд="^">
.fields
  Фамилия
  Имя
  Отчество
  Код_документа
  Серия_номер_документа
  ИндексРФ
  КодРегионаРФ
  РайонРФ
  ГородРФ
  НасПунктРФ
  replace(УлицаРФ,'"','')
  replace(ДомРФ,'"','')
  replace(КорпусРФ,'"','')
  replace(КвартираРФ,'"','')
  replace(КодСтраныПроживания,'"','')
  replace(ПолныйАдрес,'"','')
.endFields
      <ФИО Фамилия="^" Имя="^"
.{?INTERNAL; (Trim(Отчество) <> '')
      Отчество="^"
.}
      ></ФИО>
      <УдЛичнФЛ КодУдЛичн="^" СерНомДок="^"></УдЛичнФЛ>
.{?INTERNAL; (trim(ИндексРФ) <> '') or (trim(КодРегионаРФ) <> '')
      <АдрМЖРФ
.{?INTERNAL; (trim(ИндексРФ)<>'')
        Индекс="^"
.}
        КодРегион="^"
.{?INTERNAL; (trim(РайонРФ)<>'')
        Район="^"
.}
.{?INTERNAL; (trim(ГородРФ)<>'')
        Город="^"
.}
.{?INTERNAL; (trim(НасПунктРФ)<>'')
        НаселПункт="^"
.}
.{?INTERNAL; (trim(УлицаРФ)<>'')
        Улица="^"
.}
.{?INTERNAL; (trim(ДомРФ)<>'')
        Дом="^"
.}
.{?INTERNAL; (trim(КорпусРФ)<>'')
        Корпус="^"
.}
.{?INTERNAL; (trim(КвартираРФ)<>'')
        Кварт="^"
.}
        ></АдрМЖРФ>
.}
.{?INTERNAL; (trim(ПолныйАдрес) <> '')
      <АдрИНО КодСтр="^" АдрТекст="^"></АдрИНО>
.}
    </ПолучДох>
.fields
 Ставка_Налога
 Месяц_Ст1 Код_дохода_Ст1 Сумма_дохода_Ст1 Код_Вычета_Ст1 Сумма_вычета_Ст1
 Месяц_Ст2 Код_дохода_Ст2 Сумма_дохода_Ст2 Код_Вычета_Ст2 Сумма_вычета_Ст2
.endfields
.{ Percent_Cycle_2NDFL CheckEnter
   <СведДох  Ставка="^">
      <ДохВыч>
.{ Incom_Cycle_2NDFL CheckEnter
.begin
VichPrint:= false;
case Месяц_Ст1 of
10, 11, 12:
{
  Месяц_Ст1 := string(Месяц_Ст1, 2);
}
1..9:
{
  Месяц_Ст1 := '0'+string(Месяц_Ст1, 1);
}
end;
case Месяц_Ст2 of
10, 11, 12:
{
  Месяц_Ст2 := string(Месяц_Ст2, 2);
}
1..9:
{
  Месяц_Ст2 := '0'+string(Месяц_Ст2, 1);
}
end;
end.
.{?INTERNAL; (Double(Сумма_дохода_Ст1) <> 0)
        <СвСумДох Месяц="^" КодДоход="^" СумДоход="^">
.{?INTERNAL; (Double(Сумма_вычета_Ст1) <> 0)
          <СвСумВыч КодВычет="^" СумВычет="^"/>
.}
        </СвСумДох>
.}
.{?INTERNAL; (Double(Сумма_дохода_Ст2) <> 0)
        <СвСумДох Месяц="^" КодДоход="^" СумДоход="^">
.{?INTERNAL; (Double(Сумма_вычета_Ст2) <> 0)
          <СвСумВыч КодВычет="^" СумВычет="^"/>
.}
        </СвСумДох>
.}
.}//Incom_Cycle_2NDFL CheckEnter
      </ДохВыч>
.fields
 Код_Вычета_1     Сумма_вычета_1
 Код_Вычета_2     Сумма_вычета_2
 Код_Вычета_3     Сумма_вычета_3
 Код_Вычета_4     Сумма_вычета_4
.endfields
.begin
 boPrint  := false;  
end.
.{ Discount_Cycle_2NDFL CheckEnter
.begin
 boPrint  := false;  
 if (Double(Сумма_вычета_1) <> 0)
   boPrint := true
 else
   if (Double(Сумма_вычета_2) <> 0) 
     boPrint := true
     else
       if (Double(Сумма_вычета_3) <> 0)
         boPrint := true
           else
             if (Double(Сумма_вычета_4) <> 0) 
               boPrint := true;
end.
.{?INTERNAL; (boPrint = true) and (VichPrint = false);
       <НалВычССИ>
.begin 
 VichPrint:= true;
end.
.}
.{?INTERNAL; (Double(Сумма_вычета_1) <> 0);
        <ПредВычССИ КодВычет="^" СумВычет="^"></ПредВычССИ>
.}
.{?INTERNAL; (Double(Сумма_вычета_2) <> 0);
        <ПредВычССИ КодВычет="^" СумВычет="^"></ПредВычССИ>
.}
.{?INTERNAL; (Double(Сумма_вычета_3) <> 0);
        <ПредВычССИ КодВычет="^" СумВычет="^"></ПредВычССИ>
.}
.{?INTERNAL; (Double(Сумма_вычета_4) <> 0);
        <ПредВычССИ КодВычет="^" СумВычет="^"></ПредВычССИ>
.}
.}//Discount_Cycle_2NDFL CheckEnter
.fields
  НомерУведИмВыч
  ДатаВыдачиУвед
  КемВыданоУвед
.endfields
.{ Info_Discount_Cycle_2NDFL CheckEnter
.{?INTERNAL; (trim(НомерУведИмВыч) <> '') or (trim(ДатаВыдачиУвед) <> '') or (trim(КемВыданоУвед) <> '')
        <УведИмущВыч НомерУвед="^" ДатаУвед="^"  ИФНСУвед="^"></УведИмущВыч>
.}       
.}//Info_Discount_Cycle_2NDFL CheckEnter
.{?INTERNAL; (VichPrint = true);
       </НалВычССИ>
.}
.begin
 Долг1 := 0;
 Долг2 := 0;
 if ( СуммаНалогаИсч > СуммаНалогаУд )
   Долг2 := СуммаНалогаИсч - СуммаНалогаУд
 else
   if ( СуммаНалогаИсч < СуммаНалогаУд )
     Долг1 := СуммаНалогаУд  - СуммаНалогаИсч
end.
.fields
 СуммаДохода     
 НалБаза         
 СуммаНалогаИсч  
 СуммаНалогаУд   
 СуммаНалогаПереч
 Долг1
 Долг2
.endfields
      <СГДНалПер
        СумДохОбщ="^" НалБаза="^" НалИсчисл="^" НалУдерж="^"
        НалПеречисл="^"
        НалУдержЛиш="^" НалНеУдерж="^"/>
    </СведДох>
.}
  </Документ>
.}
</Файл>
.}
.endform
