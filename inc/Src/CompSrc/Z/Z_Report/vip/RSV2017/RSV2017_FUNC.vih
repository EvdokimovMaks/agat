//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика ERP 9.1 - Заработная плата
// ФУНКЦИИ ФОРМИРОВАНИЯ РСВ-2017 (ПФ РФ)
//------------------------------------------------------------------------------
#ifndef _RSV2017_FUNC_vih_INCLUDED_
#define _RSV2017_FUNC_vih_INCLUDED_

#component "Z_Report"

#doc
  Функции формирования РСВ-1
#end
//Ссылка на лицевой счет
table struct tp_Formarks
(
  cLschet : comp,
  StrTabN : s20,
  FIO     : s60,
  InsuranceNmb : string             // страховой номер
)
with index
(
  tp_Formarks01 = cLschet
);

ObjInterface objRSV2017_FUNC;
function fboInitParam(cRecDocumRsv: comp): boolean;
function fboCheckData(cRecDocumRSV: comp; wNumRazd, wNumPage, wPriznPage: word): boolean;
function fCreateRecRazd(cRecDocumRsv: comp; wRazdel, wAttachment, wPrizn: word): boolean;
function fCreateRecRazdPK(cRecDocumRsv: comp; wRazdel, wAttachment, wNumPk: word): boolean;
function fsGetCodeWork(wNumPk: word): s50;
procedure pAddFltoReport(NumRazd_, NumPage_, NumPk_, PriznPage_, wMkv, wVidSumma: word; doSum_: double);
function fwGetFontColor(wPriznEdit: word): word;
// Функция возвращает строковое наименование квартала
function fGetKvartName(_wRepPeriod: word): string;
// функция создания наименования файла excel-расшифровки
function fCreateExcelName(cRecDocumRsv: comp): string;
// процедура открывает Excel - расшифровку РСВ-2017
procedure pOpenRasshRSV2017_Excel(cRecDocumRsv: comp);
//функция возвращает код категории застрахованного лица
function fsCodeKateg(wNumCode: word; cAddNRec2_: comp): s4;
//процедура создания настройки отчета
procedure pCreateTuneRep;
//вычисление суммы по тарифу с учетом процента
function fdoGetSumTar(wPrDopTar: word; doSumTar, doProc: double): double;
end;

ObjInterface objRSV2017_FUNC2;
// процедура открывает Excel - расшифровку РСВ-2017 для раздела 3
procedure pOpenRasshRSV2017_Excel_Razd3(cRecDocumRsv: comp);
end;

ObjInterface objRSV2017_FUNCExt;
#doc
 Функция для определения кода тарифа для раздела 3
#end
function fGetKod(Kod_, Spis: word): word;

#doc
   Функция определяет, является Раздел РСВ пустым (незаполненным)
   параметры:
   cRecDocumRsv - ссылка на документ
   wNumRazd_    - номер Раздела РСВ-1
   wNumPage_    - номер подраздела
   PriznPage_   - доп. признак страницы
#end

#doc
  Функция определяет, является Раздел РСВ пустым (незаполненным)
  параметры:
  cRecDocumRsv - ссылка на документ
  wNumRazd_    - номер Раздела РСВ-1
  wNumPage_    - номер подраздела
  PriznPage_   - доп. признак страницы
  использовать для приложений 8, 9, 10
#end
function fboEmpty_RazdelExt(cRecDocumRsv: comp; NumRazd_, NumPage_, PriznPage_: word): boolean;

#doc
  Функция определяет, является Раздел РСВ пустым (незаполненным)
  параметры:
  cRecDocumRsv - ссылка на документ
  использовать для Раздела 2
#end
function fboEmpty_RazdelExt2(cRecDocumRsv: comp): boolean;

function fboEmpty_Razdel(cRecDocumRsv: comp; NumRazd_, NumPage_, PriznPage_: word): boolean;
#doc
  Функция определяет, является Раздел РСВ с подклассами пустым (незаполненным)
  параметры:
  cRecDocumRsv - ссылка на документ
  wNumRazd_    - номер Раздела РСВ-1
  wNumPage_    - номер подраздела
  wNumPK_      - номер подкласса
#end

#doc
  Функция определяет, является Раздел 3 РСВ пустым (незаполненным)
  параметры:
  cRecDocumRsv - ссылка на документ
  использовать для Раздела 3
#end
function fboEmpty_Razdel3(cRecDocumRsv: comp): boolean;

function fboEmpty_RazdelPk(cRecDocumRsv: comp; NumRazd_, NumPage_, NumPk_: word): boolean;
end;

ObjInterface objRSV2017_FUNCExt2;
#doc
  функция возвращает первый месяц квартала
#end
function fwGetBegMonthKv(wPer_: word): word;

#doc
  Функция для определения наличия отрицательных сумм в Разделе 3
  параметры:
  cRecDocumRsv - ссылка на документ
#end
function fboCheckNegSumRSV(cRecDocumRsv: comp): boolean;

#doc
  функция возвращает признак отрицательной суммы
#end
function fwGetPrNegSum(doSumProv: double): word;

#doc
  функция актуализации сумм в отчете по Разделу 3
#end
function fboReCalcSumR3_Report(cRecDocumRsv: comp): boolean;

#doc
  функция возвращает суммы взносов для Раздела 1 по данным других разделов
#end
function fGetdoSumVznRazd(cRecDocum_: comp; wNumPage_: word; var doSumVzn2, doSumVzn3, doSumVzn4: double): double;

#doc
  Процедура открывает документ "Порядок заполнения"
#end
procedure pOpenDocRSV;

end;

ObjInterface objRSV2017_FUNC_PAT;
#doc
 Функция для перерасчета ПАТ-формулы
#end
function pGetSumPATFormula(cRecDocumRsv: comp; cnTmp : word): double;

#doc
 Процедура для перерасчета всех ПАТ-формул отчета
#end
Procedure pGetPATFormulaALL( cRecDocumRsv: comp);
end;

ObjInterface objRSV2017_FUNC_ImpExp;
#doc
 Функция возвращает nRec документа
 Параметры:
 YearDoc_     - год
 PeriodDoc_   - период
 wParDocLink  - тип периода (1 - текущий, 0 - предыдущий)
 cDocPred     - ссылка на документ
#end
function fcGetPredDoc(YearDoc_, PeriodDoc_, wParDocLink: word; cDocPred: comp): comp;

end;

VipInterface RSV2017_FUNC implements objRSV2017_FUNC, objRSV2017_FUNC2, objRSV2017_FUNCExt, objRSV2017_FUNCExt2, objRSV2017_FUNC_PAT
                                    ,objRSV2017_FUNC_ImpExp #Licensed_Free;

#end
