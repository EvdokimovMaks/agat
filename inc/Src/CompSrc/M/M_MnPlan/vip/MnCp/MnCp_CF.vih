// =============================================================================
//                                                     (c)  корпорация Галактика
// Галактика 7.11 - Производственный контур
// Описание интерфейса "Общие функции для работы с производственной мощностью"
// =============================================================================

#include ListAn.vih
#include ListVal.vih

#component "M_MnPlan"

//******************************************************************************
// Типы данных

//------------------------------------------------------------------------------
// Структура для хранения фонда времени работы
#ifndef __Def_TFondWorkTime__
#define __Def_TFondWorkTime__
#doc
 Структура для хранения фонда времени работы</brief> <br>
 Поля: <br>
   wKauPrEd     - Тип производственной единицы: <br>
     cgKau_ObjRem  : Единица оборудования <br>
     cgKau_GrObjRem: Группа оборудования <br>
     cgKau_KatPodr : Подразделение <br>
     cgKau_KatOrg  : Организация <br>
     cgKau_Profes  : Профессия <br>
     cgKau_Persons : Сотрудник <br>
   cPrEd        - Ссылка на производственную единицу <br>
   wRazr        - Разряд (для профессий) <br>
   wCodTar      - Код тарифа (для профессий) <br>
   wSisOpl      - Система оплаты (для профессий) <br>
   dtBeg        - Начальная дата периода <br>
   dtEnd        - Конечная дата периода <br>
   wTypeEd      - Единица измерения времени (xDay, xWeek, ...) <br>
   dKolPrEd     - Количество производственных единиц <br>
   dFndCalendS  - Календарный фонд времени работы в секундах <br>
   dFndCalendM  - Календарный фонд времени работы в минутах <br>
   dFndCalendH  - Календарный фонд времени работы в часах <br>
   dFndCalendSS - Календарный фонд времени работы в сменах <br>
   dFndCalendD  - Календарный фонд времени работы в днях <br>
   dFndCalendW  - Календарный фонд времени работы в неделях <br>
   dFndCalendT  - Календарный фонд времени работы в декадах <br>
   dFndCalendMM - Календарный фонд времени работы в месяцах <br>
   dFndCalendQ  - Календарный фонд времени работы в кварталах <br>
   dFndCalendHY - Календарный фонд времени работы в полугодиях <br>
   dFndCalendY  - Календарный фонд времени работы в годах <br>
   dFndRegimeS  - Режимный фонд времени работы в секундах <br>
   dFndRegimeM  - Режимный фонд времени работы в минутах <br>
   dFndRegimeH  - Режимный фонд времени работы в часах <br>
   dFndRegimeSS - Режимный фонд времени работы в сменах <br>
   dFndRegimeD  - Режимный фонд времени работы в днях <br>
   dFndRegimeW  - Режимный фонд времени работы в неделях <br>
   dFndRegimeT  - Режимный фонд времени работы в декадах <br>
   dFndRegimeMM - Режимный фонд времени работы в месяцах <br>
   dFndRegimeQ  - Режимный фонд времени работы в кварталах <br>
   dFndRegimeHY - Режимный фонд времени работы в полугодиях <br>
   dFndRegimeY  - Режимный фонд времени работы в годах <br>
   dFndRealS    - Действительный фонд времени работы в секундах <br>
   dFndRealM    - Действительный фонд времени работы в минутах <br>
   dFndRealH    - Действительный фонд времени работы в часах <br>
   dFndRealSS   - Действительный фонд времени работы в сменах <br>
   dFndRealD    - Действительный фонд времени работы в днях <br>
   dFndRealW    - Действительный фонд времени работы в неделях <br>
   dFndRealT    - Действительный фонд времени работы в декадах <br>
   dFndRealMM   - Действительный фонд времени работы в месяцах <br>
   dFndRealQ    - Действительный фонд времени работы в кварталах <br>
   dFndRealHY   - Действительный фонд времени работы в полугодиях <br>
   dFndRealY    - Действительный фонд времени работы в годах <br>
   dTimeDeadS   - Время простоев в секундах <br>
   dTimeDeadM   - Время простоев в минутах <br>
   dTimeDeadH   - Время простоев в часах <br>
   dTimeDeadSS  - Время простоев в сменах <br>
   dTimeDeadD   - Время простоев в днях <br>
   dTimeDeadW   - Время простоев в неделях <br>
   dTimeDeadT   - Время простоев в декадах <br>
   dTimeDeadMM  - Время простоев в месяцах <br>
   dTimeDeadQ   - Время простоев в кварталах <br>
   dTimeDeadHY  - Время простоев в полугодиях <br>
   dTimeDeadY   - Время простоев в годах <br>
   dNormPercent - Прогрессивный процент выполнения норм <br>
#end
Type TFondWorkTime = record
  wKauPrEd: word;       // тип производственной единицы:
                        //    cgKau_ObjRem  : единица оборудования
                        //    cgKau_GrObjRem: группа оборудования
                        //    cgKau_KatPodr : подразделение
                        //    cgKau_KatOrg  : организация
                        //    cgKau_Profes  : профессия
                        //    cgKau_Persons : сотрудник
  cPrEd: comp;          // ссылка на производственную единицу
  wRazr: word;          // разряд (для профессий)
  wCodTar: word;        // код тарифа (для профессий)
  wSisOpl: word;        // cистема оплаты (для профессий)
  dtBeg: date;          // начальная дата периода
  dtEnd: date;          // конечная дата периода
  wTypeEd: word;        // единица измерения времени (xDay, xWeek, ...)
  dKolPrEd: double;     // количество производственных единиц
  dFndCalendS: double;  // календарный фонд времени работы в секундах
  dFndCalendM: double;  // календарный фонд времени работы в минутах
  dFndCalendH: double;  // календарный фонд времени работы в часах
  dFndCalendSS: double; // календарный фонд времени работы в сменах
  dFndCalendD: double;  // календарный фонд времени работы в днях
  dFndCalendW: double;  // календарный фонд времени работы в неделях
  dFndCalendT: double;  // календарный фонд времени работы в декадах
  dFndCalendMM: double; // календарный фонд времени работы в месяцах
  dFndCalendQ: double;  // календарный фонд времени работы в кварталах
  dFndCalendHY: double; // календарный фонд времени работы в полугодиях
  dFndCalendY: double;  // календарный фонд времени работы в годах
  dFndRegimeS: double;  // режимный фонд времени работы в секундах
  dFndRegimeM: double;  // режимный фонд времени работы в минутах
  dFndRegimeH: double;  // режимный фонд времени работы в часах
  dFndRegimeSS: double; // режимный фонд времени работы в сменах
  dFndRegimeD: double;  // режимный фонд времени работы в днях
  dFndRegimeW: double;  // режимный фонд времени работы в неделях
  dFndRegimeT: double;  // режимный фонд времени работы в декадах
  dFndRegimeMM: double; // режимный фонд времени работы в месяцах
  dFndRegimeQ: double;  // режимный фонд времени работы в кварталах
  dFndRegimeHY: double; // режимный фонд времени работы в полугодиях
  dFndRegimeY: double;  // режимный фонд времени работы в годах
  dFndRealS: double;    // действительный фонд времени работы в секундах
  dFndRealM: double;    // действительный фонд времени работы в минутах
  dFndRealH: double;    // действительный фонд времени работы в часах
  dFndRealSS: double;   // действительный фонд времени работы в сменах
  dFndRealD: double;    // действительный фонд времени работы в днях
  dFndRealW: double;    // действительный фонд времени работы в неделях
  dFndRealT: double;    // действительный фонд времени работы в декадах
  dFndRealMM: double;   // действительный фонд времени работы в месяцах
  dFndRealQ: double;    // действительный фонд времени работы в кварталах
  dFndRealHY: double;   // действительный фонд времени работы в полугодиях
  dFndRealY: double;    // действительный фонд времени работы в годах
  dTimeDeadS: double;   // время простоев в секундах
  dTimeDeadM: double;   // время простоев в минутах
  dTimeDeadH: double;   // время простоев в часах
  dTimeDeadSS: double;  // время простоев в сменах
  dTimeDeadD: double;   // время простоев в днях
  dTimeDeadW: double;   // время простоев в неделях
  dTimeDeadT: double;   // время простоев в декадах
  dTimeDeadMM: double;  // время простоев в месяцах
  dTimeDeadQ: double;   // время простоев в кварталах
  dTimeDeadHY: double;  // время простоев в полугодиях
  dTimeDeadY: double;   // время простоев в годах
  dNormPercent: double; // прогрессивный процент выполнения норм
End; // Type TFondWorkTime
#endif

//******************************************************************************
// ObjInterface oMnCp_CF
#ifndef __Def_oMnCp_CF__
#define __Def_oMnCp_CF__
#doc
 Описание интерфейса "Общие функции для работы с производственной мощностью"</brief>
#end
ObjInterface oMnCp_CF;

//------------------------------------------------------------------------------
#doc
 Инициализация переменных</brief> <br>
#end
Procedure Init;

//------------------------------------------------------------------------------
#doc
 Возвращает фонд времени работы производственной единицы за период</brief> <br>
 Параметры: <br>
  ardFWT - Фонд времени работы производственной единици за период с adtBeg по adtEnd <br>
 Результат: <br>
   True, если успешно, иначе - False <br>
#end
Function GetFondWorkTime(var ardFWT: TFondWorkTime): boolean;

//------------------------------------------------------------------------------
#doc
 Расчет времени работы и простоя для производственной единицы за период</brief> <br>
 Параметры: <br>
   awLeaveExistsVal - Группа флагов "оставить существующие значения": <br>
     1 - режимного фонда времени работы <br>
     2 - времени ремонтов (для оборудования, групп оборудования) <br>
   ardFWT           - Фонд времени работы производственной единици за период с adtBeg по adtEnd <br>
#end
Procedure CalcFondWorkTime(awLeaveExistsVal: word; var ardFWT: TFondWorkTime);

//------------------------------------------------------------------------------
#doc
 Проверка существования взаимосвязи между производственной единицей и объектом
 по производственной мощности</brief> <br>
 Параметры: <br>
   awKauPrEd     - Тип производственной единицы: <br>
     cgKau_ObjRem  : Единица оборудования <br>
     cgKau_GrObjRem: Группа оборудования <br>
     cgKau_KatDept : Подразделение <br>
     cgKau_KatOrg  : Организация <br>
   acPrEd        - Ссылка на производственную единицу <br>
   awKauObj      - Тип объекта: <br>
     cgKau_KatMC : МЦ <br>
     cgKau_KatUsl: Услуга <br>
   acObject      - Ссылка на объект <br>
   aoList_ObjRec - Объект для сохранения списка всех родственных для acObject объектов, связанных с acPrEd <br>
 Результат: <br>
   True, если взаимосвязь существует, иначе - False <br>
#end
Function ExistsMnCpRlt_PrEd_Obj(awKauPrEd: word; acPrEd: comp; awKauObj: word; acObject: comp;
  var aoList_ObjRec: oiListVal): boolean;

//------------------------------------------------------------------------------
#doc
 Проверка, являются ли два объекта родственными, т.е.:
   для "МЦ"     - входят ли они в состав одной и той же обобщенной МЦ
   для "Услуги" - входят ли они в состав одной и той же обобщенной Услуги</brief> <br>
 Параметры: <br>
   awKauObj1 - Тип объекта 1: <br>
     cgKau_KatMC : МЦ <br>
     cgKau_KatUsl: Услуга <br>
   acObject1 - Ссылка на объект 1 <br>
   awKauObj2 - Тип объекта 2: <br>
     cgKau_KatMC : МЦ <br>
     cgKau_KatUsl: Услуга <br>
   acObject2 - Ссылка на объект 2 <br>
 Результат: <br>
   True, если "да", иначе - False <br>
#end
Function IsLikenessObjects(awKauObj1: word; acObject1: comp;
  awKauObj2: word; acObject2: comp): boolean;

//------------------------------------------------------------------------------
#doc
 Расчет производственной мощности для объекта за заданный период</brief> <br>
 Параметры: <br>
   awFlTypeMnCp  - Флаг расчета мощности: <br>
     0: Рассчитывать входную + выходную мощность <br>
     1: Рассчитывать входную мощность <br>
     2: Рассчитывать выходную мощность <br>
   adtBeg        - Начальная дата периода <br>
   adtEnd        - Конечная дата периода <br>
   awEdTime      - Константа единицы времени измерения мощности (xHour, xDay, xWeek, xMonth, ... -> TppConst.inc) <br>
   awKauObj      - Тип объекта: <br>
     cgKau_KatMC : МЦ <br>
     cgKau_KatUsl: Услуга <br>
   acObject      - Ссылка на объект <br>
   acOtpEd       - Ссылка на единицу измерения, в которой возвращается результат <br>
   awKauPrEd     - Тип производственной единицы: <br>
     cgKau_ObjRem  : Единица оборудования <br>
     cgKau_GrObjRem: Группа оборудования <br>
     cgKau_KatDept : Подразделение <br>
     cgKau_KatOrg  : Организация <br>
   acPrEd        - Ссылка на производственную единицу <br>
   aoList_ObjRec - Объект для сохранения списка всех родственных для acObject объектов, связанных с acPrEd <br>
 Результат: <br>
   Значение производственной мощности в переданной единице измерения <br>
#end
Function CalcMnCp(awFlTypeMnCp: word; adtBeg: date; adtEnd: date; awEdTime: word;
  awKauObj: word; acObject: comp; acOtpEd: comp; awKauPrEd: word; acPrEd: comp;
  var aoList_ObjRec: oiListVal): double;

//------------------------------------------------------------------------------
#doc
 Получение данных по производительности на заданную дату для заданной единицы измерения времени</brief> <br>
 Параметры: <br>
   awFlTypeMnCp - Флаг типа мощности: <br>
     0: Входная + выходная мощность <br>
     1: Входная мощность <br>
     2: Выходная мощность <br>
   adtDat       - Дата <br>
   awEdTime     - Константа единицы измерения времени (xHour, xDay, xWeek, xMonth, ... -> TppConst.inc) <br>
   awKauObj     - Тип объекта: <br>
     cgKau_KatMC : МЦ <br>
     cgKau_KatUsl: Услуга <br>
   acObject     - Ссылка на объект <br>
   awKauPrEd    - Тип производственной единицы: <br>
     cgKau_ObjRem  : Единица оборудования <br>
     cgKau_GrObjRem: Группа оборудования <br>
     cgKau_KatDept : Подразделение <br>
     cgKau_KatOrg  : Организация <br>
   acPrEd       - Ссылка на производственную единицу <br>
   ar_MnCp_Sp   - Буфер записи MnCp_Sp <br>
 Результат: <br>
   True, если запись найдена, иначе - False <br>
#end
Function GetUnitCap(awFlTypeMnCp: word; adtDat: date; awEdTime: word;
  awKauObj: word; acObject: comp; awKauPrEd: word; acPrEd: comp;
  var ar_MnCp_Sp: type$MnCp_Sp): boolean;

End; // ObjInterface oMnCp_CF

VipInterface iMnCp_CF implements oMnCp_CF Licensed(Free);

#endif
