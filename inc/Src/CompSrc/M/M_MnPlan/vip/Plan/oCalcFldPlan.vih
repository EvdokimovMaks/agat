/*
 ╔═══════════════════════════════════════════════════════════════════════════╗
 ║                     (c) 1994,04 корпорация ГАЛАКТИКА                      ║
 ║ Проект        : ГАЛАКТИКА                                                 ║
 ║ Система       : Планирование                                              ║
 ║ Версия        : 7.1                                                       ║
 ║ Назначение    : Описание объектного интерфейса                            ║
 ║                 исполнения скрипта по плановым документам                 ║
 ║ Назначение    : Запуск скрипта по плану                                   ║
 ║ Ответственный : Климович Виктор Леонидович (VICTOR)                       ║
 ║ Параметры     : Есть                                                      ║
 ╚═══════════════════════════════════════════════════════════════════════════╝
*/
//#include GalScriptStdF.obj
#include typetbl.vpp

#ifndef __oCalcFldPlan__
#define __oCalcFldPlan__

#ifdef ComponentVersion
#component "M_MnPlan"
#end

ObjInterface oCalcFldPlan;

  // Начальная инициализация объекта запускать только для ручного ввода.
Function InitCalculation (  WayAccouNRec : comp    ; // Настройка текущего документа
                                  NumVid : word    ; // Порядковый номер представления в текущем документе ( 0.. n )
                            CurrentField : LongInt   // Какое поле текущее константа из MnPlan.inc
                                                   ): boolean;


  // Применить формулу для позиции документа (ручной ввод)
  // или для всего документа ( по конкретному представлению )
Function RunInter ( var stValSpMnP : TValSpMnP;
                    var stSpMnPl   : TSpMnPl  ;
  FlagSource : word     ;
   // источник данных (битовая маска):
   // 0 - данные уже в stValSpMnP
   // 1 - данные найти через stSpMnPl
   // 2 - делать  Update stValSpMnP
   //     в режиме расчета для алгоритма по документу по заданной позиции
   //____________________________________________________________________
  FlagRun    : word;
   // режим расчета (битовая маска):
   //  1   - для алгоритма по документу по заданной позиции
   //  2   - для алгоритма по документу по представлению
   //  4   - из интерфейса просмотра документа по позиции (ручной ввод)
   //  8   - запомнить предыдущие значения ValSpMnP для функции ПредЗнач, PrevValue и выйти из функции
   //  16  - не записывать полученные поля заголовка документа в документ
   //  32  - обнулить предыдущие значения ValSpMnP для функции ПредЗнач, PrevValue
   //  64  - для алгоритма по документу по заданной позиции ( при удалении позиции спецификации SpMnPlan)
   //____________________________________________________________________
  MnPlanNRec : comp;
   // для какого документа рассчитываем
  SysNumVid  : word;
   // системный номер алгоритма представления, актуален при ( (FlagRun and 2) > 0 )
  SysNumAlg  : word
   // системный номер расчетного алгоритма, актуален при  ( (FlagRun and 4) > 0 )
                  ): boolean;

  // Проверка возможности применения формулы в расчетных алгоритмах
  // только для режима автоматического ввода
Function GetEnableCalcforAlgor (  WayAccouNRec : comp; // Настройка текущего документа
                                        NumVid : word  // Порядковый номер представления в текущем документе ( 0.. n )
                                                       // либо системный номер представления + toConvSysNumVid
                                                      ): boolean;

  // Проверяет надо ли применять формулу для конкретного поля
  // только для режима ручного ввода
Function CheckEnableCalcForField ( ConstField : LongInt    // Какое поле, константа из MnPlan.inc
                                                        ): boolean;
Function InitInter : Boolean;
Function DoneInter : Boolean;
end;



ObjInterface oCalcFldPlan1(oCalcFldPlan);
procedure StdFuncFree;
End;


ObjInterface oCalcFldPlan2(oCalcFldPlan1);

// Делает то же что и RunInter плюс к тому добавлен новый режим - расчет формул по списку  p_wList_PickSpMnPlan         ==      Pick.wList
Function RunInter_Ext ( var stValSpMnP : TValSpMnP;
                        var stSpMnPl   : TSpMnPl  ;
                            FlagSource : word     ;
                            FlagRun    : word;
   // режим расчета (битовая маска):
   // Режимы для Function RunInter +
   // 1024 - для алгоритма по документу по помеченным позициям
   //____________________________________________________________________
                            MnPlanNRec : comp;
                            SysNumVid  : word;
                            SysNumAlg  : word;
                            p_wList_PickSpMnPlan : word // Значение Pick.wList для выбранных SpMnPlan
                           ): boolean;

end;


//VipInterface iCalcFldPlan Implements oCalcFldPlan, oGalScriptStdF #Licensed_Free;
#endif // #ifdef __oCalcFldPlan__
