//******************************************************************************
//                                                      (c) корпорация ГАЛАКТИКА
// ГАЛАКТИКА 7.1x Производственный контур/Спецификации продуктов
//                объект-менеджер расчета потребностей
//******************************************************************************


#ifndef __OIPOTREX_VIH
#define __OIPOTREX_VIH

#component "M_TPP"

#include oiPotrGt.vih

#doc
объект-менеджер расчета потребностей</brief>
#end

ObjInterface oiPotrEx;
//******************************************************************************
#doc
возвращает ссылку на активный документ</brief><br>
<I>wDocType</I> - тип искомого документа; <I>wObjType, cObject</I> - объект, для которого ищется документ
<I>wProd</I> - признак искомого документа: норма <I>(0)</I> или продукт выхода <I>(1)</I>
#end
  function GetActiveDoc(_wDocType: word; _wObjType: word; _cObject: comp; _wProd: word): comp;

#doc
возвращает ссылку на активный документ для производителя</brief><br>
<I>wDocType</I> - тип искомого документа; <I>wObjType, cObject</I> - объект, для которого ищется документ
<I>wDept, cDept</I> - производитель, для которого ищется документ
<I>wProd</I> - признак искомого документа: норма <I>(0)</I> или продукт выхода <I>(1)</I>
#end
  function GetActiveDocDept(_wDocType: word; _wObjType: word; _cObject: comp; _wDept: word; _cDept: comp; _wProd: word): comp;

#doc
возвращает тип и ссылку документа для ресурса (<I>wDoc, cDoc</I>)</brief><br>
<I>cSrcRec</I> - ссылка на исходную позицию документа
результат функции <I>= 0</I>, если документ найден, <I>> 0</I> - иначе.
#end
  function GetTPPDoc(_tSrcRec: word; _cSrcRec: comp; var _wDoc: word; var _cDoc: comp): integer;

//******************************************************************************
#doc
возвращает тип и ссылку изготовителя (<I>wDept, cDept</I>)</brief><br>
<I>tDoc, cDoc</I> ссылка на документ
результат функции <I>= 0</I>, если найден, <I>> 0</I> - иначе.
#end
  function GetDeptByDoc(_tDoc: word; _cDoc: comp; var _wDept: word; var _cDept: comp): integer;

#doc
возвращает тип и ссылку значения аналитики (<I>wKAUCode, cKAUVal</I>)</brief><br>
<I>tDoc, cDoc</I> - ссылка на документ; <I>cKAURole</I> роль аналитики
результат функции <I>= 0</I>, если найден, <I>> 0</I> - иначе.
если <I>cDoc = 0</I>, то в <I>TmpPotr</I> список документов с типом <I>tDoc</I> (<I>=0</I> - все типы),
               обладающих свойствами, указанными в <I>cKAURole, wKAUCode, cKAUVal</I>
результат функции <I>= 0</I>, если в <I>TmpPotr</I> что-то попало, <I>> 0</I> - иначе.
#end
  function GetAnValByDoc(_tDoc: word; _cDoc: comp; _cKAURole: comp; var _wKAUCode: word; var _cKAUVal: comp): integer;

//******************************************************************************
#doc
устанавливает рабочую дату расчетов для документов с типом <I>wDocType</I></brief>
#end
  procedure SetWorkDate(_wDocType: word; _onDate: date);

#doc
устанавливает фильтр по категориям ресурсов для документов с типом <I>wDocType</I></brief>
#end
  procedure SetWorkNorm(_wDocType: word; _wNormSort: word);

#doc
устанавливает рабочие параметры расчетов для документов с типом <I>wDocType</I></brief><br>
<I>_wFlag</I> - флаг параметров: бит: значение:<br>
<PRE>
                            0:    0 (0000)- очищать таблицу результатов (по умолчанию)
                                  1 (0001)- накапливать результаты
                          2,1:   00 (    )- в учетных ед.   (по умолчанию)
                                 01 (0002)- в тех, что есть
                                 10 (0004)- в акт.отпускных
                                 11 (0006)- резерв
                            3:    0 (    )- выключить визуализацию (по умолчанию)
                                  1 (0008)- включить визуализацию
                            4:    0 (    )- не разузловывать инструмент (по умолчанию)
                                  1 (0016)- разузловывать инструмент
                          6,5:   00 (    )- не учитывать %потерь и коэф.использования (по умолчанию)
                                 01 (0032)- учитывать %потерь
                                 10 (0064)- учитывать коэф.использования
                                 11 (    )- резерв
                            7:    0 (    )- выполнить пересчет формул (по умолчанию)
                                  1 (0128)- не выполнять пересчет формул
                    11,10,9,8: 0000 (    )- не проверять наличие ресурсов (по умолчанию)
                               0001 (0256)- проверять наличие материальных ресурсов
                               0010 (0512)- проверять наличие трудовых ресурсов
                               0100 (1024)- проверять наличие оборудования
                               1000 (2048)- проверять наличие инструментов
                           12:    0 (    )- контроль ресурсов по всему документу (по умолчанию)
                                  1 (4096)- пооперационный контроль ресурсов
                           13:    0 (    )- не доставать статью затрат (по умолчанию)
                                  1 (8192)- доставать статью затрат
                           14:    0 (    )- при поиске документа искать основной, при отсутствии - не основной (по умолчанию)
                                  1 (16384)- при поиске документа искать только основной
</PRE>
#end
  procedure SetWorkFlag(_wDocType: word; _wFlag: word);

#doc
устанавливает различные режимы расчетов для документов с типом <I>wDocType</I></brief><br>
<I>_wMode</I> - индекс режима работы
<I>_wValue</I> - режим работы 0: бит: значение:
                            0:   0 (0000)- исключать фантомы (по умолчанию)
                                 1 (0001)- оставлять фантомы
                            1:   0 (    )- не открывать окно отладки скриптов (по умолчанию)
                                 1 (0002)- открывать окно отладки скриптов
#end
  procedure SetWorkMode(_wDocType: word; _wMode: word; _wValue: word);

#doc
устанавливает маркер со списком контролируемых</brief>:<br>
<I>_wMode = cgKAU_KaWork</I> - видов работ
<I>_wMode = cgKAU_TechOp</I> - техопераций
#end
  procedure SetWorkMarker(_wMode: word; _lValue: TPtr);

//******************************************************************************
#doc
расчет потребности по документу на учетную единицу объекта</brief><br>
<I>wDocType, cDoc</I> ссылка на документ (обязательные параметры)
<I>wDepth</I> - глубина разузлования (пока <I>0</I> - нулевой, <I>>0</I> - все уровни)
#end
  procedure GetDocPotr(_wDocType: word; _cDoc: comp; _wDepth: word);

#doc
расчет потребности по документу на <I>wQnt cEd</I> единиц объекта</brief><br>
#end
  procedure GetDocPotrEx(_wDocType: word; _cDoc: comp; _wDepth: word; _wQnt: double; _cEd: comp);

//******************************************************************************
#doc
расчет потребностей по документу и операции на учетную единицу объекта(только по
первому уровню)</brief><br>
<I>wOpType, cOper</I> - ссылка на операцию (обязательные параметры,
                                   если <I>wOpType = cgKAU_Marsh_Sp</I>, то <I>cDoc</I> не учитывается)
<I>wDocType, cDoc</I> ссылка на документ (обязательный параметр)
#end
  procedure GetDocOperPotr(_wOpType: word; _cOper: comp; _wDocType: word; _cDoc: comp);

#doc
расчет потребностей по документу и операции на <I>wQnt cEd</I> единиц объекта</brief><br>
#end
  procedure GetDocOperPotrEx(_wOpType: word; _cOper: comp; _wDocType: word; _cDoc: comp; _wQnt: double; _cEd: comp);

//******************************************************************************
#doc
расчет потребностей для объекта на учетную единицу объекта</brief><br>
<I>wObjType, cObject<I> - сылка на объект (обязательные параметры)
<I>wDocType, cDoc</I> - ссылка на документ (если не указан, найдет активный)
<I>wDepth</I> - глубина разузлования (пока <I>0</I> - нулевой, <I>>0</I> - все уровни)
#end
  procedure GetObjPotr(_wObjType: word; _cObject: comp; _wDocType: word; _cDoc: comp; _wDepth: word);

#doc
расчет потребностей для объекта на <I>wQnt cEd</I> единиц объекта</brief><br>
#end
  procedure GetObjPotrEx(_wObjType: word; _cObject: comp; _wDocType: word; _cDoc: comp; _wDepth: word; _wQnt: double; _cEd: comp);

//******************************************************************************
#doc
расчет потребностей для объекта и операции на учетную единицу объекта(только по
первому уровню)</brief><br>
<I>wOpType, cOper</I> - ссылка на операцию (обязательные параметры,
                                   если <I>wOpType = cgKAU_Marsh_Sp</I>, то <I>cDoc</I> не учитывается)
<I>wObjType, cObject</I> - ссылка на объект (обязательные параметры)
<I>wDocType, cDoc</I> - ссылка на документ (если не указан, найдет активный для <I>wObjType, cObject</I> или
                                   возьмет из <I>Marsh_Sp</I> если <I>wOpType = cgKAU_Marsh_Sp</I>)
#end
  procedure GetObjOperPotr(_wOpType: word; _cOper: comp; _wObjType: word; _cObject: comp; _wDocType: word; _cDoc: comp);

#doc
расчет потребностей для объекта и операции на <I>wQnt cEd</I> единиц объекта</brief><br>
#end
  procedure GetObjOperPotrEx(_wOpType: word; _cOper: comp; _wObjType: word; _cObject: comp; _wDocType: word; _cDoc: comp; _wQnt: double; _cEd: comp);

//******************************************************************************
#doc
формирование списка документов куда входит объект</brief><br>
<I>wObjType, cObject</I> - ссылка на объект (обязательные параметры)
<I>wDocType = 0</I> - всех типов: <I>cgKAU_KatMarsh, cgKAU_HDR_KS, cgKAU_HDR_PS, cgKAU_KatCompl</I>
<I>cDoc</I> -  документ с типом <I>wDocType</I> (игнорируется, если <I>wDocType = 0</I>)
<I>wProdType</I> - в каком качестве входит объект <I>0</I> - норма, <I>1</I> - выход, <I>2</I> - все направления
<I>wDepth</I> глубина разузлования (пока <I>0</I> - нулевой, <I>>0</I> - все уровни)
#end
  procedure ObjPotrList(_wObjType: word; _cObject: comp; _wDocType: word; _cDoc: comp; _wProdType: word; _wDepth: word);

//******************************************************************************
#doc
закрыть протокол</brief>
#end
  procedure CloseLog;

#doc
открыть протокол</brief>
#end
  procedure OpenLog(_iEvnLog: oiEvnLog);

#doc
создать новый протокол</brief>
#end
  function NewLog: oiEvnLog;

#doc
показать протокол</brief>
#end
  procedure ShowLog;

//******************************************************************************
//  property State: integer;
#doc
получить состояние</brief>
#end
  function GetState: integer;

//  property MemOn: boolean;
#doc
получить значение флага</brief>
#end
  function GetMemOn: boolean;

#doc
установить значение флага в зависимости от параметров</brief>
#end
  function SetMemOn(_bVal: boolean; _bAct: boolean): integer;

//  property PotrTM: oiPotrGt; реализация объекта расчета для ТП/ТМ
#doc
реализация объекта расчета для ТП/ТМ</brief>
#end
  function GetPotrTM: oiPotrGt;

//  property PotrPS: oiPotrGt; реализация объекта расчета для ПС
#doc
реализация объекта расчета для ПС</brief>
#end
  function GetPotrPS: oiPotrGt;

//  property PotrMS: oiPotrGt; реализация объекта расчета для наборов
#doc
реализация объекта расчета для наборов</brief>
#end
  function GetPotrMS: oiPotrGt;

//******************************************************************************
#doc
возвращает рабочую дату расчетов для документов с типом <I>wDocType</I></brief>
#end
  function GetWorkDate(_wDocType: word): date;

#doc
возвращает установленный фильтр по категориям ресурсов для документов с типом <I>wDocType</I></brief>
#end
  function GetWorkNorm(_wDocType: word): word;

#doc
возвращает установленные рабочие параметры расчетов для документов с типом <I>wDocType</I></brief>
#end
  function GetWorkFlag(_wDocType: word): word;

#doc
возвращает установленные различные режимы расчетов для документов с типом <I>wDocType</I></brief>
<I>_wMode</I> - индекс режима работы
#end
  function GetWorkMode(_wDocType: word; _wMode: word): word;

#doc
возвращает установленный маркер со списком контролируемых</brief>:<br>
<I>_wMode = cgKAU_KaWork</I> - видов работ
<I>_wMode = cgKAU_TechOp</I> - техопераций
#end
  function GetWorkMarker(_wMode: word): TPtr;

end; // oiPotrEx

#endif  // __OIPOTREX_VIH
