//------------------------------------------------------------------------------
//                                                    (c) корпорация "Галактика"
// Галактика 8.0 - Общая функциональность
// Интерфейсы описания и доступа к псевдоклассификаторам
//------------------------------------------------------------------------------

#ifndef _PSEUDOCLASSIFIER_OBJ_INCLUDED_
#define _PSEUDOCLASSIFIER_OBJ_INCLUDED_

/*
  Code - код
  Interpretation - расшифровка
  ShortInterpretation - краткая расшифровка
  Comment - комментарий
*/

  #component "c_common"

#doc
  настройки колонки интерфейса просмотра содержимого псевдоклассификатора
#end
objinterface IColumnLayout;
  property IsVisible: boolean read write;
  property Width: integer read write;
  property Title: string read write;
  property Hint: string read write;

  property IsResizeable: boolean read write;
  property ColumnIndex: integer read write;
end;

//------------------------------------------------------------------------------
// интерфейс форматтера интерфейса просмотра содержимого псевдоклассификатора
//------------------------------------------------------------------------------
#doc
  интерфейс форматтера интерфейса просмотра содержимого псевдоклассификатора
#end
objinterface IPseudoClassifierLayout;
  property Code: IColumnLayout read write;
  property Interpretation: IColumnLayout read write;
  property ShortInterpretation: IColumnLayout read write;
  property Comment: IColumnLayout read write;

  // для настройки положения окна
  property XPos: single read write;
  property YPos: single read write;
  property Height: single read write;
  property Width: single read write;
end;

//------------------------------------------------------------------------------
// Код элемента псевдоклассификатора
//------------------------------------------------------------------------------
type
  TPseudoClassifierItemCode = string[16];

//------------------------------------------------------------------------------
// интерфейс описателя псевдоклассификатора
//------------------------------------------------------------------------------
#doc
  интерфейс описателя псевдоклассификатора
#end
objinterface IPseudoClassifierDeclarator;

  // наименование
  property Name: string write;

  // код элемента по умолчанию
  property DefaultCode: variant write;

  // ссылка на интерфейс форматтера интерфейса просмотра содержимого
  property Layout: IPseudoClassifierLayout read write;

  // контекст справки
  property HelpContext: variant write;

  // имя загрузчика
  property LoaderName: string write;

  // добавить описание элемента псевдоклассификатора (краткая форма)
  procedure AddItem(Code: variant; Interpretation: string);

  // добавить описание элемента псевдоклассификатора
  procedure AddItemExt(Code: variant; Interpretation, ShortInterpretation, Comment: string);
end;

//------------------------------------------------------------------------------
// интерфейс загрузчика псевдоклассификатора
//------------------------------------------------------------------------------
#doc
  интерфейс загрузчика псевдоклассификатора
#end
objinterface IPseudoClassifierLoader;

  #doc
  загрузить в память содержимое и описание псевдоклассификатора
  #end
  procedure Load(Declarator: IPseudoClassifierDeclarator);
end;


//------------------------------------------------------------------------------
// интерфейс описания псевдоклассификатора
//------------------------------------------------------------------------------
#doc
  интерфейс описания псевдоклассификатора
#end
objinterface IPseudoClassifierDefinition;
  // нaименование
  property Name: string read;

  // код элемента по умолчанию
  property DefaultCode: variant read;

  // ссылка на форматтер интерфейса просмотра содержимого
  property Layout: IPseudoClassifierLayout read;

  // контекст справки
  property HelpContext: variant read;

  // имя загрузчика
  property LoaderName: string read;

  #doc
  выбрать элемент из списка
  #end
  function Pick(Layout: IPseudoClassifierLayout; var Code: variant): boolean;
end;

//------------------------------------------------------------------------------
// интерфейс контейнера для хранения строки
//------------------------------------------------------------------------------
#doc
  интерфейс контейнера для хранения строки
#end
objinterface IStringContainer;
  property Value: string read write;
end;

//------------------------------------------------------------------------------
// точка расширения для поиска имени загрузчика псевдоклассификатора
// по умолчанию
//------------------------------------------------------------------------------
extensionpoint epGetPseudoClassifierDefaultLoader(
  // идентификатор загрузчика описания по умолчанию
  ResourceId: string;
  // контейнер для хранения имени загрузчика
  LoaderName: IStringContainer);

//------------------------------------------------------------------------------
// макроопределение для описания обработчика точки расширения для
// поиска имени загрузчика описания псевдоклассификатора по умолчанию
//------------------------------------------------------------------------------
#declare GetPseudoClassifierDefaultLoader(HandlerName, ResourceId, LoaderName)
  handler with replace #HandlerName on extensionpoint epGetPseudoClassifierDefaultLoader(
      ResourceId: string;
      LoaderName: IStringContainer)
    action
    {
      if ResourceId = UpCase(#ResourceId)
      {
        LoaderName.Value := #LoaderName;
        // прервать дальнейшую обработку точки расширения
        Result := false;
      }
      else
        Result := true;
    }
#end

//------------------------------------------------------------------------------
// интерфейс псевдоклассификатора
//------------------------------------------------------------------------------
#doc
  интерфейс псевдоклассификатора
#end
objinterface IPseudoClassifier;
  // код элемента
  property Code: TPseudoClassifierItemCode read;

  // расшифровка
  property Interpretation: string read;

  // краткая расшифровка
  property ShortInterpretation: string read;

  // комментарий
  property Comment: string read;

  // ссылка на интерфейс описания
  property Definition: IPseudoClassifierDefinition read write;

  #doc
  загрузить описание
  #end
  procedure Load(LoaderName: string);

  #doc
  загрузить описание по умолчанию
  #end
  procedure LoadDefault(ResourceId: string);

  #doc
  выбрать элемент из списка
  #end
  function Pick(Layout: IPseudoClassifierLayout; var Code: variant): boolean;

  #doc
  позиционироваться на элемент с кодом Code
  #end
  function Seek(Code: variant): boolean;

  #doc
  вернуть код следующего за текущим элемента
  #end
  function Next: variant;

  // объектный индекс
  index ByCode = Code(unique, noupcase);
end;

#end
