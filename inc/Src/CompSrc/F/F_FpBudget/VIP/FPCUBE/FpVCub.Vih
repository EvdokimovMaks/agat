//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 9.10 - модуль "Управление бюджетом"
// Визуальный интерфейс : "Куб данных"
//------------------------------------------------------------------------------

#ifndef __FpVCub_Vih__
#define __FpVCub_Vih__

//------------------------------------------------------------------------------
#ifdef  ComponentVersion
#component "F_FpBudget"
#endif//ComponentVersion

//------------------------------------------------------------------------------
#include FpTypes.Inc
#include xlReport.Vih
#include FpAgrSet.Vih
#include FpAxCub.Vih
#include FpL2Cel.Vih
//------------------------------------------------------------------------------
Type TColEditAttr = record  // Атрибуты редактирования колонки:
  IsCanEdit   : boolean;    // возможность редактирование
  wKodReg     : word;       // код регистра учета
end; // Type
Type TArrEditAttr = array[1..1] of TColEditAttr;  // Атрибуты редактирования колонок
//------------------------------------------------------------------------------


//==============================================================================
#doc
Визуальный интерфейс : "Куб данных"<br>
<b>Внимание!</b> Интерфейс предназначен только для внутреннего использования<br>
#end
Private ObjInterface IViewFpCube;

  //============================================================================
  //                                  ERROR
  //----------------------------------------------------------------------------
  //----------------------------------------------------------------------------
  #doc
     Функция возвращает описание последней ошибки
  #end
  function GetStLastError : string;
  //****************************************************************************


  //============================================================================
  //                                  FIELDS
  //----------------------------------------------------------------------------
  #doc
     Получить идентификатор процесса
  #end
  function GetProcessID : word;

  //----------------------------------------------------------------------------
  #doc
     Получить ссылку на объект работы с осями
  #end
  function GetObjFpAxisCube : IObjFpAxisCube;

  //----------------------------------------------------------------------------
  #doc
     Установить значения настройки представления
  #end
  function SetViewTune(_Value : comp) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Установить режим редактирования колонок
  #end
  function SetAllColCanEdit(
    _IsCanEditMode : boolean;
    _arrColCanEdit : TArrEditAttr;
    _pEditAgrSet   : IEditFpAgrSet
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Переустановить аналитику куба
  #end
  function ReSetAnCub : boolean;
  //----------------------------------------------------------------------------
  #doc
     Задать аналитику оси X
  #end
  function SetAnAxX(_CAn : TPtr) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Задать аналитику оси Y
  #end
  function SetAnAxY(_CAn : TPtr) : boolean;
  //****************************************************************************


  //============================================================================
  //                                 COMMON
  //----------------------------------------------------------------------------
  #doc
     Init куба
  #end
  function CreateCube(
    _CAnData      : TPtr;
    _MeasureCount : LongInt
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Done куба
  #end
  function DoneCube : boolean;

  //----------------------------------------------------------------------------
  #doc
     Добавить в куб Measure
  #end
  function AddCubeMeasure(
    _Title  : string;
    _isShow : boolean
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Построить оси куба
  #end
  function BuildAllAxis : boolean;
  //----------------------------------------------------------------------------
  #doc
     Перестроить оси куба
  #end
  function ReBuildAllAxis(
    _isReSetDDLeaf : boolean       // переустанавливать ли DDLeaf
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Добавить в куб значение измерения
  #end
  function AddSpDimCube(_wAn : word; _cAn : comp) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Переустановить фильтр на данные куба
  #end
  function ReSetFilter : boolean;

  //----------------------------------------------------------------------------
  #doc
     Очистить оси куба
  #end
  function ClearAllAxis : boolean;
  //----------------------------------------------------------------------------
  #doc
     Очистить данные куба
  #end
  function ClearAllValues : boolean;
  //----------------------------------------------------------------------------
  #doc
     Очистить все в кубе
  #end
  function ClearCube : boolean;
  //----------------------------------------------------------------------------
  #doc
     Очистить данные ячейки куба
  #end
  function ClearCellValue(_CAnID : TPtr; _M : LongInt) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Перечитать значения ячеек в визуальном кубе
  #end
  procedure ViewCube_ReReadAllCells;

  //----------------------------------------------------------------------------
  #doc
     Загрузить в куб "пустые" данные
  #end
  function LoadEmptyLeafValues(
    _MeasureNpp : LongInt;
    _cPeriod    : comp;
    _cStBud     : comp;
    _CAnID      : TPtr;
    _IsDDLeaf   : boolean
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Загрузить в куб данные бюджета
  #end
  function LoadValues(
      _MeasureNpp : LongInt;
      _cBudVar    : comp;
      _wKodReg    : word;
      _cPeriod    : comp;
      _cStBud     : comp;
      _cSloj      : comp;
      _cFilter    : comp;
      _cGrAnStBud : comp;
      _IsDDLeaf   : boolean;
      _cVal_StBud : comp;
      _cEdIzStBud : comp;
      _rcValInfo  : TFpValPrm;
  var _isHaveData : boolean
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Загрузить в куб данные финопераций
  #end
  function LoadOborot(
      _MeasureNpp : LongInt;
      _cCOBud     : comp;
      _wKodReg    : word;
      _cPeriod    : comp;
      _cStBud     : comp;
      _cSloj      : comp;
      _cFilter    : comp;
      _cGrAnStBud : comp;
      _IsDDLeaf   : boolean;
      _cVal_StBud : comp;
      _cEdIzStBud : comp;
      _rcValInfo  : TFpValPrm;
  var _isHaveData : boolean;
      _wIgnoreMode : word
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Загрузить в куб данные бюджета (с использованием DSQL)
  #end
  function DSQLLoadBudgetMeasure(
    _MeasureNpp : LongInt;
    _cBudVar    : comp;
    _wKodReg    : word;
    _PerMID     : TPtr;
    _cFilter    : comp;
    _rcValInfo  : TFpValPrm
  ) : boolean;
  //****************************************************************************


  //============================================================================
  //                                  AGREGATE
  //----------------------------------------------------------------------------
  //----------------------------------------------------------------------------
  #doc
     Раскрытие показателя-агрегата по данным бюджета
  #end
  function OpenCurCellByBudget : boolean;
  //----------------------------------------------------------------------------
  #doc
     Раскрытие показателя-агрегата по данным бюджета
  #end
  function OpenCurCellByOborot : boolean;
  //----------------------------------------------------------------------------
  #doc
     Загрузка показателей из книги финансовых операций
  #end
  function LoadCurCellByOborot : boolean;
  //****************************************************************************


  //============================================================================
  //                                  HIER
  //----------------------------------------------------------------------------
  //============================================================================
  // Вертикальная ось
  //----------------------------------------------------------------------------
  #doc
     Раскрыть текущий узел вертикальной оси
  #end
  procedure Hier_OpenNodeYLevel;
  //----------------------------------------------------------------------------
  #doc
     Закрыть текущий узел вертикальной оси
  #end
  procedure Hier_CloseNodeYLevel;

  //----------------------------------------------------------------------------
  #doc
     Раскрыть полностью текущий узел вертикальной оси
  #end
  procedure Hier_OpenNodeYUDown;
  //----------------------------------------------------------------------------
  #doc
     Закрыть полностью текущий узел вертикальной оси
  #end
  procedure Hier_CloseNodeYUDown;

  //----------------------------------------------------------------------------
  #doc
     Раскрыть все узлы вертикальной оси
  #end
  procedure Hier_OpenAxisY;
  //----------------------------------------------------------------------------
  #doc
     Закрыть все узлы вертикальной оси
  #end
  procedure Hier_CloseAxisY;
  // Вертикальная ось
  //****************************************************************************

  //============================================================================
  // Горизонтальная ось
  //----------------------------------------------------------------------------
  #doc
     Раскрыть текущий узел горизонтальной оси
  #end
  procedure Hier_OpenNodeXLevel;
  //----------------------------------------------------------------------------
  #doc
     Закрыть текущий узел горизонтальной оси
  #end
  procedure Hier_CloseNodeXLevel;

  //----------------------------------------------------------------------------
  #doc
     Раскрыть полностью текущий узел горизонтальной оси
  #end
  procedure Hier_OpenNodeXUDown;
  //----------------------------------------------------------------------------
  #doc
     Закрыть полностью текущий узел горизонтальной оси
  #end
  procedure Hier_CloseNodeXUDown;

  //----------------------------------------------------------------------------
  #doc
     Раскрыть все узлы горизонтальной оси
  #end
  procedure Hier_OpenAxisX;
  //----------------------------------------------------------------------------
  #doc
     Закрыть все узлы горизонтальной оси
  #end
  procedure Hier_CloseAxisX;
  // Горизонтальная ось
  //****************************************************************************

  //============================================================================
  // Весь КУБ
  //----------------------------------------------------------------------------
  #doc
     Раскрыть все узлы куба
  #end
  procedure Hier_OpenAllAxis;
  //----------------------------------------------------------------------------
  #doc
     Закрыть все узлы куба
  #end
  procedure Hier_CloseAllAxis;
  // Весь КУБ
  //****************************************************************************


  //============================================================================
  //                                 RUNVIEW
  //----------------------------------------------------------------------------
  //----------------------------------------------------------------------------
  #doc
     Запуск интерфейса печати
  #end
  function RunPrint(
      _isAllTree : boolean
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Запуск интерфейса осей
  #end
  function RunAxisWindow : boolean;

  //----------------------------------------------------------------------------
  #doc
     Запуск интерфейса фильтров
  #end
  function RunFilterEdit(
      _wAn    : word;
  Var _KolFlt : LongInt
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Заполнить список агрегатов в "Распределение агрегатов аналитик"
  #end
  function FillAllAgregates(
    _pEditFpRaspAgr: iEditFpRaspAgr
  ): boolean;

  //----------------------------------------------------------------------------
  #doc
     Проверить возможно ли распределение по переданному агрегату
  #end
  function CheckCurrentSampleAgr(
    _AgrKodGrKau   : word;
    _cAgrMean      : comp;
    _pEditFpRaspAgr: iEditFpRaspAgr
  ): boolean;
  //****************************************************************************


  //============================================================================
  //                                 EVENT
  //----------------------------------------------------------------------------
  //----------------------------------------------------------------------------
  #doc
     Событие формирования локального меню
  #end
  Event function Event_GetIHotKey : string;

  //----------------------------------------------------------------------------
  #doc
     Событие для закрытия интерфейса
  #end
  Event procedure Event_CloseInterface;

  //----------------------------------------------------------------------------
  #doc
     Событие для подгрузке данных при "раскрытии" статьи по аналитике
  #end
  Event procedure Event_LoadNextDDLevelCurStBud(
      _cPeriod    : comp;
      _cStBud     : comp;
  var _isHaveData : boolean;
  var _isAllOk    : boolean
  );

  //----------------------------------------------------------------------------
  #doc
     Событие для раскрытия всех уровней иерархии
  #end
  Event procedure Event_LoadNextDDLevelAllStBud;

  //----------------------------------------------------------------------------
  #doc
     Событие для запуска бюджетного процесса
  #end
  Event procedure Event_RunFpBPRunner(
    _wMessageMode : word           // режим выдачи сообщений
  );

  //----------------------------------------------------------------------------
  #doc
     Событие для получения DDLeaf режима для заданной статьи
  #end
  Event procedure Event_GetStBudDDLeafMode(
      _cStBud     : comp;
  var _isDDLeaf   : boolean
  );

  //----------------------------------------------------------------------------
  #doc
     Событие для запуска окна настройки иерархии
  #end
  Event procedure Event_BuildHier;

  //----------------------------------------------------------------------------
  #doc
     Событие для запуска окна настройки распределения агрегатов
  #end
  Event procedure Event_RunEditRaspRule;

  //----------------------------------------------------------------------------
  #doc
     Событие для выбора статей анализа
  #end
  Event procedure Event_PickStBud;

  //----------------------------------------------------------------------------
  #doc
     Событие для запуска редактирования списка копий бюджетов
  #end
  Event procedure Event_EditCopiesList;

  //----------------------------------------------------------------------------
  #doc
     Событие для перегрузки данных заново
  #end
  Event procedure Event_ReReadAllData;

  //----------------------------------------------------------------------------
  #doc
     Событие для проверки режима загрузки всех статей по слоям типовой формы
  #end
  Event procedure Event_GetIsAllOpenByTForm(
  var _Value : boolean
  );
  //----------------------------------------------------------------------------
  #doc
     Событие для проверки режима загрузки всех статей по группе аналитик
  #end
  Event procedure Event_GetIsAllOpenByGrAn(
  var _Value : boolean
  );
  //----------------------------------------------------------------------------
  #doc
     Событие для проверки существует ли бюджетный процесс для текущего представления
  #end
  Event procedure Event_GetIsBudProcExist(
  var _Value : boolean
  );


  //----------------------------------------------------------------------------
  #doc
     Событие получения сообщения о последней ошибке
  #end
  Event procedure Event_GetStLastError(
  var _sLastError : string   // описание ошибки
  );

  //----------------------------------------------------------------------------
  #doc
     Событие при получении значения ячейки
  #end
  Event function Event_GetCellValue(
      _CubCAnID    : TPtr   ;             // аналитика ячейки
      _MeasureNpp  : LongInt;             // номер показателя
      _OldSumma    : double ;             // старая сумма
      _BudCAnID    : TPtr   ;             // аналитика показателя
  var _rcCellInfo  : TFpBudEditCellInfo   // информация по ячейке
  ): boolean;

  //----------------------------------------------------------------------------
  #doc
     Событие при сохранении значения ячейки
  #end
  Event procedure Event_SaveCellValue(
      _CubCAnID   : TPtr   ;  // аналитика ячейки
      _MeasureNpp : LongInt;  // номер показателя
      _OldSumma   : double ;  // старая сумма
      _NewSumma   : double ;  // новая  сумма
      _IsShow     : boolean;  // режим визуализации
      _CurAgrKod  : word   ;  // текущий код аналитики
      _UnderRecKod: word   ;  // подчиненный код аналитики
  var _isModif    : boolean;  // была ли модификация данных
  var _isAllOk    : boolean   // все ли прошло успешно
  );
  //----------------------------------------------------------------------------
  #doc
     Событие при удалении значения по ячейке
  #end
  Event procedure Event_KillCellValue(
      _CubCAnID   : TPtr   ;  // аналитика ячейки
      _MeasureNpp : LongInt;  // номер показателя
  var _isModif    : boolean;  // была ли модификация данных
  var _isAllOk    : boolean   // все ли прошло успешно
  );

  //----------------------------------------------------------------------------
  #doc
     Событие при раскрытии агрегата по данным бюджета
  #end
  Event procedure Event_OpenAgrByBudget(
      _CubCAnID   : TPtr   ;  // аналитика ячейки
      _MeasureNpp : LongInt;  // номер показателя
      _OldSumma   : double ;  // старая сумма
      _isCanEdit  : boolean;  // возможность редактирования
  var _isModif    : boolean;  // была ли модификация данных
  var _isAllOk    : boolean   // все ли прошло успешно
  );
  //----------------------------------------------------------------------------
  #doc
     Событие при раскрытии агрегата по данным книги финансовых операций
  #end
  Event procedure Event_OpenAgrByOborot(
      _CubCAnID   : TPtr   ;  // аналитика ячейки
      _MeasureNpp : LongInt;  // номер показателя
      _OldSumma   : double ;  // старая сумма
      _isCanEdit  : boolean;  // возможность редактирования
  var _isModif    : boolean;  // была ли модификация данных
  var _isAllOk    : boolean   // все ли прошло успешно
  );
  //----------------------------------------------------------------------------
  #doc
     Событие при загрузке агрегата по данным книги финансовых операций
  #end
  Event procedure Event_LoadAgrByOborot(
      _CubCAnID   : TPtr   ;  // аналитика ячейки
      _MeasureNpp : LongInt;  // номер показателя
  var _isModif    : boolean;  // была ли модификация данных
  var _isAllOk    : boolean   // все ли прошло успешно
  );


  //----------------------------------------------------------------------------
  #doc
     Событие при запуске печати переменных сущности
  #end
  Event procedure Event_PrintVar(
    _pXL          : XLSRepBuilder;
    _isCreateXLT  : boolean
  );
  //----------------------------------------------------------------------------
  #doc
     Событие при запуске печати таблицы сущности
  #end
  Event procedure Event_PrintTbl(
    _pXL          : XLSRepBuilder;
    _isCreateXLT  : boolean
  );
  //****************************************************************************

End; // ObjInterface
//******************************************************************************


//==============================================================================
VipInterface ViewFpCube implements IViewFpCube
Licensed (
#include ViewFpCube.lih
);
Public:
  constructor Init;
  destructor  Done;
End;
//******************************************************************************


#endif//__FpVCub_Vih__
