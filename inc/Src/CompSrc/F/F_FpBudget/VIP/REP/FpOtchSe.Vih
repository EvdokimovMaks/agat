//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 9.10 - модуль "Управление бюджетом"
// Визуальный интерфейс : "Просмотр иерархических отчетов"
//------------------------------------------------------------------------------

#ifndef __FpOtchSe_Vih__
#define __FpOtchSe_Vih__

#ifdef  ComponentVersion
#component "F_FpBudget"
#endif//ComponentVersion

//------------------------------------------------------------------------------
#include aMakeFP.Vih
#include xlReport.Vih
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
#doc
Визуальный интерфейс : "Просмотр иерархических отчетов"<br>
<b>Внимание!</b> Интерфейс предназначен только для внутреннего использования<br>
#end
#IntPrivate ObjInterface iViewFpHierReport;

//==============================================================================
//                                  ERROR
//------------------------------------------------------------------------------
#doc
   Функция возвращает описание последней ошибки
#end
function GetStLastError : string;

//==============================================================================
//                                  INIT
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Инициализация параметров интерфейса
#end
function InitParam(
  _IntMode      : word;
  _RunMode      : word;
  _wReportType  : word;
  _cUserDeskRep : comp;
  _cValTree     : comp;
  _pRepBuilder  : iObjFpHierRepBuilder
) : boolean;

//==============================================================================
//                                 COMMON
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Получить признак актуальности данных в иерархии
#end
function GetIsTreeActualData: boolean;
//------------------------------------------------------------------------------
#doc
   Установить признак актуальности данных в иерархии
#end
procedure SetIsTreeActualData(_Value : boolean);

//------------------------------------------------------------------------------
#doc
   Установить значения валюты для всех листьев
#end
procedure SetValLeaf(_cVal: comp);

//------------------------------------------------------------------------------
#doc
   Установить валюту дерева
#end
procedure SetValTree(_cVal: comp);

//------------------------------------------------------------------------------
#doc
   Установить тип отчета
#end
function SetReportType(_wReportType : word) : boolean;

//------------------------------------------------------------------------------
#doc
   Установка режима (cgFpRep_RegimFixed)
#end
procedure SetRegim(_regim: word; _isOn: boolean);

//------------------------------------------------------------------------------
#doc
   Установка фиксированного значения (для режима фиксации)
#end
procedure SetFixedFpValues(_cFpValues: comp);

//------------------------------------------------------------------------------
#doc
   Установить интерфейс-владелец (для встраивания)
#end
procedure SetOwnerInterface(_sOwnerInterface : string);

//------------------------------------------------------------------------------
#doc
   Сохранение изменений
#end
function SaveChanges : boolean;

//------------------------------------------------------------------------------
#doc
   Получить итоговые суммы для текущего агрегата
#end
function GetAllSumByAgr(
    _cAgrStBud  : comp;       // статья агрената
    _cAgrPeriod : comp;       // период агрегата
var _pTreeSums  : TPTreeSums  // итоговые суммы
): boolean;

//------------------------------------------------------------------------------
#doc
   Пересканирование дерева
#end
procedure Tree_Rescan;

//------------------------------------------------------------------------------
#doc
   Печать отчета
#end
procedure Print_Tree(_ReportType : word);


//==============================================================================
//                                  EVENTS
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Поля интерфейса-контейнера (True - создание шаблона, False - выгрузка)
#end
Event procedure Event_PrintVar(_pXL: XLSRepBuilder; _isCreateXLT: boolean);

//------------------------------------------------------------------------------
#doc
   Таблицы интерфейса-контейнера (True - создание шаблона, False - выгрузка)
#end
Event procedure Event_PrintTbl(_pXL: XLSRepBuilder; _isCreateXLT: boolean);

//------------------------------------------------------------------------------
#doc
   Передача измененной записи
#end
Event procedure Event_ChangeFpValues(_ContAn: TPtr; _SumNes: double);
//------------------------------------------------------------------------------

#doc
   Передача удаленных записей
#end
Event procedure Event_DeleteFpValues(_markFpValues: TPtr);

//------------------------------------------------------------------------------
#doc
   Настройка иерархии
#end
Event function Event_RunHierSetting : boolean;

//------------------------------------------------------------------------------
#doc
   Обновить итоговые суммы
#end
Event function Event_ReSetAllTopSumm : boolean;

//------------------------------------------------------------------------------
#doc
   Загрузить данные в бюджет
#end
Event function Event_LoadToBudget : boolean;

//------------------------------------------------------------------------------
#doc
   Изменить фиксированное значение
#end
Event function Event_SetFixed(_ContAn: TPtr; _isOn: boolean): boolean;

//------------------------------------------------------------------------------
#doc
   Изменить значение агрегата
#end
Event function Event_DeltaSumm(_DeltaSumm: double; _DeltaSummTr: double; _DeltaSummKol: double): boolean;

//------------------------------------------------------------------------------
#doc
   Изменить значение фиксированного элемента
#end
Event function Event_DeltaSummFix(_DeltaSumm: double; _DeltaSummTr: double; _DeltaSummKol: double): boolean;

//------------------------------------------------------------------------------
#doc
   Контейнер аналитик создаваемой записи
#end
Event procedure Event_AddRecContAn(_CAn: TPtr);

//------------------------------------------------------------------------------
#doc
   Событие заполнения аналитики из места вызова
#end
Event procedure Event_GetParentAnalitics(_CAn : TPtr);

//------------------------------------------------------------------------------
#doc
   Был изменен заголовок окна
#end
Event procedure Event_TitleWasChanged(_sAddTitle : string);
//------------------------------------------------------------------------------

End;

VipInterface fpOtchSe implements iViewFpHierReport
Licensed (sfp)
Parameters (
  parIntMode      : word;
  parRunMode      : word;    // cgFpTable_ - константы из fpotchco.vpp
  parReportType   : word;    // тип отчета
  parUserDeskRep  : comp;    // настройка пользователя
  parKlValTree    : comp;    // валюта дерева
  pRepBuilder     : iObjFpHierRepBuilder
)
;

#endif//__FpOtchSe_Vih__
