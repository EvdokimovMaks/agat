//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 9.10 - модуль "Управление бюджетом"
// Интерфейс взаимодействия : "Бюджеты"
//------------------------------------------------------------------------------

#ifndef _ExtFpBudget_Included_
#define _ExtFpBudget_Included_

#component "F_FpBudget"

//------------------------------------------------------------------------------
#doc
Интерфейс взаимодействия : "Бюджеты"<br>
<b>Внимание!</b> Интерфейс предназначен только для использования внутри контура "Финансы"<br>
#end
ObjInterface iExtFpBudget;

//==============================================================================
//                                INIT-DONE
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Освобождение ссылок на объекты, провоцирующие циклические зависимости объектов
#end
function FreeCrossVipRef : boolean;

//==============================================================================
//                               FIELDS (Get)
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Получить значения свойства
#end
function GetCO(_cBudget : comp) : comp;
//------------------------------------------------------------------------------
#doc
   Получить значения свойства
#end
function GetPeriod(_cBudget : comp) : comp;

//------------------------------------------------------------------------------
#doc
   Получить значения свойства
#end
function GetMainTPer(_cBudget : comp) : comp;
//------------------------------------------------------------------------------
#doc
   Получить значения свойства
#end
function GetSpTPer  (_cBudget : comp) : comp;
//------------------------------------------------------------------------------
#doc
   Получить значения свойства
#end
function IsCurTPer  (_cBudget : comp) : boolean;

//------------------------------------------------------------------------------
#doc
<brief>Наименование бюджета, по ссылке на него</brief>
   Наименование бюджета, по ссылке на него:<br>
     ((wMode and 4) = 4) - выдает сокращенное наименование<br>
     ((wMode and 8)  =  8) - выдает наименование ЦО<br>
     ((wMode and 16) = 16) - выдает наименование периода<br>
     ((wMode and 32) = 32) - выдает в наименовании аббревиатуру ЦО<br>
#end
function GetName(wMode : word; _cBudget : comp) : string;

//------------------------------------------------------------------------------
#doc
<brief>Наименование бюджета, по заданным реквизитам</brief><br>
   Наименование бюджета, по заданным реквизитам:<br>
     ((wMode and 1)  =  1) - Агрегированный бюджет<br>
     ((wMode and 2)  =  2) - Консолидированный бюджет<br>
     ((wMode and 4)  =  4) - выдает сокращенное наименование<br>
     ((wMode and 8)  =  8) - выдает наименование ЦО<br>
     ((wMode and 16) = 16) - выдает наименование периода<br>
     ((wMode and 32) = 32) - выдает в наименовании аббревиатуру ЦО<br>
#end
function GetNameEx(wMode : word; _cCO : comp; _cPeriod : comp) : string;

//------------------------------------------------------------------------------
#doc
   Получить наименование бюджета
#end
function GetNameUniversal(wMode : word; _cBudget : comp; _cCO : comp; _cPeriod : comp) : string;

//==============================================================================
//                                  ERROR
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Функция возвращает описание последней ошибки
#end
function GetStLastError : string;

//==============================================================================
//                                  RIGHT
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Разрешено ли редактирование таблицы бюджетов
#end
function CanEditTbl(
  _wMessage : word      // режим выдачи сообщений
) : boolean;

//------------------------------------------------------------------------------
#doc
   Разрешено ли редактирование бюджета согласно статусу
#end
function CanEditByStatus(
  _cBudget  : comp;     // бюджет
  _wMessage : word      // режим выдачи сообщений
) : boolean;
//------------------------------------------------------------------------------
#doc
   Разрешено ли редактирование бюджета
#end
function CanEditRec(
  _cBudget  : comp;     // бюджет
  _wMessage : word      // режим выдачи сообщений
) : boolean;
//------------------------------------------------------------------------------
#doc
   Разрешен ли просмотр бюджета
#end
function CanViewValues(
  _cBudget  : comp;     // бюджет
  _wMessage : word      // режим выдачи сообщений
) : boolean;
//------------------------------------------------------------------------------
#doc
   Разрешено ли использование данных бюджета
#end
function CanUseValues(
  _cBudget  : comp;     // бюджет
  _wMessage : word      // режим выдачи сообщений
) : boolean;
//------------------------------------------------------------------------------
#doc
   Разрешено ли редактировать данные бюджета текущему пользователю
#end
function CanEditValues(
  _cBudget  : comp;     // бюджет
  _wMessage : word      // режим выдачи сообщений
) : boolean;
//------------------------------------------------------------------------------
#doc
   Разрешено ли редактировать данные бюджета (расширенная версия)
#end
function CanEditValues_Adv(
  _cBudget  : comp;     // бюджет
  _isByUser : boolean;  // учитывать права текущего пользователя
  _wMessage : word      // режим выдачи сообщений
) : boolean;


//==============================================================================
//                                  COMMON
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Добавить строку в "примечание" по бюджету
#end
function SetInfo(_cBudget : comp; sPrim : string) : boolean;

//------------------------------------------------------------------------------
#doc
<brief>Найти бюджет с заданными реквизитами</brief>
   Найти бюджет с заданными реквизитами:<br>
   <ul>
   <li> _wMessage - режим вывода сообщений<br>
     <ul>
     <li> cgiNoMessage      - работа без вывода сообщений<br>
     <li> cgiWarningMessage - работа с выводом предупреждений<br>
     <li> cgiErrorMessage   - работа с выводом сообщений об ошибках<br>
     </ul>
   </ul>
#end
function FindBudget(
    _cCO       : comp;
    _cPeriod   : comp;
    _wMessage  : word
) : comp;

//------------------------------------------------------------------------------
#doc
<brief>Найти "любую" доступную копию заданного бюджета</brief>
   Найти "любую" доступную копию заданного бюджета.
   Использовать, когда надо выбрать хоть какую-нибудь копию по умолчанию<br>
   <ul>
   <li> _wMessage - режим вывода сообщений<br>
     <ul>
     <li> cgiNoMessage      - работа без вывода сообщений<br>
     <li> cgiWarningMessage - работа с выводом предупреждений<br>
     <li> cgiErrorMessage   - работа с выводом сообщений об ошибках<br>
     </ul>
   </ul>
#end
function FindAnyAvBudVar(_cBudget : comp; _wMessage  : word) : comp;

//------------------------------------------------------------------------------
#doc
<brief>Создать бюджет с заданными реквизитами</brief>
   Создать бюджет с заданными реквизитами,
   если такой бюджет уже существовал, то вернет ссылку на него<br>
   <ul>
   <li> _wMessage - режим вывода сообщений<br>
     <ul>
     <li> cgiNoMessage      - работа без вывода сообщений<br>
     <li> cgiWarningMessage - работа с выводом предупреждений<br>
     <li> cgiErrorMessage   - работа с выводом сообщений об ошибках<br>
     </ul>
   </ul>
#end
function InsBudget(
    _cCO       : comp;
    _cPeriod   : comp;
    _wMessage  : word
) : comp;

//------------------------------------------------------------------------------
#doc
<brief>Создать бюджет и копию бюджета с заданными реквизитами</brief><br>
   Создать бюджет и копию бюджета с заданными реквизитами,
   если такой бюджет или копия уже существовали, то вернет ссылки на них<br>
   <ul>
   <li> _wMessage - режим вывода сообщений<br>
     <ul>
     <li> cgiNoMessage      - работа без вывода сообщений<br>
     <li> cgiWarningMessage - работа с выводом предупреждений<br>
     <li> cgiErrorMessage   - работа с выводом сообщений об ошибках<br>
     </ul>
   </ul>
#end
function InsBudgetAndBudVar(
    _cCO       : comp;
    _cPeriod   : comp;
var _cBudVar   : comp;
var _cVariant  : comp;
var _sStage    : string;
    _wMessage  : word
) : comp;

//------------------------------------------------------------------------------
#doc
<brief>Удалить бюджет с заданными реквизитами</brief>
   Удалить бюджет с заданными реквизитами:<br>
   <ul>
   <li> _wMessage - режим вывода сообщений<br>
     <ul>
     <li> cgiNoMessage      - работа без вывода сообщений<br>
     <li> cgiWarningMessage - работа с выводом предупреждений<br>
     <li> cgiErrorMessage   - работа с выводом сообщений об ошибках<br>
     </ul>
   </ul>
#end
function DelBudget(
    _cBudget   : comp;
    _wMessage  : word
) : boolean;

//------------------------------------------------------------------------------
#doc
   Пересчет бюджета
#end
function ReCalcBuget(
    _cBudVar : comp;
    _wKodReg : word;
    _cVal    : comp;
    _cTForm  : comp
) : boolean;

//==============================================================================
//                                  DIALOG
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Возвращает имя маркера интерфейса каталога бюджетов
#end
function GetMarkerName : string;

//------------------------------------------------------------------------------
#doc
   Запуск интерфейса каталога бюджетов
#end
function RunViewBudget(
var _wIntMode : word;  // Режим запуска (выбор/просмотр: cgiNo, cgiPick,...)
var _wBudMode : word;  // Тип бюджета:
                       //   cgiBudget_GetSingle - одиночный бюджета
                       //   cgiBudget_GetArg    - агрегированный бюджет
                       //   cgiBudget_GetArg    - консолидированный бюджет
var _cBudget  : comp;  // Бюджет
var _cBudVar  : comp   // Копия бюджета
) : LongInt;

//------------------------------------------------------------------------------
#doc
   Запуск интерфейса просмотра
#end
function RunViewBudgetGr(
var _wIntMode : word; // Режим запуска (выбор/просмотр: cgiNo, cgiPick,...)
var _wBudMode : word; // Тип бюджета
var _wHierMode: word; // Режим группировки (0 - по ЦО, 1 - по периодам)
var _cBudget  : comp; // Бюджет
var _cBudVar  : comp  // Копия бюджета
) : LongInt;

//------------------------------------------------------------------------------
#doc
   Запуск редактирования бюджета
#end
function RunBudEdit(
var _wBudMode : word;  // тип бюджета:
                       //   cgiBudget_GetSingle      - одиночный бюджет
                       //   cgiBudget_GetArg         - агрегированный бюджет
                       //   cgiBudget_GetConsolidate - консолидированный бюджет
var _cBudget  : comp;  // Бюджет
var _cCO      : comp;  // ЦО
var _cPeriod  : comp;  // Период
var _cBudVar  : comp;  // Копия бюджета
var _wKodReg  : word;  // Регистр учета
var _cTForm   : comp   // Типовая форма бюджета
) : boolean;

//------------------------------------------------------------------------------
#doc
   Запуск редактирования бюджета
#end
function RunBudEditNoModal(
var _wBudMode : word;  // тип бюджета:
                       //   cgiBudget_GetSingle      - одиночный бюджет
                       //   cgiBudget_GetArg         - агрегированный бюджет
                       //   cgiBudget_GetConsolidate - консолидированный бюджет
var _cBudget  : comp;  // Бюджет
var _cCO      : comp;  // ЦО
var _cPeriod  : comp;  // Период
var _cBudVar  : comp;  // Копия бюджета
var _wKodReg  : word;  // Регистр учета
var _cTForm   : comp   // Типовая форма бюджета
) : boolean;

//------------------------------------------------------------------------------
#doc
   Запуск редактирования бюджета
#end
function RunBudEditView(
var _wBudMode : word;  // тип бюджета:
                       //   cgiBudget_GetSingle      - одиночный бюджет
                       //   cgiBudget_GetArg         - агрегированный бюджет
                       //   cgiBudget_GetArgVirt     - агрегированный бюджет по заданному списку бюджетов
                       //   cgiBudget_GetConsolidate - консолидированный бюджет
var _cBudget  : comp;  // Бюджет
var _cCO      : comp;  // ЦО
var _cPeriod  : comp;  // Период
var _cBudVar  : comp;  // Копия бюджета
var _wKodReg  : word;  // Регистр учета
var _cTForm   : comp;  // Типовая форма бюджета
   _fLBID     : longInt// Сессия списков бюджетов по которым агрегировать (режим cgiBudget_GetArgVirt)
) : boolean;

//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
End;

VipInterface vExtFpBudget implements iExtFpBudget
#Licensed_Free
;

#endif //_ExtFpBudget_Included_
