//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 9.10 - модуль "Управление бюджетом"
// Интерфейс взаимодействия с бюджетами
//------------------------------------------------------------------------------

#include ExFpBud_V01.Vih  // новая версия

#ifndef __ExFpBud_Vih__
#define __ExFpBud_Vih__

#component "F_FpBudget"

#doc
Интерфейс взаимодействия с бюджетами
#end
ObjInterface iExtFpBudgetValues;

//==============================================================================
//                                  ERROR
//------------------------------------------------------------------------------
#doc
   Функция возвращает описание последней ошибки
#end
//------------------------------------------------------------------------------
function GetStLastError : string;


//==============================================================================
//                                  FPTPER
//------------------------------------------------------------------------------
#doc
   Функция возвращает наименование заданного типа периода планирования
#end
function GetTPerName(_cTPer : comp) : string;

//------------------------------------------------------------------------------
#doc
   Функция возвращает имя маркера интерфейса типов периода
#end
function GetTPerMarkerName : string;

//------------------------------------------------------------------------------
#doc
   Функция запуска окна выбора/редактирования всех типов периода
#end
//------------------------------------------------------------------------------
function RunViewTPer(
    _wIntMode : word;  // режим запуска (cgiNo, cgiPick, ...) см.GLOCONST.INC
var _cGetRec  : comp   // выбранный тип периода
) : integer;

//------------------------------------------------------------------------------
// Запуск интерфейса "главных" типов периода
//------------------------------------------------------------------------------
#doc
   Функция запуска окна выбора/редактирования "главных "типов периода
#end
function RunViewMainTPer(
    _wIntMode : word;  // режим запуска (cgiNo, cgiPick, ...) см.GLOCONST.INC
var _cGetRec  : comp   // выбранный тип периода
) : integer;

//------------------------------------------------------------------------------
#doc
   Функция запуска окна выбора/редактирования спецификаций типов периода
#end
function RunViewSpTPer(
    _wIntMode : word;  // режим запуска (cgiNo, cgiPick, ...) см.GLOCONST.INC
    _cTopRec  : comp;  // тип периода, если 0, то берется тип периода бюджетирования
var _cGetRec  : comp   // выбранная спецификация типа периода
) : integer;

//==============================================================================
//                                 FPPERIOD
//------------------------------------------------------------------------------
#doc
   Функция возвращает наименование заданного периода планирования
#end
function GetPeriodName(_cPeriod : comp) : string;

//------------------------------------------------------------------------------
// Найти период по спецификации типа периода и дате
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция возвращает период по спецификации типа периода и дате
#end
function FindPeriodBySpTPerDate(
    _cSpTPer  : comp;
    _dtDate   : date;
    _wMessage : word
) : comp;

//------------------------------------------------------------------------------
// Найти листовой период по главному типу периода и дате
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция возвращает листовой период по главному типу периода и дате
#end
function FindLeafPeriodByMainTPerDate(
    _cMainTPer : comp;
    _dtDate    : date;
    _wMessage  : word
) : comp;

//------------------------------------------------------------------------------
// Найти листовой период бюджетирования по дате
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция возвращает листовой период бюджетирования по дате
#end
function FindLeafFpPeriodByDate(
    _dtDate   : date;
    _wMessage : word
) : comp;

//------------------------------------------------------------------------------
// Найти наименование листовой период бюджетирования по дате
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция возвращает наименование листового периода бюджетирования по дате
#end
function FindLeafFpPeriodNameByDate(
    _dtDate   : date;
    _wMessage : word
) : string;


//==============================================================================
//                                  FPCO
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
// Наименование центра ответственности
//------------------------------------------------------------------------------
#doc
   Функция возвращает наименование заданного центра ответственности
#end
function GetCOName(_cCO : comp) : string;

//------------------------------------------------------------------------------
#doc
   Функция запуска окна выбора/редактирования доступных ЦО
#end
function RunAvCO(_wIntMode : word; var _cCO : comp) : integer;


//==============================================================================
//                                 FPVARIANT
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Функция возвращает наименование заданного варианта планирования
#end
function GetVariantName(_cVariant : comp) : string;

//------------------------------------------------------------------------------
#doc
   Функция запуска окна выбора/редактирования доступных вариантов бюджета
#end
function RunAvVariant(_wIntMode : word; _cArea : comp; var _cVariant : comp) : integer;


//==============================================================================
//                                 FPSTBUD
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Функция возвращает наименование заданной статьи бюджета
#end
function GetStBudName(_cStBud : comp) : string;

//------------------------------------------------------------------------------
#doc
   Функция возвращает группу аналитики у заданной статьи
#end
function GetStBudGrAn(_cStBud : comp) : comp;

//------------------------------------------------------------------------------
#doc
   Функция возвращает валюту заданной статьи
#end
function GetStBudVal(_cStBud : comp) : comp;

//------------------------------------------------------------------------------
#doc
   Функция возвращает единицу измерения заданной статьи
#end
function GetStBudEd(_cStBud : comp) : comp;

//------------------------------------------------------------------------------
#doc
   Функция формирует Hash для заданной статьи по переданному контейнеру аналитик
#end
function GetHashByStBud(_cStBud : comp; _CAn : TPtr) : comp;

//------------------------------------------------------------------------------
#doc
   Функция формирует маркер доступных статей пользователя
#end
#ifndef __GetAList_PutToOpenMarker__
function GetAvailableStBudMarker(_sMarker: string) : boolean;
#else //__GetAList_PutToOpenMarker__
function GetAvailableStBudMarker(_MID : TPtr) : boolean;
#endif//__GetAList_PutToOpenMarker__

//------------------------------------------------------------------------------
#doc
   Функция запуска окна выбора/редактирования доступных статей
#end
function RunAvStBud(_wIntMode : word; var _cStBud : comp) : integer;

//------------------------------------------------------------------------------
#doc
   Функция запуска окна выбора/редактирования доступных статей, отфильтрованные по маркеру
#end
function RunAvFltStBud(
      _wIntMode : word;
      _FltMID   : TPtr;  // маркер-фильтр
      _PickMID  : TPtr;  // маркер выбранных статей
  var _cStBud   : comp
) : integer;


//==============================================================================
//                                 FPTFORM
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Функция возвращает наименование заданной типовой формы
#end
function GetTFormName(_cTForm : comp) : string;

//------------------------------------------------------------------------------
#doc
   Функция запуска окна выбора/редактирования доступных типовых форм
#end
function RunAvTForm(_wIntMode : word; _cCO : comp; var _cTForm : comp) : integer;


//==============================================================================
//                               FPBUDANMEAN
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
// проверяет заданный контейнер, на наличие в нем только значений,
// учитываемых в бюджетировании, и при необходимости корректирует его
// True - если теперь в контейнере все значения учитываются в бюджетировании
//------------------------------------------------------------------------------
#doc
   Функция провяет заданный контейнер на наличие в нем только значений учитываемых в бюджетировании, и при необходимости корректирует его
#end
function CheckAnBudCAn(_CAn : TPtr) : boolean;


//==============================================================================
//                                 FPBUDGET
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
// Наименование бюджета, по ссылке на него
//   ((wMode and 4) = 4) - выдает сокращенное наименование
//------------------------------------------------------------------------------
#doc
   Функция возвращает наименование заданного бюджета
#end
function GetBudgetName(_wMode : word; _cBudget : comp) : string;

//------------------------------------------------------------------------------
// Наименование бюджета, по заданным реквизитам
//   ((wMode and 1) = 1) - Агрегированный бюджет
//   ((wMode and 2) = 2) - Консолидированный бюджет
//   ((wMode and 4) = 4) - выдает сокращенное наименование
//------------------------------------------------------------------------------
#doc
   Функция возвращает наименование бюджета по заданным реквизитам
#end
function GetBudgetNameEx(_wMode : word; _cCO : comp; _cPeriod : comp) : string;

#doc
   Функция добавляет строчку в "примечание" заданного бюджета
#end
function SetBudgetInfo(_cBudget : comp; sPrim : string) : boolean;

//------------------------------------------------------------------------------
// Найти бюджет с заданными реквизитами
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция возвращает ссылку на бюджет, найденный по заданным реквизитам
#end
function FindBudget(
    _cCO       : comp;      // ЦО бюджета
    _cPeriod   : comp;      // Период бюджета
    _wMessage  : word
) : comp;

//------------------------------------------------------------------------------
// Создать, если надо, бюджет с заданными реквизитами,
// возвращает ссылку на созданный/найденный бюджет
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция по заданным реквезитам возвращает ссылку на бюджет, найденный, или созданный при его не существовании
#end
function InsBudget(
    _cCO       : comp;      // ЦО бюджета
    _cPeriod   : comp;      // Период бюджета
    _wMessage  : word
) : comp;

//------------------------------------------------------------------------------
// Создать, если надо, бюджет и копию бюджета с заданными реквизитами,
// возвращает ссылку на созданный/найденный бюджет
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция создает, в случае необходимости, бюджет и копию бюджета с заданными реквизитами и возвращает ссылку на созданный/найденный бюджет
#end
function InsBudgetAndBudVar(
    _cCO       : comp;      // ЦО бюджета
    _cPeriod   : comp;      // Период бюджета
var _cBudVar   : comp;      // копия бюджета
var _cVariant  : comp;      // Вариант бюджета
var _sStage    : string;    // Стадия бюджетного процесса
    _wMessage  : word
) : comp;

//------------------------------------------------------------------------------
// Удалить бюджет с заданными реквизитами
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция удаляет заданный бюджет
#end
function DelBudget(
    _cBudget   : comp;
    _wMessage  : word
) : boolean;

//------------------------------------------------------------------------------
#doc
   Функция возвращает имя маркера интерфейса каталога бюджетов
#end
function GetKatBudMarkerName : string;

//------------------------------------------------------------------------------
#doc
   Функция запуска интерфейса каталога бюджетов
#end
function RunViewBudget(
var _wIntMode : word;  // Режим запуска (выбор/просмотр: cgiNo, cgiPick,...)
var _wBudMode : word;  // Тип бюджета:
                       //   cgiBudget_GetSingle      - одиночный бюджета
                       //   cgiBudget_GetArg         - агрегированный бюджет
                       //   cgiBudget_GetConsolidate - консолидированный бюджет
var _cBudget  : comp;  // Бюджет
var _cBudVar  : comp   // Копия бюджета
) : integer;

//------------------------------------------------------------------------------
#doc
   Функция запуска интерфейса редактирования бюджетов
#end
function RunBudEdit(
var _wBudMode : word;  // Тип бюджета:
                       //   cgiBudget_GetSingle      - одиночный бюджета
                       //   cgiBudget_GetArg         - агрегированный бюджет
                       //   cgiBudget_GetConsolidate - консолидированный бюджет
var _cBudget  : comp;  // Бюджет
var _cCO      : comp;  // ЦО
var _cPeriod  : comp;  // Период
var _cBudVar  : comp;  // Копия бюджета
var _wKodReg  : word;  // Регистр учета
var _cTForm   : comp   // Типовая форма бюджета
) : boolean;

//------------------------------------------------------------------------------
#doc
   Функция запуска интерфейса просмотра лимитов бюджета
#end
function RunViewLimit(
    _cBudVar : comp;   // копия бюджета
    _cStBud  : comp;   // статья бюджета
    _dDate   : date;   // дата совершения операции
    _CAn     : TPtr    // контейнер аналитик
) : boolean;

//------------------------------------------------------------------------------
#doc
   Функция запуска интерфейса анализа лимитов бюджета
#end
function RunOfpLimitAnaliz(
    _cAnalizTune : comp;
    _cStBudRec   : comp;
    _wTipDoc     : word;
    _cDocRec     : comp
): boolean;


//==============================================================================
//                                 FPBUDVAR
//------------------------------------------------------------------------------
#doc
   Функция возвращает наименование копии бюджета
#end
function GetBudVarName(_cBudVar : comp) : string;

#doc
   Функция добавляет строчку в "примечание" копии бюджета
#end
function SetBudVarInfo(_cBudget : comp; sPrim : string) : boolean;

//------------------------------------------------------------------------------
// Найти "любую" доступную копию заданного бюджета
// Использовать, когда надо выбрать хоть какую-нибудь копию по умолчанию
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция возвращает ссылку на "любую" доступную копию заданного бюджета
#end
function FindAnyAvBudVar(_cBudget : comp; _wMessage : word) : comp;

//------------------------------------------------------------------------------
// Найти копию бюджета по заданным реквизитам
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция возвращает сслыку на копию бюджета, найденную по заданным реквизитам
#end
function FindBudVar(
    _cBudget   : comp;    // Бюджет
    _cVariant  : comp;    // Вариант бюджета
    _sStage    : string;  // Стадия бюджетного процесса
    _wMessage  : word
) : comp;

//------------------------------------------------------------------------------
// Найти "последнюю" копию бюджета по заданным реквизитам
// _wMessage - режим вывода сообщений
//   cgiNoMessage      - работа без вывода сообщений
//   cgiWarningMessage - работа с выводом предупреждений
//   cgiErrorMessage   - работа с выводом сообщений об ошибках
//------------------------------------------------------------------------------
#doc
   Функция возвращает сслыку на последнюю копию бюджета, найденную по заданным реквизитам
#end
function FindLastBudVar(
    _cBudget   : comp;    // Бюджет
    _cVariant  : comp;    // Вариант бюджета
    _wMessage  : word
) : comp;

//------------------------------------------------------------------------------
#doc
   Функция запуска интерфейса выбора доступных копий бюджета
#end
function RunViewBudVar(
    _wIntMode : word;  // режим (выбор/просмотр: cgiNo, cgiPick,...)
    _cBudget  : comp;  // бюджет
var _cBudVar  : comp   // копия бюджета
) : integer;

//------------------------------------------------------------------------------
#doc
   Функция запуска интерфейса редактирования копии бюджета
#end
function RunEditBudVar(
    _wIntMode : word;  // режим (выбор/просмотр: cgiNo, cgiPick,...)
    _cBudget  : comp;  // бюджет
var _cBudVar  : comp   // копия бюджета
) : boolean;


//==============================================================================
//                                  FPVALUES
//------------------------------------------------------------------------------
#doc
   Функция добавляет сумму в заданную копию бюджета по заданным реквизитам
#end
function AddSumToBudget(
    _cBudVar : comp;     // копия бюджета
    _wKodReg : word;     // код регистра учета
    _cStBud  : comp;     // статья бюджета
    _dDate   : date;     // дата совершения операции
    _CAn     : TPtr;     // контейнер аналитик
    _cVal    : comp;     // валюта операции
    _Summa   : double    // сумма
) : boolean;

//------------------------------------------------------------------------------
// Добавить сумму из бюджета по заданным реквизитам
//------------------------------------------------------------------------------
#doc
   Функция удаляет сумму из бюджета по заданным реквизитам
#end
function DelSumFromBudget(
    _cBudVar : comp;     // копия бюджета
    _wKodReg : word;     // код регистра учета
    _cStBud  : comp;     // статья бюджета
    _dDate   : date;     // дата совершения операции
    _CAn     : TPtr      // контейнер аналитик
) : boolean;

//------------------------------------------------------------------------------
#doc
   Функция удаляет сумму из бюджета по заданным реквизитам
#end
function DelSumFromBudget_SpecPK(
    _cBudCO    : comp;
    _cBudTPer  : comp;
    _dDate     : date;
    _wKodReg   : word;
    _cVariant  : comp;
    _sStage    : string;
    _MarkerID  : TPtr;
    _wMessage  : word
) : boolean;

//------------------------------------------------------------------------------
#doc
   Функция возвращает ссылку на хэш по заданному слою и контейнеру аналитик
#end
function GetHash(
    _cSloj    : comp;
    _CAn      : TPtr;
    _Ins      : boolean
) : comp;


//==============================================================================
//                                  FPOBOROT
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Функция создает фин. операцию по заданным реквизитам и с указанной суммой
#end
function AddSumToFpOborot(
    _cSoprHoz : comp;    // cSoprHoz
    _wKodReg  : word;    // код регистра учета
    _cCO      : comp;    // ЦО
    _cStBud   : comp;    // статья бюджета
    _dDate    : date;    // дата совершения операции
    _CAn      : TPtr;    // контейнер аналитик
    _cVal     : comp;    // валюта операции
    _Summa    : double;  // сумма
    _wMessage : word     // режим вывода сообщений
) : boolean;
//------------------------------------------------------------------------------
#doc
   Функция удаляет фин. операции по заданным реквизитам
#end
function DelSumFromFpOborot(
    _cSoprHoz : comp;    // cSoprHoz
    _wKodReg  : word;    // код регистра учета
    _wMessage : word     // режим вывода сообщений
) : boolean;


//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
End;

VipInterface vExtFpBudgetValues implements iExtFpBudgetValues
#Licensed_Free
;

#endif //__ExFpBud_Vih__

