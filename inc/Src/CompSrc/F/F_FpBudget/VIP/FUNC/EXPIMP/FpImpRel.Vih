//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 9.10 - модуль "Управление бюджетом"
// Интерфейс настройки : "Соответствие аналитик"
//------------------------------------------------------------------------------

#ifndef _ObjImpRel_Included_
#define _ObjImpRel_Included_

#ifdef  ComponentVersion
#component "F_FpBudget"
#endif//ComponentVersion

//------------------------------------------------------------------------------
#doc
Интерфейс настройки : "Соответствие аналитик"<br>
<b>Внимание!</b> Интерфейс предназначен только для внутреннего использования<br>
#end
#IntPrivate ObjInterface tImpRelObjInterface;

//------------------------------------------------------------------------------
// Инициализация режима использования "только для ТXО"
//------------------------------------------------------------------------------
#doc
   Инициализация режима использования "соответствия для КАУ"
#end
function SetKauMode : boolean;

//------------------------------------------------------------------------------
#doc
   Запуск интерфейса на выполнение
#end
function RunFpImpRel(
  _wIntMode   : word;
  _wRunMode   : word;
  _cFixKatImp : comp;
  _wImpKod    : word;
  _title      : string;
  _ID         : LongInt
) : boolean;

//------------------------------------------------------------------------------
#doc
   Проверить существование аналитики в соответствии
#end
function CheckImpRel(
  _cFpKatImp   : comp;   // каталог
  _wKauSrc     : word;   // Код КАУ источника
  _cKauSrc     : comp;   // Значение аналитики в источнике
  var _wKauDst : word;   // Код КАУ в приёмника
  var _cKauDst : comp;   // Значение аналитики в приемнике
  var _isImp   : boolean // Импортировать/Не импортировать
): boolean;              // Есть/Нет

//------------------------------------------------------------------------------
#doc
   <brief>Проверить существование аналитики в соответствии</brief>
   Проверить существование аналитики в соответствии.
   Проверка происходит без предварительной загрузки в память соответствия.
   Сначала происходит проверка в памяти. Если запись отсутствует то происходит
   проверка в хранимом соответствии. Если в хранимом соответствии была обнаружена
   запись, то она загружается в таблицу в памяти, если нет, то возвращается False
#end
function CheckImpRelEx(
    _cFpKatImp   : comp;   // каталог
    _wKauSrc     : word;   // Код КАУ источника
    _cKauSrc     : comp;   // Значение аналитики в источнике
var _wKauDst     : word;   // Код КАУ в приёмника
var _cKauDst     : comp;   // Значение аналитики в приемнике
var _isImp       : boolean // Импортировать/Не импортировать
): boolean;                // Есть/Нет

//==============================================================================
//                               FIELDS (Get)
//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
#doc
   Установить значения ID
#end
function SetNewID : boolean;

//------------------------------------------------------------------------------
#doc
   Получить значения ID
#end
function GetCurID : LongInt;

//------------------------------------------------------------------------------
#doc
   Убить ID
#end
function KillID : boolean;

//------------------------------------------------------------------------------
#doc
   Сбросить счетчик количества записей
#end
function ResetCountRec : boolean;

//------------------------------------------------------------------------------
#doc
   Увеличить счетчик количества записей
#end
function IncCountRec : boolean;

//------------------------------------------------------------------------------
#doc
   Получить количество обработанных записей
#end
function GetCountRec : LongInt;

//------------------------------------------------------------------------------
#doc
   Получить значения свойства по буферу таблицы
#end
function BufGetIsImport(_Buff : type$p_fpImpRel) : boolean;

//------------------------------------------------------------------------------
#doc
   Получить значения свойства по буферу таблицы
#end
function BufGetNoDetect(_Buff: type$p_fpImpRel) : boolean;

//------------------------------------------------------------------------------
#doc
   Получить значения свойства по буферу таблицы
#end
function BufGetCalcIsImport(_Buff : type$p_fpImpRel) : boolean;

//------------------------------------------------------------------------------
#doc
   Запуск функции проверки корректности
#end
function CheckImportTune(
    _cKatImp   : comp;   // ссылка на каталог соответствий
var _msg       : string
) : boolean;

//------------------------------------------------------------------------------
#doc
   Запуск функции проверки корректности (для аналитик отчета)
#end
function CheckImportTuneMem(
    _cKatImp   : comp;   // ссылка на каталог соответствий
var _msg       : string
) : boolean;
//------------------------------------------------------------------------------
#doc
   Запуск функции проверки корректности
#end
function CheckImportSysNotDetect(
    _cKatImp   : comp    // ссылка на каталог соответствий
) : boolean;

//------------------------------------------------------------------------------
#doc
   Запуск функции проверки корректности
#end
function CheckFileDiffAn(
    _cKatImp   : comp;   // ссылка на каталог соответствий
var _count     : integer
): boolean;

//------------------------------------------------------------------------------
#doc
   Вставить соответствия во временную таблицу
#end
function InsertFromAnToTmp(
    _cKatImp   : comp    // ссылка на каталог соответствий
) : boolean;

//------------------------------------------------------------------------------
#doc
   Чистка темповой таблицы по всем ID
#end
function DeleteAllMtFpImpRel: boolean;

//------------------------------------------------------------------------------
#doc
   Удаление из темповой таблицы соответствие _cKatImp по текущему ID
#end
function DelOneMtFpImpRel(
    _cKatImp   : comp    // ссылка на каталог соответствий
) : boolean;

//------------------------------------------------------------------------------
#doc
   Загрузка в темповое соответствие хранимое и проверка установки параметров
   если вернет False то надо запускать окно редактирования
#end
function LoadAndCheckInMem(
    _cKatImp   : comp    // ссылка на каталог соответствий
) : boolean;

//------------------------------------------------------------------------------
#doc
   Дозагрузка в темповое соответствие из хранимого то чего еще нет в памяти
#end
function LoadingInMem(
    _cKatImp   : comp    // ссылка на каталог соответствий
) : boolean;

//------------------------------------------------------------------------------
#doc
   Умное сохранение темпового соответствия :) для КАУ
#end
function SaveMemKatImp(
    _cKatImp   : comp    // ссылка на каталог соответствий
) : boolean;

//------------------------------------------------------------------------------
#doc
   Сохранение из таблицы в памяти в хранимые только новых соответствий
#end
function SaveAllMemKatImp : boolean;

//------------------------------------------------------------------------------
#doc
   Сохранение темпового соответствия
#end
function SaveSpKatImp(
    _cKatImp   : comp    // ссылка на каталог соответствий
) : boolean;

//------------------------------------------------------------------------------
#doc
   Установить значения свойства
#end
procedure SetFpMeanCashMode(_wMode : word);

//------------------------------------------------------------------------------
#doc
    Является ли КАУ системным
#end
function IsFpSystemKau(
    _cKodGrKau   : word
) : boolean;

//------------------------------------------------------------------------------
#doc
   Существуют ли в данном соответствии общие каталоги КАУ
#end
function IsCommonKAUExist(
    _cKatImp   : comp    // ссылка на каталог соответствий
) : boolean;

//------------------------------------------------------------------------------
#doc
   Является ли данное КАУ общим каталогом<br>
    
    
#end
function IsCommonKAU(
    _cKatImp   : comp;   // ссылка на каталог соответствий
    _wKodGrKAU : word    // код КАУ
) : boolean;

//------------------------------------------------------------------------------
#doc
   чистка темповой таблицы
#end
function DeleteMtFpImpRel : boolean;

//------------------------------------------------------------------------------
#doc
   Нужно ли производить автоподбор и вставка значений
#end
function IsNeedAutoFindIns : boolean;

//------------------------------------------------------------------------------
#doc
   Выполнить автоподбор и вставку значений
#end
function DoAutoFindIns : boolean;

//------------------------------------------------------------------------------
#doc
   Вставить соответствие по NRec
#end
function InsertFpImpRelByNRec(
    _cKatImp : comp;     // в какой каталог соответствий          
    _wImpKod : word;     // код аналитики источника               
    _cImpAn  : comp;     // поле NRec значения аналитики источника
    _sImpAn  : string    // поле Name значения аналитики источника
) : boolean;

//------------------------------------------------------------------------------
#doc
   Вставить соответствие по NRec в темповую таблицу
#end
function InsertMtFpImpRelByNRec(
    _cKatImp : comp;     // в какой каталог соответствий          
    _wImpKod : word;     // код аналитики источника               
    _cImpAn  : comp;     // поле NRec значения аналитики источника
    _sImpAn  : string    // поле Name значения аналитики источника
) : boolean;

//------------------------------------------------------------------------------
#doc
   Вставить соответствие по NRec в темповую таблицу (ИСПОЛЬЗОВАТЬ ДЛЯ КАУ!!!)
#end
function InsertMtFpImpRelByNRecForKau(
    _cKatImp : comp;     // в какой каталог соответствий          
    _wImpKod : word;     // код аналитики источника               
    _cImpAn  : comp;     // поле NRec значения аналитики источника
    _sImpAn  : string    // поле Name значения аналитики источника
) : boolean;

//------------------------------------------------------------------------------
#doc
   Вставить соответствие по Name в темповую таблицу
#end
function InsertMtFpImpRelByName(
    _cKatImp : comp;     // в какой каталог соответствий          
    _wImpKod : word;     // код аналитики источника               
    _cImpAn  : comp;     // поле NRec значения аналитики источника
    _sImpAn  : string    // поле Name значения аналитики источника
) : boolean;

//------------------------------------------------------------------------------
#doc
   Вставить соответствие по Name
#end
function InsertFpImpRelByName(
    _cKatImp : comp;     // в какой каталог соответствий          
    _wImpKod : word;     // код аналитики источника               
    _cImpAn  : comp;     // поле NRec значения аналитики источника
    _sImpAn  : string    // поле Name значения аналитики источника
) : boolean;

//------------------------------------------------------------------------------
#doc
   Вставить соответствие
#end
function InsertFpImpRel(
    _cKatImp : comp;     // ссылка на каталог соответствий        
    _wImpKod : word;     // код аналитики источника               
    _cImpAn  : comp;     // поле NRec значения аналитики источника
    _sImpAn  : string    // поле Name значения аналитики источника
) : boolean;

//------------------------------------------------------------------------------
#doc
   Получить соответствующую аналитику по NRec
#end
function GetRelatedAnaliticByNRec(
    _cKatImp : comp;     // ссылка на каталог соответствий        
    _wImpKod : word;     // код аналитики источника               
    _cImpAn  : comp;     // поле NRec значения аналитики источника
var _wKod    : word;     // код аналитики приемника               
var _cAn     : comp;     // поле NRec значения аналитики приемника
var _isImp   : boolean   // возвращает значение импортировать или нет
) : boolean;

//------------------------------------------------------------------------------
#doc
   Получить соответствующую аналитику по Name
#end
function GetRelatedAnaliticByName(
    _cKatImp : comp;     // ссылка на каталог соответствий           
    _wImpKod : word;     // код аналитики источника                  
    _sImpAn  : string;   // поле Name значения аналитики источника
var _wKod    : word;     // код аналитики приемника                  
var _cAn     : comp;     // поле NRec значения аналитики приемника   
var _isImp   : boolean   // возвращает значение импортировать или нет
) : boolean;

//------------------------------------------------------------------------------
#doc
   Получить соответствующую аналитику по NRec
#end
function GetRelatedAnalitic(
    _cKatImp : comp;     // ссылка на каталог соответствий           
    _wImpKod : word;     // код аналитики источника                  
    _cImpAn  : comp;     // поле NRec значения аналитики источника
    _sImpAn  : string;   // поле Name значения аналитики источника   
var _wKod    : word;     // код аналитики приемника                  
var _cAn     : comp;     // поле NRec значения аналитики приемника   
var _isImp   : boolean   // возвращает значение импортировать или нет
 ) : boolean;

//------------------------------------------------------------------------------
#doc
   Удаление всех спецификаций для каталога соответствий _cKatImp
#end
function DeleteSpKatImp(_cKatImp : comp) : boolean;

//------------------------------------------------------------------------------
#doc
   Удаление всего каталога соответствий _cKatImp
#end
function DeleteKatImp(_cKatImp : comp) : boolean;

//------------------------------------------------------------------------------
#doc
   Копирование всех соответствий
#end
function CopySpKatImp(
    _cKatImp1 : comp;    // в  каталог 
    _cKatImp2 : comp;    // из каталога
    _wMode    : word     // режим копирования:
                         // 0 - не копировать настройки об общих каталогах
                         // 1 - копировать также настройки об общих каталогах
) : boolean;

//------------------------------------------------------------------------------
#doc
   Копирование соответствий хранящихся во временной таблице в каталог
#end
function CopyMtSpKatImp(
    _cKatImp1 : comp;    // в  каталог                                           
    _cKatImp2 : comp;    // из каталога                                          
    _wKodGrKAU: word;    // для КАУ
    _wMode    : word     // режим копирования:                                   
                         // 0 - не копировать настройки об общих каталогах   
                         // 1 - копировать также настройки об общих каталогах
) : boolean;

//------------------------------------------------------------------------------
#doc
   Добавление соответствий (синхронизация по NRec)
#end
function AddSpKatImpByNRec(
    _cKatImp1  : comp;   // в  каталог                                       
    _cKatImp2  : comp;   // из каталога                                      
    _wKodGrKAU : word;   // для КАУ                                          
    _wMode     : word    // режим копирования:                               
                         // 0 - оставлять существующие соответствия в _cKatImp1
                         // 1 - замещать  существующие соответствия в _cKatImp1
) : boolean;

//------------------------------------------------------------------------------
#doc
   Добавление соответствий (синхронизация по Name)
#end
function AddSpKatImpByName(
    _cKatImp1  : comp;   // в  каталог                                       
    _cKatImp2  : comp;   // из каталога                                      
    _wKodGrKAU : word;   // для КАУ                                          
    _wMode     : word    // режим копирования:                               
                         // 0 - оставлять существующие соответствия в _cKatImp1
                         // 1 - замещать  существующие соответствия в _cKatImp1
) : boolean;

//------------------------------------------------------------------------------
#doc
   Добавление соответствий
#end
function AddSpKatImp(
    _cKatImp1  : comp;   // в  каталог                                       
    _cKatImp2  : comp;   // из каталога                                      
    _wKodGrKAU : word;   // для КАУ                                          
    _wMode     : word    // режим копирования:                               
                         // 0 - оставлять существующие соответствия в _cKatImp1
                         // 1 - замещать  существующие соответствия в _cKatImp1
) : boolean;

//------------------------------------------------------------------------------
#doc
   Добавление соответствий из темповой таблицы
#end
function AddMtSpKatImp(
    _cKatImp1  : comp;   // в  каталог                                       
    _cKatImp2  : comp;   // из каталога                                      
    _wKodGrKAU : word;   // для КАУ                                          
    _wMode     : word    // режим копирования:                               
                         // 0 - оставлять существующие соответствия в _cKatImp1
                         // 1 - замещать  существующие соответствия в _cKatImp1
) : boolean;

//------------------------------------------------------------------------------
#doc
   Переустановить соответствия (синхронизация по NRec)
#end
function ReRelSpKatImpByNRec(
    _cKatImp1  : comp;   // в  каталоге 
    _cKatImp2  : comp;   // по каталогу 
    _wKodGrKAU : word    // для КАУ     
) : boolean;

//------------------------------------------------------------------------------
#doc
   Переустановить соответствия (синхронизация по Name)
#end
function ReRelSpKatImpByName(
    _cKatImp1  : comp;   // в  каталоге 
    _cKatImp2  : comp;   // по каталогу 
    _wKodGrKAU : word    // для КАУ     
) : boolean;

//------------------------------------------------------------------------------
#doc
   Переустановить соответствия
#end
function ReRelSpKatImp(
    _cKatImp1  : comp;   // в  каталоге 
    _cKatImp2  : comp;   // по каталогу 
    _wKodGrKAU : word    // для КАУ     
) : boolean;

//------------------------------------------------------------------------------
#doc
   Переустановить соответствия (для таблицы в памяти)
#end
function ReRelMtSpKatImp(
    _cKatImp1  : comp;   // в  каталоге 
    _cKatImp2  : comp;   // по каталогу 
    _wKodGrKAU : word    // для КАУ     
) : boolean;

//------------------------------------------------------------------------------
#doc
   Обновить соответствия для общих каталогов
#end
function RefreshRelForKau(
    _wMode     : word;   // режим обработки для системных аналитик учитывается ли в бюджетировании
                         // 0 - проверяет, если нет, то устанавливает как "прочие"
                         // 1 - не проверяет и автоматом добавляет в каталог аналитик бюджетирования
    _cKatImp   : comp;   // ссылка на каталог соответствий
    _wKodGrKAU : word    // код КАУ
) : boolean;

//------------------------------------------------------------------------------
#doc
   Обновить соответствия для общих каталогов используя временную таблицу в памяти<br>
#end
function RefreshMtRelForKau(
    _wMode     : word;   // режим обработки для системных аналитик учитывается ли в бюджетировании
                         // 0 - проверяет, если нет, то устанавливает как "прочие"
                         // 1 - не проверяет и автоматом добавляет в каталог аналитик бюджетирования
    _cKatImp   : comp;   // ссылка на каталог соответствий
    _wKodGrKAU : word    // код КАУ
) : boolean;

//------------------------------------------------------------------------------
#doc
   Инициализация сессии работы с соответствием 
   (нужно для загрузки аналитик по-умолчанию)
#end
function InitSession(
    _cKatImp : comp
) : boolean;

//------------------------------------------------------------------------------
#doc
    Удаление настроек из сущности. Используется при удалении соответствия<br>
#end
function Del_ITune(
    _cTune : comp        // ссылка на каталог соответствий<br>
) : boolean;

//------------------------------------------------------------------------------
#doc
   Получить для КАУ источника КАУ приемника по умолчанию
#end
function GetDefAnForKau(
    _cKatImp : comp; 
    _wKodAn  : word
) : word;

//------------------------------------------------------------------------------
#doc
   Получить для КАУ источника значение КАУ приемника по умолчанию
#end
function GetDefAnMeanForKau(
    _cKatImp : comp; 
    _wKodAn  : word
) : comp;

//------------------------------------------------------------------------------
#doc
   Удалить отвязные записи занчений поумолчанию
#end
function DelGarbageDefAnDst : boolean;

//------------------------------------------------------------------------------
#doc
   Подставить значения по умолчанию
#end
function FillDefValues(
    _cKatImp : comp
) : boolean;


//==============================================================================
//                                 EVENT
//******************************************************************************
//------------------------------------------------------------------------------
Event function Event_LoadAn : boolean;

//------------------------------------------------------------------------------
//------------------------------------------------------------------------------
End;

VipInterface ImportRelation implements tImpRelObjInterface
#Licensed_Free
#ifdef  Atl51
Parameters (
  wIntMode      : word;      // режим запуска (cgiNo, cgiPick, ...) см.GLOCONST.INC
  wRunMode      : word;      // режим исполнения:
                             // Аналитика бюджетирования:
                             //   0 - просмотр всего набора соответствий
                             //   1 - соответствия только текущей сессии отчета
                             // Общесистемная аналитика (КАУ)
                             //   2 -
                             //   3 - просмотр всего набора соответствий

  cFixKatImp    : comp;      // ссылка на каталог соответствий
  wImpKod       : word;      // код аналитики по умолчанию
  curTblID         : LongInt    // ID сессии, для работы временных таблиц
)
#endif //Atl51
;

#endif
