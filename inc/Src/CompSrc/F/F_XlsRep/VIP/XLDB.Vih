//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 9.10 - "XLT отчеты"
// Базовый объект : "Работа с Excel БД"
//------------------------------------------------------------------------------

#ifndef __xlDB_Vih__
#define __xlDB_Vih__

#ifdef  ComponentVersion
#component "F_XlsRep"
#endif//ComponentVersion

//------------------------------------------------------------------------------
#include xlType.Inc // Типы данных используемые при формировании отчета
//------------------------------------------------------------------------------

//==============================================================================
#doc
Базовый объект : "Работа с Excel БД"<br>
<b>Внимание!</b> Интерфейс предназначен только для внутреннего использования<br>
#end
Private ObjInterface IObjXLSDB;  //#region ObjInterface

  //============================================================================
  //#region ERROR
  //----------------------------------------------------------------------------
  #doc
     Получить описание последней ошибки выполнения
  #end
  function GetStLastError : string;
  //----------------------------------------------------------------------------
  #doc
     Вывести сообщения о последней ошибке выполнения
  #end
  function RunShowError : boolean;

  //----------------------------------------------------------------------------
  #doc
     Возвращает последнюю ошибку работы с Excel
  #end
  function GetLastError : string;
  //#endregion ERROR
  //****************************************************************************

  //============================================================================
  //#region INIT/DONE EXCEL
  //----------------------------------------------------------------------------
  #doc
     Очистить все временные таблицы
  #end
  procedure ClearAllMT;
  //#endregion INIT/DONE EXCEL
  //****************************************************************************

  //============================================================================
  //#region GALRANGENAME
  //----------------------------------------------------------------------------
  #doc
     Формирует стандартное имя (т.е. добавляет "стандартный префикс")
     поименованного диапазона ячеек, для заданной переменной
  #end
  function MakeGalVarName(_Name : string) : string;
  //----------------------------------------------------------------------------
  #doc
     Формирует стандартное имя (т.е. добавляет "стандартный префикс")
     поименованного диапазона ячеек, для заданной таблицы
  #end
  function MakeGalTblName(_Name : string) : string;
  //----------------------------------------------------------------------------
  #doc
     Формирует стандартное имя (т.е. добавляет "стандартный префикс")
     поименованного диапазона ячеек, для заданного поля таблицы
  #end
  function MakeGalTblFldName(_Name : string) : string;
  //#endregion GALRANGENAME
  //****************************************************************************

  //============================================================================
  //#region REPORT_VARS
  //----------------------------------------------------------------------------
  #doc
     Создать определения переменных в XLS БД (Vars Constructor)
  #end
  function CreateVar(
    _DBFileName : string   // XLS БД
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Все необходимые пост действия, по опубликованию таблицы для внешних источников (Vars Destructor)
  #end
  function PublishVar : boolean;

  //----------------------------------------------------------------------------
  #doc
     Очистить все переменные в XLS БД
  #end
  function ClearAllVar(
    _DBFileName : string   // XLS БД
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     <brief>Установить значение переменной _VarName в значение _Value</brief>
     Установить значение переменной _VarName в значение _Value.
     Тип переменное в XLS БД будет String,
     _VarType - является дополнительным описанием типа,
     это описание возможно использовать уже при формировании самого отчета
  #end
  function SetVar(
    _VarName : string;     // Наименование переменной
    _VarType : string;     // Тип переменной
    _Value   : string      // Значение переменной
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Установить значение переменной _VarName в значение _Value (тип Number)
  #end
  function SetNumberVar(_VarName : string; _Value : double) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Установить значение переменной _VarName в значение _Value (тип Date)
  #end
  function SetDateVar(_VarName : string; _Value : date) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Установить значение переменной _VarName в значение _Value (тип String)
  #end
  function SetStringVar(_VarName : string; _Value : string) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Установить массив строк в переменную _VarName
  #end
  function SetArrStrVar(
    _VarName : string;     // имя переменной
    _Value   : TXLS_ArrStr // массив строк (см. xlType.Inc)
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Вывести содержимое файла в переменную _VarName.
  #end
  function SetFileVar(
    _VarName  : string;    // имя переменной
    _FID      : TPtr;      // ссылка на объект File, полученная методом Handle.
    _sDivider : string     // разделитель строк, например chr(10)
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Вывести содержимое AllMemo.Mem в переменную _VarName
  #end
  function SetAllMemoVar(
    _VarName  : string;    // имя переменной
    _Value    : comp;      // AllMemo.NRec
    _sDivider : string     // разделитель строк, например chr(10)
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Добавить примечание к заголовку переменной отчета
  #end
  function SetVarComment(_VarName : string; _Value : string) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Добавить примечание к значению переменной отчета
  #end
  function SetVarValueComment(_VarName : string; _Value : string) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Установить массив строк примечания к значению переменной отчета
  #end
  function SetArrStrVarValueComment(
    _VarName : string;     // имя переменной
    _Value   : TXLS_ArrStr // массив строк (см. xlType.Inc)
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Вывести содержимое файла в примечания к значению переменной отчета
  #end
  function SetFileVarValueComment(
    _VarName  : string;    // имя переменной
    _FID      : TPtr;      // ссылка на объект File, полученная методом Handle.
    _sDivider : string     // разделитель строк, например chr(10)
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Вывести содержимое AllMemo.Mem в примечания к значению переменной отчета
  #end
  function SetAllMemoVarValueComment(
    _VarName  : string;    // имя переменной
    _Value    : comp;      // AllMemo.NRec
    _sDivider : string     // разделитель строк, например chr(10)
  ) : boolean;
  //#endregion REPORT_VARS
  //****************************************************************************


  //============================================================================
  //#region REPORT_Table
  //----------------------------------------------------------------------------
  #doc
     Начать сессию формирования таблиц в XLS БД
  #end
  function CreateTbls(
    _DBFileName : string  // XLS БД
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Создать таблицу в XLS БД (Table Constructor)
  #end
  function CreateTbl(
    _TblName    : string   // Наименование таблицы
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Все необходимые пост действия, по опубликованию таблицы для внешних источников (Table Destructor)
  #end
  function PublishTbl(
    _TblName : string      // Наименование таблицы
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Очистить все таблицы в XLS БД
  #end
  function ClearAllTbl(
    _DBFileName : string   // XLS БД
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Создать поле таблицы, определенной в CreateTable
  #end
  function CreateTblFld(
    _TblFldName : string   // Наименование поля таблицы
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Очистить буфер записи таблицы определенной в CreateTable
  #end
  function ClearTblBuffer : boolean;

  //----------------------------------------------------------------------------
  #doc
     Установить текущее значение поля таблицы _TblFldName в значение _Value (тип Number)
  #end
  function SetTblNumberFldValue(_TblFldName : string; _Value : double) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Установить текущее значение поля таблицы _TblFldName в значение _Value (тип Date)
  #end
  function SetTblDateFldValue(_TblFldName : string; _Value : date) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Установить текущее значение поля таблицы _TblFldName в значение _Value (тип String)
  #end
  function SetTblStringFldValue(_TblFldName : string; _Value : string) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Добавить строку к текущему значению поля таблицы _TblFldName
  #end
  function AddTblStringFldValue(
    _TblFldName : string;     // имя поля таблицы
    _Value      : string      // добавляемая строка
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Установить массив строк в значение поля таблицы _TblFldName
  #end
  function SetTblArrStrFldValue(
    _TblFldName : string;     // имя поля таблицы
    _Value      : TXLS_ArrStr // массив строк (см. xlType.Inc)
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Вывести содержимое файла в поля таблицы _TblFldName
  #end
  function SetTblFileFldValue(
    _TblFldName : string;     // имя поля таблицы
    _FID        : TPtr;       // ссылка на объект File, полученная методом Handle.
    _sDivider   : string      // разделитель строк, например chr(10)
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Вывести содержимое AllMemo.Mem в поля таблицы _TblFldName
  #end
  function SetTblAllMemoFldValue(
    _TblFldName : string;     // имя поля таблицы
    _Value      : comp;       // AllMemo.NRec
    _sDivider   : string      // разделитель строк, например chr(10)
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Добавить примечание к заголовку поля таблицы
  #end
  function SetTblFldComment(_TblFldName : string; _Value : string) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Добавить примечание к текущему значению поля таблицы
  #end
  function SetTblFldValueComment(_TblFldName : string; _Value : string) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Добавить строку примечания к текущему значению поля таблицы
  #end
  function AddTblFldValueComment(
    _TblFldName : string;     // имя поля таблицы
    _Value      : string      // добавляемая стока
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Установить массив строк в примечание к текущему значению поля таблицы
  #end
  function SetTblArrStrFldValueComment(
    _TblFldName : string;     // имя поля таблицы
    _Value      : TXLS_ArrStr // массив строк (см. xlType.Inc)
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Вывести содержимое файла в примечание к текущему значению поля таблицы
  #end
  function SetTblFileFldValueComment(
    _TblFldName : string;     // имя поля таблицы
    _FID        : TPtr;       // ссылка на объект File, полученная методом Handle.
    _sDivider   : string      // разделитель строк, например chr(10)
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Вывести содержимое AllMemo.Mem в примечание к текущему значению поля таблицы
  #end
  function SetTblAllMemoFldValueComment(
    _TblFldName : string;     // имя поля таблицы
    _Value      : comp;       // AllMemo.NRec
    _sDivider   : string      // разделитель строк, например chr(10)
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Вставить текущие значения полей в таблицу
  #end
  function InsTblRow : boolean;
  //#endregion REPORT_Table
  //****************************************************************************

End; //#endregion ObjInterface
//******************************************************************************


//==============================================================================
VipInterface ObjXLSDB implements IObjXLSDB
#Licensed_Free;
Public:
  constructor Init;
  destructor  Done;
End;
//******************************************************************************

#endif//__xlDB_Vih__
