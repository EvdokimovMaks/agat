//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 8.10 - модуль "Управление бюджетом"
// Табличный объект взаимодействия: "Финансовые операции"
//------------------------------------------------------------------------------

#ifndef __ExtTablClearing_Vih__
#define __ExtTablClearing_Vih__

#ifdef  ComponentVersion
#component "F_OFP"
#endif//ComponentVersion
              
//------------------------------------------------------------------------------
#include IModify.Vih             // Абстрактный табличный интерфейс
//------------------------------------------------------------------------------
#include ofptypes.vpp
#include ExtTablClearing.Inc     // типы данных Табличный объект взаимодействия: "Финансовые операции"
//------------------------------------------------------------------------------


//------------------------------------------------------------------------------
#doc
Табличный объект взаимодействия: "Финансовые операции"
#end
ObjInterface oExtTablClearing;
  Property NRec              : comp      read write;   // Номер записи
  Property cAktOFP           : comp      read write;   // Ссылка на акт обязательств
  Property cChainClearing    : comp      read write;   // Ссылка на предыдущую фин операцию
  Property cClearing         : comp      read write;   // Ссылка на связанную операцию
  Property ClearType         : Word      read write;   // Тип операции
  Property cOFPModel         : comp      read write;   // Ссылка на модель
  Property cPlatMean         : comp      read write;   // Ссылка на платежное средство
  Property cTmpCl            : comp      read write;   // Временно <для создания модели>
  Property dDoc              : Date      read write;   // Дата операции
  Property Direct            : Word      read write;   // Направление движения средств
  Property HozSumma          : tSumma    read write;   // Сумма исполнения операции
  Property IsArchive         : Word      read write;   // Признак архивной операции
  Property MeanType          : Word      read write;   // Вид платежного средства
  Property SaldoOut          : tSumma    read write;   // Входящий остаток плат средства
  Property Status            : Word      read write;   // Статус операции
  Property Attr              : Word      read write;   // атрибуты
  Property DocType           : Word      read write;   // Тип платежного документа
  Property CourseFrom        : Word      read write;   // Способ определения курса
  Property cSoprHoz          : comp      read write;   // Ссылка на исполнение
  Property SumFact           : tSumma    read write;   // Сумма фактического исполнения
  Property Summa             : tSumma    read write;   // Сумма операции
  Property SumVal            : tSumma    read write;   // Сумма операции в валюте ФОБ
  Property cVal              : comp      read write;   // Ссылка на валюту плат ср-ва
  Property sVal              : s5        read      ;   // Наименование валюты

  Property ClearTypeName     : TName     read      ;   // Наименование типа операции
  Property DirectName        : TName     read      ;   // Наименование направления движения средств
  Property MeanTypeFullName  : TName     read      ;   // Полное  наименование типа платежного средства
  Property MeanTypeAbbrName  : TName     read      ;   // Краткое наименование типа платежного средства
  Property PlatMeanName      : TName     read      ;   // Наименование платежного средства
  Property IsMultyPlatMean   : boolean   read      ;   // По типу ПС, ведется несколько ПС 
  Property TiDKGal           : word      read write;   // Тип документа системный
  Property TiDKGalName       : TName     read      ;   // Наименование системного типа документа 

  Index Clearing01  =  NRec(Unique, Primary);
  Index Clearing02  =  cAktOFP, dDoc;
  Index Clearing03  =  IsArchive, cOFPModel, MeanType, cPlatMean, cVal, dDoc;
  Index Clearing04  =  cClearing, Status;
  Index Clearing05  =  cChainClearing;
  Index Clearing06  =  IsArchive, cOFPModel, MeanType, cPlatMean, cVal, Status, dDoc;
  Index Clearing07  =  cTmpCl, cOFPModel;
  Index Clearing08  =  IsArchive, cOFPModel, dDoc;
  Index Clearing09  =  cAktOFP, Status, dDoc;
  Index Clearing10  =  ClearType, IsArchive, cOFPModel;
  Index Clearing11  =  cSoprHoz, IsArchive, cOFPModel;

  //----------------------------------------------------------------------------
  #doc
     Описание последней ошибки
  #end
  Function GetStLastError : string;
  //----------------------------------------------------------------------------
  #doc
     Сообщение последней ошибки
  #end
  Function RunShowError : boolean;

  //----------------------------------------------------------------------------
  #doc
     Проверка корректности заполнения полей
  #end
  Function CheckFld : Boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить буфер типа TClearing
  #end
  Function GetClearingBuffer : TClearing;
  //----------------------------------------------------------------------------
  #doc
     Заполнить буфер типа TClearing
  #end
  Procedure SetClearingBuffer(_Value : TClearing);

  //----------------------------------------------------------------------------
  #doc
     Заполнение полей значениями по умолчанию
  #end
  Function FillDefault(
  var _BuffClearing : TClearing;
      _BufAktOfp    : TAktOfp
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить наименование типа платежного средства
  #end
  Function GetMeanTypeName(
    _wMeanType  : word;       // тип ПС
    _IsAbbrName : boolean     // True - выводить краткое наименование, False - полное
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Сформировать массивы значений типа платежного средства
  #end
  Function GetMeanTypeArray(
      _wClearType : word;     // тип операции
  var _ArrMTs     : TArrMTs;  // массив наименований
  var _ArrMTw     : TArrMTw   // массив констант
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Перевод суммы из валюты _cVal в валюту ФО
  #end
  Function SummaInValAkt(
    _Summa      : double;     // сумма для конвертации
    _cVal       : comp;       // валюта для конвертации
    _dDoc       : date;       // дата курса по умолчанию
    _BufAktOfp  : TAktOfp;    // буффер ФОБ
    _IsToValFO  : boolean     // TRUE  - переведить в  валюту ФОБ
                              // False - переведить из валюты ФОБ
  ) : double;                 // результат ковертации

  //----------------------------------------------------------------------------
  #doc
     Установить сумму в НДЕ
  #end
  Function SetSumma(
    _Value : double
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Установить сумму в валюте ФОБ
  #end
  Function SetSumVal(
    _Value : double
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Запуск выбора платежного средства
  #end
  Function RunPickPlatMean(
      _wMeanType : word;      // тип ПС
  var _cPlatMean : comp       // GC
  ) : boolean;

End; // ObjInterface

//------------------------------------------------------------------------------
VipInterface ExtTablClearing implements oExtTablClearing, IModify
  Licensed(Free);
Public:
  Constructor Init;
  Destructor  Done;
End;

#endif//__ExtTablClearing_Vih__
