//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 8.10 - модуль "Платежный календарь"
// Финансовые операции
//------------------------------------------------------------------------------

#ifndef __AOFPOUTCLEARING_VIH__
#define __AOFPOUTCLEARING_VIH__

//------------------------------------------------------------------------------
#component "F_OFP"

//------------------------------------------------------------------------------
#include ofptypes.vpp
//------------------------------------------------------------------------------

#doc
Интерфейс взаимодействия: "Финансовые операции модуля Платежный календарь"
#end
ObjInterface objOfpOutClearing;

  #doc
  Обновление SoprHoz (для ТФО - разноски по статьям бюджета).<br>
  #end
  Function Clearing_MakeSoprHoz(bufClearing: TClearing): boolean;
  #doc
  Просмотр бюджета по Фоп.<br>
  #end
  Function Clearing_SeeBudget(bufClearing: TClearing; bufAktOfp: TAktOfp): boolean;
  #doc
  Просмотр/редактирование (_regim) привязки к статьям.<br>
  #end
  Procedure Clearing_EditStBud(_regim: word; bufClearing: TClearing);
  #doc
  Аналитика только данного документа.<br>
  #end
  Function Clearing_GetDocAnaliticByBuf(bufClearing: TClearing; bufAktOfp: TAktOfp; var _contId: longint): boolean;
  #doc
  Заполнение контейнера аналитик по буферу ФОБ (связана с предыдущей).<br>
  #end
  Function Clearing_GetAnaliticByBuf(bufClearing: TClearing; bufAktOfp: TAktOfp; var _contId: longint): boolean;
  #doc
  Оплачена ли Фоп.<br>
  #end
  Function Clearing_isRealized(bufClearing: TClearing): boolean;
  #doc
  Влияет ли Фоп на остатки ПС.<br>
  #end
  Function Clearing_HasAffectOnSaldR(bufClearing: TClearing): boolean;
  #doc
  Влияет ли Фоп на факт ФОБ.<br>
  #end
  Function Clearing_HasAffectOnFactFO(bufClearing: TClearing): boolean;
  #doc
  Есть ли у Фоп AktPerf (привязан плат док).<br>
  #end
  Function Clearing_HasAktPerf(bufClearing: TClearing): boolean;
  #doc
  Исп.Фоп нельзя удалять.<br>
  #end
  Function Clearing_CheckDelete(bufClearing: TClearing): boolean;
  #doc
  Нераспределенная сумма.<br>
  #end
  Function Clearing_GetFreeHozSumma(bufClearing: TClearing): double;
  #doc
  Есть ли у Фоп нераспределенная сумма.<br>
  #end
  Function Clearing_HasFreeHozSumma(bufClearing: TClearing): boolean;
  #doc
  Есть ли еще сумма к распределению.<br>
  #end
  Function Clearing_CheckFreeHozSumma(bufClearing: TClearing): boolean;
  #doc
  Статус ФОБ 'исполняемый' и по Фоп нет исполнения - можно менять статус Фоп.<br>
  #end
  Function Clearing_CanSetStatus(_cClearing: comp; _AktStatus: word): boolean;
  #doc
  То же, но с сообщениями.<br>
  #end
  Function Clearing_CheckCanSetStatus(bufClearing: TClearing; _AktStatus: word): boolean;
  #doc
  Можно ли переносить Фоп на указанную дату.<br>
  #end
  Function Clearing_CanMoveToDay(_cClearing: comp; _OldDate: date; _NewDate: date; _isMessage: word): boolean;
  #doc
  Корректно ли поле "Платежное средстро".<br>
  #end
  Function Clearing_PsNeedChange(_MeanType: word; _cPlatMean: comp): boolean;
  #doc
  Возвращает SummaVal - при изменении Summa, и наоборот _cVal - валюта для if (_isToValFO, _Sum, _Summa).<br>
  #end
  Function Clearing_SummaBySum( bufAktOfp: TAktOfp;
                               _isToValFO: boolean;
                                    _cVal: comp;
                                   _Summa: double;
                                  _OldSum: double;
                                     _Sum: double
                                        ): double;
  #doc
  Название финоперации.<br>
  #end
  Function Clearing_GetName(_ClearType: word): string;
  #doc
  Название финоперации.<br>
  #end
  Function Clearing_GetNameByBuf(bufClearing: TClearing): string;
  #doc
  Название финоперации.<br>
  #end
  Function Clearing_GetNameByCT(_ClearType: word; _dDoc: date): string;
  #doc
  Название финоперации.<br>
  #end
  Function Clearing_GetNameRec(_cClearing: comp): string;
  #doc
  Название финоперации.<br>
  #end
  Function Clearing_GetNameWhithFO(_cClearing: comp): string;
  #doc
  Тип ПС (короткое или полное имя).<br>
  #end
  Function Clearing_GetMeanTypeName(_MeanType: word; _isShort: boolean): string;
  #doc
  Название статуса.<br>
  #end
  Function Clearing_GetStatusName(_Status: word): string;
  #doc
  Факт по ФОп - сумма по хоз.документам (в валюте Фоп).<br>
  #end
  Function Clearing_GetFact(_Clearing: comp; var _sumFact: double; var _hozSumma: double): word;
  #doc
  Сумма Фоп по буферу ФОБ, Фоп.<br>
  #end
  Procedure Clearing_SetSummaToBuf(_Summa: double; bufAktOfp: type$AktOfp; var bufClearing: type$Clearing);
  #doc
  ФОп (_HandMade - вручную создается).<br>
  #end
  Function Clearing_Fill(var bufClearing: TClearing; _nRecClearing: comp; bufAktOfp: TAktOfp; _FOCourse: word; _HandMade: boolean): boolean;
  #doc
  Заполнение буфера ФОп по ХО.<br>
  #end
  Function FillFOpBySH(_cSoprHoz: TnRec; var _pClearing: #TClearingX): boolean;
  #doc
  Сразу после добавления любой записи.<br>
  #end
  Function Clearing_AfterInsert(bufClearing: TClearing): boolean;
  #doc
  Добавляет Фоп и обновляет период активных Фоп у ФОБ.<br>
  #end
  Function Clearing_Insert(Var _pClearing: #TClearingX ): comp;
  #doc
  Создает Фоп.<br>
  #end
  Function Clearing_Create(bufAktOfp: TAktOfp; _FOCourse: word; _HandMade: boolean): comp;
  #doc
  Обновление ФОп.<br>
  #end
  Function Clearing_UpdateP(_pClearing: type$p_Clearing; _cClearing: comp): comp;
  #doc
  Удаление Фоп и подвязанных к ней.<br>
  #end
  Function Clearing_DeleteP(_pClearing: TPClearing; _NeedRecount: boolean; _NeedUpdate: boolean): boolean;
  #doc
  Удаление Фоп по ссылке, пересчитывая Остатки и Факт.<br>
  #end
  Function Clearing_Delete(_cClearing: comp): boolean;
  #doc
  По обязательству и SoprHoz создает финоперацию (_NeedCheck - с проверкой).<br>
  #end
  Function Clearing_BySoprHoz(_cAktOFP: comp; _cSoprHoz: comp; _NeedCheck: boolean): comp;
  #doc
  Изменение даты финоперации с проверкой сумм в бюджете.<br>
  #end
  Function Clearing_SetDateWithBudgetCheck(_cClearing: comp; _NewDate: date): boolean;
  #doc
  Изменение даты финоперации.<br>
  #end
  Function Clearing_DateSet(_cClearing: comp; _NewDate: date; _CheckFO: boolean; _isMessage: word; _AnyWhere: boolean): boolean;
  #doc
  Спрашивает новое платежное средство.<br>
  #end
  Function Clearing_PsGet(_cClearing: comp; var NewMeanType: word; var NewPlatMean: comp; var NewTiDkGal: word): boolean;
  #doc
  Изменяет платежное средство у финоперации.<br>
  #end
  Procedure Clearing_PsSet(_cClearing: comp; _MeanType: word; _cPlatMean: comp; _TiDkGal: word);
  #doc
  Изменение суммы Фоп.<br>
  #end
  Function Clearing_SetSumma(_cClearing: comp; _Summa: double): boolean;
  #doc
  Изменение (увеличение или уменьшение) исполнения и факта Фоп.<br>
  #end
  Function Clearing_ChangeFact(_cClearing: comp;
                                 _SumPerf: double;
                                _dSoprHoz: date;
                                  _direct: word;
                                   _wMode: word
                                        ): boolean;
End;

//------------------------------------------------------------------------------
VipInterface iOfpOutClearing implements objOfpOutClearing
  Licensed(Free);
Public:
  Constructor Init;
  Destructor  Done;
End;
//------------------------------------------------------------------------------
#end //__AOFPOUTCLEARING_VIH__
