//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 8.10 - модуль "Платежный календарь (PR)"
// Библиотека функций : "Сопроводительные документы по заявке"
//------------------------------------------------------------------------------

#ifndef __LibSDDocReq_Vih__
#define __LibSDDocReq_Vih__

#ifdef  ComponentVersion
#component "F_OFPPR"
#endif//ComponentVersion

//------------------------------------------------------------------------------
#include Fp_BaseAbstractEnt.Vih   // Абстрактный базовый интерфейс : "Entity"
#include ListSDDocReq.Tbl         // Таблица обмена : "Сопроводительные документы по заявке"
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
#doc
Библиотека функций : "Сопроводительные документы по заявке"
#end
Private ObjInterface oLibSDDocReq( oFp_BaseAbstractEnt );
  //----------------------------------------------------------------------------
  #doc
    Добавить в список ListSDDocReq.Tbl - SoprHoz
  #end
  Function InsInListSoprHoz(
    _Buff : type$SoprHoz
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
    Добавить в список ListSDDocReq.Tbl - SchFact
  #end
  Function InsInListSchFact(
    _Buff : type$SchFact
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
    Добавление приложений в заявку из списка ListSDDocReq.Tbl
  #end
  Function AddGalDocFromList(
    _cDocReq  : comp;   // заявка
    _wMessage : word    // режим выдачи сообщений
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
    Добавление приложений в заявку из списка ListSDDocReq.Tbl
  #end
  Function DelGalDocFromList(
    _cDocReq  : comp;   // заявка
    _wMessage : word    // режим выдачи сообщений
  ) : boolean;


  //----------------------------------------------------------------------------
  #doc
     Привязать к заявке сопроводителные документы ДО
  #end
  Function AddBaseDocSoprDoc(
    _cDocReq  : comp;   // заявка
    _cBaseDoc : comp;   // ДО
    _wMessage : word    // режим выдачи сообщений
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Отвязать от заявки сопроводителные документы ДО
  #end
  Function DelBaseDocSoprDoc(
    _cDocReq  : comp;   // заявка
    _cBaseDoc : comp;   // ДО
    _wMessage : word    // режим выдачи сообщений
  ) : boolean;

  //------------------------------------------------------------------------------
  #doc
     Получить распределенную по СЗО сумму документа
  #end
  Function GetGalDocDistrSumma(
    _TiDKDoc    : word;    // системный тип документа
    _cDocRec    : comp;    // NRec документа
    _dDocDate   : date;    // дата документа
    _cDocVal    : comp     // валюта документа
  ) : double;
  //----------------------------------------------------------------------------
  #doc
     Получить сумму выплаченного аванса по документу
  #end
  Function GetGalDocAvansSumma(
    _TiDKDoc    : word;    // системный тип документа
    _cDocRec    : comp;    // NRec документа
    _dDocDate   : date;    // дата документа
    _cDocVal    : comp     // валюта документа
  ) : double;

  //----------------------------------------------------------------------------
  #doc
     Можно ли привязать к заявке такой документ
  #end
  Function CanAddGalDocToDocReq(
    _cDocReq    : comp;    // заявка
    _dDocDate   : date;    // дата документа
    _DocumSumma : double;  // сумма по документу
    _AvansSumma : double;  // сумма выплаченого аванса по документу
    _DistrSumma : double;  // сумма заявок распределенных по документу
    _cDocVal    : comp     // валюта документа
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     По заявке получить сумму, с учетом разноски по реестам платежей
  #end
  Function GetDocReqActiveSumma(
      _cDocReq  : comp;    // заявка
  var _Summa    : double;  // сумма
  var _cVal     : comp     // валюта
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Пересчитать порядковые номера первичных документов
  #end
  Function ReCalcNppPD(
    _cDocReq  : comp       // заявка
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Удалить все документы из приложения к СЗО
  #end
  Function DelAllDoc(
    _cDocReq  : comp;      // заявка
    _wMessage : word       // режим выдачи сообщений
  ) : boolean;             // результат выполнения

  //----------------------------------------------------------------------------
  #doc
     Поиск документа спецификации по заданным параметрам
  #end
  Function FindDoc(
    _wMode      : word;    // параметры поиска
    _cDocReq    : comp;    // заявка
    _TiDKDoc    : word;    // системный тип документа
    _NoDocBeg   : tNoDoc;  // номер документа
    _NoDocEnd   : tNoDoc;  // номер документа
    _dBeg       : Date;    // дата начала
    _dEnd       : Date;    // дата окончания
    _cOrg       : comp     // NRec контрагента
  ) : comp;                // результат выполнения

  //----------------------------------------------------------------------------
  #doc
    Получить период оплаты по сопроводительным документам, привязанных к заявке
  #end
  Function PeriodOpl(
    _cDocReq  : comp       // заявка
  ) : string;

  //============================================================================
  // ОТЧЕТ
  //----------------------------------------------------------------------------
  #doc
     Начало формирования отчета
  #end
  Function ReportGalDoc_Beg(
    _sTitle : string       //
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Добавить в отчет документ
  #end
  Function ReportGalDoc_Add(
    _TiDK    : word;       // системный тип документа
    _cDoc    : comp;       // NRec документа
    _NoDoc   : TNoDoc;     // номер документа
    _dDate   : date;       // дата документа
    _Summa   : double;     // сумма документа
    _cVal    : comp        // валюта документа
  ) : boolean;
  //----------------------------------------------------------------------------
  #doc
     Запуск отчета
  #end
  Function ReportGalDoc_Run(
    _isShow : boolean      // показывать ли отчет
  ) : boolean;

  //****************************************************************************

End; // oLibSDDocReq

//===============================================================================
VipInterface LibSDDocReq( Fp_BaseAbstractEnt) implements oLibSDDocReq
Licensed(Free);


#endif//__LibSDDocReq_Vih__
