//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 9.1 - модуль "Электронная отчетность"
// Сервисная библиотека : "Работа с XML"
//------------------------------------------------------------------------------

#ifndef __TRXMLLib_Vih__
#define __TRXMLLib_Vih__

#component "F_TaxReport"

//------------------------------------------------------------------------------
Type TXmlAttrValue = record
  Name : string;
  Value: string;
End;
Type TXmlAttrValueList = Array[0..0] of TXmlAttrValue;
//------------------------------------------------------------------------------
Type TXmlNodeName = record
  Name : string;
  Node : TPtr;
End;
Type TXmlNodeList = Array[0..0] of TXmlNodeName;
//------------------------------------------------------------------------------
Type TXmlMultyError = record
  sError1 : string;
  sError2 : string;
End;
Type TXmlMultyErrorList = Array[0..0] of TXmlMultyError;
//------------------------------------------------------------------------------


//==============================================================================
#doc
Сервисная библиотека : "Работа с XML"
#end
Private ObjInterface ITRXMLLib;  //#region ObjInterface

  //============================================================================
  //#region ERROR
  //----------------------------------------------------------------------------
  #doc
     Получить описание последней ошибки выполнения
  #end
  function GetStLastError : string;
  //----------------------------------------------------------------------------
  #doc
     Получить описание последней ошибки выполнения (множественное)
  #end
  function GetStLastErrorList : TXmlMultyErrorList;
  //----------------------------------------------------------------------------
  #doc
     Очистить список описаний последней ошибки выполнения (множественное)
  #end
  procedure ClearStLastErrorList;
  //#endregion ERROR
  //****************************************************************************


  //============================================================================
  //#region XML СЕРВИС
  //----------------------------------------------------------------------------
  #doc
     Создать XML документ
  #end
  function CreateDoc : TPtr;

  //----------------------------------------------------------------------------
  #doc
     Сохранить XML документ в файл
  #end
  function SaveDoc(
    _xmlDoc : TPtr;     // ID xml документа
    _sFile  : string    // полный путь на файл
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Создать XML вершину
  #end
  function CreateNode(
    _xmlDoc : TPtr;     // ID xml документа
    _Parent : TPtr;     // ID родителя
    _sName  : string    // имя вершины
  ) : TPtr;

  //----------------------------------------------------------------------------
  #doc
     Создать XML вершину текст
  #end
  function CreateText(
    _xmlDoc : TPtr;     // ID xml документа
    _Parent : TPtr;     // ID родителя
    _sName  : string;   // имя вершины
    _sData  : string    // значение вершины
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Получить значение из заданной текстовой XML вершины
  #end
  function GetTextValue(
    _xmlNode : TPtr     // ID вершины
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Получить ID заданной XML вершины
  #end
  function GetThisNode(
    _Parent : TPtr;     // ID родителя
    _sName  : string    // имя вершины
  ) : TPtr;
  //----------------------------------------------------------------------------
  #doc
     Получить ID заданного XML атрибута
  #end
  function GetThisAttr(
    _xmlNode : TPtr;    // ID вершины
    _sName   : string   // имя атрибута
  ) : TPtr;

  //----------------------------------------------------------------------------
  #doc
     Получить значение атрибута XML вершины
  #end
  function GetAttrValue(
    _xmlNode : TPtr;    // ID вершины
    _sName   : string   // имя атрибута
  ) : string;

  //----------------------------------------------------------------------------
  #doc
     Получить список значений атрибутов XML вершины
  #end
  function GetAttrValueList(
    _xmlNode : TPtr     // ID вершины
  ) : TXmlAttrValueList;

  //----------------------------------------------------------------------------
  #doc
     Получить список подчиненных XML вершин
  #end
  function GetSubNodeList(
    _Parent   : TPtr;   // ID родителя
    _sSubNode : string  // наименование подчиненных XML вершин
  ) : TXmlNodeList;
  //----------------------------------------------------------------------------
  #doc
     Освободить список XML вершин
  #end
  function ReleaseNodeList(
    _NodeList : TXmlNodeList  // список XML вершин
  ) : boolean;

  //#endregion XML СЕРВИС
  //****************************************************************************


  //============================================================================
  //#region ПРОВЕРКА ДАННЫХ
  //----------------------------------------------------------------------------
  #doc
     Получить путь на каталог расположения XSD файлов
  #end
  function GetXSDFileDir : string;

  //----------------------------------------------------------------------------
  #doc
     Задать адреса XML и XSD
  #end
  procedure SetInfoXmlXSD(
    _sXMLFilePath : string;  // XML файл
    _sXSDFilePath : string   // XSD файл
  );

  //----------------------------------------------------------------------------
  #doc
     Для проверки использовался только Tester
  #end
  function myIsOnlyTester : boolean;

  //----------------------------------------------------------------------------
  #doc
     Занести в список временных файлов полный адрес XML файла
  #end
  procedure masTmpFiles_AddNew(
    _FilePath : string  // полный адрес XML файла
  );

  //----------------------------------------------------------------------------
  #doc
     Проверить XML файл по заданной XSD схеме
  #end
  function CheckFileByXSD(
    _sXMLFilePath : string;  // XML файл
    _sXSDFilePath : string;  // XSD файл
    _wProcessor   : word;    // тип процессора проверки
    _wErrLimit    : word     // лимит ошибок
  ) : boolean;

  //----------------------------------------------------------------------------
  #doc
     Запустить диалог выбора режима проверки данных по XSD
  #end
  function RunSetModeCheckByXSD(
  var _wProcessor   : word;  // тип процессора проверки
  var _wErrLimit    : word   // лимит ошибок
  ) : boolean;
  //#endregion ПРОВЕРКА ДАННЫХ
  //****************************************************************************

End; //#endregion ObjInterface
//******************************************************************************


//==============================================================================
VipInterface TRXMLLib implements ITRXMLLib
#Licensed_Free;
Public: //#region Public
  constructor Init;
  destructor  Done;
End; //#endregion Public
//******************************************************************************

#endif//__TRXMLLib_Vih__
