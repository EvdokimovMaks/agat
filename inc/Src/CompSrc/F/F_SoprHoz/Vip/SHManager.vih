//******************************************************************************
//                                                      (c) корпорация Галактика
// Галактика 7.12 - Финконтур
// Объект для работы с Журналом хозяйственных операций.
//******************************************************************************

#ifndef _SHManager_Vih_
#define _SHManager_Vih_

#ifdef ComponentVersion
#Component "F_SoprHoz"
#end

#include FinTypes.inc

//******************************************************************************
#doc
Объект для работы с Журналом хозяйственных операций
#end
ObjInterface ObjSHmanager;

  //****************************************************************************
  #doc
  Через буфер таблицы (медленно): вставить запись
  #end
  function InsertRecord(var buf : TSoprHoz) : boolean;

  #doc
  Через буфер таблицы (медленно): обновить запись
  #end
  function UpdateRecord(var buf : TSoprHoz) : boolean;

  #doc
  Удалить одну заданную запись
  #end
  function DeleteRec(cRec : comp) : boolean;

  #doc
  Удалить все окружение кроме SoprHoz и BaseFin
  #end
  function DeleteRecNoSH(cRec : comp) : boolean;

#ifdef Gal9_1
  //****************************************************************************
  #doc
  Через буфер с позицией (быстее): вставить запись
  #end
  function InsByHan(var buf : #TSoprHozX ) : word;

  #doc
  Через буфер с позицией (быстее): обновить запись
  #end
  function UpdByHan(var buf : #TSoprHozX ) : word;

  #doc
  Через буфер с позицией (быстее): удалить одну запись
  #end
  function DelByHan(var buf : #TSoprHozX ) : word;
#else
  //****************************************************************************
  #doc
  Через буфер с позицией (быстее): вставить запись
  #end
  function InsByHan(var buf : #TSoprHozX ) : integer;

  #doc
  Через буфер с позицией (быстее): обновить запись
  #end
  function UpdByHan(var buf : #TSoprHozX ) : integer;

  #doc
  Через буфер с позицией (быстее): удалить одну запись
  #end
  function DelByHan(var buf : #TSoprHozX ) : integer;
#end
  //****************************************************************************
  #doc
  Удалить все записи по документу
  #end
  function DeleteDoc(cDocNRec : comp; wTiDk : word) : boolean;

  //****************************************************************************
  // сервисные функции для внутреннего использования
  #doc
  Проверка корректности MagOper
  #end
  function CheckMagOper (var buf : #TSoprHozX; var mode : integer) : integer;

  #doc
  Добавляет в MagOper новые записи, удаляет ненужные и исправляет приоритеты (в зависимости от настройки mode)
  #end
  function CheckDelMagOper (buf : #TSoprHozX; var mode : integer) : integer;

  #doc
  Установить контрагента по ХозОперации
  #end
  procedure SetContractor(cOrg : comp);

  #doc
  Получить контрагента по ХозОперации
  #end
  function GetContractor : comp;

  #doc
  Проверка наличия бухпроводок у хозоперации
  #end
  function HaveBuhOborot(acSoprHoz, acPlansSch: comp; awMessage: word): boolean;

  #doc
  Проверка наличия финпроводок у ХозОперации
  #end
  function HaveFpOborot(acSoprHoz, acPlansSch: comp; awMessage: word): boolean;

  #doc
  #Doc_Internal
  Вставка распределения по ДО
  #end
  function InsertRaspred(tSH : TSoprHoz) : comp;

  #doc
  #Doc_Internal
  Удаление распределения по ДО
  #end
  function DeleteRaspred(tSH : TSoprHoz) : boolean;
end;

//******************************************************************************
#doc
Функционал проверки прав доступа на модификацию SoprHoz
#end
ObjInterface ObjSHRightManager;

  //****************************************************************************
  // wMessage - режим вывода сообщений (см. GLOCONST.INC ):
  //  cgiNoMessage      - работа без вывода сообщений
  //  cgiWarningMessage - работа с выводом предупреждений
  //  cgiErrorMessage   - работа с выводом сообщений об ошибках
  //  cgiMessage        - работа с выводом предупреждений и сообщений об ошибках

  //****************************************************************************
  #doc
  Cтроковое описание последней ошибки
  #end
  function GetStLastError : string;

  //****************************************************************************
  #doc
  Можно ли редактировать/удалять все операции по документу
  #end
  function CanEditDoc(
    cDocNRec  : comp;    // NRec документа
    wTiDk     : word;    // Тип документа
    wMessage  : word     // режим вывода сообщений
  ) : boolean;

  //****************************************************************************
  #doc
  Можно ли редактировать/удалять данные по заданному регистру учета
  #end
  function CanEditPlchData(
    cSoprHoz  : comp;    // SoprHoz документа
    cPlansSch : comp;    // план счетов
    wMessage  : word     // режим вывода сообщений
  ) : boolean;

end;

#doc
"Облегченная" функция удаления хозопераций по документу для Управления транспортом
#end
ObjInterface ObjSHmanagerPut;

  #doc
  Удалить все записи по документу
  #end
  function DeleteDocPut(cDocNRec : comp; wTiDk : word) : boolean;

end;

#doc
"Облегченная" функция обновления хозоперации
#end
ObjInterface ObjSHmanagerEx;
  #doc
  Обновить запись с синхронизацией BaseFin, без проверки оборотов
  #end
  function UpdByHanEx(var buf : #TSoprHozX ) : word;
end;

ObjInterface ObjSHmanagerEx2;
   #doc
   Получить полный номер документа по его ссылке
   #end
  function GetLongDocNum(_cSoprDoc : comp; _TiDkGal : word; _NoDoc : string) : string;
end;

ObjInterface ObjSHmanagerEx3;
  #doc
  Инициализация ссылок на договор, соглашение и ПКП в SoprHoz'е
  #end
  Function setDogovor(acSoprHoz: comp; var DogInfo: TDogovorInfo): boolean;

  #doc
  Установить сумму хозоперации
  #end
  Function setSumma(acSoprHoz: comp; var NewSum: TCurrency): boolean;

  #doc
  Разбивает сумму хозоперации на заданную и формирует хозоперацию на непривязанный остаток
  #end
  Function splitSumma(cSource: comp; var Sum: TCurrency; var cDestination: comp; mode: word): boolean;

  #doc
  Поиск сумм SoprHoz ни к чему не привязанных и без проводок
  #end
  Function collectFreeSums(acDoc: comp; awTiDkGal: word): comp;

end;

ObjInterface ObjSHmanagerEx4;
  #doc
  Привязка ДО к хозоперации (без дробления) и пересчета существующих сумм,
  с запуском расчета налогов и авто распределения
  #end
  Function BaseDoc2Soprhoz(cSoprHoz, cBaseDoc : comp; bCreateFOB, bShowMess : boolean) : boolean;
end;

ObjInterface ObjSHmanagerEx5;
  #doc
  Привязка ДО к хозоперации (без дробления) и пересчета существующих сумм,
  bDistr - запуск расчета налогов и авто распределения
  bCreateFOB - формирование ФОБ при привязке ДО
  #end
  Function BaseDoc2SoprhozEx(cSoprHoz, cBaseDoc : comp; bCreateFOB, bDistr, bShowMess : boolean): boolean;
end;

#doc
Расширение 18 объектного интерфейса  ObjSHmanager - функции по работе с доплатой ндс
#end
ObjInterface ObjSHmanagerEx18;

  #doc
  Участвует ли хозоперация в связи доплаты налога с авансом
  #end
  Function isExistLinkWithAvans(_cSoprHoz : comp): boolean;

  #doc
  Является ли хозоперация доплатой НДС
  #end
  Function isSurchargeNDS(_cSoprHoz : comp): boolean;

  #doc
  При наличии связи получить ссылку на другую ХО
  #end
  Function GetLinkWithAvans(_cSoprHoz : comp): comp;

  #doc
  Установить связь между ХО доплатой налога _cSurcharge и ХО авансом _cAvans
  #end
  Function InsertLinkWithAvans(_cAvans, _cSurcharge: comp): boolean;

  #doc
  Удалить связь между доплатой налога и авансом
  #end
  Function DeleteLinkWithAvans(_cSoprHoz: comp): boolean;

  #doc
  Перемещение ссылки на доплату НДС с хозоперации _cSrcRec на хозоперацию _cDstRec
  #end
  Function MoveLinkWithAvansForNDS(_cSrcRec, _cDstRec : comp): boolean;

end;

#doc
Расширение 16 объектного интерфейса  ObjSHmanager
#end
ObjInterface ObjSHmanagerEx16;

  #doc
    Есть ли по хозоперации _cSoprHoz ручные налоги
  #end
  function isManualNal(_cSoprHoz : comp) : boolean;

  #doc
    Разделить ручные налоги хозоперации cOne с хозоперацией cTwo пропорционально их суммам
  #end
  function SplitManualNalFromOneToTwo(_cOne, _cTwo : comp) : boolean;

  #doc
    Перенести ручные налоги хозоперации _cOne в хозоперацию _cTwo
  #end
  function UnionManualNalFromOneToTwo(_cOne, _cTwo : comp) : boolean;

  #doc
    Начало сессии дробления налогов в исходной хозоперации
  #end
  function InitSplitSession(_cSoprHoz : comp) : boolean;

  #doc
    Выполняется ли сессия дробления ручных налогов
  #end
  property isSplitSessionNow : boolean read;

  #doc
    Добавление в сессию дробления налогов дополнительной хозоперации
  #end
  procedure AddToSplitSession(_cSoprHoz : comp);

  #doc
    Раздробить налоги по всем добавленным хозоперациям и завершить сессию
  #end
  function DoAndDoneSplitSession : boolean;

  #doc
    Начало сессии объединения налогов в исходной хозоперации
  #end
  function InitUnionSession(_cSoprHoz : comp) : boolean;

  #doc
    Выполняется ли сессия объединения ручных налогов
  #end
  property isUnionSessionNow : boolean read;

  #doc
    Добавление в сессию объединения налогов дополнительной хозоперации
  #end
  procedure AddToUnionSession(_cSoprHoz : comp);

  #doc
    Раздробить налоги по всем добавленным хозоперациям и завершить сессию
  #end
  function DoAndDoneUnionSession : boolean;

  #doc
    Сброс текущей сессии объединения или разделения
  #end
  function ResetSession : boolean;

end;

#doc
Расширение 17 объектного интерфейса  ObjSHmanager
#end
ObjInterface ObjSHmanagerEx17;

#doc
  Установить в хозоперацию cSubRec ссылку на материнскую хозоперацию cMainRec
#end
function SetLinkToMainSoprHoz(cSubRec, cMainRec : comp) : boolean;

end;

#doc
Расширение 12 объектного интерфейса  ObjSHmanager
#end
ObjInterface ObjSHmanagerEx12;

#doc
  Разбивает сумму хозоперации на заданную и формирует аналогичную хозоперацию на остаток
#end
Function divSumma(cSource: comp; var Sum: TCurrency; var cDestination: comp; mode: word): boolean;

  #doc
  Разбивает хозоперацию на заданную сумму и формирует аналогичную на остаток
  Текущая хозоперация cSource становится с заданной суммой, новая cDestination на сумму остатка
  #end
  Function divSummaEx(cSource: comp; var Sum: TCurrency; var cDestination: comp; mode: word): boolean;

  #doc
  Установить в хозоперацию cSoprHozOne ссылку на финансовую операцию из хозоперации cSoprHozTwo
  #end
  Procedure SetRefToFOP(cSoprHozOne, cSoprHozTwo : comp);

  #doc
  Начало сессии дробления любых налогов в исходной хозоперации
  #end
  function InitAnySplitSession(_cSoprHoz : comp; bOnlyManual : boolean) : boolean;

  #doc
  Раздробить любые налоги по всем добавленным хозоперациям и завершить сессию
  #end
  function DoAndDoneAnySplitSession(bOnlyManual : boolean) : boolean;

  #doc
  Раздробить любые налоги по всем добавленным хозоперациям и завершить сессию
  #end
  function DoAndDoneAnyUnionSession(bOnlyManual : boolean) : boolean;

end;

//******************************************************************************
VipInterface SHManager
  Implements ObjSHmanager, ObjSHRightManager, ObjSHmanagerPut, ObjSHmanagerEx, ObjSHmanagerEx2, ObjSHmanagerEx3, ObjSHmanagerEx4, ObjSHmanagerEx5, ObjSHmanagerEx18, ObjSHmanagerEx16, ObjSHmanagerEx17, ObjSHmanagerEx12
  #ifdef Atl51
  Licensed (Free)
  #end
;

#end
