//------------------------------------------------------------------------------
//                                                      (c) корпорация Галактика
// Галактика 5.8 - Бухгалтерский контур
// Объект работы с таблицей BaseFin
//------------------------------------------------------------------------------

#ifndef _BFManager_Obj_
#define _BFManager_Obj_

#ifdef ComponentVersion
#Component "F_SoprHoz"
#end

#include FinTypes.inc

#doc
Объект работы с таблицей BaseFin
#end
ObjInterface ObjBFManager;

  #doc
  Вставить запись
  #end
#ifdef Gal9_1
  Function InsByHan(var buf: #TBaseFinX): word;
#else
  Function InsByHan(var buf: #TBaseFinX): integer;
#end

  #doc
  Инициализация ссылок на договор, соглашение и ПКП в BaseFin'е
  #end
  Function SetDogovor(acBaseFin: comp; var DogInfo: TDogovorInfo): boolean;

  #doc
  Установить заданную сумму платежа
  #end
  Function SetSumma(acBaseFin: comp; var NewSum: TCurrency): boolean;

  #doc
  Разбивает сумму на заданную и формирует непривязанный остаток
  #end
  Function SplitSumma(cSource: comp; var Sum: TCurrency; var cDestination: comp; mode: word): boolean;

  #doc
  Поиск сумм BaseFin ни к чему не привязанных и без проводок
  #end
  Function CollectFreeSums(acDoc: comp; awTiDkGal: word): comp;

  #doc
  Выбор исполняемого ДО
  #end
  Function Get_BaseDoc(GetMulti: boolean; Dir: word; Vid: word; var PickDoc: comp; var PickStep: comp; var PickOrg: comp; var SumDolga: TSumma): boolean;

  #doc
  Распределение платежа по ДО
  #end
  Function BaseFin_BaseDoc(var cFin: comp; myPlansNo: comp; var myOrg: comp; myDatR: Date; cSF: comp; var myDO: word): boolean;

  #doc
  Внешний просчет Сумовой разницы
  #end
  Function CalcSumRaznica(cRecBF, cRecBD: comp; dat: Date): boolean;
End;

ObjInterface ObjBFManagerEx1;
  #doc
  Группировка сумм BaseFin ни к чему не привязанных и без проводок, но в разрезе договоров
  #end
  Function CollectFreeSumsByDog(acDoc: comp; awTiDkGal: word): boolean;
end;

ObjInterface ObjBFManagerEx2;
  #doc
  Привязка ДО к хозоперации (без дробления) и пересчета существующих сумм,
  с запуском расчета налогов и авто распределения
  #end
  Function BaseDoc2BaseFin(cBaseFin, cBaseDoc : comp; bCreateFOB, bShowMess : boolean): boolean;
end;

ObjInterface ObjBFManagerEx6;
#doc
  Внешний просчет Сумовой разницы в зависимости от страны
#end
  Function RunSumRaznica(cRecBF, cRecBD, cOrg: comp; dDate: date): boolean;
end;

ObjInterface ObjBFManagerEx3;
  #doc
  Привязка ДО к хозоперации (без дробления) и пересчета существующих сумм,
  с возможность включить/выключить формирование ФОБ и расчет налогов с распределением
  #end
  Function BaseDoc2BaseFinEx(cBaseFin, cBaseDoc : comp; bCreateFOB, bDistr, bShowMess : boolean): boolean;
end;

ObjInterface ObjBFManagerEx8;

  #doc
    Есть ли по хозоперации _cBaseFin ручные налоги
  #end
  Function isManualNal(_cBaseFin : comp) : boolean;

  #doc
    Разделить ручные налоги хозоперации _cOneBaseFin с хозоперацией _cTwoBaseFin пропорционально их суммам
  #end
  Function SplitManualNalFromOneToTwo(_cOneBaseFin, _cTwoBaseFin : comp) : boolean;

  #doc
    Перенести ручные налоги хозоперации _cOneBaseFin в хозоперацию _cTwoBaseFin
  #end
  function UnionManualNalFromOneToTwo(_cOneBaseFin, _cTwoBaseFin : comp) : boolean;

  #doc
    Начало сессии дробления налогов в исходной хозоперации
  #end
  function InitSplitSession(_cBaseFin : comp) : boolean;

  #doc
    Выполняется ли сессия дробления ручных налогов
  #end
  property isSplitSessionNow : boolean read;

  #doc
    Добавление в сессию дробления налогов дополнительной хозоперации
  #end
  Procedure AddToSplitSession(_cBaseFin : comp);

  #doc
    Раздробить налоги по всем добавленным хозоперациям и завершить сессию
  #end
  function DoAndDoneSplitSession : boolean;

  #doc
    Начало сессии объединения налогов в исходной хозоперации
  #end
  function InitUnionSession(_cBaseFin : comp) : boolean;

  #doc
    Выполняется ли сессия объединения ручных налогов
  #end
  property isUnionSessionNow : boolean read;

  #doc
    Добавление в сессию объединения налогов дополнительной хозоперации
  #end
  Procedure AddToUnionSession(_cBaseFin : comp);

  #doc
    Раздробить налоги по всем добавленным хозоперациям и завершить сессию
  #end
  function DoAndDoneUnionSession : boolean;

  #doc
    Сброс текущей сессии объединения или разделения
  #end
  function ResetSession : boolean;

end;

ObjInterface ObjBFManagerEx10;
  #doc
    изменить тип налога при привязке ДО на заданный для России при переходе ставки НДС с 18% на 20%
  #end
  Function ShiftNalFinModeByDO(_cBaseFin, _cBaseDoc : comp; _wShiftMode: word): boolean;

  #doc
    изменить тип налога для заданной накладной/акта для России при переходе ставки НДС с 18% на 20%
  #end
  Function ShiftNalFinModeByKatSopr(_cBaseFin, _cKatSopr : comp; _wShiftMode: word): boolean;
end;

ObjInterface ObjBFManagerEx11;

  #doc
  Признак использования настройки - Распределять сумму платежа
  Если False, то всегда выполняется распределение, вне зависимости от настроек
  #end
  Property isDistrByTuneMode: boolean;
end;

ObjInterface ObjBFManagerEx9;

  #doc
    Привязать одно или несколько ДО к одной хозоперации с выполнением дробления
    в разрезе ДО и накладных с обработкой суммовой разницы
  #end
  Function BaseDoc2BaseFinWithSplit(var cFin: comp; var myOrg: comp; myDatR: date; cSF: comp; var myDO: word; var cFreeSplit: comp): boolean;
end;


#end
