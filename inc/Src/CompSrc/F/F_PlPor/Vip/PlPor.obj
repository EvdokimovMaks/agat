//------------------------------------------------------------------------------
//                                                      (c) Корпорация ГАЛАКТИКА
//------------------------------------------------------------------------------
// Галактика 8.0 - Бухгалтерский контур
// Объект обработки платежных документов (PlPor)
//------------------------------------------------------------------------------

#ifndef __PlPor__obj__
#define __PlPor__obj__

#ifdef ComponentVersion
#Component "F_PlPor"
#end

#include TPlPor.vih

//------------------------------------------------------------------------------
// Public-функции для работы с корневой таблицей PlPor
// !!! Внимание : перед их использованием внешними
//                интерфейсами должен быть вызван конструктор InitPlPor,
//                а после окончания работы - деструктор DonePlPor.
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
#doc
Объект обработки платежных документов (PlPor).<br>
<b>Внимание!</b> Перед их использованием внешними интерфейсами должен быть вызван
конструктор InitPlPor, а после окончания работы - деструктор DonePlPor.
#end
ObjInterface ObjPlPor;
  //----------------------------------------------------------------------------
  #doc
  Конструктор
  #end
  procedure InitPlPor(myTip : word; myTipUser : word);
  //----------------------------------------------------------------------------
  #doc
  Загрузить платежный документ по NRec'у
  #end
  function LoadPlPor(myRec : comp) : boolean;
  //----------------------------------------------------------------------------
  #doc
  Снять ограничение по NRec'у
  #end
  procedure UnLoadPlPor;
  //----------------------------------------------------------------------------
  #doc
  Заполнение буфера новой записи по умолчанию
  #end
  function CreateDefault(dForm : date; var buf : TPlPor; setDskDef : word ): Boolean;
  //----------------------------------------------------------------------------
  #doc
  Сохранение текущей записи в базе
  #end
  procedure UpDateRecordPlPor(Summ : double; SumV : double; val : comp; CorrectSH : boolean);
  //----------------------------------------------------------------------------
  #doc
  МЕТОД УСТАРЕВШИЙ! НЕ ИСПОЛЬЗОЛВАТЬ.
  Вместо него использовать PlPorSimple::PlPor_CheckSH. <br>
  Контроллинг изменений в SoprHoz и Oborot
  #end
  function ControlSubOrdinate(PlNRec : comp;      // nrec платежного документа
                             CheckPl : boolean;   // контроль суммы платежа
                            CheckOne : boolean;   // контроль одного SoprHoz
                          CorrectSH  : boolean;   // корректировать SoprHoz
                           CheckProv : boolean)   // контроль сумм проводок
                                     : boolean;
  //----------------------------------------------------------------------------
  #doc
  Печать платежного документа
  #end
  function  PrintPlPor(hnd : TPtr;
                      tmpC : comp;
                     tiRee : word;
                  OutInVal : boolean;
                    GoSopr : boolean;
                  DopParam : word)
                           : boolean;
  //----------------------------------------------------------------------------
  #doc
  Формирование SoprHoz.<br>
  <i>Ранее это был единственный метод TSoprHozObjInterface</i>
  #end
  function InsertSoprHoz(PlNRec : comp; NewNRec : comp) : boolean;
  //----------------------------------------------------------------------------
  #doc
  Деструктор
  #end
  procedure DonePlPor;
  //----------------------------------------------------------------------------
end; // ObjPlPor
//------------------------------------------------------------------------------

ObjInterface ObjPlPorExt;
  //----------------------------------------------------------------------------
  #doc
  Сохранение текущей записи в базе c флагом формирования назначения платежа
  #end
  procedure UpDateRecordPlPorExt(Summ : double; SumV : double; val : comp; CorrectSH : boolean; CreateTempl : boolean);
  //----------------------------------------------------------------------------
end;

ObjInterface ObjPlPorExt1;

  #doc
  Расширение №1 метода PrintPlPor. Печать платежного документа
  #end
  function PrintPlPorExt1(hnd: TPtr;
                         tmpC: comp;
                        tiRee: word;
                     OutInVal: boolean;
                     pg_flag, DopParam: word): boolean;

end;

ObjInterface ObjPlPorExtPrint;
  #doc
  Печать платежного документа с дополнительным параметром
  #end
  function PrintPlPorExt(hnd: TPtr;
                        tmpC: comp;
                       tiRee: word;
                    OutInVal: boolean;
                    pg_flag, DopParam, DopParam2: word): boolean;
  //----------------------------------------------------------------------------
end;

ObjInterface ObjPlPorExtPrint1;
  #doc
  Печать платежного документа с дополнительным параметром
  #end
  Function PrintPlPorExt2(hnd: TPtr;
                         tmpC: comp;
                        tiRee: word;
                     OutInVal, PrintPolSum: boolean;
                     pg_flag, DopParam, DopParam2: word): boolean;
  //----------------------------------------------------------------------------
end;

ObjInterface ObjPlPorExt2;
  //----------------------------------------------------------------------------
  #doc
  Сохранение текущей записи в базе c флагом формирования назначения платежа
  #end
  procedure UpDateRecordPlPorExt2(Summ,
                                  SumV,
                                  Sum1: double;
                                  val: comp;
                                  CorrectSH : boolean;
							   	  CreateTempl : boolean;
                                  CurFld : longint);
  //----------------------------------------------------------------------------
end;

ObjInterface ObjPlPorAlg;
  //----------------------------------------------------------------------------
  #doc
  Формирование назначения платежа с помощью скрипта или LotExpression
  #end
  Function GetAlgValue_NaznPl(cAlg: comp) : string;

  #doc
  Проверка синтаксиса алгоритма в шаблоне формирования назначения платежа
  #end
  Function GetAlgCheckResult(cAlg: comp) : string;
  //----------------------------------------------------------------------------
end;

ObjInterface ObjPlPorRunEditSH;
  //----------------------------------------------------------------------------
  #doc
  Запуск окна редактирования хозоперации платежного документа
  #end
  Function RunWinEditSoprHoz(pcSoprHoz: comp; pwMode: word): boolean;
  //----------------------------------------------------------------------------
End;

ExtensionPoint epOnCreateMenu(MenuID: longint; wTidkGal: word);

#end // __PlPor__obj__
